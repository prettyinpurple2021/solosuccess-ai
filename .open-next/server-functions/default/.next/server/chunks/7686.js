exports.id=7686,exports.ids=[4291,7686],exports.modules={30477:(a,b,c)=>{"use strict";c.d(b,{HG:()=>i,JE:()=>g,fH:()=>h,vF:()=>e,vV:()=>f});class d{constructor(){this.isDevelopment=!1,this.logLevel=this.isDevelopment?3:2}shouldLog(a){return a<=this.logLevel}formatLogEntry(a){let b=["ERROR","WARN","INFO","DEBUG"][a.level],c=`[${a.timestamp}] ${b}: ${a.message}`;return a.context&&Object.keys(a.context).length>0&&(c+=` | Context: ${JSON.stringify(a.context)}`),a.error&&(c+=` | Error: ${a.error.message}`,this.isDevelopment&&a.error.stack&&(c+=` | Stack: ${a.error.stack}`)),c}log(a,b,c,d){if(!this.shouldLog(a))return;let e={level:a,message:b,timestamp:new Date().toISOString(),context:c,error:d},f=this.formatLogEntry(e);0===a&&console.error(f),!this.isDevelopment&&a<=1&&this.sendToExternalService(e)}async sendToExternalService(a){}error(a,b,c){this.log(0,a,b,c)}warn(a,b){this.log(1,a,b)}info(a,b){this.log(2,a,b)}debug(a,b){this.log(3,a,b)}apiLog(a,b,c,d,e){let f=`${a} ${b} - ${c}${d?` (${d}ms)`:""}`,g=c>=500?0:c>=400?1:2;this.log(g,f,{method:a,path:b,statusCode:c,duration:d,...e})}dbLog(a,b,c,d){let e=`DB ${a} on ${b}${c?` (${c}ms)`:""}`;this.log(3,e,{operation:a,table:b,duration:c,...d})}authLog(a,b,c=!0,d){let e=`Auth ${a}${b?` for user ${b}`:""} - ${c?"SUCCESS":"FAILED"}`;this.log(c?2:1,e,{action:a,userId:b,success:c,...d})}}let e=new d,f=(a,b,c)=>{b instanceof Error?e.error(a,void 0,b):"object"==typeof b&&null!==b?e.error(a,b,c):e.error(a,void 0,c)},g=(a,b)=>e.warn(a,b),h=(a,b)=>e.info(a,b),i=(a,b,c,d,f)=>e.apiLog(a,b,c,d,f)},31238:(a,b,c)=>{"use strict";c.d(b,{M:()=>k});var d=c(30477),e=c(97356),f=c(41393),g=c(48689),h=c(71559),i=c(20862);class j{async generateRecommendations(a){try{let b=[];switch(a.opportunityType){case"competitor_weakness":b.push(...await this.generateWeaknessRecommendations(a));break;case"market_gap":b.push(...await this.generateMarketGapRecommendations(a));break;case"pricing_opportunity":b.push(...await this.generatePricingRecommendations(a));break;case"talent_acquisition":b.push(...await this.generateTalentRecommendations(a));break;case"partnership_opportunity":b.push(...await this.generatePartnershipRecommendations(a));break;default:b.push(...await this.generateGenericRecommendations(a))}return b.sort((a,b)=>{let c=this.getPriorityScore(b.priority)-this.getPriorityScore(a.priority);return 0!==c?c:b.expectedROI-a.expectedROI})}catch(a){return(0,d.vV)("Error generating recommendations:",a),[]}}async calculatePriorityScore(a){try{let b=this.calculateImpactScore(a),c=this.calculateEffortScore(a),d=this.calculateTimingScore(a),e=10*a.confidence,f=await this.calculateRiskScore(a),g=await this.calculateResourceScore(a),h=await this.calculateStrategicAlignmentScore(a),i=this.calculateCompetitiveAdvantageScore(a),j=await this.calculateMarketTimingScore(a),k=.25*b+.15*c+.15*d+.1*e+.1*f+.1*g+.1*h+.03*i+.02*j;return{opportunityId:a.id,priorityScore:k,impactScore:b,effortScore:c,timingScore:d,confidenceScore:e,riskScore:f,resourceScore:g,strategicAlignmentScore:h,competitiveAdvantageScore:i,marketTimingScore:j}}catch(b){return(0,d.vV)("Error calculating priority score:",b),{opportunityId:a.id,priorityScore:5,impactScore:5,effortScore:5,timingScore:5,confidenceScore:5,riskScore:5,resourceScore:5,strategicAlignmentScore:5,competitiveAdvantageScore:5,marketTimingScore:5}}}async storeOpportunity(a,b,c,g){try{let[d]=await e.db.insert(f.competitiveOpportunities).values({id:b.id,user_id:a,competitor_id:b.competitorId,opportunity_type:b.opportunityType,title:b.title,description:b.description,confidence:b.confidence.toString(),impact:b.impact,effort:b.effort,timing:b.timing,priority_score:g.priorityScore.toString(),evidence:b.evidence,recommendations:b.recommendations,status:"identified",roi_estimate:this.estimateROI(b).toString(),success_metrics:this.generateSuccessMetrics(b),tags:this.generateTags(b),detected_at:b.detectedAt}).returning();for(let d of c)await e.db.insert(f.opportunityActions).values({opportunity_id:b.id,user_id:a,action_type:d.actionType,title:d.title,description:d.description,priority:d.priority,estimated_effort_hours:d.estimatedEffort,estimated_cost:d.estimatedCost.toString(),expected_outcome:`Expected ROI: ${d.expectedROI}%`,status:"pending"});for(let c of this.generateInitialMetrics(b))await e.db.insert(f.opportunityMetrics).values({opportunity_id:b.id,user_id:a,metric_name:c.name,metric_type:c.type,baseline_value:c.baselineValue?.toString(),target_value:c.targetValue?.toString(),current_value:c.baselineValue?.toString(),unit:c.unit});return b.id}catch(a){throw(0,d.vV)("Error storing opportunity:",a),a}}async getOpportunities(a,b={},c={field:"priority_score",direction:"desc"}){try{let d=[(0,g.eq)(f.competitiveOpportunities.user_id,a)];b.status?.length&&d.push((0,g.RV)(f.competitiveOpportunities.status,b.status)),b.opportunityType?.length&&d.push((0,g.RV)(f.competitiveOpportunities.opportunity_type,b.opportunityType)),b.impact?.length&&d.push((0,g.RV)(f.competitiveOpportunities.impact,b.impact)),b.competitorId&&d.push((0,g.eq)(f.competitiveOpportunities.competitor_id,b.competitorId)),b.minPriorityScore&&d.push((0,g.RO)(f.competitiveOpportunities.priority_score,b.minPriorityScore.toString())),void 0!==b.isArchived&&d.push((0,g.eq)(f.competitiveOpportunities.is_archived,b.isArchived));let i=f.competitiveOpportunities[c.field],j="desc"===c.direction?(0,h.i)(i):(0,h.Y)(i),k=e.db.select({opportunity:f.competitiveOpportunities,competitor:f.competitorProfiles}).from(f.competitiveOpportunities).leftJoin(f.competitorProfiles,(0,g.eq)(f.competitiveOpportunities.competitor_id,f.competitorProfiles.id)).where(d.length>1?(0,g.Uo)(...d):d[0]).orderBy(j);return await k}catch(a){return(0,d.vV)("Error getting opportunities:",a),[]}}async updateOpportunityStatus(a,b,c,h,i){try{let d={status:c,updated_at:new Date};return"in_progress"!==c||h||(d.started_at=new Date),"completed"===c&&(d.completed_at=new Date,d.progress=100),i&&(d.implementation_notes=i),await e.db.update(f.competitiveOpportunities).set(d).where((0,g.Uo)((0,g.eq)(f.competitiveOpportunities.id,a),(0,g.eq)(f.competitiveOpportunities.user_id,b))),!0}catch(a){return(0,d.vV)("Error updating opportunity status:",a),!1}}async trackOpportunityROI(a,b,c,h,i,j){try{return await e.db.update(f.competitiveOpportunities).set({actual_roi:c.toString(),implementation_notes:j,updated_at:new Date}).where((0,g.Uo)((0,g.eq)(f.competitiveOpportunities.id,a),(0,g.eq)(f.competitiveOpportunities.user_id,b))),void 0!==h&&await this.updateMetric(a,b,"revenue",h),void 0!==i&&await this.updateMetric(a,b,"costs",i),!0}catch(a){return(0,d.vV)("Error tracking opportunity ROI:",a),!1}}async updateMetric(a,b,c,h,i){try{let d=await e.db.select().from(f.opportunityMetrics).where((0,g.Uo)((0,g.eq)(f.opportunityMetrics.opportunity_id,a),(0,g.eq)(f.opportunityMetrics.user_id,b),(0,g.eq)(f.opportunityMetrics.metric_name,c))).limit(1);return d.length>0?await e.db.update(f.opportunityMetrics).set({current_value:h.toString(),measurement_date:new Date,notes:i,updated_at:new Date}).where((0,g.eq)(f.opportunityMetrics.id,d[0].id)):await e.db.insert(f.opportunityMetrics).values({opportunity_id:a,user_id:b,metric_name:c,metric_type:"custom",current_value:h.toString(),unit:"units",notes:i}),!0}catch(a){return(0,d.vV)("Error updating metric:",a),!1}}async getOpportunityAnalytics(a,b="month"){try{let c=new Date;c.setDate(c.getDate()-({week:7,month:30,quarter:90,year:365})[b]);let d=await e.db.select({total:(0,i.ll)`count(*)`,completed:(0,i.ll)`count(*) filter (where status = 'completed')`,in_progress:(0,i.ll)`count(*) filter (where status = 'in_progress')`,identified:(0,i.ll)`count(*) filter (where status = 'identified')`,avg_priority:(0,i.ll)`avg(cast(priority_score as decimal))`,total_estimated_roi:(0,i.ll)`sum(cast(roi_estimate as decimal))`,total_actual_roi:(0,i.ll)`sum(cast(actual_roi as decimal))`}).from(f.competitiveOpportunities).where((0,g.Uo)((0,g.eq)(f.competitiveOpportunities.user_id,a),(0,g.RO)(f.competitiveOpportunities.detected_at,c),(0,g.eq)(f.competitiveOpportunities.is_archived,!1))),j=await e.db.select({opportunity_type:f.competitiveOpportunities.opportunity_type,count:(0,i.ll)`count(*)`,avg_priority:(0,i.ll)`avg(cast(priority_score as decimal))`}).from(f.competitiveOpportunities).where((0,g.Uo)((0,g.eq)(f.competitiveOpportunities.user_id,a),(0,g.RO)(f.competitiveOpportunities.detected_at,c),(0,g.eq)(f.competitiveOpportunities.is_archived,!1))).groupBy(f.competitiveOpportunities.opportunity_type),k=await e.db.select().from(f.competitiveOpportunities).where((0,g.Uo)((0,g.eq)(f.competitiveOpportunities.user_id,a),(0,g.AU)((0,g.kZ)(f.competitiveOpportunities.actual_roi)),(0,g.eq)(f.competitiveOpportunities.is_archived,!1))).orderBy((0,h.i)(f.competitiveOpportunities.actual_roi)).limit(5);return{stats:d[0]||{total:0,completed:0,in_progress:0,identified:0,avg_priority:0,total_estimated_roi:0,total_actual_roi:0},byType:j,topPerforming:k,timeframe:b}}catch(a){return(0,d.vV)("Error getting opportunity analytics:",a),null}}async generateWeaknessRecommendations(a){return[{id:`rec_weakness_${Date.now()}_1`,opportunityId:a.id,title:"Develop Superior Solution",description:"Create a product/service that directly addresses the competitor weakness",actionType:"product",priority:"high",estimatedEffort:40,estimatedCost:5e3,expectedROI:150,timeframe:"medium-term",prerequisites:["Market research","Technical feasibility study"],risks:["Development delays","Market timing"],successMetrics:["Customer acquisition","Market share gain"],resources:["Development team","Marketing budget"],confidence:a.confidence,createdAt:new Date},{id:`rec_weakness_${Date.now()}_2`,opportunityId:a.id,title:"Targeted Marketing Campaign",description:"Launch marketing campaign highlighting your advantages over competitor weakness",actionType:"marketing",priority:"medium",estimatedEffort:20,estimatedCost:2e3,expectedROI:80,timeframe:"short-term",prerequisites:["Marketing materials","Target audience analysis"],risks:["Competitor response","Brand perception"],successMetrics:["Lead generation","Brand awareness"],resources:["Marketing team","Creative assets"],confidence:.8*a.confidence,createdAt:new Date}]}async generateMarketGapRecommendations(a){return[{id:`rec_gap_${Date.now()}_1`,opportunityId:a.id,title:"Market Entry Strategy",description:"Develop strategy to enter the identified market gap",actionType:"strategic",priority:"high",estimatedEffort:60,estimatedCost:1e4,expectedROI:200,timeframe:"long-term",prerequisites:["Market analysis","Business plan","Funding"],risks:["Market validation","Competition entry"],successMetrics:["Market penetration","Revenue growth"],resources:["Strategy team","Investment capital"],confidence:a.confidence,createdAt:new Date}]}async generatePricingRecommendations(a){return[{id:`rec_pricing_${Date.now()}_1`,opportunityId:a.id,title:"Pricing Strategy Optimization",description:"Adjust pricing to capitalize on competitor pricing gaps",actionType:"pricing",priority:"high",estimatedEffort:10,estimatedCost:500,expectedROI:120,timeframe:"immediate",prerequisites:["Pricing analysis","Customer research"],risks:["Customer reaction","Margin impact"],successMetrics:["Revenue increase","Market share"],resources:["Pricing team","Analytics tools"],confidence:a.confidence,createdAt:new Date}]}async generateTalentRecommendations(a){return[{id:`rec_talent_${Date.now()}_1`,opportunityId:a.id,title:"Strategic Talent Acquisition",description:"Recruit key talent from competitor during their hiring challenges",actionType:"talent",priority:"medium",estimatedEffort:30,estimatedCost:15e3,expectedROI:100,timeframe:"short-term",prerequisites:["Talent pipeline","Competitive packages"],risks:["Legal issues","Cultural fit"],successMetrics:["Key hires","Team capability"],resources:["HR team","Recruitment budget"],confidence:.7*a.confidence,createdAt:new Date}]}async generatePartnershipRecommendations(a){return[{id:`rec_partnership_${Date.now()}_1`,opportunityId:a.id,title:"Strategic Partnership Development",description:"Develop partnerships to fill gaps left by competitor relationship changes",actionType:"partnership",priority:"medium",estimatedEffort:50,estimatedCost:8e3,expectedROI:90,timeframe:"medium-term",prerequisites:["Partner identification","Value proposition"],risks:["Partnership failure","Integration challenges"],successMetrics:["Partnership deals","Revenue impact"],resources:["Business development","Legal support"],confidence:.6*a.confidence,createdAt:new Date}]}async generateGenericRecommendations(a){return[{id:`rec_generic_${Date.now()}_1`,opportunityId:a.id,title:"Opportunity Research",description:"Conduct detailed research to understand the opportunity better",actionType:"research",priority:"medium",estimatedEffort:15,estimatedCost:1e3,expectedROI:50,timeframe:"short-term",prerequisites:["Research plan"],risks:["Time investment"],successMetrics:["Research insights","Action plan"],resources:["Research team"],confidence:.5*a.confidence,createdAt:new Date}]}getPriorityScore(a){return({low:1,medium:2,high:3,critical:4})[a]||2}calculateImpactScore(a){return({low:2,medium:5,high:8,critical:10})[a.impact]||5}calculateEffortScore(a){return({low:10,medium:6,high:3})[a.effort]||6}calculateTimingScore(a){return({immediate:10,"short-term":8,"medium-term":5,"long-term":3})[a.timing]||5}async calculateRiskScore(a){let b=7;return a.evidence.length<3&&(b-=2),a.confidence<.5&&(b-=2),"partnership_opportunity"===a.opportunityType&&(b-=1),Math.max(1,Math.min(10,b))}async calculateResourceScore(a){return 6}async calculateStrategicAlignmentScore(a){return 7}calculateCompetitiveAdvantageScore(a){return Math.min(10,5*a.confidence+.5*a.evidence.length)}async calculateMarketTimingScore(a){return({immediate:10,"short-term":8,"medium-term":6,"long-term":4})[a.timing]||6}estimateROI(a){return Math.round(({low:50,medium:100,high:200,critical:400}[a.impact]||100)/(({low:1,medium:2,high:4})[a.effort]||2)*a.confidence)}generateSuccessMetrics(a){let b={revenue_impact:{target:1e4,unit:"USD"},market_share:{target:5,unit:"percentage"},customer_acquisition:{target:100,unit:"customers"}};switch(a.opportunityType){case"pricing_opportunity":return{...b,pricing_optimization:{target:15,unit:"percentage"}};case"talent_acquisition":return{...b,key_hires:{target:3,unit:"employees"}};default:return b}}generateTags(a){let b=[a.opportunityType,a.impact,a.timing];return a.evidence.some(a=>"social_media"===a.type)&&b.push("social_media_driven"),a.evidence.some(a=>"pricing_data"===a.type)&&b.push("pricing_related"),b}generateInitialMetrics(a){return[{id:`metric_${Date.now()}_1`,name:"Revenue Impact",type:"revenue",baselineValue:0,targetValue:100*this.estimateROI(a),currentValue:0,unit:"USD",measurementDate:new Date,trend:"stable"},{id:`metric_${Date.now()}_2`,name:"Implementation Progress",type:"efficiency",baselineValue:0,targetValue:100,currentValue:0,unit:"percentage",measurementDate:new Date,trend:"stable"}]}}let k=new j},42981:(a,b,c)=>{"use strict";function d(a,b,c,d){let e,f=(globalThis.__rateLimits||(globalThis.__rateLimits=new Map),(e=globalThis.__rateLimits.get(a))||(e=new Map,globalThis.__rateLimits.set(a,e)),e),g=Date.now(),h=f.get(b);if(!h||g-h.ts>c)return f.set(b,{count:1,ts:g}),{allowed:!0,remaining:d-1};h.count+=1,h.ts=g;let i=Math.max(0,d-h.count);return{allowed:h.count<=d,remaining:i}}async function e(a,b){let c=function(a){let b=a.headers.get("x-forwarded-for");if(b)return b.split(",")[0].trim();let c=a.headers.get("x-real-ip");if(c)return c;let d=a.headers.get("cf-connecting-ip");return d||"127.0.0.1"}(a),e=d(a.url||"default",c,1e3*b.window,b.requests);return{...e,success:e.allowed}}function f(a,b,c,f){if(a instanceof Request&&"object"==typeof b)return e(a,b);if("string"==typeof a&&"string"==typeof b&&c&&f)return d(a,b,c,f);throw Error("Invalid rateLimitByIp arguments")}c.d(b,{E:()=>f})},74291:(a,b,c)=>{"use strict";c.d(b,{_:()=>m,authenticateRequest:()=>l});var d=c(30477);c(10641);var e=c(86802),f=c(80829),g=c.n(f),h=c(94570),i=c(41393),j=c(48689);async function k(){try{let a=await (0,e.b3)(),b=a.get("authorization"),c=null;if(b&&b.startsWith("Bearer "))c=b.substring(7);else{let b=a.get("cookie");b&&(c=b.split(";").reduce((a,b)=>{let[c,d]=b.trim().split("=");return a[c]=d,a},{}).auth_token||null)}if(!c)return null;let d=g().verify(c,"local-development-jwt-secret-key");if(!d||!d.userId)return null;let f=(0,h.Lf)(),k=await f.select({id:i.users.id,email:i.users.email,full_name:i.users.full_name,username:i.users.username,date_of_birth:i.users.date_of_birth,created_at:i.users.created_at,updated_at:i.users.updated_at,subscription_tier:i.users.subscription_tier,subscription_status:i.users.subscription_status}).from(i.users).where((0,j.eq)(i.users.id,d.userId)).limit(1);if(0===k.length)return null;let l=k[0];return{id:l.id,email:l.email,full_name:l.full_name,name:l.full_name,username:l.username,created_at:l.created_at,updated_at:l.updated_at,subscription_tier:l.subscription_tier??"free",subscription_status:l.subscription_status??"active"}}catch(a){return(0,d.vV)("JWT authentication error:",a),null}}async function l(){try{let a=await k();if(a)return{user:a,error:null};return{user:null,error:"No authenticated user session found"}}catch(a){return(0,d.vV)("Authentication error:",a),{user:null,error:"Authentication failed"}}}async function m(a){try{let a=await l();return{user:a.user||void 0,error:a.error||void 0}}catch(a){return(0,d.vV)("verifyAuth error:",a),{error:"Authentication failed"}}}},78335:()=>{},96487:()=>{},97356:(a,b,c)=>{"use strict";c.d(b,{db:()=>d.db});var d=c(94570);c(41393)}};