"use strict";exports.id=5415,exports.ids=[5415],exports.modules={22365:(a,b,c)=>{c.d(b,{eU:()=>g});let d=[],e=0,f=0,g=a=>{let b=[],c={get:()=>(c.lc||c.listen(()=>{})(),c.value),lc:0,listen:a=>(c.lc=b.push(a),()=>{for(let b=e+4;b<d.length;)d[b]===a?d.splice(b,4):b+=4;let f=b.indexOf(a);~f&&(b.splice(f,1),--c.lc||c.off())}),notify(a,g){f++;let h=!d.length;for(let e of b)d.push(e,c.value,a,g);if(h){for(e=0;e<d.length;e+=4)d[e](d[e+1],d[e+2],d[e+3]);d.length=0}},off(){},set(a){let b=c.value;b!==a&&(c.value=a,c.notify(b))},subscribe(a){let b=c.listen(a);return a(c.value),b},value:a};return c}},23581:(a,b,c)=>{c.d(b,{B:()=>d});class d extends Error{constructor(a,b){super(a),this.name="BetterAuthError",this.message=a,this.cause=b,this.stack=""}}},30787:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return i}});let d=function(a,b){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=e(b);if(c&&c.has(a))return c.get(a);var d={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(d,g,h):d[g]=a[g]}return d.default=a,c&&c.set(a,d),d}(c(74515));function e(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(e=function(a){return a?c:b})(a)}let f={current:null},g="function"==typeof d.cache?d.cache:a=>a,h=console.warn;function i(a){return function(...b){h(a(...b))}}g(a=>{try{h(f.current)}finally{f.current=null}})},31851:(a,b,c)=>{c.d(b,{e:()=>f});let d=Object.create(null),e=a=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(a?d:globalThis),f=new Proxy(d,{get:(a,b)=>e()[b]??d[b],has:(a,b)=>b in e()||b in d,set:(a,b,c)=>(e(!0)[b]=c,!0),deleteProperty(a,b){if(!b)return!1;let c=e(!0);return delete c[b],!0},ownKeys:()=>Object.keys(e(!0))});"undefined"!=typeof process&&process.env},67501:(a,b,c)=>{c.d(b,{u:()=>g});var d=c(22365);let e=(a,b)=>((a,b,c,d)=>(a.events=a.events||{},a.events[15]||(a.events[15]=d(b=>{a.events[c].reduceRight((a,b)=>(b(a),a),{shared:{},...b})})),a.events[c]=a.events[c]||[],a.events[c].push(b),()=>{let d=a.events[c],e=d.indexOf(b);d.splice(e,1),d.length||(delete a.events[c],a.events[c+10](),delete a.events[c+10])}))(a,c=>{let d=b(c);d&&a.events[6].push(d)},5,b=>{let c=a.listen;a.listen=(...d)=>(a.lc||a.active||(a.active=!0,b()),c(...d));let d=a.off;return a.events[6]=[],a.off=()=>{d(),setTimeout(()=>{if(a.active&&!a.lc){for(let b of(a.active=!1,a.events[6]))b();a.events[6]=[]}},1e3)},()=>{a.listen=c,a.off=d}}),f="undefined"==typeof window,g=(a,b,c,g)=>{let h=(0,d.eU)({data:null,error:null,isPending:!0,isRefetching:!1,refetch:a=>i(a)}),i=a=>{let d="function"==typeof g?g({data:h.get().data,error:h.get().error,isPending:h.get().isPending}):g;c(b,{...d,query:{...d?.query,...a?.query},async onSuccess(a){h.set({data:a.data,error:null,isPending:!1,isRefetching:!1,refetch:h.value.refetch}),await d?.onSuccess?.(a)},async onError(a){let{request:b}=a,c="number"==typeof b.retry?b.retry:b.retry?.attempts,e=b.retryAttempt||0;c&&e<c||(h.set({error:a.error,data:null,isPending:!1,isRefetching:!1,refetch:h.value.refetch}),await d?.onError?.(a))},async onRequest(a){let b=h.get();h.set({isPending:null===b.data,data:b.data,error:null,isRefetching:!0,refetch:h.value.refetch}),await d?.onRequest?.(a)}}).catch(a=>{h.set({error:a,data:null,isPending:!1,isRefetching:!1,refetch:h.value.refetch})})};a=Array.isArray(a)?a:[a];let j=!1;for(let b of a)b.subscribe(()=>{f||(j?i():e(h,()=>{let a=setTimeout(()=>{j||(i(),j=!0)},0);return()=>{h.off(),b.off(),clearTimeout(a)}}))});return h}},71430:(a,b,c)=>{c.d(b,{MB:()=>o});var d=c(75562),e=c(31851),f=c(23581);function g(a,b="/api/auth"){return!function(a){try{let b=new URL(a);return"/"!==b.pathname}catch(b){throw new f.B(`Invalid base URL: ${a}. Please provide a valid base URL.`)}}(a)?(b=b.startsWith("/")?b:`/${b}`,`${a.replace(/\/+$/,"")}${b}`):a}var h=c(22365),i=c(67501);let j={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},k=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,l={true:!0,false:!1,null:null,undefined:void 0,nan:NaN,infinity:1/0,"-infinity":-1/0},m=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/,n={id:"redirect",name:"Redirect",hooks:{onSuccess(a){if(a.data?.url&&a.data?.redirect&&"undefined"!=typeof window&&window.location&&window.location)try{window.location.href=a.data.url}catch{}}}};function o(a){var b;let{pluginPathMethods:c,pluginsActions:o,pluginsAtoms:p,$fetch:q,atomListeners:r,$store:s}=((a,b)=>{let c="credentials"in Request.prototype,o=function(a,b,c,d){if(a)return g(a,b);if(!1!==d){let a=e.e.BETTER_AUTH_URL||e.e.NEXT_PUBLIC_BETTER_AUTH_URL||e.e.PUBLIC_BETTER_AUTH_URL||e.e.NUXT_PUBLIC_BETTER_AUTH_URL||e.e.NUXT_PUBLIC_AUTH_URL||("/"!==e.e.BASE_URL?e.e.BASE_URL:void 0);if(a)return g(a,b)}let h=c?.headers.get("x-forwarded-host"),i=c?.headers.get("x-forwarded-proto");if(h&&i)return g(`${i}://${h}`,b);if(c){let a=function(a){try{return new URL(a).origin}catch(a){return null}}(c.url);if(!a)throw new f.B("Could not get origin from request. Please provide a valid base URL.");return g(a,b)}if("undefined"!=typeof window&&window.location)return g(window.location.origin,b)}(a?.baseURL,a?.basePath,void 0,void 0)??"/api/auth",p=a?.plugins?.flatMap(a=>a.fetchPlugins).filter(a=>void 0!==a)||[],q={id:"lifecycle-hooks",name:"lifecycle-hooks",hooks:{onSuccess:a?.fetchOptions?.onSuccess,onError:a?.fetchOptions?.onError,onRequest:a?.fetchOptions?.onRequest,onResponse:a?.fetchOptions?.onResponse}},{onSuccess:r,onError:s,onRequest:t,onResponse:u,...v}=a?.fetchOptions||{},w=(0,d.Hy)({baseURL:o,...c?{credentials:"include"}:{},method:"GET",jsonParser:a=>a?function(a,b={strict:!0}){return function(a,b={}){let{strict:c=!1,warnings:d=!1,reviver:e,parseDates:f=!0}=b;if("string"!=typeof a)return a;let g=a.trim();if(g.length>0&&'"'===g[0]&&g.endsWith('"')&&!g.slice(1,-1).includes('"'))return g.slice(1,-1);let h=g.toLowerCase();if(h.length<=9&&h in l)return l[h];if(!k.test(g)){if(c)throw SyntaxError("[better-json] Invalid JSON");return a}if(Object.entries(j).some(([a,b])=>{let c=b.test(g);return c&&d&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${a} pattern`),c})&&c)throw Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(g,(a,b)=>{if("__proto__"===a||"constructor"===a&&b&&"object"==typeof b&&"prototype"in b){d&&console.warn(`[better-json] Dropping "${a}" key to prevent prototype pollution`);return}if(f&&"string"==typeof b){let a=function(a){let b=m.exec(a);if(!b)return null;let[,c,d,e,f,g,h,i,j,k,l]=b,n=new Date(Date.UTC(parseInt(c,10),parseInt(d,10)-1,parseInt(e,10),parseInt(f,10),parseInt(g,10),parseInt(h,10),i?parseInt(i.padEnd(3,"0"),10):0));if(j){let a=(60*parseInt(k,10)+parseInt(l,10))*("+"===j?-1:1);n.setUTCMinutes(n.getUTCMinutes()+a)}return n instanceof Date&&!isNaN(n.getTime())?n:null}(b);if(a)return a}return e?e(a,b):b})}catch(b){if(c)throw b;return a}}(a,b)}(a,{strict:!1}):null,customFetchImpl:fetch,...v,plugins:[q,...v.plugins||[],...a?.disableDefaultFetchPlugins?[]:[n],...p]}),{$sessionSignal:x,session:y}=function(a){let b=(0,h.eU)(!1);return{session:(0,i.u)(b,"/get-session",a,{method:"GET"}),$sessionSignal:b}}(w),z=a?.plugins||[],A={},B={$sessionSignal:x,session:y},C={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"},D=[{signal:"$sessionSignal",matcher:a=>"/sign-out"===a||"/update-user"===a||a.startsWith("/sign-in")||a.startsWith("/sign-up")||"/delete-user"===a||"/verify-email"===a}];for(let a of z)a.getAtoms&&Object.assign(B,a.getAtoms?.(w)),a.pathMethods&&Object.assign(C,a.pathMethods),a.atomListeners&&D.push(...a.atomListeners);let E={notify:a=>{B[a].set(!B[a].get())},listen:(a,b)=>{B[a].subscribe(b)},atoms:B};for(let b of z)b.getActions&&Object.assign(A,b.getActions?.(w,E,a));return{get baseURL(){return o},pluginsActions:A,pluginsAtoms:B,pluginPathMethods:C,atomListeners:D,$fetch:w,$store:E}})(a),t={};for(let[a,b]of Object.entries(p))t[`use${a.charAt(0).toUpperCase()+a.slice(1)}`]=b;return b={...o,...t,$fetch:q,$store:s},function a(d=[]){return new Proxy(function(){},{get(c,e){var f;if("then"===e||"catch"===e||"finally"===e)return;let g=[...d,e],h=b;for(let a of g)if(h&&"object"==typeof h&&a in h)h=h[a];else{h=void 0;break}return"function"==typeof h?h:"object"==typeof(f=h)&&null!==f&&"get"in f&&"function"==typeof f.get&&"lc"in f&&"number"==typeof f.lc?h:a(g)},apply:async(a,b,e)=>{let f="/"+d.map(a=>a.replace(/[A-Z]/g,a=>`-${a.toLowerCase()}`)).join("/"),g=e[0]||{},h=e[1]||{},{query:i,fetchOptions:j,...k}=g,l={...h,...j},m=function(a,b,c){let d=b[a],{fetchOptions:e,query:f,...g}=c||{};return d||(e?.method?e.method:g&&Object.keys(g).length>0?"POST":"GET")}(f,c,g);return await q(f,{...l,body:"GET"===m?void 0:{...k,...l?.body||{}},query:i||l?.query,method:m,async onSuccess(a){await l?.onSuccess?.(a);let b=r?.find(a=>a.matcher(f));if(!b)return;let c=p[b.signal];if(!c)return;let d=c.get();setTimeout(()=>{c.set(!d)},10)}})}})}()}},75562:(a,b,c)=>{c.d(b,{Hy:()=>z});var d=Object.defineProperty,e=Object.defineProperties,f=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,j=(a,b,c)=>b in a?d(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,k=(a,b)=>{for(var c in b||(b={}))h.call(b,c)&&j(a,c,b[c]);if(g)for(var c of g(b))i.call(b,c)&&j(a,c,b[c]);return a},l=(a,b)=>e(a,f(b)),m=class extends Error{constructor(a,b,c){super(b||a.toString(),{cause:c}),this.status=a,this.statusText=b,this.error=c}},n=async(a,b)=>{var c,d,e,f,g,h;let i=b||{},j={onRequest:[null==b?void 0:b.onRequest],onResponse:[null==b?void 0:b.onResponse],onSuccess:[null==b?void 0:b.onSuccess],onError:[null==b?void 0:b.onError],onRetry:[null==b?void 0:b.onRetry]};if(!b||!(null==b?void 0:b.plugins))return{url:a,options:i,hooks:j};for(let k of(null==b?void 0:b.plugins)||[]){if(k.init){let d=await (null==(c=k.init)?void 0:c.call(k,a.toString(),b));i=d.options||i,a=d.url}j.onRequest.push(null==(d=k.hooks)?void 0:d.onRequest),j.onResponse.push(null==(e=k.hooks)?void 0:e.onResponse),j.onSuccess.push(null==(f=k.hooks)?void 0:f.onSuccess),j.onError.push(null==(g=k.hooks)?void 0:g.onError),j.onRetry.push(null==(h=k.hooks)?void 0:h.onRetry)}return{url:a,options:i,hooks:j}},o=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(){return this.options.delay}},p=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(a){return Math.min(this.options.maxDelay,this.options.baseDelay*2**a)}},q=async a=>{let b={},c=async a=>"function"==typeof a?await a():a;if(null==a?void 0:a.auth){if("Bearer"===a.auth.type){let d=await c(a.auth.token);if(!d)return b;b.authorization=`Bearer ${d}`}else if("Basic"===a.auth.type){let d=c(a.auth.username),e=c(a.auth.password);if(!d||!e)return b;b.authorization=`Basic ${btoa(`${d}:${e}`)}`}else if("Custom"===a.auth.type){let d=c(a.auth.value);if(!d)return b;b.authorization=`${c(a.auth.prefix)} ${d}`}}return b},r=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function s(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}function t(a){try{return JSON.parse(a)}catch(b){return a}}function u(a){return"function"==typeof a}async function v(a){let b=new Headers(null==a?void 0:a.headers);for(let[c,d]of Object.entries(await q(a)||{}))b.set(c,d);if(!b.has("content-type")){let c=s(null==a?void 0:a.body)?"application/json":null;c&&b.set("content-type",c)}return b}var w=class a extends Error{constructor(b,c){super(c||JSON.stringify(b,null,2)),this.issues=b,Object.setPrototypeOf(this,a.prototype)}};async function x(a,b){let c=await a["~standard"].validate(b);if(c.issues)throw new w(c.issues);return c.value}var y=["get","post","put","patch","delete"],z=a=>async function(b,c){let d,e=l(k(k({},a),c),{plugins:[...(null==a?void 0:a.plugins)||[],(d=a||{},{id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(a,b){var c,e,f,g;let h=(null==(e=null==(c=d.plugins)?void 0:c.find(b=>{var c;return null!=(c=b.schema)&&!!c.config&&(a.startsWith(b.schema.config.baseURL||"")||a.startsWith(b.schema.config.prefix||""))}))?void 0:e.schema)||d.schema;if(h){let c=a;(null==(f=h.config)?void 0:f.prefix)&&c.startsWith(h.config.prefix)&&(c=c.replace(h.config.prefix,""),h.config.baseURL&&(a=a.replace(h.config.prefix,h.config.baseURL))),(null==(g=h.config)?void 0:g.baseURL)&&c.startsWith(h.config.baseURL)&&(c=c.replace(h.config.baseURL,""));let d=h.schema[c];if(d){let c=l(k({},b),{method:d.method,output:d.output});return(null==b?void 0:b.disableValidation)||(c=l(k({},c),{body:d.input?await x(d.input,null==b?void 0:b.body):null==b?void 0:b.body,params:d.params?await x(d.params,null==b?void 0:b.params):null==b?void 0:b.params,query:d.query?await x(d.query,null==b?void 0:b.query):null==b?void 0:b.query})),{url:a,options:c}}}return{url:a,options:b}}})]});if(null==a?void 0:a.catchAllError)try{return await A(b,e)}catch(a){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:a}}}return await A(b,e)},A=async(a,b)=>{var c,d,e,f,g,h,i,j;let{hooks:q,url:w,options:z}=await n(a,b),B=function(a){if(null==a?void 0:a.customFetchImpl)return a.customFetchImpl;if("undefined"!=typeof globalThis&&u(globalThis.fetch))return globalThis.fetch;if("undefined"!=typeof window&&u(window.fetch))return window.fetch;throw Error("No fetch implementation found")}(z),C=new AbortController,D=null!=(c=z.signal)?c:C.signal,E=function(a,b){let{baseURL:c,params:d,query:e}=b||{query:{},params:{},baseURL:""},f=a.startsWith("http")?a.split("/").slice(0,3).join("/"):c||"";if(a.startsWith("@")){let b=a.toString().split("@")[1].split("/")[0];y.includes(b)&&(a=a.replace(`@${b}/`,"/"))}f.endsWith("/")||(f+="/");let[g,h]=a.replace(f,"").split("?"),i=new URLSearchParams(h);for(let[a,b]of Object.entries(e||{}))null!=b&&i.set(a,String(b));if(d)if(Array.isArray(d))for(let[a,b]of g.split("/").filter(a=>a.startsWith(":")).entries()){let c=d[a];g=g.replace(b,c)}else for(let[a,b]of Object.entries(d))g=g.replace(`:${a}`,String(b));(g=g.split("/").map(encodeURIComponent).join("/")).startsWith("/")&&(g=g.slice(1));let j=i.toString();return(j=j.length>0?`?${j}`.replace(/\+/g,"%20"):"",f.startsWith("http"))?new URL(`${g}${j}`,f):`${f}${g}${j}`}(w,z),F=function(a){if(!(null==a?void 0:a.body))return null;let b=new Headers(null==a?void 0:a.headers);if(s(a.body)&&!b.has("content-type")){for(let[b,c]of Object.entries(null==a?void 0:a.body))c instanceof Date&&(a.body[b]=c.toISOString());return JSON.stringify(a.body)}return a.body}(z),G=await v(z),H=function(a,b){var c;if(null==b?void 0:b.method)return b.method.toUpperCase();if(a.startsWith("@")){let d=null==(c=a.split("@")[1])?void 0:c.split("/")[0];return y.includes(d)?d.toUpperCase():(null==b?void 0:b.body)?"POST":"GET"}return(null==b?void 0:b.body)?"POST":"GET"}(w,z),I=l(k({},z),{url:E,headers:G,body:F,method:H,signal:D});for(let a of q.onRequest)if(a){let b=await a(I);b instanceof Object&&(I=b)}("pipeTo"in I&&"function"==typeof I.pipeTo||"function"==typeof(null==(d=null==b?void 0:b.body)?void 0:d.pipe))&&!("duplex"in I)&&(I.duplex="half");let{clearTimeout:J}=function(a,b){let c;return!(null==a?void 0:a.signal)&&(null==a?void 0:a.timeout)&&(c=setTimeout(()=>null==b?void 0:b.abort(),null==a?void 0:a.timeout)),{abortTimeout:c,clearTimeout:()=>{c&&clearTimeout(c)}}}(z,C),K=await B(I.url,I);J();let L={response:K,request:I};for(let a of q.onResponse)if(a){let c=await a(l(k({},L),{response:(null==(e=null==b?void 0:b.hookOptions)?void 0:e.cloneResponse)?K.clone():K}));c instanceof Response?K=c:c instanceof Object&&(K=c.response)}if(K.ok){if("HEAD"===I.method)return{data:"",error:null};let a=function(a){let b=a.headers.get("content-type"),c=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!b)return"json";let d=b.split(";").shift()||"";return r.test(d)?"json":c.has(d)||d.startsWith("text/")?"text":"blob"}(K),c={data:"",response:K,request:I};if("json"===a||"text"===a){let a=await K.text(),b=null!=(f=I.jsonParser)?f:t;c.data=await b(a)}else c.data=await K[a]();for(let a of((null==I?void 0:I.output)&&I.output&&!I.disableValidation&&(c.data=await x(I.output,c.data)),q.onSuccess))a&&await a(l(k({},c),{response:(null==(g=null==b?void 0:b.hookOptions)?void 0:g.cloneResponse)?K.clone():K}));return(null==b?void 0:b.throw)?c.data:{data:c.data,error:null}}let M=null!=(h=null==b?void 0:b.jsonParser)?h:t,N=await K.text(),O=function(a){try{return JSON.parse(a),!0}catch(a){return!1}}(N),P=O?await M(N):null,Q={response:K,responseText:N,request:I,error:l(k({},P),{status:K.status,statusText:K.statusText})};for(let a of q.onError)a&&await a(l(k({},Q),{response:(null==(i=null==b?void 0:b.hookOptions)?void 0:i.cloneResponse)?K.clone():K}));if(null==b?void 0:b.retry){let c=function(a){if("number"==typeof a)return new o({type:"linear",attempts:a,delay:1e3});switch(a.type){case"linear":return new o(a);case"exponential":return new p(a);default:throw Error("Invalid retry strategy")}}(b.retry),d=null!=(j=b.retryAttempt)?j:0;if(await c.shouldAttemptRetry(d,K)){for(let a of q.onRetry)a&&await a(L);let e=c.getDelay(d);return await new Promise(a=>setTimeout(a,e)),await A(a,l(k({},b),{retryAttempt:d+1}))}}if(null==b?void 0:b.throw)throw new m(K.status,K.statusText,O?P:N);return{data:null,error:l(k({},P),{status:K.status,statusText:K.statusText})}}},79578:(a,b,c)=>{c.d(b,{N$:()=>B,jz:()=>A,KM:()=>z,NA:()=>x});var d=c(22365);c(75562),c(31851);var e=c(67501),f=c(23581);function g(a){return{newRole:a=>{var b;return{authorize(a,c="AND"){let d=!1;for(let[e,g]of Object.entries(a)){let a=b[e];if(!a)return{success:!1,error:`You are not allowed to access resource: ${e}`};if(Array.isArray(g))d=g.every(b=>a.includes(b));else if("object"==typeof g)d="OR"===g.connector?g.actions.some(b=>a.includes(b)):g.actions.every(b=>a.includes(b));else throw new f.B("Invalid access control request");if(d&&"OR"===c)return{success:d};if(!d&&"AND"===c)return{success:!1,error:`unauthorized to access resource "${e}"`}}return d?{success:d}:{success:!1,error:"Not authorized"}},statements:b=a}},statements:a}}let h=g({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"],ac:["create","read","update","delete"]});function i(a){let b=new Uint8Array(a),c="";for(let a of b)c+=String.fromCharCode(a);return btoa(c).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function j(a){let b=a.replace(/-/g,"+").replace(/_/g,"/"),c=(4-b.length%4)%4,d=atob(b.padEnd(b.length+c,"=")),e=new ArrayBuffer(d.length),f=new Uint8Array(e);for(let a=0;a<d.length;a++)f[a]=d.charCodeAt(a);return e}function k(){return l.stubThis(globalThis?.PublicKeyCredential!==void 0&&"function"==typeof globalThis.PublicKeyCredential)}h.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"],team:["create","update","delete"],ac:["create","read","update","delete"]}),h.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"],ac:["create","read","update","delete"]}),h.newRole({organization:[],member:[],invitation:[],team:[],ac:["read"]});let l={stubThis:a=>a};function m(a){let{id:b}=a;return{...a,id:j(b),transports:a.transports}}function n(a){return"localhost"===a||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(a)}class o extends Error{constructor({message:a,code:b,cause:c,name:d}){super(a,{cause:c}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=d??c.name,this.code=b}}class p{constructor(){Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}createNewAbortSignal(){if(this.controller){let a=Error("Cancelling existing WebAuthn API call for new one");a.name="AbortError",this.controller.abort(a)}let a=new AbortController;return this.controller=a,a.signal}cancelCeremony(){if(this.controller){let a=Error("Manually cancelling existing WebAuthn API call");a.name="AbortError",this.controller.abort(a),this.controller=void 0}}}let q=new p,r=["cross-platform","platform"];function s(a){if(a&&!(0>r.indexOf(a)))return a}async function t(a){let b,c,d,e,f;!a.optionsJSON&&a.challenge&&(console.warn("startRegistration() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),a={optionsJSON:a});let{optionsJSON:g,useAutoRegister:h=!1}=a;if(!k())throw Error("WebAuthn is not supported in this browser");let l={...g,challenge:j(g.challenge),user:{...g.user,id:j(g.user.id)},excludeCredentials:g.excludeCredentials?.map(m)},p={};h&&(p.mediation="conditional"),p.publicKey=l,p.signal=q.createNewAbortSignal();try{b=await navigator.credentials.create(p)}catch(a){throw function({error:a,options:b}){let{publicKey:c}=b;if(!c)throw Error("options was missing required publicKey property");if("AbortError"===a.name){if(b.signal instanceof AbortSignal)return new o({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else if("ConstraintError"===a.name){if(c.authenticatorSelection?.requireResidentKey===!0)return new o({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:a});else if("conditional"===b.mediation&&c.authenticatorSelection?.userVerification==="required")return new o({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:a});else if(c.authenticatorSelection?.userVerification==="required")return new o({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:a})}else if("InvalidStateError"===a.name)return new o({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:a});else if("NotAllowedError"===a.name)return new o({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});else if("NotSupportedError"===a.name)return new o(0===c.pubKeyCredParams.filter(a=>"public-key"===a.type).length?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:a}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:a});else if("SecurityError"===a.name){let b=globalThis.location.hostname;if(!n(b))return new o({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a});if(c.rp.id!==b)return new o({message:`The RP ID "${c.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else if("TypeError"===a.name){if(c.user.id.byteLength<1||c.user.id.byteLength>64)return new o({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:a})}else if("UnknownError"===a.name)return new o({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a});return a}({error:a,options:p})}if(!b)throw Error("Registration was not completed");let{id:r,rawId:t,response:v,type:w}=b;if("function"==typeof v.getTransports&&(d=v.getTransports()),"function"==typeof v.getPublicKeyAlgorithm)try{e=v.getPublicKeyAlgorithm()}catch(a){u("getPublicKeyAlgorithm()",a)}if("function"==typeof v.getPublicKey)try{let a=v.getPublicKey();null!==a&&(f=i(a))}catch(a){u("getPublicKey()",a)}if("function"==typeof v.getAuthenticatorData)try{c=i(v.getAuthenticatorData())}catch(a){u("getAuthenticatorData()",a)}return{id:r,rawId:i(t),response:{attestationObject:i(v.attestationObject),clientDataJSON:i(v.clientDataJSON),transports:d,publicKeyAlgorithm:e,publicKey:f,authenticatorData:c},type:w,clientExtensionResults:b.getClientExtensionResults(),authenticatorAttachment:s(b.authenticatorAttachment)}}function u(a,b){console.warn(`The browser extension that intercepted this WebAuthn API call incorrectly implemented ${a}. You should report this error to them.
`,b)}let v={stubThis:a=>a};async function w(a){let b,c,d;!a.optionsJSON&&a.challenge&&(console.warn("startAuthentication() was not called correctly. It will try to continue with the provided options, but this call should be refactored to use the expected call structure instead. See https://simplewebauthn.dev/docs/packages/browser#typeerror-cannot-read-properties-of-undefined-reading-challenge for more information."),a={optionsJSON:a});let{optionsJSON:e,useBrowserAutofill:f=!1,verifyBrowserAutofillInput:g=!0}=a;if(!k())throw Error("WebAuthn is not supported in this browser");e.allowCredentials?.length!==0&&(b=e.allowCredentials?.map(m));let h={...e,challenge:j(e.challenge),allowCredentials:b},l={};if(f){if(!await function(){if(!k())return v.stubThis(new Promise(a=>a(!1)));let a=globalThis.PublicKeyCredential;return a?.isConditionalMediationAvailable===void 0?v.stubThis(new Promise(a=>a(!1))):v.stubThis(a.isConditionalMediationAvailable())}())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete$='webauthn']").length<1&&g)throw Error('No <input> with "webauthn" as the only or last value in its `autocomplete` attribute was detected');l.mediation="conditional",h.allowCredentials=[]}l.publicKey=h,l.signal=q.createNewAbortSignal();try{c=await navigator.credentials.get(l)}catch(a){throw function({error:a,options:b}){let{publicKey:c}=b;if(!c)throw Error("options was missing required publicKey property");if("AbortError"===a.name){if(b.signal instanceof AbortSignal)return new o({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else if("NotAllowedError"===a.name)return new o({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});else if("SecurityError"===a.name){let b=globalThis.location.hostname;if(!n(b))return new o({message:`${globalThis.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a});if(c.rpId!==b)return new o({message:`The RP ID "${c.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else if("UnknownError"===a.name)return new o({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a});return a}({error:a,options:l})}if(!c)throw Error("Authentication was not completed");let{id:p,rawId:r,response:t,type:u}=c;return t.userHandle&&(d=i(t.userHandle)),{id:p,rawId:i(r),response:{authenticatorData:i(t.authenticatorData),clientDataJSON:i(t.clientDataJSON),signature:i(t.signature),userHandle:d},type:u,clientExtensionResults:c.getClientExtensionResults(),authenticatorAttachment:s(c.authenticatorAttachment)}}let x=a=>({id:"two-factor",$InferServerPlugin:{},atomListeners:[{matcher:a=>a.startsWith("/two-factor/"),signal:"$sessionSignal"}],pathMethods:{"/two-factor/disable":"POST","/two-factor/enable":"POST","/two-factor/send-otp":"POST","/two-factor/generate-backup-codes":"POST"},fetchPlugins:[{id:"two-factor",name:"two-factor",hooks:{async onSuccess(b){b.data?.twoFactorRedirect&&a?.onTwoFactorRedirect&&await a.onTwoFactorRedirect()}}}]}),y=g({user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]});y.newRole({user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]}),y.newRole({user:[],session:[]});let z=()=>{let a=(0,d.eU)();return{id:"passkey",$InferServerPlugin:{},getActions:b=>((a,{$listPasskeys:b})=>({signIn:{passkey:async(b,c)=>{let d=await a("/passkey/generate-authenticate-options",{method:"POST"});if(!d.data)return d;try{let e=await w({optionsJSON:d.data,useBrowserAutofill:b?.autoFill});return await a("/passkey/verify-authentication",{body:{response:e},...b?.fetchOptions,...c,method:"POST"})}catch(a){return{data:null,error:{code:"AUTH_CANCELLED",message:"auth cancelled",status:400,statusText:"BAD_REQUEST"}}}}},passkey:{addPasskey:async(c,d)=>{let e=await a("/passkey/generate-register-options",{method:"GET",query:{...c?.authenticatorAttachment&&{authenticatorAttachment:c.authenticatorAttachment},...c?.name&&{name:c.name}}});if(!e.data)return e;try{let f=await t({optionsJSON:e.data,useAutoRegister:c?.useAutoRegister}),g=await a("/passkey/verify-registration",{...c?.fetchOptions,...d,body:{response:f,name:c?.name},method:"POST"});if(!g.data)return g;b.set(Math.random())}catch(a){if(a instanceof o){if("ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED"===a.code)return{data:null,error:{code:a.code,message:"previously registered",status:400,statusText:"BAD_REQUEST"}};if("ERROR_CEREMONY_ABORTED"===a.code)return{data:null,error:{code:a.code,message:"registration cancelled",status:400,statusText:"BAD_REQUEST"}};return{data:null,error:{code:a.code,message:a.message,status:400,statusText:"BAD_REQUEST"}}}return{data:null,error:{code:"UNKNOWN_ERROR",message:a instanceof Error?a.message:"unknown error",status:500,statusText:"INTERNAL_SERVER_ERROR"}}}}},$Infer:{}}))(b,{$listPasskeys:a}),getAtoms:b=>({listPasskeys:(0,e.u)(a,"/passkey/list-user-passkeys",b,{method:"GET"}),$listPasskeys:a}),pathMethods:{"/passkey/register":"POST","/passkey/authenticate":"POST"},atomListeners:[{matcher:a=>"/passkey/verify-registration"===a||"/passkey/delete-passkey"===a||"/passkey/update-passkey"===a,signal:"_listPasskeys"}]}},A=()=>({id:"multi-session",$InferServerPlugin:{},atomListeners:[{matcher:a=>"/multi-session/set-active"===a,signal:"$sessionSignal"}]}),B=()=>({id:"email-otp",$InferServerPlugin:{}})}};