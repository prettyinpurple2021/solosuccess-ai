exports.id=5173,exports.ids=[4291,5173],exports.modules={30477:(a,b,c)=>{"use strict";c.d(b,{HG:()=>i,JE:()=>g,fH:()=>h,vF:()=>e,vV:()=>f});class d{constructor(){this.isDevelopment=!1,this.logLevel=this.isDevelopment?3:2}shouldLog(a){return a<=this.logLevel}formatLogEntry(a){let b=["ERROR","WARN","INFO","DEBUG"][a.level],c=`[${a.timestamp}] ${b}: ${a.message}`;return a.context&&Object.keys(a.context).length>0&&(c+=` | Context: ${JSON.stringify(a.context)}`),a.error&&(c+=` | Error: ${a.error.message}`,this.isDevelopment&&a.error.stack&&(c+=` | Stack: ${a.error.stack}`)),c}log(a,b,c,d){if(!this.shouldLog(a))return;let e={level:a,message:b,timestamp:new Date().toISOString(),context:c,error:d},f=this.formatLogEntry(e);0===a&&console.error(f),!this.isDevelopment&&a<=1&&this.sendToExternalService(e)}async sendToExternalService(a){}error(a,b,c){this.log(0,a,b,c)}warn(a,b){this.log(1,a,b)}info(a,b){this.log(2,a,b)}debug(a,b){this.log(3,a,b)}apiLog(a,b,c,d,e){let f=`${a} ${b} - ${c}${d?` (${d}ms)`:""}`,g=c>=500?0:c>=400?1:2;this.log(g,f,{method:a,path:b,statusCode:c,duration:d,...e})}dbLog(a,b,c,d){let e=`DB ${a} on ${b}${c?` (${c}ms)`:""}`;this.log(3,e,{operation:a,table:b,duration:c,...d})}authLog(a,b,c=!0,d){let e=`Auth ${a}${b?` for user ${b}`:""} - ${c?"SUCCESS":"FAILED"}`;this.log(c?2:1,e,{action:a,userId:b,success:c,...d})}}let e=new d,f=(a,b,c)=>{b instanceof Error?e.error(a,void 0,b):"object"==typeof b&&null!==b?e.error(a,b,c):e.error(a,void 0,c)},g=(a,b)=>e.warn(a,b),h=(a,b)=>e.info(a,b),i=(a,b,c,d,f)=>e.apiLog(a,b,c,d,f)},34591:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{r:()=>i});var e=c(30477),f=c(67939),g=a([f]);f=(g.then?(await g)():g)[0];let h=[{id:"pricing-response",name:"Pricing Strategy Response",description:"Analyze and respond to competitor pricing changes",category:"Strategic Response",priority:"high",estimatedMinutes:120,alertTypes:["pricing_change","new_pricing_tier"],taskTemplate:{title:"Respond to {competitor} pricing change",description:"Analyze {competitor}'s new pricing strategy and develop our response. Consider: 1) Impact on our positioning, 2) Customer retention risk, 3) Revenue implications, 4) Competitive advantages to highlight.",category:"Strategic Response",priority:"high",tags:["competitive-intelligence","pricing","strategy"]}},{id:"product-launch-response",name:"Product Launch Counter-Strategy",description:"Develop response to competitor product launches",category:"Product Strategy",priority:"high",estimatedMinutes:180,alertTypes:["product_launch","feature_announcement"],taskTemplate:{title:"Counter-strategy for {competitor} product launch",description:"Develop response to {competitor}'s new product/feature. Actions: 1) Feature gap analysis, 2) Accelerate roadmap items, 3) Marketing counter-narrative, 4) Customer retention strategy.",category:"Product Strategy",priority:"high",tags:["competitive-intelligence","product","launch-response"]}},{id:"talent-acquisition-opportunity",name:"Talent Acquisition Opportunity",description:"Capitalize on competitor talent movements",category:"Talent Strategy",priority:"medium",estimatedMinutes:90,alertTypes:["layoffs","key_departure","hiring_freeze"],taskTemplate:{title:"Talent opportunity from {competitor} changes",description:"Capitalize on {competitor}'s talent situation. Actions: 1) Identify key talent to recruit, 2) Reach out to affected employees, 3) Accelerate hiring in affected areas, 4) Improve employer branding.",category:"Talent Strategy",priority:"medium",tags:["competitive-intelligence","talent","recruitment"]}},{id:"market-expansion-opportunity",name:"Market Expansion Response",description:"Respond to competitor market moves",category:"Market Strategy",priority:"medium",estimatedMinutes:150,alertTypes:["market_expansion","new_geography","partnership_announcement"],taskTemplate:{title:"Market response to {competitor} expansion",description:"Respond to {competitor}'s market expansion. Consider: 1) First-mover advantage opportunities, 2) Partnership possibilities, 3) Resource allocation, 4) Competitive positioning in new market.",category:"Market Strategy",priority:"medium",tags:["competitive-intelligence","market-expansion","strategy"]}},{id:"crisis-opportunity",name:"Crisis Response Opportunity",description:"Capitalize on competitor crises",category:"Crisis Response",priority:"critical",estimatedMinutes:60,alertTypes:["negative_news","security_breach","service_outage","legal_issues"],taskTemplate:{title:"Capitalize on {competitor} crisis",description:"Respond to {competitor}'s crisis situation. Immediate actions: 1) Customer acquisition campaign, 2) Highlight our advantages, 3) Prepare crisis communications, 4) Monitor customer sentiment.",category:"Crisis Response",priority:"critical",tags:["competitive-intelligence","crisis-response","opportunity"]}}];class i{static async createTaskFromAlert(a,b){try{let c=await (0,f.UU)(),d=h.find(b=>b.alertTypes.includes(a.alert_type));if(!d)return(0,e.fH)(`No task template found for alert type: ${a.alert_type}`),null;let{rows:g}=await c.query("SELECT name FROM competitor_profiles WHERE id = $1",[a.competitor_id]),i=g[0]?.name||"Unknown Competitor",j=d.taskTemplate.title.replace("{competitor}",i),k=d.taskTemplate.description.replace(/{competitor}/g,i),{rows:l}=await c.query(`INSERT INTO tasks (
          user_id, title, description, category, priority, 
          estimated_minutes, tags, ai_suggestions, status
        ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, 'pending') RETURNING id`,[b,j,k,d.taskTemplate.category,d.taskTemplate.priority,d.estimatedMinutes,JSON.stringify([...d.taskTemplate.tags,`alert-${a.id}`]),JSON.stringify({source:"competitive_intelligence",alert_id:a.id,competitor_id:a.competitor_id,template_id:d.id,created_from_alert:!0})]);return l[0]?.id||null}catch(a){return(0,e.vV)("Error creating task from alert:",a),null}}static async addCompetitiveContextToGoal(a,b,c){try{let d=await (0,f.UU)(),{rows:e}=await d.query("SELECT name, threat_level, market_position FROM competitor_profiles WHERE id = $1 AND user_id = $2",[b,c]);if(0===e.length)return null;let g=e[0],{rows:h}=await d.query(`SELECT data_type, extracted_data, analysis_results 
         FROM intelligence_data 
         WHERE competitor_id = $1 AND user_id = $2 
         AND importance IN ('high', 'critical')
         ORDER BY collected_at DESC 
         LIMIT 10`,[b,c]),i=this.extractBenchmarkMetrics(h),j={goalId:a,competitorId:b,competitorName:g.name,threatLevel:g.threat_level,marketPosition:g.market_position,benchmarkMetrics:i};return await d.query(`UPDATE goals 
         SET ai_suggestions = COALESCE(ai_suggestions, '{}')::jsonb || $1::jsonb
         WHERE id = $2 AND user_id = $3`,[JSON.stringify({competitive_context:j,updated_at:new Date().toISOString()}),a,c]),j}catch(a){return(0,e.vV)("Error adding competitive context to goal:",a),null}}static async createCompetitiveMilestone(a,b,c,d){try{let e=await (0,f.UU)(),{rows:g}=await e.query(`INSERT INTO tasks (
          user_id, goal_id, title, description, category, priority,
          due_date, tags, ai_suggestions, status
        ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, 'pending') RETURNING id`,[d,a,c.title,c.description,"Competitive Milestone","high",c.dueDate,JSON.stringify(["competitive-milestone","benchmark",`competitor-${b}`]),JSON.stringify({milestone_type:"competitive_benchmark",competitor_id:b,target_metric:c.targetMetric,competitor_benchmark:c.competitorBenchmark,target_value:c.targetValue,created_from_intelligence:!0})]);return g[0]?.id||null}catch(a){return(0,e.vV)("Error creating competitive milestone:",a),null}}static async getCompetitiveProgress(a,b){try{let c=await (0,f.UU)(),{rows:d}=await c.query("SELECT title, description, ai_suggestions FROM goals WHERE id = $1 AND user_id = $2",[a,b]);if(0===d.length)return null;let e=d[0],g=e.ai_suggestions?.competitive_context;if(!g)return null;let{rows:h}=await c.query(`SELECT id, title, description, status, ai_suggestions, completed_at
         FROM tasks 
         WHERE goal_id = $1 AND user_id = $2 
         AND category = 'Competitive Milestone'
         ORDER BY created_at ASC`,[a,b]),{rows:i}=await c.query(`SELECT id.data_type, id.importance, id.collected_at, cp.name as competitor_name
         FROM intelligence_data id
         JOIN competitor_profiles cp ON cp.id = id.competitor_id
         WHERE id.competitor_id = $1 AND id.user_id = $2
         AND id.collected_at > NOW() - INTERVAL '30 days'
         ORDER BY id.collected_at DESC
         LIMIT 5`,[g.competitorId,b]);return{goal:e,competitiveContext:g,milestones:h,recentIntelligence:i}}catch(a){return(0,e.vV)("Error getting competitive progress:",a),null}}static extractBenchmarkMetrics(a){let b=[];for(let c of a){let a=c.extracted_data||{},d=c.analysis_results||[];switch(c.data_type){case"pricing":a.pricing_tiers&&b.push({metric:"Pricing Tiers",competitorValue:a.pricing_tiers.length,trend:"stable"});break;case"social_media":a.engagement_rate&&b.push({metric:"Social Engagement Rate",competitorValue:`${a.engagement_rate}%`,trend:a.engagement_trend||"stable"});break;case"product_features":a.feature_count&&b.push({metric:"Product Features",competitorValue:a.feature_count,trend:"improving"});break;case"job_postings":a.open_positions&&b.push({metric:"Open Positions",competitorValue:a.open_positions,trend:a.hiring_trend||"stable"})}for(let a of d)if(a.insights)for(let c of a.insights)c.metric&&c.value&&b.push({metric:c.metric,competitorValue:c.value,trend:c.trend||"stable"})}return b.slice(0,10)}}d()}catch(a){d(a)}})},42981:(a,b,c)=>{"use strict";function d(a,b,c,d){let e,f=(globalThis.__rateLimits||(globalThis.__rateLimits=new Map),(e=globalThis.__rateLimits.get(a))||(e=new Map,globalThis.__rateLimits.set(a,e)),e),g=Date.now(),h=f.get(b);if(!h||g-h.ts>c)return f.set(b,{count:1,ts:g}),{allowed:!0,remaining:d-1};h.count+=1,h.ts=g;let i=Math.max(0,d-h.count);return{allowed:h.count<=d,remaining:i}}async function e(a,b){let c=function(a){let b=a.headers.get("x-forwarded-for");if(b)return b.split(",")[0].trim();let c=a.headers.get("x-real-ip");if(c)return c;let d=a.headers.get("cf-connecting-ip");return d||"127.0.0.1"}(a),e=d(a.url||"default",c,1e3*b.window,b.requests);return{...e,success:e.allowed}}function f(a,b,c,f){if(a instanceof Request&&"object"==typeof b)return e(a,b);if("string"==typeof a&&"string"==typeof b&&c&&f)return d(a,b,c,f);throw Error("Invalid rateLimitByIp arguments")}c.d(b,{E:()=>f})},67939:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{KU:()=>j,P:()=>k,UU:()=>i});var e=c(30477),f=c(64939),g=a([f]);f=(g.then?(await g)():g)[0];let h=null,i=()=>{if(!h){let a="postgresql://neondb_owner:npg_MRLUf85DBNPv@ep-curly-meadow-aefoagku-pooler.c-2.us-east-2.aws.neon.tech/neondb?sslmode=require&channel_binding=require";if(!a)throw Error("Missing Neon database environment variables. Please set DATABASE_URL");(h=new f.Pool({connectionString:a,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3})).on("error",a=>{(0,e.vV)("Unexpected error on idle client",a)})}return h},j=async()=>{let a=i();return await a.connect()},k=async(a,b)=>{let c=await j();try{return await c.query(a,b)}finally{c.release()}};d()}catch(a){d(a)}})},74291:(a,b,c)=>{"use strict";c.d(b,{_:()=>m,authenticateRequest:()=>l});var d=c(30477);c(10641);var e=c(86802),f=c(80829),g=c.n(f),h=c(94570),i=c(41393),j=c(48689);async function k(){try{let a=await (0,e.b3)(),b=a.get("authorization"),c=null;if(b&&b.startsWith("Bearer "))c=b.substring(7);else{let b=a.get("cookie");b&&(c=b.split(";").reduce((a,b)=>{let[c,d]=b.trim().split("=");return a[c]=d,a},{}).auth_token||null)}if(!c)return null;let d=g().verify(c,"local-development-jwt-secret-key");if(!d||!d.userId)return null;let f=(0,h.Lf)(),k=await f.select({id:i.users.id,email:i.users.email,full_name:i.users.full_name,username:i.users.username,date_of_birth:i.users.date_of_birth,created_at:i.users.created_at,updated_at:i.users.updated_at,subscription_tier:i.users.subscription_tier,subscription_status:i.users.subscription_status}).from(i.users).where((0,j.eq)(i.users.id,d.userId)).limit(1);if(0===k.length)return null;let l=k[0];return{id:l.id,email:l.email,full_name:l.full_name,name:l.full_name,username:l.username,created_at:l.created_at,updated_at:l.updated_at,subscription_tier:l.subscription_tier??"free",subscription_status:l.subscription_status??"active"}}catch(a){return(0,d.vV)("JWT authentication error:",a),null}}async function l(){try{let a=await k();if(a)return{user:a,error:null};return{user:null,error:"No authenticated user session found"}}catch(a){return(0,d.vV)("Authentication error:",a),{user:null,error:"Authentication failed"}}}async function m(a){try{let a=await l();return{user:a.user||void 0,error:a.error||void 0}}catch(a){return(0,d.vV)("verifyAuth error:",a),{error:"Authentication failed"}}}},78335:()=>{},96487:()=>{}};