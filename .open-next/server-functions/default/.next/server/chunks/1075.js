exports.id=1075,exports.ids=[1075,4291],exports.modules={30477:(a,b,c)=>{"use strict";c.d(b,{HG:()=>i,JE:()=>g,fH:()=>h,vF:()=>e,vV:()=>f});class d{constructor(){this.isDevelopment=!1,this.logLevel=this.isDevelopment?3:2}shouldLog(a){return a<=this.logLevel}formatLogEntry(a){let b=["ERROR","WARN","INFO","DEBUG"][a.level],c=`[${a.timestamp}] ${b}: ${a.message}`;return a.context&&Object.keys(a.context).length>0&&(c+=` | Context: ${JSON.stringify(a.context)}`),a.error&&(c+=` | Error: ${a.error.message}`,this.isDevelopment&&a.error.stack&&(c+=` | Stack: ${a.error.stack}`)),c}log(a,b,c,d){if(!this.shouldLog(a))return;let e={level:a,message:b,timestamp:new Date().toISOString(),context:c,error:d},f=this.formatLogEntry(e);0===a&&console.error(f),!this.isDevelopment&&a<=1&&this.sendToExternalService(e)}async sendToExternalService(a){}error(a,b,c){this.log(0,a,b,c)}warn(a,b){this.log(1,a,b)}info(a,b){this.log(2,a,b)}debug(a,b){this.log(3,a,b)}apiLog(a,b,c,d,e){let f=`${a} ${b} - ${c}${d?` (${d}ms)`:""}`,g=c>=500?0:c>=400?1:2;this.log(g,f,{method:a,path:b,statusCode:c,duration:d,...e})}dbLog(a,b,c,d){let e=`DB ${a} on ${b}${c?` (${c}ms)`:""}`;this.log(3,e,{operation:a,table:b,duration:c,...d})}authLog(a,b,c=!0,d){let e=`Auth ${a}${b?` for user ${b}`:""} - ${c?"SUCCESS":"FAILED"}`;this.log(c?2:1,e,{action:a,userId:b,success:c,...d})}}let e=new d,f=(a,b,c)=>{b instanceof Error?e.error(a,void 0,b):"object"==typeof b&&null!==b?e.error(a,b,c):e.error(a,void 0,c)},g=(a,b)=>e.warn(a,b),h=(a,b)=>e.info(a,b),i=(a,b,c,d,f)=>e.apiLog(a,b,c,d,f)},42981:(a,b,c)=>{"use strict";function d(a,b,c,d){let e,f=(globalThis.__rateLimits||(globalThis.__rateLimits=new Map),(e=globalThis.__rateLimits.get(a))||(e=new Map,globalThis.__rateLimits.set(a,e)),e),g=Date.now(),h=f.get(b);if(!h||g-h.ts>c)return f.set(b,{count:1,ts:g}),{allowed:!0,remaining:d-1};h.count+=1,h.ts=g;let i=Math.max(0,d-h.count);return{allowed:h.count<=d,remaining:i}}async function e(a,b){let c=function(a){let b=a.headers.get("x-forwarded-for");if(b)return b.split(",")[0].trim();let c=a.headers.get("x-real-ip");if(c)return c;let d=a.headers.get("cf-connecting-ip");return d||"127.0.0.1"}(a),e=d(a.url||"default",c,1e3*b.window,b.requests);return{...e,success:e.allowed}}function f(a,b,c,f){if(a instanceof Request&&"object"==typeof b)return e(a,b);if("string"==typeof a&&"string"==typeof b&&c&&f)return d(a,b,c,f);throw Error("Invalid rateLimitByIp arguments")}c.d(b,{E:()=>f})},74291:(a,b,c)=>{"use strict";c.d(b,{_:()=>m,authenticateRequest:()=>l});var d=c(30477);c(10641);var e=c(86802),f=c(80829),g=c.n(f),h=c(94570),i=c(41393),j=c(48689);async function k(){try{let a=await (0,e.b3)(),b=a.get("authorization"),c=null;if(b&&b.startsWith("Bearer "))c=b.substring(7);else{let b=a.get("cookie");b&&(c=b.split(";").reduce((a,b)=>{let[c,d]=b.trim().split("=");return a[c]=d,a},{}).auth_token||null)}if(!c)return null;let d=g().verify(c,"local-development-jwt-secret-key");if(!d||!d.userId)return null;let f=(0,h.Lf)(),k=await f.select({id:i.users.id,email:i.users.email,full_name:i.users.full_name,username:i.users.username,date_of_birth:i.users.date_of_birth,created_at:i.users.created_at,updated_at:i.users.updated_at,subscription_tier:i.users.subscription_tier,subscription_status:i.users.subscription_status}).from(i.users).where((0,j.eq)(i.users.id,d.userId)).limit(1);if(0===k.length)return null;let l=k[0];return{id:l.id,email:l.email,full_name:l.full_name,name:l.full_name,username:l.username,created_at:l.created_at,updated_at:l.updated_at,subscription_tier:l.subscription_tier??"free",subscription_status:l.subscription_status??"active"}}catch(a){return(0,d.vV)("JWT authentication error:",a),null}}async function l(){try{let a=await k();if(a)return{user:a,error:null};return{user:null,error:"No authenticated user session found"}}catch(a){return(0,d.vV)("Authentication error:",a),{user:null,error:"Authentication failed"}}}async function m(a){try{let a=await l();return{user:a.user||void 0,error:a.error||void 0}}catch(a){return(0,d.vV)("verifyAuth error:",a),{error:"Authentication failed"}}}},78335:()=>{},79913:(a,b,c)=>{"use strict";c.d(b,{zS:()=>e}),c(30477);class d{async trackEvent(a,b={},c){let d={event:a,timestamp:new Date,properties:b,metadata:c?{userAgent:c.headers.get("user-agent")||void 0,ip:c.headers.get("x-forwarded-for")||c.headers.get("x-real-ip")||void 0,referrer:c.headers.get("referer")||void 0,url:c.url}:void 0};this.events.push(d),b.userId&&await this.updateUserMetrics(b.userId,a,b)}async updateUserMetrics(a,b,c){let d=this.userMetrics.get(a);switch(!d&&(d={userId:a,totalSessions:0,totalPageViews:0,totalAIInteractions:0,goalsCreated:0,goalsCompleted:0,tasksCreated:0,tasksCompleted:0,filesUploaded:0,templatesSaved:0,lastActiveAt:new Date,firstSeenAt:new Date,averageSessionDuration:0,retentionScore:0}),b){case"user_signup":d.firstSeenAt=new Date;break;case"user_login":d.totalSessions++;break;case"page_view":d.totalPageViews++;break;case"ai_agent_interaction":d.totalAIInteractions++;break;case"goal_created":d.goalsCreated++;break;case"goal_completed":d.goalsCompleted++;break;case"task_created":d.tasksCreated++;break;case"task_completed":d.tasksCompleted++;break;case"file_uploaded":d.filesUploaded++;break;case"template_saved":d.templatesSaved++}d.lastActiveAt=new Date,this.userMetrics.set(a,d)}async trackPerformance(a){let b={pageLoadTime:a.pageLoadTime||0,apiResponseTime:a.apiResponseTime||0,errorRate:a.errorRate||0,uptime:a.uptime||100,memoryUsage:a.memoryUsage||0,cpuUsage:a.cpuUsage||0,databaseQueryTime:a.databaseQueryTime||0,...a};this.performanceMetrics.push(b),this.performanceMetrics.length>1e3&&(this.performanceMetrics=this.performanceMetrics.slice(-1e3))}getUserMetrics(a){return this.userMetrics.get(a)||null}getAllUserMetrics(){return Array.from(this.userMetrics.values())}getPerformanceMetrics(){return this.performanceMetrics}getBusinessMetrics(){return this.businessMetrics}async calculateBusinessMetrics(){let a=this.getAllUserMetrics(),b=new Date,c=new Date(b.getFullYear(),b.getMonth(),b.getDate()),d=new Date(c.getTime()-6048e5),e=new Date(c.getTime()-2592e6),f=a.length,g=a.filter(a=>a.lastActiveAt>d).length,h=a.filter(a=>a.firstSeenAt>=c).length,i=a.filter(a=>a.firstSeenAt>=d).length,j=a.filter(a=>a.firstSeenAt>=e).length,k={ai_agents:a.filter(a=>a.totalAIInteractions>0).length/f*100,goals:a.filter(a=>a.goalsCreated>0).length/f*100,tasks:a.filter(a=>a.tasksCreated>0).length/f*100,files:a.filter(a=>a.filesUploaded>0).length/f*100,templates:a.filter(a=>a.templatesSaved>0).length/f*100},l=f>0?a.filter(a=>a.goalsCompleted>0).length/f*100:0,m=new Date(b.getTime()-2592e6),n=a.filter(a=>a.lastActiveAt<m).length,o={totalUsers:f,activeUsers:g,newUsersToday:h,newUsersThisWeek:i,newUsersThisMonth:j,userRetentionRate:f>0?g/f*100:0,featureAdoptionRate:k,conversionRate:l,churnRate:f>0?n/f*100:0,revenue:0,mrr:0};return this.businessMetrics=o,o}async getDashboardData(){let a=await this.calculateBusinessMetrics();return{events:this.events.slice(-100),userMetrics:this.getAllUserMetrics(),performanceMetrics:this.getPerformanceMetrics().slice(-50),businessMetrics:a}}clearOldData(){let a=new Date(Date.now()-6048e5);this.events=this.events.filter(b=>b.timestamp>a);let b=new Date(Date.now()-864e5);this.performanceMetrics=this.performanceMetrics.filter(a=>new Date>b)}constructor(){this.events=[],this.userMetrics=new Map,this.performanceMetrics=[],this.businessMetrics=null}}let e=new d},96487:()=>{}};