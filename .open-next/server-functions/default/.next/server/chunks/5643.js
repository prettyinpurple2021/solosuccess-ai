exports.id=5643,exports.ids=[5643],exports.modules={28287:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{U:()=>h});var e=c(64939),f=a([e]);e=(f.then?(await f)():f)[0];let g=null,h=async()=>{if(!g){let a="postgresql://neondb_owner:npg_MRLUf85DBNPv@ep-curly-meadow-aefoagku-pooler.c-2.us-east-2.aws.neon.tech/neondb?sslmode=require&channel_binding=require";if(!a)throw Error("Missing Neon database environment variables. Please set DATABASE_URL");g=new e.Pool({connectionString:a,ssl:{rejectUnauthorized:!1}})}return g};d()}catch(a){d(a)}})},30477:(a,b,c)=>{"use strict";c.d(b,{HG:()=>i,JE:()=>g,fH:()=>h,vF:()=>e,vV:()=>f});class d{constructor(){this.isDevelopment=!1,this.logLevel=this.isDevelopment?3:2}shouldLog(a){return a<=this.logLevel}formatLogEntry(a){let b=["ERROR","WARN","INFO","DEBUG"][a.level],c=`[${a.timestamp}] ${b}: ${a.message}`;return a.context&&Object.keys(a.context).length>0&&(c+=` | Context: ${JSON.stringify(a.context)}`),a.error&&(c+=` | Error: ${a.error.message}`,this.isDevelopment&&a.error.stack&&(c+=` | Stack: ${a.error.stack}`)),c}log(a,b,c,d){if(!this.shouldLog(a))return;let e={level:a,message:b,timestamp:new Date().toISOString(),context:c,error:d},f=this.formatLogEntry(e);0===a&&console.error(f),!this.isDevelopment&&a<=1&&this.sendToExternalService(e)}async sendToExternalService(a){}error(a,b,c){this.log(0,a,b,c)}warn(a,b){this.log(1,a,b)}info(a,b){this.log(2,a,b)}debug(a,b){this.log(3,a,b)}apiLog(a,b,c,d,e){let f=`${a} ${b} - ${c}${d?` (${d}ms)`:""}`,g=c>=500?0:c>=400?1:2;this.log(g,f,{method:a,path:b,statusCode:c,duration:d,...e})}dbLog(a,b,c,d){let e=`DB ${a} on ${b}${c?` (${c}ms)`:""}`;this.log(3,e,{operation:a,table:b,duration:c,...d})}authLog(a,b,c=!0,d){let e=`Auth ${a}${b?` for user ${b}`:""} - ${c?"SUCCESS":"FAILED"}`;this.log(c?2:1,e,{action:a,userId:b,success:c,...d})}}let e=new d,f=(a,b,c)=>{b instanceof Error?e.error(a,void 0,b):"object"==typeof b&&null!==b?e.error(a,b,c):e.error(a,void 0,c)},g=(a,b)=>e.warn(a,b),h=(a,b)=>e.info(a,b),i=(a,b,c,d,f)=>e.apiLog(a,b,c,d,f)},49708:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{D:()=>h});var e=c(30477),f=c(28287),g=a([f]);f=(g.then?(await g)():g)[0];class h{constructor(){this.rateLimitStore=new Map,this.activeSessions=new Map}static getInstance(){return h.instance||(h.instance=new h),h.instance}async getDb(){return await (0,f.U)()}async authenticateUser(a,b){try{if(!a||"anonymous"===a)return!1;let b=this.activeSessions.get(a);if(b){let c=Date.now();if(c-b.lastActivity<18e5)return b.lastActivity=c,!0;this.activeSessions.delete(a)}return this.activeSessions.set(a,{userId:a,lastActivity:Date.now()}),!0}catch(a){return(0,e.vV)("Authentication error:",a),!1}}async authorizeAgentAccess(a,b,c){try{let d=await this.getDb(),e=await d.query(`
        SELECT permissions, restrictions, expires_at
        FROM agent_permissions 
        WHERE user_id = $1 AND agent_id = $2
        AND (expires_at IS NULL OR expires_at > NOW())
      `,[a,b]);if(0===e.rows.length)return!1;let f=e.rows[0];if(f.restrictions&&f.restrictions.includes(c))return!1;if(f.permissions&&f.permissions.includes(c)||f.permissions&&f.permissions.includes("*"))return!0;return!1}catch(a){return(0,e.vV)("Authorization error:",a),!1}}async checkRateLimit(a,b,c){let d=`${a}:${b}`,e=Date.now(),f=this.rateLimitStore.get(d);return!f||e>f.resetTime?(this.rateLimitStore.set(d,{count:1,resetTime:e+c.windowMs}),!0):!(f.count>=c.maxRequests)&&(f.count++,!0)}async logSecurityEvent(a,b,c,d,f,g={},h,i){try{let e=await this.getDb();await e.query(`
        INSERT INTO security_audit_logs (
          id, user_id, agent_id, action, resource, success,
          ip_address, user_agent, metadata, timestamp
        ) VALUES (
          $1, $2, $3, $4, $5, $6, $7, $8, $9, $10
        )
      `,[crypto.randomUUID(),a,b,c,d,f,h||null,i||null,JSON.stringify(g),new Date])}catch(a){(0,e.vV)("Audit logging error:",a)}}async grantPermission(a,b,c,d=[],f){try{let e=await this.getDb();await e.query(`
        INSERT INTO agent_permissions (
          id, user_id, agent_id, permissions, restrictions, expires_at, created_at, updated_at
        ) VALUES (
          $1, $2, $3, $4, $5, $6, $7, $8
        ) ON CONFLICT (user_id, agent_id) 
        DO UPDATE SET 
          permissions = $4,
          restrictions = $5,
          expires_at = $6,
          updated_at = $8
      `,[crypto.randomUUID(),a,b,JSON.stringify(c),JSON.stringify(d),f||null,new Date,new Date])}catch(a){throw(0,e.vV)("Permission grant error:",a),Error("Failed to grant permission")}}async revokePermission(a,b){try{let c=await this.getDb();await c.query(`
        DELETE FROM agent_permissions 
        WHERE user_id = $1 AND agent_id = $2
      `,[a,b])}catch(a){throw(0,e.vV)("Permission revoke error:",a),Error("Failed to revoke permission")}}async getSecurityConfig(){return{requireAuthentication:!0,requireAuthorization:!0,enableRateLimiting:!0,enableAuditLogging:!0,maxConcurrentSessions:5,sessionTimeoutMs:18e5,allowedOrigins:["http://localhost:3000","https://yourdomain.com"],blockedIPs:[]}}validateInput(a,b){let c=[],d=a;switch(a.length>1e4&&c.push("Input too long (max 10000 characters)"),a.length<1&&c.push("Input cannot be empty"),d=d.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").trim(),b){case"message":break;case"command":/^[a-zA-Z0-9\s\-_]+$/.test(d)||c.push("Commands can only contain letters, numbers, spaces, hyphens, and underscores");break;case"query":/['";\\]/.test(d)&&c.push("Query contains potentially dangerous characters")}return{valid:0===c.length,sanitized:d,errors:c}}async createSession(a,b={}){let c=crypto.randomUUID();return this.activeSessions.set(c,{userId:a,lastActivity:Date.now()}),await this.logSecurityEvent(a,"system","session_create","user_session",!0,{sessionId:c,...b}),c}async validateSession(a){let b=this.activeSessions.get(a);if(!b)return{valid:!1};let c=Date.now();return c-b.lastActivity>18e5?(this.activeSessions.delete(a),{valid:!1}):(b.lastActivity=c,{valid:!0,userId:b.userId})}async destroySession(a){let b=this.activeSessions.get(a);b&&await this.logSecurityEvent(b.userId,"system","session_destroy","user_session",!0,{sessionId:a}),this.activeSessions.delete(a)}async cleanup(){let a=Date.now();for(let[b,c]of this.activeSessions.entries())a-c.lastActivity>18e5&&this.activeSessions.delete(b);for(let[b,c]of this.rateLimitStore.entries())a>c.resetTime&&this.rateLimitStore.delete(b)}async getSecurityMetrics(){try{let a=await this.getDb(),[b,c]=await Promise.all([a.query(`
          SELECT COUNT(*) as total_logs
          FROM security_audit_logs 
          WHERE timestamp >= NOW() - INTERVAL '24 hours'
        `),a.query(`
          SELECT COUNT(*) as failed_attempts
          FROM security_audit_logs 
          WHERE action = 'authenticate' AND success = false
          AND timestamp >= NOW() - INTERVAL '24 hours'
        `)]);return{activeSessions:this.activeSessions.size,totalAuditLogs:parseInt(b.rows[0]?.total_logs||"0"),failedAuthAttempts:parseInt(c.rows[0]?.failed_attempts||"0"),rateLimitHits:0}}catch(a){return(0,e.vV)("Error getting security metrics:",a),{activeSessions:this.activeSessions.size,totalAuditLogs:0,failedAuthAttempts:0,rateLimitHits:0}}}}d()}catch(a){d(a)}})},78095:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{n:()=>i});var e=c(30477),f=c(10641),g=c(49708),h=a([g]);g=(h.then?(await h)():h)[0];class i{constructor(){this.rateLimitConfig={maxRequests:100,windowMs:9e5,skipSuccessfulRequests:!1,skipFailedRequests:!0},this.securityManager=g.D.getInstance()}async authenticateRequest(a){try{let b=a.headers.get("x-user-id")||a.cookies.get("user-id")?.value||"default-user";if(!b||"anonymous"===b)return{success:!1,error:"Authentication required"};let c=a.headers.get("x-session-id")||a.cookies.get("session-id")?.value;if(c){let a=await this.securityManager.validateSession(c);if(!a.valid)return{success:!1,error:"Invalid or expired session"};if(a.userId!==b)return{success:!1,error:"Session user mismatch"}}if(!await this.securityManager.authenticateUser(b,c))return{success:!1,error:"Authentication failed"};return{success:!0,userId:b}}catch(a){return(0,e.vV)("Authentication error:",a),{success:!1,error:"Authentication error"}}}async authorizeRequest(a,b,c){try{if(!await this.securityManager.authorizeAgentAccess(a,b,c))return{success:!1,error:"Insufficient permissions"};return{success:!0}}catch(a){return(0,e.vV)("Authorization error:",a),{success:!1,error:"Authorization error"}}}async checkRateLimit(a,b){try{if(!await this.securityManager.checkRateLimit(a,b,this.rateLimitConfig))return{success:!1,error:"Rate limit exceeded",retryAfter:this.rateLimitConfig.windowMs/1e3};return{success:!0}}catch(a){return(0,e.vV)("Rate limit check error:",a),{success:!1,error:"Rate limit check failed"}}}async validateInput(a,b){try{let c=this.securityManager.validateInput(a,b);if(!c.valid)return{success:!1,error:`Input validation failed: ${c.errors.join(", ")}`};return{success:!0,sanitized:c.sanitized}}catch(a){return(0,e.vV)("Input validation error:",a),{success:!1,error:"Input validation error"}}}async logSecurityEvent(a,b,c={}){try{await this.securityManager.logSecurityEvent(a.userId,a.agentId,a.action,a.resource,b,c,a.ipAddress,a.userAgent)}catch(a){(0,e.vV)("Security logging error:",a)}}async processRequest(a,b,c,d){try{let e=a.headers.get("x-forwarded-for")||a.headers.get("x-real-ip")||"unknown",g=a.headers.get("user-agent")||"unknown",h=await this.authenticateRequest(a);if(!h.success)return await this.logSecurityEvent({userId:"unknown",agentId:b,action:c,resource:d,ipAddress:e,userAgent:g},!1,{error:h.error}),{success:!1,response:f.NextResponse.json({error:h.error},{status:401}),error:h.error};let i=h.userId,j=await this.authorizeRequest(i,b,c);if(!j.success)return await this.logSecurityEvent({userId:i,agentId:b,action:c,resource:d,ipAddress:e,userAgent:g},!1,{error:j.error}),{success:!1,response:f.NextResponse.json({error:j.error},{status:403}),error:j.error};let k=await this.checkRateLimit(i,b);if(!k.success){await this.logSecurityEvent({userId:i,agentId:b,action:c,resource:d,ipAddress:e,userAgent:g},!1,{error:k.error});let a=f.NextResponse.json({error:k.error},{status:429});return k.retryAfter&&a.headers.set("Retry-After",k.retryAfter.toString()),{success:!1,response:a,error:k.error}}if("POST"===a.method)try{let h=await a.json();if(h.message){let a=await this.validateInput(h.message,"message");if(!a.success)return await this.logSecurityEvent({userId:i,agentId:b,action:c,resource:d,ipAddress:e,userAgent:g},!1,{error:a.error}),{success:!1,response:f.NextResponse.json({error:a.error},{status:400}),error:a.error}}}catch(a){}let l={userId:i,agentId:b,action:c,resource:d,ipAddress:e,userAgent:g,sessionId:a.headers.get("x-session-id")||a.cookies.get("session-id")?.value};return await this.logSecurityEvent(l,!0),{success:!0,context:l}}catch(a){return(0,e.vV)("Security middleware error:",a),{success:!1,response:f.NextResponse.json({error:"Security processing failed"},{status:500}),error:"Security processing failed"}}}createSecurityHeaders(){return{"X-Content-Type-Options":"nosniff","X-Frame-Options":"DENY","X-XSS-Protection":"1; mode=block","Strict-Transport-Security":"max-age=31536000; includeSubDomains","Content-Security-Policy":"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'","Referrer-Policy":"strict-origin-when-cross-origin"}}createErrorResponse(a,b,c){let d=f.NextResponse.json({error:a},{status:b}),e=this.createSecurityHeaders();return Object.entries(e).forEach(([a,b])=>{d.headers.set(a,b)}),c&&d.headers.set("Retry-After",c.toString()),d}}d()}catch(a){d(a)}})},78335:()=>{},96487:()=>{}};