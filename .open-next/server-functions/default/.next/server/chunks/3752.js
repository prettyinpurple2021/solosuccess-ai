exports.id=3752,exports.ids=[3752,4291],exports.modules={30477:(a,b,c)=>{"use strict";c.d(b,{HG:()=>i,JE:()=>g,fH:()=>h,vF:()=>e,vV:()=>f});class d{constructor(){this.isDevelopment=!1,this.logLevel=this.isDevelopment?3:2}shouldLog(a){return a<=this.logLevel}formatLogEntry(a){let b=["ERROR","WARN","INFO","DEBUG"][a.level],c=`[${a.timestamp}] ${b}: ${a.message}`;return a.context&&Object.keys(a.context).length>0&&(c+=` | Context: ${JSON.stringify(a.context)}`),a.error&&(c+=` | Error: ${a.error.message}`,this.isDevelopment&&a.error.stack&&(c+=` | Stack: ${a.error.stack}`)),c}log(a,b,c,d){if(!this.shouldLog(a))return;let e={level:a,message:b,timestamp:new Date().toISOString(),context:c,error:d},f=this.formatLogEntry(e);0===a&&console.error(f),!this.isDevelopment&&a<=1&&this.sendToExternalService(e)}async sendToExternalService(a){}error(a,b,c){this.log(0,a,b,c)}warn(a,b){this.log(1,a,b)}info(a,b){this.log(2,a,b)}debug(a,b){this.log(3,a,b)}apiLog(a,b,c,d,e){let f=`${a} ${b} - ${c}${d?` (${d}ms)`:""}`,g=c>=500?0:c>=400?1:2;this.log(g,f,{method:a,path:b,statusCode:c,duration:d,...e})}dbLog(a,b,c,d){let e=`DB ${a} on ${b}${c?` (${c}ms)`:""}`;this.log(3,e,{operation:a,table:b,duration:c,...d})}authLog(a,b,c=!0,d){let e=`Auth ${a}${b?` for user ${b}`:""} - ${c?"SUCCESS":"FAILED"}`;this.log(c?2:1,e,{action:a,userId:b,success:c,...d})}}let e=new d,f=(a,b,c)=>{b instanceof Error?e.error(a,void 0,b):"object"==typeof b&&null!==b?e.error(a,b,c):e.error(a,void 0,c)},g=(a,b)=>e.warn(a,b),h=(a,b)=>e.info(a,b),i=(a,b,c,d,f)=>e.apiLog(a,b,c,d,f)},42981:(a,b,c)=>{"use strict";function d(a,b,c,d){let e,f=(globalThis.__rateLimits||(globalThis.__rateLimits=new Map),(e=globalThis.__rateLimits.get(a))||(e=new Map,globalThis.__rateLimits.set(a,e)),e),g=Date.now(),h=f.get(b);if(!h||g-h.ts>c)return f.set(b,{count:1,ts:g}),{allowed:!0,remaining:d-1};h.count+=1,h.ts=g;let i=Math.max(0,d-h.count);return{allowed:h.count<=d,remaining:i}}async function e(a,b){let c=function(a){let b=a.headers.get("x-forwarded-for");if(b)return b.split(",")[0].trim();let c=a.headers.get("x-real-ip");if(c)return c;let d=a.headers.get("cf-connecting-ip");return d||"127.0.0.1"}(a),e=d(a.url||"default",c,1e3*b.window,b.requests);return{...e,success:e.allowed}}function f(a,b,c,f){if(a instanceof Request&&"object"==typeof b)return e(a,b);if("string"==typeof a&&"string"==typeof b&&c&&f)return d(a,b,c,f);throw Error("Invalid rateLimitByIp arguments")}c.d(b,{E:()=>f})},73180:(a,b,c)=>{"use strict";c.d(b,{c:()=>i});var d=c(97356),e=c(41393),f=c(48689),g=c(71559);class h{static getInstance(){return h.instance||(h.instance=new h),h.instance}constructor(){this.alertTriggers=new Map,this.recentAlerts=new Map,this.initializeDefaultTriggers()}initializeDefaultTriggers(){this.addTrigger("pricing_change",{id:"pricing-change-critical",name:"Critical Pricing Changes",description:"Significant pricing changes that require immediate attention",conditions:[{field:"data_type",operator:"equals",value:"pricing",weight:1},{field:"change_percentage",operator:"greater_than",value:20,weight:.8}],severity:"critical",cooldownMinutes:60,isActive:!0}),this.addTrigger("product_launch",{id:"product-launch-urgent",name:"New Product Launches",description:"Competitor launches new products or features",conditions:[{field:"data_type",operator:"equals",value:"product",weight:1},{field:"content",operator:"contains",value:"launch|release|announce",weight:.9}],severity:"urgent",cooldownMinutes:30,isActive:!0}),this.addTrigger("key_hire",{id:"key-hire-warning",name:"Strategic Hiring",description:"Competitor hires key personnel in strategic roles",conditions:[{field:"data_type",operator:"equals",value:"job_posting",weight:1},{field:"role_level",operator:"equals",value:"executive",weight:.9}],severity:"warning",cooldownMinutes:120,isActive:!0}),this.addTrigger("funding_announcement",{id:"funding-critical",name:"Funding Announcements",description:"Competitor receives significant funding",conditions:[{field:"data_type",operator:"equals",value:"news",weight:1},{field:"content",operator:"contains",value:"funding|investment|raised",weight:.8},{field:"funding_amount",operator:"greater_than",value:1e6,weight:.9}],severity:"critical",cooldownMinutes:60,isActive:!0}),this.addTrigger("website_change",{id:"website-change-info",name:"Website Updates",description:"Significant changes to competitor websites",conditions:[{field:"data_type",operator:"equals",value:"website",weight:1},{field:"change_significance",operator:"greater_than",value:.3,weight:.7}],severity:"info",cooldownMinutes:240,isActive:!0})}addTrigger(a,b){this.alertTriggers.has(a)||this.alertTriggers.set(a,[]),this.alertTriggers.get(a).push(b)}async processIntelligenceForAlerts(a){let b={alertsGenerated:0,alertsDeduped:0,errors:[]};try{let c=await d.db.select().from(e.intelligenceData).where((0,f.eq)(e.intelligenceData.id,a)).limit(1);if(0===c.length)return b.errors.push(`Intelligence data not found: ${a}`),b;let g=c[0],h=await d.db.select().from(e.competitorProfiles).where((0,f.eq)(e.competitorProfiles.id,g.competitor_id)).limit(1);if(0===h.length)return b.errors.push(`Competitor not found: ${g.competitor_id}`),b;let i=h[0];for(let[a,c]of this.alertTriggers)for(let d of c)if(d.isActive&&await this.evaluateTrigger(d,g,i)){if(await this.checkForDuplicateAlert(g.user_id,g.competitor_id,a,d.cooldownMinutes)){b.alertsDeduped++;continue}await this.generateAlert(g,i,a,d),b.alertsGenerated++}return b}catch(c){return b.errors.push(`Error processing intelligence ${a}: ${c}`),b}}async evaluateTrigger(a,b,c){let d=0,e=0;for(let f of a.conditions){e+=f.weight;let a=this.getFieldValue(f.field,b,c);this.evaluateCondition(f,a)&&(d+=f.weight)}return d>=.7*e}getFieldValue(a,b,c){if(a.includes(".")){let c=a.split("."),d=b;for(let a of c)if(!d||"object"!=typeof d)return null;else d=d[a];return d}return b.hasOwnProperty(a)?b[a]:c.hasOwnProperty(a)?c[a]:b.extracted_data&&b.extracted_data[a]?b.extracted_data[a]:null}evaluateCondition(a,b){if(null==b)return!1;switch(a.operator){case"equals":return b===a.value;case"contains":case"matches_pattern":if("string"==typeof b&&"string"==typeof a.value)return RegExp(a.value,"i").test(b);return!1;case"greater_than":return Number(b)>Number(a.value);case"less_than":return Number(b)<Number(a.value);case"changed":return!0;default:return!1}}async checkForDuplicateAlert(a,b,c,g){let h=new Date(Date.now()-60*g*1e3);return(await d.db.select().from(e.competitorAlerts).where((0,f.Uo)((0,f.eq)(e.competitorAlerts.user_id,a),(0,f.eq)(e.competitorAlerts.competitor_id,b),(0,f.eq)(e.competitorAlerts.alert_type,c),(0,f.RO)(e.competitorAlerts.created_at,h))).limit(1)).length>0}async generateAlert(a,b,c,f){let g={competitor_id:a.competitor_id,user_id:a.user_id,intelligence_id:a.id,alert_type:c,severity:f.severity,title:this.generateAlertTitle(c,b.name,a),description:this.generateAlertDescription(c,a,f),source_data:{intelligence_id:a.id,trigger_id:f.id,confidence:a.confidence,source_url:a.source_url},action_items:this.generateActionItems(c,a,b),recommended_actions:this.generateRecommendedActions(c,a,b)};await d.db.insert(e.competitorAlerts).values(g)}generateAlertTitle(a,b,c){return({pricing_change:`${b} Changed Pricing`,product_launch:`${b} Launched New Product`,funding_announcement:`${b} Received Funding`,key_hire:`${b} Made Strategic Hire`,negative_news:`Negative News About ${b}`,website_change:`${b} Updated Website`,social_activity:`${b} Social Media Activity`,job_posting:`${b} Posted New Jobs`,partnership:`${b} Announced Partnership`,acquisition:`${b} Acquisition News`,market_expansion:`${b} Expanding Market`})[a]||`${b} Activity Detected`}generateAlertDescription(a,b,c){let d=(b.extracted_data||{}).content||b.raw_content||"",e="string"==typeof d?d.substring(0,200)+(d.length>200?"...":""):"Intelligence data detected";return`${c.description}

Details: ${e}`}generateActionItems(a,b,c){let d=[{id:`review-${Date.now()}`,title:"Review Intelligence Data",description:"Analyze the collected intelligence for strategic implications",priority:"medium",estimatedEffort:"15 minutes",potentialImpact:"medium"}],e={pricing_change:[{id:`pricing-analysis-${Date.now()}`,title:"Analyze Pricing Impact",description:"Evaluate how competitor pricing changes affect our positioning",priority:"high",estimatedEffort:"30 minutes",potentialImpact:"high"}],product_launch:[{id:`product-comparison-${Date.now()}`,title:"Compare Product Features",description:"Analyze new product features against our offerings",priority:"high",estimatedEffort:"45 minutes",potentialImpact:"high"}],funding_announcement:[{id:`funding-strategy-${Date.now()}`,title:"Assess Competitive Threat",description:"Evaluate increased competitive threat from new funding",priority:"high",estimatedEffort:"60 minutes",potentialImpact:"critical"}],key_hire:[{id:`talent-strategy-${Date.now()}`,title:"Review Talent Strategy",description:"Consider talent acquisition in response to competitor hiring",priority:"medium",estimatedEffort:"30 minutes",potentialImpact:"medium"}],negative_news:[{id:`opportunity-assessment-${Date.now()}`,title:"Identify Market Opportunities",description:"Assess opportunities arising from competitor challenges",priority:"high",estimatedEffort:"45 minutes",potentialImpact:"high"}],website_change:d,social_activity:d,job_posting:d,partnership:d,acquisition:d,market_expansion:d};return[...d,...e[a]||[]]}generateRecommendedActions(a,b,c){return["Monitor competitor response and market reaction","Update competitive analysis documentation","Share intelligence with relevant team members",...{pricing_change:["Consider adjusting pricing strategy","Analyze customer price sensitivity","Evaluate value proposition positioning"],product_launch:["Accelerate competing feature development","Update product roadmap priorities","Prepare competitive response messaging"],funding_announcement:["Increase market monitoring frequency","Prepare for increased competitive pressure","Consider strategic partnerships or funding"],key_hire:["Review talent retention strategies","Identify potential talent acquisition targets","Strengthen team in competing areas"],negative_news:["Capitalize on market opportunity","Increase marketing and sales efforts","Prepare messaging highlighting advantages"],website_change:["Analyze UX/UI improvements","Consider similar website enhancements"],social_activity:["Monitor engagement patterns","Adjust social media strategy"],job_posting:["Analyze hiring patterns for strategic insights","Consider talent acquisition in similar roles"],partnership:["Evaluate partnership opportunities","Assess impact on market positioning"],acquisition:["Analyze strategic implications","Consider defensive or offensive moves"],market_expansion:["Evaluate market entry opportunities","Prepare competitive response strategy"]}[a]||[]]}async getActiveAlerts(a,b=50){return await d.db.select({id:e.competitorAlerts.id,competitor_id:e.competitorAlerts.competitor_id,alert_type:e.competitorAlerts.alert_type,severity:e.competitorAlerts.severity,title:e.competitorAlerts.title,description:e.competitorAlerts.description,is_read:e.competitorAlerts.is_read,created_at:e.competitorAlerts.created_at,competitor_name:e.competitorProfiles.name,competitor_threat_level:e.competitorProfiles.threat_level}).from(e.competitorAlerts).leftJoin(e.competitorProfiles,(0,f.eq)(e.competitorAlerts.competitor_id,e.competitorProfiles.id)).where((0,f.Uo)((0,f.eq)(e.competitorAlerts.user_id,a),(0,f.eq)(e.competitorAlerts.is_archived,!1))).orderBy((0,g.i)(e.competitorAlerts.created_at)).limit(b)}async markAlertAsRead(a,b){await d.db.update(e.competitorAlerts).set({is_read:!0,acknowledged_at:new Date,updated_at:new Date}).where((0,f.Uo)((0,f.eq)(e.competitorAlerts.id,a),(0,f.eq)(e.competitorAlerts.user_id,b)))}async archiveAlert(a,b){await d.db.update(e.competitorAlerts).set({is_archived:!0,updated_at:new Date}).where((0,f.Uo)((0,f.eq)(e.competitorAlerts.id,a),(0,f.eq)(e.competitorAlerts.user_id,b)))}async getAlertsByCompetitor(a,b,c=20){return await d.db.select().from(e.competitorAlerts).where((0,f.Uo)((0,f.eq)(e.competitorAlerts.user_id,a),(0,f.eq)(e.competitorAlerts.competitor_id,b),(0,f.eq)(e.competitorAlerts.is_archived,!1))).orderBy((0,g.i)(e.competitorAlerts.created_at)).limit(c)}async getAlertStats(a){let b=await d.db.select({severity:e.competitorAlerts.severity,alert_type:e.competitorAlerts.alert_type,is_read:e.competitorAlerts.is_read}).from(e.competitorAlerts).where((0,f.Uo)((0,f.eq)(e.competitorAlerts.user_id,a),(0,f.eq)(e.competitorAlerts.is_archived,!1))),c={total:b.length,unread:b.filter(a=>!a.is_read).length,critical:b.filter(a=>"critical"===a.severity).length,urgent:b.filter(a=>"urgent"===a.severity).length,byType:{}};return b.forEach(a=>{c.byType[a.alert_type]=(c.byType[a.alert_type]||0)+1}),c}}let i=h.getInstance()},74291:(a,b,c)=>{"use strict";c.d(b,{_:()=>m,authenticateRequest:()=>l});var d=c(30477);c(10641);var e=c(86802),f=c(80829),g=c.n(f),h=c(94570),i=c(41393),j=c(48689);async function k(){try{let a=await (0,e.b3)(),b=a.get("authorization"),c=null;if(b&&b.startsWith("Bearer "))c=b.substring(7);else{let b=a.get("cookie");b&&(c=b.split(";").reduce((a,b)=>{let[c,d]=b.trim().split("=");return a[c]=d,a},{}).auth_token||null)}if(!c)return null;let d=g().verify(c,"local-development-jwt-secret-key");if(!d||!d.userId)return null;let f=(0,h.Lf)(),k=await f.select({id:i.users.id,email:i.users.email,full_name:i.users.full_name,username:i.users.username,date_of_birth:i.users.date_of_birth,created_at:i.users.created_at,updated_at:i.users.updated_at,subscription_tier:i.users.subscription_tier,subscription_status:i.users.subscription_status}).from(i.users).where((0,j.eq)(i.users.id,d.userId)).limit(1);if(0===k.length)return null;let l=k[0];return{id:l.id,email:l.email,full_name:l.full_name,name:l.full_name,username:l.username,created_at:l.created_at,updated_at:l.updated_at,subscription_tier:l.subscription_tier??"free",subscription_status:l.subscription_status??"active"}}catch(a){return(0,d.vV)("JWT authentication error:",a),null}}async function l(){try{let a=await k();if(a)return{user:a,error:null};return{user:null,error:"No authenticated user session found"}}catch(a){return(0,d.vV)("Authentication error:",a),{user:null,error:"Authentication failed"}}}async function m(a){try{let a=await l();return{user:a.user||void 0,error:a.error||void 0}}catch(a){return(0,d.vV)("verifyAuth error:",a),{error:"Authentication failed"}}}},78335:()=>{},96487:()=>{},97356:(a,b,c)=>{"use strict";c.d(b,{db:()=>d.db});var d=c(94570);c(41393)}};