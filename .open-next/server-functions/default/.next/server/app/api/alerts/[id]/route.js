(()=>{var a={};a.id=7575,a.ids=[4291,7575],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5492:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{H:()=>h});var e=c(30477),f=c(67939),g=a([f]);f=(g.then?(await g)():g)[0];class h{static async onCompetitorAdded(a,b){try{await this.triggerGamificationEvent(a,"competitor_added",1),(0,e.fH)(`Gamification triggered: competitor_added for user ${a}`)}catch(a){(0,e.vV)("Error triggering competitor added gamification:",a)}}static async onIntelligenceGathered(a,b=1){try{await this.triggerGamificationEvent(a,"intelligence_gathered",b),(0,e.fH)(`Gamification triggered: intelligence_gathered (${b}) for user ${a}`)}catch(a){(0,e.vV)("Error triggering intelligence gathered gamification:",a)}}static async onAlertProcessed(a,b){try{await this.triggerGamificationEvent(a,"alert_processed",1);let c=await (0,f.UU)(),{rows:d}=await c.query("SELECT severity FROM competitor_alerts WHERE id = $1 AND user_id = $2",[b,a]);d.length>0&&("urgent"===d[0].severity||"critical"===d[0].severity)&&await this.triggerGamificationEvent(a,"threat_response",1),(0,e.fH)(`Gamification triggered: alert_processed for user ${a}`)}catch(a){(0,e.vV)("Error triggering alert processed gamification:",a)}}static async onOpportunityIdentified(a,b){try{await this.triggerGamificationEvent(a,"opportunity_identified",1),(0,e.fH)(`Gamification triggered: opportunity_identified for user ${a}`)}catch(a){(0,e.vV)("Error triggering opportunity identified gamification:",a)}}static async onCompetitiveTaskCompleted(a,b){try{await this.triggerGamificationEvent(a,"competitive_task_completed",1);let c=await (0,f.UU)(),{rows:d}=await c.query("SELECT priority FROM tasks WHERE id = $1 AND user_id = $2",[b,a]);d.length>0&&("high"===d[0].priority||"critical"===d[0].priority)&&await this.awardBonusPoints(a,25,"High-priority competitive task completion"),(0,e.fH)(`Gamification triggered: competitive_task_completed for user ${a}`)}catch(a){(0,e.vV)("Error triggering competitive task completed gamification:",a)}}static async onIntelligenceStreak(a,b){try{await this.triggerGamificationEvent(a,"intelligence_streak",b),(0,e.fH)(`Gamification triggered: intelligence_streak (${b} days) for user ${a}`)}catch(a){(0,e.vV)("Error triggering intelligence streak gamification:",a)}}static async onCompetitiveVictory(a,b){try{let c={minor:50,moderate:100,major:250,game_changing:500}[b.impact_level];await this.triggerGamificationEvent(a,"competitive_victory",1,{...b,points_awarded:c}),(0,e.fH)(`Gamification triggered: competitive_victory (${b.impact_level}) for user ${a}`)}catch(a){(0,e.vV)("Error triggering competitive victory gamification:",a)}}static async checkIntelligenceStreaks(a){try{let b=await (0,f.UU)(),{rows:c}=await b.query(`SELECT DATE(collected_at) as activity_date, COUNT(*) as intelligence_count
         FROM intelligence_data 
         WHERE user_id = $1 
         AND collected_at > NOW() - INTERVAL '30 days'
         GROUP BY DATE(collected_at)
         ORDER BY activity_date DESC`,[a]),d=0,e=new Date;for(let a=0;a<c.length;a++){let b=new Date(c[a].activity_date);if(Math.floor((e.getTime()-b.getTime())/864e5)===a)d++;else break}await b.query("UPDATE user_competitive_stats SET intelligence_streaks = $1 WHERE user_id = $2",[d,a]),d>=7&&await this.onIntelligenceStreak(a,d)}catch(a){(0,e.vV)("Error checking intelligence streaks:",a)}}static async awardBonusPoints(a,b,c){try{let d=await (0,f.UU)();await d.query("UPDATE user_competitive_stats SET competitive_advantage_points = competitive_advantage_points + $1 WHERE user_id = $2",[b,a]),await d.query("UPDATE users SET total_points = total_points + $1 WHERE id = $2",[b,a]),(0,e.fH)(`Bonus points awarded: ${b} points to user ${a} for ${c}`)}catch(a){(0,e.vV)("Error awarding bonus points:",a)}}static async generateTeamChallenge(a){try{let b=await (0,f.UU)(),c=`team_challenge_${Date.now()}`,d={title:"Team Intelligence Domination",description:"Work together to gather competitive intelligence and dominate the market",objectives:[{task:"Collectively monitor 20 competitors",points:200,completed:!1},{task:"Process 100 competitive alerts as a team",points:300,completed:!1},{task:"Identify 15 market opportunities together",points:250,completed:!1},{task:"Achieve 5 competitive victories as a team",points:500,completed:!1}],total_points:1250,expires_at:new Date(Date.now()+12096e5)};for(let e of a)await b.query(`INSERT INTO competitive_challenges (
            id, user_id, title, description, objectives, total_points, expires_at
          ) VALUES ($1, $2, $3, $4, $5, $6, $7)`,[`${c}_${e}`,e,d.title,d.description,JSON.stringify(d.objectives),d.total_points,d.expires_at]);return c}catch(a){throw(0,e.vV)("Error generating team challenge:",a),a}}static async updateLeaderboards(){try{let a=await (0,f.UU)();await a.query(`
        INSERT INTO competitive_leaderboard (
          user_id, competitive_advantage_points, market_victories, intelligence_gathered, last_updated
        )
        SELECT 
          ucs.user_id,
          ucs.competitive_advantage_points,
          ucs.market_victories,
          ucs.intelligence_gathered,
          NOW()
        FROM user_competitive_stats ucs
        ON CONFLICT (user_id) DO UPDATE SET
          competitive_advantage_points = EXCLUDED.competitive_advantage_points,
          market_victories = EXCLUDED.market_victories,
          intelligence_gathered = EXCLUDED.intelligence_gathered,
          last_updated = NOW()
      `),await a.query(`
        WITH ranked_users AS (
          SELECT 
            user_id,
            ROW_NUMBER() OVER (ORDER BY competitive_advantage_points DESC, market_victories DESC) as new_rank,
            PERCENT_RANK() OVER (ORDER BY competitive_advantage_points DESC) * 100 as new_percentile
          FROM competitive_leaderboard
        )
        UPDATE competitive_leaderboard cl
        SET 
          rank_position = ru.new_rank,
          percentile = ROUND(ru.new_percentile::numeric, 2)
        FROM ranked_users ru
        WHERE cl.user_id = ru.user_id
      `),(0,e.fH)("Competitive intelligence leaderboards updated")}catch(a){(0,e.vV)("Error updating leaderboards:",a)}}static async triggerGamificationEvent(a,b,c,d){try{let a=await fetch("http://localhost:3000/api/competitive-intelligence/gamification",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.INTERNAL_API_KEY}`},body:JSON.stringify({activity_type:b,value:c,victory_data:d})});a.ok||(0,e.vV)(`Failed to trigger gamification for ${b}:`,await a.text())}catch(d){(0,e.vV)(`Error triggering gamification for ${b}:`,d);try{let d=await (0,f.UU)(),e=this.getStatUpdates(b,c);if(Object.keys(e).length>0){let b=`
            UPDATE user_competitive_stats SET 
            ${Object.keys(e).map((a,b)=>`${a} = ${a} + $${b+2}`).join(", ")},
            updated_at = NOW()
            WHERE user_id = $1
          `;await d.query(b,[a,...Object.values(e)])}}catch(a){(0,e.vV)("Fallback gamification update failed:",a)}}}static getStatUpdates(a,b){let c={};switch(a){case"competitor_added":c.competitors_monitored=b;break;case"intelligence_gathered":c.intelligence_gathered=b;break;case"alert_processed":c.alerts_processed=b;break;case"opportunity_identified":c.opportunities_identified=b;break;case"competitive_task_completed":c.competitive_tasks_completed=b;break;case"threat_response":c.threat_responses=b;break;case"competitive_victory":c.market_victories=b}return c}}d()}catch(a){d(a)}})},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12380:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{handler:()=>x,patchFetch:()=>w,routeModule:()=>y,serverHooks:()=>B,workAsyncStorage:()=>z,workUnitAsyncStorage:()=>A});var e=c(95736),f=c(9117),g=c(4044),h=c(39326),i=c(32324),j=c(261),k=c(54290),l=c(85328),m=c(38928),n=c(46595),o=c(3421),p=c(17679),q=c(41681),r=c(63446),s=c(86439),t=c(51356),u=c(47399),v=a([u]);u=(v.then?(await v)():v)[0];let y=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/alerts/[id]/route",pathname:"/api/alerts/[id]",filename:"route",bundlePath:"app/api/alerts/[id]/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"C:\\Users\\prett\\Desktop\\SoloSuccess AI\\app\\api\\alerts\\[id]\\route.ts",nextConfigOutput:"standalone",userland:u}),{workAsyncStorage:z,workUnitAsyncStorage:A,serverHooks:B}=y;function w(){return(0,g.patchFetch)({workAsyncStorage:z,workUnitAsyncStorage:A})}async function x(a,b,c){var d;let e="/api/alerts/[id]/route";"/index"===e&&(e="/");let g=await y.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(z.dynamicRoutes[E]||z.routes[D]);if(F&&!x){let a=!!z.routes[D],b=z.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||y.isDev||x||(G=D,G="/index"===G?"/":G);let H=!0===y.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:z,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>y.onRequestError(a,b,d,A)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>y.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await y.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},A),b}},l=await y.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||b instanceof s.NoFallbackError||await y.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}d()}catch(a){d(a)}})},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30477:(a,b,c)=>{"use strict";c.d(b,{HG:()=>i,JE:()=>g,fH:()=>h,vF:()=>e,vV:()=>f});class d{constructor(){this.isDevelopment=!1,this.logLevel=this.isDevelopment?3:2}shouldLog(a){return a<=this.logLevel}formatLogEntry(a){let b=["ERROR","WARN","INFO","DEBUG"][a.level],c=`[${a.timestamp}] ${b}: ${a.message}`;return a.context&&Object.keys(a.context).length>0&&(c+=` | Context: ${JSON.stringify(a.context)}`),a.error&&(c+=` | Error: ${a.error.message}`,this.isDevelopment&&a.error.stack&&(c+=` | Stack: ${a.error.stack}`)),c}log(a,b,c,d){if(!this.shouldLog(a))return;let e={level:a,message:b,timestamp:new Date().toISOString(),context:c,error:d},f=this.formatLogEntry(e);0===a&&console.error(f),!this.isDevelopment&&a<=1&&this.sendToExternalService(e)}async sendToExternalService(a){}error(a,b,c){this.log(0,a,b,c)}warn(a,b){this.log(1,a,b)}info(a,b){this.log(2,a,b)}debug(a,b){this.log(3,a,b)}apiLog(a,b,c,d,e){let f=`${a} ${b} - ${c}${d?` (${d}ms)`:""}`,g=c>=500?0:c>=400?1:2;this.log(g,f,{method:a,path:b,statusCode:c,duration:d,...e})}dbLog(a,b,c,d){let e=`DB ${a} on ${b}${c?` (${c}ms)`:""}`;this.log(3,e,{operation:a,table:b,duration:c,...d})}authLog(a,b,c=!0,d){let e=`Auth ${a}${b?` for user ${b}`:""} - ${c?"SUCCESS":"FAILED"}`;this.log(c?2:1,e,{action:a,userId:b,success:c,...d})}}let e=new d,f=(a,b,c)=>{b instanceof Error?e.error(a,void 0,b):"object"==typeof b&&null!==b?e.error(a,b,c):e.error(a,void 0,c)},g=(a,b)=>e.warn(a,b),h=(a,b)=>e.info(a,b),i=(a,b,c,d,f)=>e.apiLog(a,b,c,d,f)},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47399:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{DELETE:()=>p,GET:()=>n,PUT:()=>o});var e=c(30477),f=c(10641),g=c(97356),h=c(41393),i=c(74291),j=c(5492),k=c(2995),l=c(48689),m=a([j]);j=(m.then?(await m)():m)[0];let q=k.Ik({alertType:k.Yj().min(1).max(100).optional(),severity:k.k5(["info","warning","urgent","critical"]).optional(),title:k.Yj().min(1).max(255).optional(),description:k.Yj().max(1e3).optional(),sourceData:k.g1(k.bz()).optional(),actionItems:k.YO(k.Ik({id:k.Yj(),title:k.Yj(),description:k.Yj(),priority:k.k5(["low","medium","high"]),estimatedEffort:k.Yj(),potentialImpact:k.Yj(),recommendedBy:k.Yj(),dueDate:k.Yj().datetime().optional(),status:k.k5(["pending","in_progress","completed","dismissed"]).default("pending")})).optional(),recommendedActions:k.YO(k.Ik({id:k.Yj(),type:k.k5(["defensive","offensive","monitoring","strategic"]),title:k.Yj(),description:k.Yj(),priority:k.k5(["low","medium","high"]),estimatedEffort:k.Yj(),potentialImpact:k.Yj(),timeline:k.Yj(),actionItems:k.YO(k.Yj()).default([])})).optional(),isRead:k.zM().optional(),isArchived:k.zM().optional()});async function n(a,b){try{let{id:a}=await b.params,{user:c,error:d}=await (0,i.authenticateRequest)();if(d||!c)return f.NextResponse.json({error:"Unauthorized"},{status:401});let e=parseInt(a);if(isNaN(e))return f.NextResponse.json({error:"Invalid alert ID"},{status:400});let j=await g.db.select({alert:h.competitorAlerts,competitor:{id:h.competitorProfiles.id,name:h.competitorProfiles.name,domain:h.competitorProfiles.domain,threatLevel:h.competitorProfiles.threat_level},intelligence:{id:h.intelligenceData.id,sourceType:h.intelligenceData.source_type,dataType:h.intelligenceData.data_type,sourceUrl:h.intelligenceData.source_url}}).from(h.competitorAlerts).leftJoin(h.competitorProfiles,(0,l.eq)(h.competitorAlerts.competitor_id,h.competitorProfiles.id)).leftJoin(h.intelligenceData,(0,l.eq)(h.competitorAlerts.intelligence_id,h.intelligenceData.id)).where((0,l.Uo)((0,l.eq)(h.competitorAlerts.id,e),(0,l.eq)(h.competitorAlerts.user_id,c.id))).limit(1);if(0===j.length)return f.NextResponse.json({error:"Alert not found or access denied"},{status:404});let k=j[0],m={id:k.alert.id,competitorId:k.alert.competitor_id,userId:k.alert.user_id,intelligenceId:k.alert.intelligence_id||void 0,alertType:k.alert.alert_type,severity:k.alert.severity,title:k.alert.title,description:k.alert.description||void 0,sourceData:k.alert.source_data||{},actionItems:k.alert.action_items||[],recommendedActions:k.alert.recommended_actions||[],isRead:k.alert.is_read,isArchived:k.alert.is_archived,acknowledgedAt:k.alert.acknowledged_at||void 0,createdAt:k.alert.created_at,updatedAt:k.alert.updated_at};return f.NextResponse.json({alert:m,competitor:k.competitor?{id:k.competitor.id,name:k.competitor.name,domain:k.competitor.domain||void 0,threatLevel:k.competitor.threatLevel}:void 0,intelligence:k.intelligence?{id:k.intelligence.id,sourceType:k.intelligence.sourceType,dataType:k.intelligence.dataType,sourceUrl:k.intelligence.sourceUrl||void 0}:void 0})}catch(a){return(0,e.vV)("Error fetching alert:",a),f.NextResponse.json({error:"Failed to fetch alert"},{status:500})}}async function o(a,b){try{let{id:c}=await b.params,{user:d,error:e}=await (0,i.authenticateRequest)();if(e||!d)return f.NextResponse.json({error:"Unauthorized"},{status:401});let k=parseInt(c);if(isNaN(k))return f.NextResponse.json({error:"Invalid alert ID"},{status:400});let m=await a.json(),n=q.safeParse(m);if(!n.success)return f.NextResponse.json({error:"Invalid payload",details:n.error.flatten()},{status:400});let o=n.data,p=await g.db.select().from(h.competitorAlerts).where((0,l.Uo)((0,l.eq)(h.competitorAlerts.id,k),(0,l.eq)(h.competitorAlerts.user_id,d.id))).limit(1);if(0===p.length)return f.NextResponse.json({error:"Alert not found or access denied"},{status:404});let r={updated_at:new Date};void 0!==o.alertType&&(r.alert_type=o.alertType),void 0!==o.severity&&(r.severity=o.severity),void 0!==o.title&&(r.title=o.title),void 0!==o.description&&(r.description=o.description),void 0!==o.sourceData&&(r.source_data=o.sourceData),void 0!==o.actionItems&&(r.action_items=o.actionItems),void 0!==o.recommendedActions&&(r.recommended_actions=o.recommendedActions),void 0!==o.isRead&&(r.is_read=o.isRead),void 0!==o.isArchived&&(r.is_archived=o.isArchived);let[s]=await g.db.update(h.competitorAlerts).set(r).where((0,l.eq)(h.competitorAlerts.id,k)).returning();!0!==o.isRead||p[0].is_read||await j.H.onAlertProcessed(d.id,k);let t=await g.db.select({id:h.competitorProfiles.id,name:h.competitorProfiles.name,domain:h.competitorProfiles.domain,threatLevel:h.competitorProfiles.threat_level}).from(h.competitorProfiles).where((0,l.eq)(h.competitorProfiles.id,s.competitor_id)).limit(1),u=null;if(s.intelligence_id){let a=await g.db.select({id:h.intelligenceData.id,sourceType:h.intelligenceData.source_type,dataType:h.intelligenceData.data_type,sourceUrl:h.intelligenceData.source_url}).from(h.intelligenceData).where((0,l.eq)(h.intelligenceData.id,s.intelligence_id)).limit(1);u=a.length>0?a[0]:null}let v={id:s.id,competitorId:s.competitor_id,userId:s.user_id,intelligenceId:s.intelligence_id||void 0,alertType:s.alert_type,severity:s.severity,title:s.title,description:s.description||void 0,sourceData:s.source_data||{},actionItems:s.action_items||[],recommendedActions:s.recommended_actions||[],isRead:s.is_read,isArchived:s.is_archived,acknowledgedAt:s.acknowledged_at||void 0,createdAt:s.created_at,updatedAt:s.updated_at};return f.NextResponse.json({alert:v,competitor:t.length>0?{id:t[0].id,name:t[0].name,domain:t[0].domain||void 0,threatLevel:t[0].threatLevel}:void 0,intelligence:u?{id:u.id,sourceType:u.sourceType,dataType:u.dataType,sourceUrl:u.sourceUrl||void 0}:void 0})}catch(a){return(0,e.vV)("Error updating alert:",a),f.NextResponse.json({error:"Failed to update alert"},{status:500})}}async function p(a,b){try{let{id:a}=await b.params,{user:c,error:d}=await (0,i.authenticateRequest)();if(d||!c)return f.NextResponse.json({error:"Unauthorized"},{status:401});let e=parseInt(a);if(isNaN(e))return f.NextResponse.json({error:"Invalid alert ID"},{status:400});let j=await g.db.select().from(h.competitorAlerts).where((0,l.Uo)((0,l.eq)(h.competitorAlerts.id,e),(0,l.eq)(h.competitorAlerts.user_id,c.id))).limit(1);if(0===j.length)return f.NextResponse.json({error:"Alert not found or access denied"},{status:404});return await g.db.delete(h.competitorAlerts).where((0,l.eq)(h.competitorAlerts.id,e)),f.NextResponse.json({message:"Alert deleted successfully",deletedId:e})}catch(a){return(0,e.vV)("Error deleting alert:",a),f.NextResponse.json({error:"Failed to delete alert"},{status:500})}}d()}catch(a){d(a)}})},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64939:a=>{"use strict";a.exports=import("pg")},67939:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{KU:()=>j,P:()=>k,UU:()=>i});var e=c(30477),f=c(64939),g=a([f]);f=(g.then?(await g)():g)[0];let h=null,i=()=>{if(!h){let a="postgresql://neondb_owner:npg_MRLUf85DBNPv@ep-curly-meadow-aefoagku-pooler.c-2.us-east-2.aws.neon.tech/neondb?sslmode=require&channel_binding=require";if(!a)throw Error("Missing Neon database environment variables. Please set DATABASE_URL");(h=new f.Pool({connectionString:a,ssl:{rejectUnauthorized:!1},max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:2e3})).on("error",a=>{(0,e.vV)("Unexpected error on idle client",a)})}return h},j=async()=>{let a=i();return await a.connect()},k=async(a,b)=>{let c=await j();try{return await c.query(a,b)}finally{c.release()}};d()}catch(a){d(a)}})},74291:(a,b,c)=>{"use strict";c.d(b,{_:()=>m,authenticateRequest:()=>l});var d=c(30477);c(10641);var e=c(86802),f=c(80829),g=c.n(f),h=c(94570),i=c(41393),j=c(48689);async function k(){try{let a=await (0,e.b3)(),b=a.get("authorization"),c=null;if(b&&b.startsWith("Bearer "))c=b.substring(7);else{let b=a.get("cookie");b&&(c=b.split(";").reduce((a,b)=>{let[c,d]=b.trim().split("=");return a[c]=d,a},{}).auth_token||null)}if(!c)return null;let d=g().verify(c,"local-development-jwt-secret-key");if(!d||!d.userId)return null;let f=(0,h.Lf)(),k=await f.select({id:i.users.id,email:i.users.email,full_name:i.users.full_name,username:i.users.username,date_of_birth:i.users.date_of_birth,created_at:i.users.created_at,updated_at:i.users.updated_at,subscription_tier:i.users.subscription_tier,subscription_status:i.users.subscription_status}).from(i.users).where((0,j.eq)(i.users.id,d.userId)).limit(1);if(0===k.length)return null;let l=k[0];return{id:l.id,email:l.email,full_name:l.full_name,name:l.full_name,username:l.username,created_at:l.created_at,updated_at:l.updated_at,subscription_tier:l.subscription_tier??"free",subscription_status:l.subscription_status??"active"}}catch(a){return(0,d.vV)("JWT authentication error:",a),null}}async function l(){try{let a=await k();if(a)return{user:a,error:null};return{user:null,error:"No authenticated user session found"}}catch(a){return(0,d.vV)("Authentication error:",a),{user:null,error:"Authentication failed"}}}async function m(a){try{let a=await l();return{user:a.user||void 0,error:a.error||void 0}}catch(a){return(0,d.vV)("verifyAuth error:",a),{error:"Authentication failed"}}}},78335:()=>{},80829:a=>{"use strict";a.exports=require("jsonwebtoken")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},96487:()=>{},97356:(a,b,c)=>{"use strict";c.d(b,{db:()=>d.db});var d=c(94570);c(41393)}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[5873,1428,1692,9608,6802,2098,2995,4570],()=>b(b.s=12380));module.exports=c})();