(()=>{var a={};a.id=3302,a.ids=[3302],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},2952:(a,b,c)=>{"use strict";c.d(b,{$O:()=>r,DT:()=>u,NF:()=>s,Ow:()=>w,RY:()=>v,kU:()=>q,q5:()=>t,vd:()=>p});var d=c(44625),e=c(31009),f=c(49374),g=c(69385),h=c(60353),i=c(57105),j=c(81266),k=c(68019),l=c(40659),m=c(38729),n=c(80906),o=c(67183);function p(a){return(0,h.Kg)(a)?t(a):a.toOperationNode()}function q(a){return(0,h.MH)(a)?a.map(a=>r(a)):[r(a)]}function r(a){return(0,i.SS)(a)?(0,i.YK)(a):p(a)}function s(a,b){let c=t(a);if((0,l.Xm)(b))return m.Q.create(c,n.k.create(l.zX.create(b)));let d=b.slice(0,-1);if((0,l.Xm)(d))return m.Q.create(c,o.c.create(l.zX.create(d)));throw Error(`Invalid JSON operator: ${b}`)}function t(a){if(!a.includes("."))return f.q.create(e.Z.create(a));let b=a.split(".").map(x);if(3===b.length){var c=b;let[a,d,h]=c;return f.q.create(e.Z.create(h),g.H.createWithSchema(a,d))}if(2===b.length){var d=b;let[a,c]=d;return f.q.create(e.Z.create(c),g.H.create(a))}throw Error(`invalid column reference ${a}`)}function u(a){let b=" as ";if(!a.includes(b))return t(a);{let[c,e]=a.split(b).map(x);return d.N.create(t(c),j.O.create(e))}}function v(a){return e.Z.create(a)}function w(a){if(!a.includes(" "))return v(a);{let[b,c]=a.split(" ").map(x);if(!(0,k.bE)(c))throw Error(`invalid order direction "${c}" next to "${b}"`);return(0,k.xk)([b,c])[0]}}function x(a){return a.trim()}},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3421:(a,b,c)=>{"use strict";Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(71237),e=c(55088),f=c(17679);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},4315:(a,b,c)=>{"use strict";c.d(b,{L:()=>o});var d=c(47467),e=c(18804),f=c(93087),g=c(68228),h=c(54744),i=c(60353);let j=(0,i.CN)({is:a=>"ReturningNode"===a.kind,create:a=>(0,i.CN)({kind:"ReturningNode",selections:(0,i.CN)(a)}),cloneWithSelections:(a,b)=>(0,i.CN)({...a,selections:a.selections?(0,i.CN)([...a.selections,...b]):(0,i.CN)(b)})}),k=(0,i.CN)({is:a=>"ExplainNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"ExplainNode",format:a,options:b})});var l=c(24118);let m=(0,i.CN)({is:a=>"OutputNode"===a.kind,create:a=>(0,i.CN)({kind:"OutputNode",selections:(0,i.CN)(a)}),cloneWithSelections:(a,b)=>(0,i.CN)({...a,selections:a.selections?(0,i.CN)([...a.selections,...b]):(0,i.CN)(b)})});var n=c(47777);let o=(0,i.CN)({is:a=>e.L.is(a)||d.o.is(a)||f.U.is(a)||g.e.is(a)||l.r.is(a),cloneWithEndModifier:(a,b)=>(0,i.CN)({...a,endModifiers:a.endModifiers?(0,i.CN)([...a.endModifiers,b]):(0,i.CN)([b])}),cloneWithWhere:(a,b)=>(0,i.CN)({...a,where:a.where?h.o.cloneWithOperation(a.where,"And",b):h.o.create(b)}),cloneWithJoin:(a,b)=>(0,i.CN)({...a,joins:a.joins?(0,i.CN)([...a.joins,b]):(0,i.CN)([b])}),cloneWithReturning:(a,b)=>(0,i.CN)({...a,returning:a.returning?j.cloneWithSelections(a.returning,b):j.create(b)}),cloneWithoutReturning:a=>(0,i.CN)({...a,returning:void 0}),cloneWithoutWhere:a=>(0,i.CN)({...a,where:void 0}),cloneWithExplain:(a,b,c)=>(0,i.CN)({...a,explain:k.create(b,c?.toOperationNode())}),cloneWithTop:(a,b)=>(0,i.CN)({...a,top:b}),cloneWithOutput:(a,b)=>(0,i.CN)({...a,output:a.output?m.cloneWithSelections(a.output,b):m.create(b)}),cloneWithOrderByItems:(a,b)=>(0,i.CN)({...a,orderBy:a.orderBy?n.O.cloneWithItems(a.orderBy,b):n.O.create(b)}),cloneWithoutOrderBy:a=>(0,i.CN)({...a,orderBy:void 0})})},9005:(a,b,c)=>{"use strict";c.d(b,{U:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"SelectAllNode"===a.kind,create:()=>(0,d.CN)({kind:"SelectAllNode"})})},10106:(a,b,c)=>{"use strict";c.d(b,{F:()=>d,x:()=>e});class d extends Error{node;constructor(a){super("no result"),this.node=a}}function e(a){return Object.prototype.hasOwnProperty.call(a,"prototype")}},10670:(a,b,c)=>{"use strict";let d,e,f,g,h;c.r(b),c.d(b,{handler:()=>nR,patchFetch:()=>nQ,routeModule:()=>nM,serverHooks:()=>nP,workAsyncStorage:()=>nN,workUnitAsyncStorage:()=>nO});var i,j={};c.r(j),c.d(j,{GET:()=>nL,POST:()=>nL});var k=c(95736),l=c(9117),m=c(4044),n=c(39326),o=c(32324),p=c(261),q=c(54290),r=c(85328),s=c(38928),t=c(46595),u=c(3421),v=c(17679),w=c(41681),x=c(63446),y=c(86439),z=c(51356);function A(){let a="undefined"!=typeof globalThis&&globalThis.crypto;if(a&&"object"==typeof a.subtle&&null!=a.subtle)return a.subtle;throw Error("crypto.subtle must be defined")}let B=(()=>{let a=function(){};return a.prototype=Object.create(null),a})();function C(){return{root:{key:""},static:new B}}function D(a){return a.split("/").filter(Boolean)}function E(a,b){let c=new B;for(let[d,e]of b){let b=d<0?a.slice(-1*d).join("/"):a[d];if("string"==typeof e)c[e]=b;else{let a=b.match(e);if(a)for(let b in a.groups)c[b]=a.groups[b]}}return c}function F(a,b="",c,d){let e=D(c),f=a.root,g=0,h=[];for(let a=0;a<e.length;a++){let b=e[a];if(b.startsWith("**")){f.wildcard||(f.wildcard={key:"**"}),f=f.wildcard,h.push([-a,b.split(":")[1]||"_",2===b.length]);break}if("*"===b||b.includes(":")){f.param||(f.param={key:"*"}),f=f.param;let c="*"===b;h.push([a,c?`_${g++}`:function(a){if(!a.includes(":",1))return a.slice(1);let b=a.replace(/:(\w+)/g,(a,b)=>`(?<${b}>\\w+)`);return RegExp(`^${b}$`)}(b),c]);continue}let c=f.static?.[b];if(c)f=c;else{let a={key:b};f.static||(f.static=new B),f.static[b]=a,f=a}}let i=h.length>0;f.methods||(f.methods=new B),f.methods[b]||(f.methods[b]=[]),f.methods[b].push({data:d||null,paramsMap:i?h:void 0}),i||(a.static[c]=f)}var G=Object.defineProperty,H={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511},I=function(a,b){class c extends a{#a;constructor(...a){if(function(){let a=Object.getOwnPropertyDescriptor(Error,"stackTraceLimit");return void 0===a?Object.isExtensible(Error):Object.prototype.hasOwnProperty.call(a,"writable")?a.writable:void 0!==a.set}()){let b=Error.stackTraceLimit;Error.stackTraceLimit=0,super(...a),Error.stackTraceLimit=b}else super(...a);let b=Error().stack;b&&(this.#a=function(a){let b=a.split("\n    at ");return b.length<=1?a:(b.splice(1,1),b.join("\n    at "))}(b.replace(/^Error/,this.name)))}get errorStack(){return this.#a}}return Object.defineProperty(c.prototype,"constructor",{get:()=>b,enumerable:!1,configurable:!0}),c}(class extends Error{constructor(a="INTERNAL_SERVER_ERROR",b,c={},d="number"==typeof a?a:H[a]){super(b?.message,b?.cause?{cause:b.cause}:void 0),this.status=a,this.body=b,this.headers=c,this.statusCode=d,this.name="APIError",this.status=a,this.headers=c,this.statusCode=d,this.body=b?{code:b?.message?.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...b}:void 0}},Error);async function J(a){let b=a.headers.get("content-type")||"";if(a.body){if(b.includes("application/json"))return await a.json();if(b.includes("application/x-www-form-urlencoded")){let b=await a.formData(),c={};return b.forEach((a,b)=>{c[b]=a.toString()}),c}if(b.includes("multipart/form-data")){let b=await a.formData(),c={};return b.forEach((a,b)=>{c[b]=a}),c}return b.includes("text/plain")?await a.text():b.includes("application/octet-stream")?await a.arrayBuffer():b.includes("application/pdf")||b.includes("image/")||b.includes("video/")?await a.blob():b.includes("application/stream")||a.body instanceof ReadableStream?a.body:await a.text()}}function K(a){return a instanceof I||a?.name==="APIError"}function L(a,b){if(a instanceof Response)return b?.headers instanceof Headers&&b.headers.forEach((b,c)=>{a.headers.set(c,b)}),a;if(a&&"object"==typeof a&&"_flag"in a&&"json"===a._flag){let c=a.body,d=a.routerResponse;if(d instanceof Response)return d;let e=new Headers({...d?.headers,...a.headers,...b?.headers,"Content-Type":"application/json"});return new Response(JSON.stringify(c),{...d,headers:e,status:a.status??b?.status??d?.status,statusText:b?.statusText??d?.statusText})}if(K(a))return L(a.body,{status:b?.status??a.statusCode,statusText:a.status.toString(),headers:b?.headers||a.headers});let c=a,d=new Headers(b?.headers);return a?"string"==typeof a?(c=a,d.set("Content-Type","text/plain")):a instanceof ArrayBuffer||ArrayBuffer.isView(a)?(c=a,d.set("Content-Type","application/octet-stream")):a instanceof Blob?(c=a,d.set("Content-Type",a.type||"application/octet-stream")):a instanceof FormData?c=a:a instanceof URLSearchParams?(c=a,d.set("Content-Type","application/x-www-form-urlencoded")):a instanceof ReadableStream?(c=a,d.set("Content-Type","application/octet-stream")):function(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}(a)&&(c=function(a,b,c){let d=0,e=new WeakMap;return JSON.stringify(a,(a,b)=>{if("bigint"==typeof b)return b.toString();if("object"==typeof b&&null!==b){if(e.has(b))return`[Circular ref-${e.get(b)}]`;e.set(b,d++)}return b},void 0)}(a),d.set("Content-Type","application/json")):(null===a&&(c=JSON.stringify(null)),d.set("content-type","application/json")),new Response(c,{...b,headers:d})}async function M(a,b={}){let c={body:b.body,query:b.query};if(a.body){let d=await a.body["~standard"].validate(b.body);if(d.issues)return{data:null,error:N(d.issues,"body")};c.body=d.value}if(a.query){let d=await a.query["~standard"].validate(b.query);if(d.issues)return{data:null,error:N(d.issues,"query")};c.query=d.value}return a.requireHeaders&&!b.headers?{data:null,error:{message:"Headers is required"}}:a.requireRequest&&!b.request?{data:null,error:{message:"Request is required"}}:{data:c,error:null}}function N(a,b){let c=[];for(let b of a){let a=b.message;c.push(a)}return{message:`Invalid ${b} parameters`}}var O={name:"HMAC",hash:"SHA-256"},P=async a=>{let b="string"==typeof a?new TextEncoder().encode(a):a;return await A().importKey("raw",b,O,!1,["sign","verify"])},Q=async(a,b,c)=>{try{let d=atob(a),e=new Uint8Array(d.length);for(let a=0,b=d.length;a<b;a++)e[a]=d.charCodeAt(a);return await A().verify(O,c,e,new TextEncoder().encode(b))}catch(a){return!1}},R=async(a,b)=>{let c=await P(b);return btoa(String.fromCharCode(...new Uint8Array(await A().sign(O.name,c,new TextEncoder().encode(a)))))},S=async(a,b)=>{let c=await R(a,b);return encodeURIComponent(a=`${a}.${c}`)},T=(a,b)=>{let c=a;if(b)if("secure"===b)c="__Secure-"+a;else{if("host"!==b)return;c="__Host-"+a}return c},U=(a,b,c={})=>{let d;if(d=c?.prefix==="secure"?`__Secure-${a}=${b}`:c?.prefix==="host"?`__Host-${a}=${b}`:`${a}=${b}`,a.startsWith("__Secure-")&&!c.secure&&(c.secure=!0),a.startsWith("__Host-")&&(c.secure||(c.secure=!0),"/"!==c.path&&(c.path="/"),c.domain&&(c.domain=void 0)),c&&"number"==typeof c.maxAge&&c.maxAge>=0){if(c.maxAge>3456e4)throw Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");d+=`; Max-Age=${Math.floor(c.maxAge)}`}if(c.domain&&"host"!==c.prefix&&(d+=`; Domain=${c.domain}`),c.path&&(d+=`; Path=${c.path}`),c.expires){if(c.expires.getTime()-Date.now()>3456e7)throw Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");d+=`; Expires=${c.expires.toUTCString()}`}return c.httpOnly&&(d+="; HttpOnly"),c.secure&&(d+="; Secure"),c.sameSite&&(d+=`; SameSite=${c.sameSite.charAt(0).toUpperCase()+c.sameSite.slice(1)}`),c.partitioned&&(c.secure||(c.secure=!0),d+="; Partitioned"),d},V=async(a,b,c,d)=>U(a,b=await S(b,c),d),W=async(a,{options:b,path:c})=>{let d=new Headers,{data:e,error:f}=await M(b,a);if(f)throw new I(400,{message:f.message,code:"VALIDATION_ERROR"});let g="headers"in a?a.headers instanceof Headers?a.headers:new Headers(a.headers):"request"in a&&a.request instanceof Request?a.request.headers:null,h=g?.get("cookie"),i=h?function(a){if("string"!=typeof a)throw TypeError("argument str must be a string");let b=new Map,c=0;for(;c<a.length;){let d=a.indexOf("=",c);if(-1===d)break;let e=a.indexOf(";",c);if(-1===e)e=a.length;else if(e<d){c=a.lastIndexOf(";",d-1)+1;continue}let f=a.slice(c,d).trim();if(!b.has(f)){let c=a.slice(d+1,e).trim();34===c.codePointAt(0)&&(c=c.slice(1,-1)),b.set(f,function(a){try{return a.includes("%")?decodeURIComponent(a):a}catch{return a}}(c))}c=e+1}return b}(h):void 0,j={...a,body:e.body,query:e.query,path:a.path||c,context:"context"in a&&a.context?a.context:{},returned:void 0,headers:a?.headers,request:a?.request,params:"params"in a?a.params:void 0,method:a.method,setHeader:(a,b)=>{d.set(a,b)},getHeader:a=>g?g.get(a):null,getCookie:(a,b)=>{let c=T(a,b);return c&&i?.get(c)||null},getSignedCookie:async(a,b,c)=>{let d=T(a,c);if(!d)return null;let e=i?.get(d);if(!e)return null;let f=e.lastIndexOf(".");if(f<1)return null;let g=e.substring(0,f),h=e.substring(f+1);if(44!==h.length||!h.endsWith("="))return null;let j=await P(b);return!!await Q(h,g,j)&&g},setCookie:(a,b,c)=>{let e=((a,b,c)=>U(a,b=encodeURIComponent(b),c))(a,b,c);return d.append("set-cookie",e),e},setSignedCookie:async(a,b,c,e)=>{let f=await V(a,b,c,e);return d.append("set-cookie",f),f},redirect:a=>(d.set("location",a),new I("FOUND",void 0,d)),error:(a,b,c)=>new I(a,b,c),json:(b,c)=>a.asResponse?{body:c?.body||b,routerResponse:c,_flag:"json"}:b,responseHeaders:d};for(let a of b.use||[]){let b=await a({...j,returnHeaders:!0,asResponse:!1});b.response&&Object.assign(j.context,b.response),b.headers&&b.headers.forEach((a,b)=>{j.responseHeaders.set(b,a)})}return j};function X(a,b){let c=async c=>{let d="function"==typeof a?a:b,e=await W(c,{options:"function"==typeof a?{}:a,path:"/"});if(!d)throw Error("handler must be defined");let f=await d(e),g=e.responseHeaders;return c.returnHeaders?{headers:g,response:f}:f};return c.options="function"==typeof a?{}:a,c}X.create=a=>function(b,c){if("function"==typeof b)return X({use:a?.use},b);if(!c)throw Error("Middleware handler is required");return X({...b,method:"*",use:[...a?.use||[],...b.use||[]]},c)};var Y=(a,b,c)=>{let d=async(...d)=>{let e=d[0]||{},f=await W(e,{options:b,path:a}),g=await c(f).catch(async a=>{if(K(a)){let c=b.onAPIError;if(c&&await c(a),e.asResponse)return a}throw a}),h=f.responseHeaders;return e.asResponse?L(g,{headers:h}):e.returnHeaders?{headers:h,response:g}:g};return d.options=b,d.path=a,d};function Z(a,b,c){function d(c,d){var e;for(let f in Object.defineProperty(c,"_zod",{value:c._zod??{},enumerable:!1}),(e=c._zod).traits??(e.traits=new Set),c._zod.traits.add(a),b(c,d),g.prototype)f in c||Object.defineProperty(c,f,{value:g.prototype[f].bind(c)});c._zod.constr=g,c._zod.def=d}let e=c?.Parent??Object;class f extends e{}function g(a){var b;let e=c?.Parent?new f:this;for(let c of(d(e,a),(b=e._zod).deferred??(b.deferred=[]),e._zod.deferred))c();return e}return Object.defineProperty(f,"name",{value:a}),Object.defineProperty(g,"init",{value:d}),Object.defineProperty(g,Symbol.hasInstance,{value:b=>!!c?.Parent&&b instanceof c.Parent||b?._zod?.traits?.has(a)}),Object.defineProperty(g,"name",{value:a}),g}Y.create=a=>(b,c,d)=>Y(b,{...c,use:[...c?.use||[],...a?.use||[]]},d),Object.freeze({status:"aborted"}),Symbol("zod_brand");var $=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},_={};function aa(a){return a&&Object.assign(_,a),_}var ab={};function ac(a){return a}function ad(a){return a}function ae(a){}function af(a){throw Error()}function ag(a){}function ah(a){let b=Object.values(a).filter(a=>"number"==typeof a);return Object.entries(a).filter(([a,c])=>-1===b.indexOf(+a)).map(([a,b])=>b)}function ai(a,b="|"){return a.map(a=>aG(a)).join(b)}function aj(a,b){return"bigint"==typeof b?b.toString():b}function ak(a){return{get value(){{let b=a();return Object.defineProperty(this,"value",{value:b}),b}}}}function al(a){return null==a}function am(a){let b=+!!a.startsWith("^"),c=a.endsWith("$")?a.length-1:a.length;return a.slice(b,c)}function an(a,b){let c=(a.toString().split(".")[1]||"").length,d=(b.toString().split(".")[1]||"").length,e=c>d?c:d;return Number.parseInt(a.toFixed(e).replace(".",""))%Number.parseInt(b.toFixed(e).replace(".",""))/10**e}function ao(a,b,c){Object.defineProperty(a,b,{get(){{let d=c();return a[b]=d,d}},set(c){Object.defineProperty(a,b,{value:c})},configurable:!0})}function ap(a,b,c){Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!0,configurable:!0})}function aq(a,b){return b?b.reduce((a,b)=>a?.[b],a):a}function ar(a){let b=Object.keys(a);return Promise.all(b.map(b=>a[b])).then(a=>{let c={};for(let d=0;d<b.length;d++)c[b[d]]=a[d];return c})}function as(a=10){let b="abcdefghijklmnopqrstuvwxyz",c="";for(let d=0;d<a;d++)c+=b[Math.floor(Math.random()*b.length)];return c}function at(a){return JSON.stringify(a)}((a,b)=>{for(var c in b)G(a,c,{get:b[c],enumerable:!0})})(ab,{BIGINT_FORMAT_RANGES:()=>aJ,Class:()=>aY,NUMBER_FORMAT_RANGES:()=>aI,aborted:()=>aQ,allowsEval:()=>aw,assert:()=>ag,assertEqual:()=>ac,assertIs:()=>ae,assertNever:()=>af,assertNotEqual:()=>ad,assignProp:()=>ap,cached:()=>ak,captureStackTrace:()=>au,cleanEnum:()=>aX,cleanRegex:()=>am,clone:()=>aD,createTransparentProxy:()=>aF,defineLazy:()=>ao,esc:()=>at,escapeRegex:()=>aC,extend:()=>aM,finalizeIssue:()=>aT,floatSafeRemainder:()=>an,getElementAtPath:()=>aq,getEnumValues:()=>ah,getLengthableOrigin:()=>aV,getParsedType:()=>az,getSizableOrigin:()=>aU,isObject:()=>av,isPlainObject:()=>ax,issue:()=>aW,joinValues:()=>ai,jsonStringifyReplacer:()=>aj,merge:()=>aN,normalizeParams:()=>aE,nullish:()=>al,numKeys:()=>ay,omit:()=>aL,optionalKeys:()=>aH,partial:()=>aO,pick:()=>aK,prefixIssues:()=>aR,primitiveTypes:()=>aB,promiseAllObject:()=>ar,propertyKeyTypes:()=>aA,randomString:()=>as,required:()=>aP,stringifyPrimitive:()=>aG,unwrapMessage:()=>aS});var au=Error.captureStackTrace?Error.captureStackTrace:(...a)=>{};function av(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}var aw=ak(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(a){return!1}});function ax(a){if(!1===av(a))return!1;let b=a.constructor;if(void 0===b)return!0;let c=b.prototype;return!1!==av(c)&&!1!==Object.prototype.hasOwnProperty.call(c,"isPrototypeOf")}function ay(a){let b=0;for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b++;return b}var az=a=>{let b=typeof a;switch(b){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(a)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(a.then&&"function"==typeof a.then&&a.catch&&"function"==typeof a.catch)return"promise";if("undefined"!=typeof Map&&a instanceof Map)return"map";if("undefined"!=typeof Set&&a instanceof Set)return"set";if("undefined"!=typeof Date&&a instanceof Date)return"date";if("undefined"!=typeof File&&a instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${b}`)}},aA=new Set(["string","number","symbol"]),aB=new Set(["string","number","bigint","boolean","symbol","undefined"]);function aC(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function aD(a,b,c){let d=new a._zod.constr(b??a._zod.def);return(!b||c?.parent)&&(d._zod.parent=a),d}function aE(a){if(!a)return{};if("string"==typeof a)return{error:()=>a};if(a?.message!==void 0){if(a?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");a.error=a.message}return(delete a.message,"string"==typeof a.error)?{...a,error:()=>a.error}:a}function aF(a){let b;return new Proxy({},{get:(c,d,e)=>(b??(b=a()),Reflect.get(b,d,e)),set:(c,d,e,f)=>(b??(b=a()),Reflect.set(b,d,e,f)),has:(c,d)=>(b??(b=a()),Reflect.has(b,d)),deleteProperty:(c,d)=>(b??(b=a()),Reflect.deleteProperty(b,d)),ownKeys:c=>(b??(b=a()),Reflect.ownKeys(b)),getOwnPropertyDescriptor:(c,d)=>(b??(b=a()),Reflect.getOwnPropertyDescriptor(b,d)),defineProperty:(c,d,e)=>(b??(b=a()),Reflect.defineProperty(b,d,e))})}function aG(a){return"bigint"==typeof a?a.toString()+"n":"string"==typeof a?`"${a}"`:`${a}`}function aH(a){return Object.keys(a).filter(b=>"optional"===a[b]._zod.optin&&"optional"===a[b]._zod.optout)}var aI={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},aJ={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function aK(a,b){let c={},d=a._zod.def;for(let a in b){if(!(a in d.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&(c[a]=d.shape[a])}return aD(a,{...a._zod.def,shape:c,checks:[]})}function aL(a,b){let c={...a._zod.def.shape},d=a._zod.def;for(let a in b){if(!(a in d.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&delete c[a]}return aD(a,{...a._zod.def,shape:c,checks:[]})}function aM(a,b){if(!ax(b))throw Error("Invalid input to extend: expected a plain object");let c={...a._zod.def,get shape(){let c={...a._zod.def.shape,...b};return ap(this,"shape",c),c},checks:[]};return aD(a,c)}function aN(a,b){return aD(a,{...a._zod.def,get shape(){let c={...a._zod.def.shape,...b._zod.def.shape};return ap(this,"shape",c),c},catchall:b._zod.def.catchall,checks:[]})}function aO(a,b,c){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in d))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=a?new a({type:"optional",innerType:d[b]}):d[b])}else for(let b in d)e[b]=a?new a({type:"optional",innerType:d[b]}):d[b];return aD(b,{...b._zod.def,shape:e,checks:[]})}function aP(a,b,c){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in e))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=new a({type:"nonoptional",innerType:d[b]}))}else for(let b in d)e[b]=new a({type:"nonoptional",innerType:d[b]});return aD(b,{...b._zod.def,shape:e,checks:[]})}function aQ(a,b=0){for(let c=b;c<a.issues.length;c++)if(a.issues[c]?.continue!==!0)return!0;return!1}function aR(a,b){return b.map(b=>(b.path??(b.path=[]),b.path.unshift(a),b))}function aS(a){return"string"==typeof a?a:a?.message}function aT(a,b,c){let d={...a,path:a.path??[]};return a.message||(d.message=aS(a.inst?._zod.def?.error?.(a))??aS(b?.error?.(a))??aS(c.customError?.(a))??aS(c.localeError?.(a))??"Invalid input"),delete d.inst,delete d.continue,b?.reportInput||delete d.input,d}function aU(a){return a instanceof Set?"set":a instanceof Map?"map":a instanceof File?"file":"unknown"}function aV(a){return Array.isArray(a)?"array":"string"==typeof a?"string":"unknown"}function aW(...a){let[b,c,d]=a;return"string"==typeof b?{message:b,code:"custom",input:c,inst:d}:{...b}}function aX(a){return Object.entries(a).filter(([a,b])=>Number.isNaN(Number.parseInt(a,10))).map(a=>a[1])}var aY=class{constructor(...a){}},aZ=(a,b)=>{a.name="$ZodError",Object.defineProperty(a,"_zod",{value:a._zod,enumerable:!1}),Object.defineProperty(a,"issues",{value:b,enumerable:!1}),Object.defineProperty(a,"message",{get:()=>JSON.stringify(b,aj,2),enumerable:!0}),Object.defineProperty(a,"toString",{value:()=>a.message,enumerable:!1})},a$=Z("$ZodError",aZ),a_=Z("$ZodError",aZ,{Parent:Error}),a0=a=>(b,c,d)=>{let e=d?{...d,async:!1}:{async:!1},f=b._zod.run({value:c,issues:[]},e);if(f instanceof Promise)throw new $;return f.issues.length?{success:!1,error:new(a??a$)(f.issues.map(a=>aT(a,e,aa())))}:{success:!0,data:f.value}},a1=a0(a_),a2=a=>async(b,c,d)=>{let e=d?Object.assign(d,{async:!0}):{async:!0},f=b._zod.run({value:c,issues:[]},e);return f instanceof Promise&&(f=await f),f.issues.length?{success:!1,error:new a(f.issues.map(a=>aT(a,e,aa())))}:{success:!0,data:f.value}},a3=a2(a_),a4=Z("$ZodCheck",(a,b)=>{var c;a._zod??(a._zod={}),a._zod.def=b,(c=a._zod).onattach??(c.onattach=[])}),a5=Z("$ZodCheckMaxLength",(a,b)=>{var c;a4.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return!al(b)&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.maximum??1/0;b.maximum<c&&(a._zod.bag.maximum=b.maximum)}),a._zod.check=c=>{let d=c.value;if(d.length<=b.maximum)return;let e=aV(d);c.issues.push({origin:e,code:"too_big",maximum:b.maximum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),a6=Z("$ZodCheckMinLength",(a,b)=>{var c;a4.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return!al(b)&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.minimum??-1/0;b.minimum>c&&(a._zod.bag.minimum=b.minimum)}),a._zod.check=c=>{let d=c.value;if(d.length>=b.minimum)return;let e=aV(d);c.issues.push({origin:e,code:"too_small",minimum:b.minimum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),a7=Z("$ZodCheckLengthEquals",(a,b)=>{var c;a4.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return!al(b)&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag;c.minimum=b.length,c.maximum=b.length,c.length=b.length}),a._zod.check=c=>{let d=c.value,e=d.length;if(e===b.length)return;let f=aV(d),g=e>b.length;c.issues.push({origin:f,...g?{code:"too_big",maximum:b.length}:{code:"too_small",minimum:b.length},inclusive:!0,exact:!0,input:c.value,inst:a,continue:!b.abort})}}),a8=Z("$ZodCheckOverwrite",(a,b)=>{a4.init(a,b),a._zod.check=a=>{a.value=b.tx(a.value)}}),a9=class{constructor(a=[]){this.content=[],this.indent=0,this&&(this.args=a)}indented(a){this.indent+=1,a(this),this.indent-=1}write(a){if("function"==typeof a){a(this,{execution:"sync"}),a(this,{execution:"async"});return}let b=a.split("\n").filter(a=>a),c=Math.min(...b.map(a=>a.length-a.trimStart().length));for(let a of b.map(a=>a.slice(c)).map(a=>" ".repeat(2*this.indent)+a))this.content.push(a)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(a=>`  ${a}`)].join("\n"))}},ba={major:4,minor:0,patch:0},bb=Z("$ZodType",(a,b)=>{var c;a??(a={}),a._zod.def=b,a._zod.bag=a._zod.bag||{},a._zod.version=ba;let d=[...a._zod.def.checks??[]];for(let b of(a._zod.traits.has("$ZodCheck")&&d.unshift(a),d))for(let c of b._zod.onattach)c(a);if(0===d.length)(c=a._zod).deferred??(c.deferred=[]),a._zod.deferred?.push(()=>{a._zod.run=a._zod.parse});else{let b=(a,b,c)=>{let d,e=aQ(a);for(let f of b){if(f._zod.def.when){if(!f._zod.def.when(a))continue}else if(e)continue;let b=a.issues.length,g=f._zod.check(a);if(g instanceof Promise&&c?.async===!1)throw new $;if(d||g instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await g,a.issues.length!==b&&(e||(e=aQ(a,b)))});else{if(a.issues.length===b)continue;e||(e=aQ(a,b))}}return d?d.then(()=>a):a};a._zod.run=(c,e)=>{let f=a._zod.parse(c,e);if(f instanceof Promise){if(!1===e.async)throw new $;return f.then(a=>b(a,d,e))}return b(f,d,e)}}a["~standard"]={validate:b=>{try{let c=a1(a,b);return c.success?{value:c.data}:{issues:c.error?.issues}}catch(c){return a3(a,b).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}}),bc=Z("$ZodUnknown",(a,b)=>{bb.init(a,b),a._zod.parse=a=>a}),bd=Z("$ZodNever",(a,b)=>{bb.init(a,b),a._zod.parse=(b,c)=>(b.issues.push({expected:"never",code:"invalid_type",input:b.value,inst:a}),b)});function be(a,b,c){a.issues.length&&b.issues.push(...aR(c,a.issues)),b.value[c]=a.value}var bf=Z("$ZodArray",(a,b)=>{bb.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!Array.isArray(e))return c.issues.push({expected:"array",code:"invalid_type",input:e,inst:a}),c;c.value=Array(e.length);let f=[];for(let a=0;a<e.length;a++){let g=e[a],h=b.element._zod.run({value:g,issues:[]},d);h instanceof Promise?f.push(h.then(b=>be(b,c,a))):be(h,c,a)}return f.length?Promise.all(f).then(()=>c):c}});function bg(a,b,c){a.issues.length&&b.issues.push(...aR(c,a.issues)),b.value[c]=a.value}function bh(a,b,c,d){a.issues.length?void 0===d[c]?c in d?b.value[c]=void 0:b.value[c]=a.value:b.issues.push(...aR(c,a.issues)):void 0===a.value?c in d&&(b.value[c]=void 0):b.value[c]=a.value}var bi=Z("$ZodObject",(a,b)=>{let c,d;bb.init(a,b);let e=ak(()=>{let a=Object.keys(b.shape);for(let c of a)if(!(b.shape[c]instanceof bb))throw Error(`Invalid element at key "${c}": expected a Zod schema`);let c=aH(b.shape);return{shape:b.shape,keys:a,keySet:new Set(a),numKeys:a.length,optionalKeys:new Set(c)}});ao(a._zod,"propValues",()=>{let a=b.shape,c={};for(let b in a){let d=a[b]._zod;if(d.values)for(let a of(c[b]??(c[b]=new Set),d.values))c[b].add(a)}return c});let f=!_.jitless,g=f&&aw.value,h=b.catchall;a._zod.parse=(i,j)=>{d??(d=e.value);let k=i.value;if(!av(k))return i.issues.push({expected:"object",code:"invalid_type",input:k,inst:a}),i;let l=[];if(f&&g&&j?.async===!1&&!0!==j.jitless)c||(c=(a=>{let b=new a9(["shape","payload","ctx"]),c=e.value,d=a=>{let b=at(a);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};b.write("const input = payload.value;");let f=Object.create(null),g=0;for(let a of c.keys)f[a]=`key_${g++}`;for(let a of(b.write("const newResult = {}"),c.keys))if(c.optionalKeys.has(a)){let c=f[a];b.write(`const ${c} = ${d(a)};`);let e=at(a);b.write(`
        if (${c}.issues.length) {
          if (input[${e}] === undefined) {
            if (${e} in input) {
              newResult[${e}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${c}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${e}, ...iss.path] : [${e}],
              }))
            );
          }
        } else if (${c}.value === undefined) {
          if (${e} in input) newResult[${e}] = undefined;
        } else {
          newResult[${e}] = ${c}.value;
        }
        `)}else{let c=f[a];b.write(`const ${c} = ${d(a)};`),b.write(`
          if (${c}.issues.length) payload.issues = payload.issues.concat(${c}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${at(a)}, ...iss.path] : [${at(a)}]
          })));`),b.write(`newResult[${at(a)}] = ${c}.value`)}b.write("payload.value = newResult;"),b.write("return payload;");let h=b.compile();return(b,c)=>h(a,b,c)})(b.shape)),i=c(i,j);else{i.value={};let a=d.shape;for(let b of d.keys){let c=a[b],d=c._zod.run({value:k[b],issues:[]},j),e="optional"===c._zod.optin&&"optional"===c._zod.optout;d instanceof Promise?l.push(d.then(a=>e?bh(a,i,b,k):bg(a,i,b))):e?bh(d,i,b,k):bg(d,i,b)}}if(!h)return l.length?Promise.all(l).then(()=>i):i;let m=[],n=d.keySet,o=h._zod,p=o.def.type;for(let a of Object.keys(k)){if(n.has(a))continue;if("never"===p){m.push(a);continue}let b=o.run({value:k[a],issues:[]},j);b instanceof Promise?l.push(b.then(b=>bg(b,i,a))):bg(b,i,a)}return(m.length&&i.issues.push({code:"unrecognized_keys",keys:m,input:k,inst:a}),l.length)?Promise.all(l).then(()=>i):i}});function bj(a,b,c,d){for(let c of a)if(0===c.issues.length)return b.value=c.value,b;return b.issues.push({code:"invalid_union",input:b.value,inst:c,errors:a.map(a=>a.issues.map(a=>aT(a,d,aa())))}),b}var bk=Z("$ZodUnion",(a,b)=>{bb.init(a,b),ao(a._zod,"optin",()=>b.options.some(a=>"optional"===a._zod.optin)?"optional":void 0),ao(a._zod,"optout",()=>b.options.some(a=>"optional"===a._zod.optout)?"optional":void 0),ao(a._zod,"values",()=>{if(b.options.every(a=>a._zod.values))return new Set(b.options.flatMap(a=>Array.from(a._zod.values)))}),ao(a._zod,"pattern",()=>{if(b.options.every(a=>a._zod.pattern)){let a=b.options.map(a=>a._zod.pattern);return RegExp(`^(${a.map(a=>am(a.source)).join("|")})$`)}}),a._zod.parse=(c,d)=>{let e=!1,f=[];for(let a of b.options){let b=a._zod.run({value:c.value,issues:[]},d);if(b instanceof Promise)f.push(b),e=!0;else{if(0===b.issues.length)return b;f.push(b)}}return e?Promise.all(f).then(b=>bj(b,c,a,d)):bj(f,c,a,d)}}),bl=Z("$ZodIntersection",(a,b)=>{bb.init(a,b),a._zod.parse=(a,c)=>{let d=a.value,e=b.left._zod.run({value:d,issues:[]},c),f=b.right._zod.run({value:d,issues:[]},c);return e instanceof Promise||f instanceof Promise?Promise.all([e,f]).then(([b,c])=>bm(a,b,c)):bm(a,e,f)}});function bm(a,b,c){if(b.issues.length&&a.issues.push(...b.issues),c.issues.length&&a.issues.push(...c.issues),aQ(a))return a;let d=function a(b,c){if(b===c||b instanceof Date&&c instanceof Date&&+b==+c)return{valid:!0,data:b};if(ax(b)&&ax(c)){let d=Object.keys(c),e=Object.keys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1,mergeErrorPath:[d,...e.mergeErrorPath]};f[d]=e.data}return{valid:!0,data:f}}if(Array.isArray(b)&&Array.isArray(c)){if(b.length!==c.length)return{valid:!1,mergeErrorPath:[]};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1,mergeErrorPath:[e,...f.mergeErrorPath]};d.push(f.data)}return{valid:!0,data:d}}return{valid:!1,mergeErrorPath:[]}}(b.value,c.value);if(!d.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(d.mergeErrorPath)}`);return a.value=d.data,a}var bn=Z("$ZodEnum",(a,b)=>{bb.init(a,b);let c=ah(b.entries);a._zod.values=new Set(c),a._zod.pattern=RegExp(`^(${c.filter(a=>aA.has(typeof a)).map(a=>"string"==typeof a?aC(a):a.toString()).join("|")})$`),a._zod.parse=(b,d)=>{let e=b.value;return a._zod.values.has(e)||b.issues.push({code:"invalid_value",values:c,input:e,inst:a}),b}}),bo=Z("$ZodTransform",(a,b)=>{bb.init(a,b),a._zod.parse=(a,c)=>{let d=b.transform(a.value,a);if(c.async)return(d instanceof Promise?d:Promise.resolve(d)).then(b=>(a.value=b,a));if(d instanceof Promise)throw new $;return a.value=d,a}}),bp=Z("$ZodOptional",(a,b)=>{bb.init(a,b),a._zod.optin="optional",a._zod.optout="optional",ao(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,void 0]):void 0),ao(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${am(a.source)})?$`):void 0}),a._zod.parse=(a,c)=>"optional"===b.innerType._zod.optin?b.innerType._zod.run(a,c):void 0===a.value?a:b.innerType._zod.run(a,c)}),bq=Z("$ZodNullable",(a,b)=>{bb.init(a,b),ao(a._zod,"optin",()=>b.innerType._zod.optin),ao(a._zod,"optout",()=>b.innerType._zod.optout),ao(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${am(a.source)}|null)$`):void 0}),ao(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,null]):void 0),a._zod.parse=(a,c)=>null===a.value?a:b.innerType._zod.run(a,c)}),br=Z("$ZodDefault",(a,b)=>{bb.init(a,b),a._zod.optin="optional",ao(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if(void 0===a.value)return a.value=b.defaultValue,a;let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(a=>bs(a,b)):bs(d,b)}});function bs(a,b){return void 0===a.value&&(a.value=b.defaultValue),a}var bt=Z("$ZodPrefault",(a,b)=>{bb.init(a,b),a._zod.optin="optional",ao(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>(void 0===a.value&&(a.value=b.defaultValue),b.innerType._zod.run(a,c))}),bu=Z("$ZodNonOptional",(a,b)=>{bb.init(a,b),ao(a._zod,"values",()=>{let a=b.innerType._zod.values;return a?new Set([...a].filter(a=>void 0!==a)):void 0}),a._zod.parse=(c,d)=>{let e=b.innerType._zod.run(c,d);return e instanceof Promise?e.then(b=>bv(b,a)):bv(e,a)}});function bv(a,b){return a.issues.length||void 0!==a.value||a.issues.push({code:"invalid_type",expected:"nonoptional",input:a.value,inst:b}),a}var bw=Z("$ZodCatch",(a,b)=>{bb.init(a,b),a._zod.optin="optional",ao(a._zod,"optout",()=>b.innerType._zod.optout),ao(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(d=>(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>aT(a,c,aa()))},input:a.value}),a.issues=[]),a)):(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>aT(a,c,aa()))},input:a.value}),a.issues=[]),a)}}),bx=Z("$ZodPipe",(a,b)=>{bb.init(a,b),ao(a._zod,"values",()=>b.in._zod.values),ao(a._zod,"optin",()=>b.in._zod.optin),ao(a._zod,"optout",()=>b.out._zod.optout),a._zod.parse=(a,c)=>{let d=b.in._zod.run(a,c);return d instanceof Promise?d.then(a=>by(a,b,c)):by(d,b,c)}});function by(a,b,c){return aQ(a)?a:b.out._zod.run({value:a.value,issues:a.issues},c)}var bz=Z("$ZodReadonly",(a,b)=>{bb.init(a,b),ao(a._zod,"propValues",()=>b.innerType._zod.propValues),ao(a._zod,"values",()=>b.innerType._zod.values),ao(a._zod,"optin",()=>b.innerType._zod.optin),ao(a._zod,"optout",()=>b.innerType._zod.optout),a._zod.parse=(a,c)=>{let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(bA):bA(d)}});function bA(a){return a.value=Object.freeze(a.value),a}var bB=Z("$ZodCustom",(a,b)=>{a4.init(a,b),bb.init(a,b),a._zod.parse=(a,b)=>a,a._zod.check=c=>{let d=c.value,e=b.fn(d);if(e instanceof Promise)return e.then(b=>bC(b,c,d,a));bC(e,c,d,a)}});function bC(a,b,c,d){if(!a){let a={code:"custom",input:c,inst:d,path:[...d._zod.def.path??[]],continue:!d._zod.def.abort};d._zod.def.params&&(a.params=d._zod.def.params),b.issues.push(aW(a))}}Symbol("ZodOutput"),Symbol("ZodInput");var bD=new class{constructor(){this._map=new Map,this._idmap=new Map}add(a,...b){let c=b[0];if(this._map.set(a,c),c&&"object"==typeof c&&"id"in c){if(this._idmap.has(c.id))throw Error(`ID ${c.id} already exists in the registry`);this._idmap.set(c.id,a)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(a){let b=this._map.get(a);return b&&"object"==typeof b&&"id"in b&&this._idmap.delete(b.id),this._map.delete(a),this}get(a){let b=a._zod.parent;if(b){let c={...this.get(b)??{}};return delete c.id,{...c,...this._map.get(a)}}return this._map.get(a)}has(a){return this._map.has(a)}};function bE(a,b){return new a6({check:"min_length",...aE(b),minimum:a})}var bF=(a,b)=>{a$.init(a,b),a.name="ZodError",Object.defineProperties(a,{format:{value:b=>(function(a,b){let c=b||function(a){return a.message},d={_errors:[]},e=a=>{for(let b of a.issues)if("invalid_union"===b.code&&b.errors.length)b.errors.map(a=>e({issues:a}));else if("invalid_key"===b.code)e({issues:b.issues});else if("invalid_element"===b.code)e({issues:b.issues});else if(0===b.path.length)d._errors.push(c(b));else{let a=d,e=0;for(;e<b.path.length;){let d=b.path[e];e===b.path.length-1?(a[d]=a[d]||{_errors:[]},a[d]._errors.push(c(b))):a[d]=a[d]||{_errors:[]},a=a[d],e++}}};return e(a),d})(a,b)},flatten:{value:b=>(function(a,b=a=>a.message){let c={},d=[];for(let e of a.issues)e.path.length>0?(c[e.path[0]]=c[e.path[0]]||[],c[e.path[0]].push(b(e))):d.push(b(e));return{formErrors:d,fieldErrors:c}})(a,b)},addIssue:{value:b=>a.issues.push(b)},addIssues:{value:b=>a.issues.push(...b)},isEmpty:{get:()=>0===a.issues.length}})};Z("ZodError",bF);var bG=Z("ZodError",bF,{Parent:Error}),bH=(a,b,c,d)=>{let e=c?Object.assign(c,{async:!1}):{async:!1},f=a._zod.run({value:b,issues:[]},e);if(f instanceof Promise)throw new $;if(f.issues.length){let a=new(d?.Err??bG)(f.issues.map(a=>aT(a,e,aa())));throw au(a,d?.callee),a}return f.value},bI=async(a,b,c,d)=>{let e=c?Object.assign(c,{async:!0}):{async:!0},f=a._zod.run({value:b,issues:[]},e);if(f instanceof Promise&&(f=await f),f.issues.length){let a=new(d?.Err??bG)(f.issues.map(a=>aT(a,e,aa())));throw au(a,d?.callee),a}return f.value},bJ=a0(bG),bK=a2(bG),bL=Z("ZodType",(a,b)=>(bb.init(a,b),a.def=b,Object.defineProperty(a,"_def",{value:b}),a.check=(...c)=>a.clone({...b,checks:[...b.checks??[],...c.map(a=>"function"==typeof a?{_zod:{check:a,def:{check:"custom"},onattach:[]}}:a)]}),a.clone=(b,c)=>aD(a,b,c),a.brand=()=>a,a.register=(b,c)=>(b.add(a,c),a),a.parse=(b,c)=>bH(a,b,c,{callee:a.parse}),a.safeParse=(b,c)=>bJ(a,b,c),a.parseAsync=async(b,c)=>bI(a,b,c,{callee:a.parseAsync}),a.safeParseAsync=async(b,c)=>bK(a,b,c),a.spa=a.safeParseAsync,a.refine=(b,c)=>a.check(function(a,b={}){return new b4({type:"custom",check:"custom",fn:a,...aE(b)})}(b,c)),a.superRefine=b=>a.check(function(a){let b=function(a){let b=new a4({check:"custom"});return b._zod.check=a,b}(c=>(c.addIssue=a=>{"string"==typeof a?c.issues.push(ab.issue(a,c.value,b._zod.def)):(a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=c.value),a.inst??(a.inst=b),a.continue??(a.continue=!b._zod.def.abort),c.issues.push(ab.issue(a)))},a(c.value,c)));return b}(b)),a.overwrite=b=>a.check(new a8({check:"overwrite",tx:b})),a.optional=()=>bW(a),a.nullable=()=>bY(a),a.nullish=()=>bW(bY(a)),a.nonoptional=b=>{var c,d;return c=a,d=b,new b_({type:"nonoptional",innerType:c,...ab.normalizeParams(d)})},a.array=()=>(function(a,b){return new bP({type:"array",element:a,...aE(void 0)})})(a),a.or=b=>new bR({type:"union",options:[a,b],...ab.normalizeParams(void 0)}),a.and=b=>{var c;return c=a,new bS({type:"intersection",left:c,right:b})},a.transform=b=>b2(a,new bU({type:"transform",transform:b})),a.default=b=>(function(a,b){return new bZ({type:"default",innerType:a,get defaultValue(){return"function"==typeof b?b():b}})})(a,b),a.prefault=b=>(function(a,b){return new b$({type:"prefault",innerType:a,get defaultValue(){return"function"==typeof b?b():b}})})(a,b),a.catch=b=>(function(a,b){return new b0({type:"catch",innerType:a,catchValue:"function"==typeof b?b:()=>b})})(a,b),a.pipe=b=>b2(a,b),a.readonly=()=>new b3({type:"readonly",innerType:a}),a.describe=b=>{let c=a.clone();return bD.add(c,{description:b}),c},Object.defineProperty(a,"description",{get:()=>bD.get(a)?.description,configurable:!0}),a.meta=(...b)=>{if(0===b.length)return bD.get(a);let c=a.clone();return bD.add(c,b[0]),c},a.isOptional=()=>a.safeParse(void 0).success,a.isNullable=()=>a.safeParse(null).success,a)),bM=Z("ZodUnknown",(a,b)=>{bc.init(a,b),bL.init(a,b)});function bN(){return new bM({type:"unknown"})}var bO=Z("ZodNever",(a,b)=>{bd.init(a,b),bL.init(a,b)}),bP=Z("ZodArray",(a,b)=>{bf.init(a,b),bL.init(a,b),a.element=b.element,a.min=(b,c)=>a.check(bE(b,c)),a.nonempty=b=>a.check(bE(1,b)),a.max=(b,c)=>a.check(new a5({check:"max_length",...aE(c),maximum:b})),a.length=(b,c)=>a.check(new a7({check:"length_equals",...aE(c),length:b})),a.unwrap=()=>a.element}),bQ=Z("ZodObject",(a,b)=>{bi.init(a,b),bL.init(a,b),ab.defineLazy(a,"shape",()=>b.shape),a.keyof=()=>(function(a,b){return new bT({type:"enum",entries:Array.isArray(a)?Object.fromEntries(a.map(a=>[a,a])):a,...ab.normalizeParams(void 0)})})(Object.keys(a._zod.def.shape)),a.catchall=b=>a.clone({...a._zod.def,catchall:b}),a.passthrough=()=>a.clone({...a._zod.def,catchall:bN()}),a.loose=()=>a.clone({...a._zod.def,catchall:bN()}),a.strict=()=>a.clone({...a._zod.def,catchall:new bO({type:"never",...aE(void 0)})}),a.strip=()=>a.clone({...a._zod.def,catchall:void 0}),a.extend=b=>ab.extend(a,b),a.merge=b=>ab.merge(a,b),a.pick=b=>ab.pick(a,b),a.omit=b=>ab.omit(a,b),a.partial=(...b)=>ab.partial(bV,a,b[0]),a.required=(...b)=>ab.required(b_,a,b[0])}),bR=Z("ZodUnion",(a,b)=>{bk.init(a,b),bL.init(a,b),a.options=b.options}),bS=Z("ZodIntersection",(a,b)=>{bl.init(a,b),bL.init(a,b)}),bT=Z("ZodEnum",(a,b)=>{bn.init(a,b),bL.init(a,b),a.enum=b.entries,a.options=Object.values(b.entries);let c=new Set(Object.keys(b.entries));a.extract=(a,d)=>{let e={};for(let d of a)if(c.has(d))e[d]=b.entries[d];else throw Error(`Key ${d} not found in enum`);return new bT({...b,checks:[],...ab.normalizeParams(d),entries:e})},a.exclude=(a,d)=>{let e={...b.entries};for(let b of a)if(c.has(b))delete e[b];else throw Error(`Key ${b} not found in enum`);return new bT({...b,checks:[],...ab.normalizeParams(d),entries:e})}}),bU=Z("ZodTransform",(a,b)=>{bo.init(a,b),bL.init(a,b),a._zod.parse=(c,d)=>{c.addIssue=d=>{"string"==typeof d?c.issues.push(ab.issue(d,c.value,b)):(d.fatal&&(d.continue=!1),d.code??(d.code="custom"),d.input??(d.input=c.value),d.inst??(d.inst=a),d.continue??(d.continue=!0),c.issues.push(ab.issue(d)))};let e=b.transform(c.value,c);return e instanceof Promise?e.then(a=>(c.value=a,c)):(c.value=e,c)}}),bV=Z("ZodOptional",(a,b)=>{bp.init(a,b),bL.init(a,b),a.unwrap=()=>a._zod.def.innerType});function bW(a){return new bV({type:"optional",innerType:a})}var bX=Z("ZodNullable",(a,b)=>{bq.init(a,b),bL.init(a,b),a.unwrap=()=>a._zod.def.innerType});function bY(a){return new bX({type:"nullable",innerType:a})}var bZ=Z("ZodDefault",(a,b)=>{br.init(a,b),bL.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeDefault=a.unwrap}),b$=Z("ZodPrefault",(a,b)=>{bt.init(a,b),bL.init(a,b),a.unwrap=()=>a._zod.def.innerType}),b_=Z("ZodNonOptional",(a,b)=>{bu.init(a,b),bL.init(a,b),a.unwrap=()=>a._zod.def.innerType}),b0=Z("ZodCatch",(a,b)=>{bw.init(a,b),bL.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeCatch=a.unwrap}),b1=Z("ZodPipe",(a,b)=>{bx.init(a,b),bL.init(a,b),a.in=b.in,a.out=b.out});function b2(a,b){return new b1({type:"pipe",in:a,out:b})}var b3=Z("ZodReadonly",(a,b)=>{bz.init(a,b),bL.init(a,b)}),b4=Z("ZodCustom",(a,b)=>{bB.init(a,b),bL.init(a,b)}),b5={};function b6(a){switch(a.constructor.name){case"ZodString":default:return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array"}}function b7(a){let b=[];return a.metadata?.openapi?.parameters?b.push(...a.metadata.openapi.parameters):a.query instanceof bQ&&Object.entries(a.query.shape).forEach(([a,c])=>{c instanceof bQ&&b.push({name:a,in:"query",schema:{type:b6(c),..."minLength"in c&&c.minLength?{minLength:c.minLength}:{},description:c.description}})}),b}function b8(a){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...a}}async function b9(a,b){return Object.entries(a).forEach(([a,b])=>{let c=b.options;if(!c.metadata?.SERVER_ONLY&&("GET"===c.method&&(b5[b.path]={get:{tags:["Default",...c.metadata?.openapi?.tags||[]],description:c.metadata?.openapi?.description,operationId:c.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:b7(c),responses:b8(c.metadata?.openapi?.responses)}}),"POST"===c.method)){let a=function(a){if(a.metadata?.openapi?.requestBody)return a.metadata.openapi.requestBody;if(a.body&&(a.body instanceof bQ||a.body instanceof bV)){let b=a.body.shape;if(!b)return;let c={},d=[];return Object.entries(b).forEach(([a,b])=>{b instanceof bQ&&(c[a]={type:b6(b),description:b.description},b instanceof bV||d.push(a))}),{required:!(a.body instanceof bV)&&!!a.body,content:{"application/json":{schema:{type:"object",properties:c,required:d}}}}}}(c);b5[b.path]={post:{tags:["Default",...c.metadata?.openapi?.tags||[]],description:c.metadata?.openapi?.description,operationId:c.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:b7(c),...a?{requestBody:a}:{requestBody:{content:{"application/json":{schema:{type:"object",properties:{}}}}}},responses:b8(c.metadata?.openapi?.responses)}}}}),{openapi:"3.1.1",info:{title:"Better Auth",description:"API Reference for your Better Auth Instance",version:"1.1.0"},components:{schemas:{}},security:[{apiKeyCookie:[]}],servers:[{url:b?.url}],tags:[{name:"Default",description:"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."}],paths:b5}}function ca(a,b,c){function d(c,d){var e;for(let f in Object.defineProperty(c,"_zod",{value:c._zod??{},enumerable:!1}),(e=c._zod).traits??(e.traits=new Set),c._zod.traits.add(a),b(c,d),g.prototype)f in c||Object.defineProperty(c,f,{value:g.prototype[f].bind(c)});c._zod.constr=g,c._zod.def=d}let e=c?.Parent??Object;class f extends e{}function g(a){var b;let e=c?.Parent?new f:this;for(let c of(d(e,a),(b=e._zod).deferred??(b.deferred=[]),e._zod.deferred))c();return e}return Object.defineProperty(f,"name",{value:a}),Object.defineProperty(g,"init",{value:d}),Object.defineProperty(g,Symbol.hasInstance,{value:b=>!!c?.Parent&&b instanceof c.Parent||b?._zod?.traits?.has(a)}),Object.defineProperty(g,"name",{value:a}),g}Object.freeze({status:"aborted"}),Symbol("zod_brand");class cb extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class cc extends Error{constructor(a){super(`Encountered unidirectional transform during encode: ${a}`),this.name="ZodEncodeError"}}let cd={};function ce(a){return a&&Object.assign(cd,a),cd}function cf(a,b="|"){return a.map(a=>cx(a)).join(b)}function cg(a,b){return"bigint"==typeof b?b.toString():b}function ch(a){return{get value(){{let b=a();return Object.defineProperty(this,"value",{value:b}),b}}}}function ci(a){let b=+!!a.startsWith("^"),c=a.endsWith("$")?a.length-1:a.length;return a.slice(b,c)}let cj=Symbol("evaluating");function ck(a,b,c){let d;Object.defineProperty(a,b,{get(){if(d!==cj)return void 0===d&&(d=cj,d=c()),d},set(c){Object.defineProperty(a,b,{value:c})},configurable:!0})}function cl(a,b,c){Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!0,configurable:!0})}function cm(...a){let b={};for(let c of a)Object.assign(b,Object.getOwnPropertyDescriptors(c));return Object.defineProperties({},b)}function cn(a){return JSON.stringify(a)}let co="captureStackTrace"in Error?Error.captureStackTrace:(...a)=>{};function cp(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}let cq=ch(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(a){return!1}});function cr(a){if(!1===cp(a))return!1;let b=a.constructor;if(void 0===b)return!0;let c=b.prototype;return!1!==cp(c)&&!1!==Object.prototype.hasOwnProperty.call(c,"isPrototypeOf")}function cs(a){return cr(a)?{...a}:Array.isArray(a)?[...a]:a}let ct=new Set(["string","number","symbol"]);function cu(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function cv(a,b,c){let d=new a._zod.constr(b??a._zod.def);return(!b||c?.parent)&&(d._zod.parent=a),d}function cw(a){if(!a)return{};if("string"==typeof a)return{error:()=>a};if(a?.message!==void 0){if(a?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");a.error=a.message}return(delete a.message,"string"==typeof a.error)?{...a,error:()=>a.error}:a}function cx(a){return"bigint"==typeof a?a.toString()+"n":"string"==typeof a?`"${a}"`:`${a}`}let cy={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function cz(a,b=0){if(!0===a.aborted)return!0;for(let c=b;c<a.issues.length;c++)if(a.issues[c]?.continue!==!0)return!0;return!1}function cA(a,b){return b.map(b=>(b.path??(b.path=[]),b.path.unshift(a),b))}function cB(a){return"string"==typeof a?a:a?.message}function cC(a,b,c){let d={...a,path:a.path??[]};return a.message||(d.message=cB(a.inst?._zod.def?.error?.(a))??cB(b?.error?.(a))??cB(c.customError?.(a))??cB(c.localeError?.(a))??"Invalid input"),delete d.inst,delete d.continue,b?.reportInput||delete d.input,d}function cD(a){return Array.isArray(a)?"array":"string"==typeof a?"string":"unknown"}function cE(...a){let[b,c,d]=a;return"string"==typeof b?{message:b,code:"custom",input:c,inst:d}:{...b}}let cF=(a,b)=>{a.name="$ZodError",Object.defineProperty(a,"_zod",{value:a._zod,enumerable:!1}),Object.defineProperty(a,"issues",{value:b,enumerable:!1}),a.message=JSON.stringify(b,cg,2),Object.defineProperty(a,"toString",{value:()=>a.message,enumerable:!1})},cG=ca("$ZodError",cF),cH=ca("$ZodError",cF,{Parent:Error}),cI=a=>(b,c,d,e)=>{let f=d?Object.assign(d,{async:!1}):{async:!1},g=b._zod.run({value:c,issues:[]},f);if(g instanceof Promise)throw new cb;if(g.issues.length){let b=new(e?.Err??a)(g.issues.map(a=>cC(a,f,ce())));throw co(b,e?.callee),b}return g.value},cJ=a=>async(b,c,d,e)=>{let f=d?Object.assign(d,{async:!0}):{async:!0},g=b._zod.run({value:c,issues:[]},f);if(g instanceof Promise&&(g=await g),g.issues.length){let b=new(e?.Err??a)(g.issues.map(a=>cC(a,f,ce())));throw co(b,e?.callee),b}return g.value},cK=a=>(b,c,d)=>{let e=d?{...d,async:!1}:{async:!1},f=b._zod.run({value:c,issues:[]},e);if(f instanceof Promise)throw new cb;return f.issues.length?{success:!1,error:new(a??cG)(f.issues.map(a=>cC(a,e,ce())))}:{success:!0,data:f.value}},cL=cK(cH),cM=a=>async(b,c,d)=>{let e=d?Object.assign(d,{async:!0}):{async:!0},f=b._zod.run({value:c,issues:[]},e);return f instanceof Promise&&(f=await f),f.issues.length?{success:!1,error:new a(f.issues.map(a=>cC(a,e,ce())))}:{success:!0,data:f.value}},cN=cM(cH),cO=/^[cC][^\s-]{8,}$/,cP=/^[0-9a-z]+$/,cQ=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,cR=/^[0-9a-vA-V]{20}$/,cS=/^[A-Za-z0-9]{27}$/,cT=/^[a-zA-Z0-9_-]{21}$/,cU=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,cV=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,cW=a=>a?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${a}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,cX=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,cY=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,cZ=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,c$=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,c_=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,c0=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,c1=/^[A-Za-z0-9_-]*$/,c2=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,c3=/^\+(?:[0-9]){6,14}[0-9]$/,c4="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",c5=RegExp(`^${c4}$`);function c6(a){let b="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof a.precision?-1===a.precision?`${b}`:0===a.precision?`${b}:[0-5]\\d`:`${b}:[0-5]\\d\\.\\d{${a.precision}}`:`${b}(?::[0-5]\\d(?:\\.\\d+)?)?`}let c7=/^-?\d+n?$/,c8=/^-?\d+$/,c9=/^-?\d+(?:\.\d+)?/,da=/^(?:true|false)$/i,db=/^[^A-Z]*$/,dc=/^[^a-z]*$/,dd=ca("$ZodCheck",(a,b)=>{var c;a._zod??(a._zod={}),a._zod.def=b,(c=a._zod).onattach??(c.onattach=[])}),de={number:"number",bigint:"bigint",object:"date"},df=ca("$ZodCheckLessThan",(a,b)=>{dd.init(a,b);let c=de[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.maximum:c.exclusiveMaximum)??1/0;b.value<d&&(b.inclusive?c.maximum=b.value:c.exclusiveMaximum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value<=b.value:d.value<b.value)||d.issues.push({origin:c,code:"too_big",maximum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),dg=ca("$ZodCheckGreaterThan",(a,b)=>{dd.init(a,b);let c=de[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.minimum:c.exclusiveMinimum)??-1/0;b.value>d&&(b.inclusive?c.minimum=b.value:c.exclusiveMinimum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value>=b.value:d.value>b.value)||d.issues.push({origin:c,code:"too_small",minimum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),dh=ca("$ZodCheckMultipleOf",(a,b)=>{dd.init(a,b),a._zod.onattach.push(a=>{var c;(c=a._zod.bag).multipleOf??(c.multipleOf=b.value)}),a._zod.check=c=>{if(typeof c.value!=typeof b.value)throw Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof c.value?c.value%b.value===BigInt(0):0===function(a,b){let c=(a.toString().split(".")[1]||"").length,d=b.toString(),e=(d.split(".")[1]||"").length;if(0===e&&/\d?e-\d?/.test(d)){let a=d.match(/\d?e-(\d?)/);a?.[1]&&(e=Number.parseInt(a[1]))}let f=c>e?c:e;return Number.parseInt(a.toFixed(f).replace(".",""))%Number.parseInt(b.toFixed(f).replace(".",""))/10**f}(c.value,b.value))||c.issues.push({origin:typeof c.value,code:"not_multiple_of",divisor:b.value,input:c.value,inst:a,continue:!b.abort})}}),di=ca("$ZodCheckNumberFormat",(a,b)=>{dd.init(a,b),b.format=b.format||"float64";let c=b.format?.includes("int"),d=c?"int":"number",[e,f]=cy[b.format];a._zod.onattach.push(a=>{let d=a._zod.bag;d.format=b.format,d.minimum=e,d.maximum=f,c&&(d.pattern=c8)}),a._zod.check=g=>{let h=g.value;if(c){if(!Number.isInteger(h))return void g.issues.push({expected:d,format:b.format,code:"invalid_type",continue:!1,input:h,inst:a});if(!Number.isSafeInteger(h))return void(h>0?g.issues.push({input:h,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}):g.issues.push({input:h,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}))}h<e&&g.issues.push({origin:"number",input:h,code:"too_small",minimum:e,inclusive:!0,inst:a,continue:!b.abort}),h>f&&g.issues.push({origin:"number",input:h,code:"too_big",maximum:f,inst:a})}}),dj=ca("$ZodCheckMaxLength",(a,b)=>{var c;dd.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.maximum??1/0;b.maximum<c&&(a._zod.bag.maximum=b.maximum)}),a._zod.check=c=>{let d=c.value;if(d.length<=b.maximum)return;let e=cD(d);c.issues.push({origin:e,code:"too_big",maximum:b.maximum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),dk=ca("$ZodCheckMinLength",(a,b)=>{var c;dd.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.minimum??-1/0;b.minimum>c&&(a._zod.bag.minimum=b.minimum)}),a._zod.check=c=>{let d=c.value;if(d.length>=b.minimum)return;let e=cD(d);c.issues.push({origin:e,code:"too_small",minimum:b.minimum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),dl=ca("$ZodCheckLengthEquals",(a,b)=>{var c;dd.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return null!=b&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag;c.minimum=b.length,c.maximum=b.length,c.length=b.length}),a._zod.check=c=>{let d=c.value,e=d.length;if(e===b.length)return;let f=cD(d),g=e>b.length;c.issues.push({origin:f,...g?{code:"too_big",maximum:b.length}:{code:"too_small",minimum:b.length},inclusive:!0,exact:!0,input:c.value,inst:a,continue:!b.abort})}}),dm=ca("$ZodCheckStringFormat",(a,b)=>{var c,d;dd.init(a,b),a._zod.onattach.push(a=>{let c=a._zod.bag;c.format=b.format,b.pattern&&(c.patterns??(c.patterns=new Set),c.patterns.add(b.pattern))}),b.pattern?(c=a._zod).check??(c.check=c=>{b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:b.format,input:c.value,...b.pattern?{pattern:b.pattern.toString()}:{},inst:a,continue:!b.abort})}):(d=a._zod).check??(d.check=()=>{})}),dn=ca("$ZodCheckRegex",(a,b)=>{dm.init(a,b),a._zod.check=c=>{b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:"regex",input:c.value,pattern:b.pattern.toString(),inst:a,continue:!b.abort})}}),dp=ca("$ZodCheckLowerCase",(a,b)=>{b.pattern??(b.pattern=db),dm.init(a,b)}),dq=ca("$ZodCheckUpperCase",(a,b)=>{b.pattern??(b.pattern=dc),dm.init(a,b)}),dr=ca("$ZodCheckIncludes",(a,b)=>{dd.init(a,b);let c=cu(b.includes),d=new RegExp("number"==typeof b.position?`^.{${b.position}}${c}`:c);b.pattern=d,a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(d)}),a._zod.check=c=>{c.value.includes(b.includes,b.position)||c.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:b.includes,input:c.value,inst:a,continue:!b.abort})}}),ds=ca("$ZodCheckStartsWith",(a,b)=>{dd.init(a,b);let c=RegExp(`^${cu(b.prefix)}.*`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.startsWith(b.prefix)||c.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:b.prefix,input:c.value,inst:a,continue:!b.abort})}}),dt=ca("$ZodCheckEndsWith",(a,b)=>{dd.init(a,b);let c=RegExp(`.*${cu(b.suffix)}$`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.endsWith(b.suffix)||c.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:b.suffix,input:c.value,inst:a,continue:!b.abort})}}),du=ca("$ZodCheckOverwrite",(a,b)=>{dd.init(a,b),a._zod.check=a=>{a.value=b.tx(a.value)}});class dv{constructor(a=[]){this.content=[],this.indent=0,this&&(this.args=a)}indented(a){this.indent+=1,a(this),this.indent-=1}write(a){if("function"==typeof a){a(this,{execution:"sync"}),a(this,{execution:"async"});return}let b=a.split("\n").filter(a=>a),c=Math.min(...b.map(a=>a.length-a.trimStart().length));for(let a of b.map(a=>a.slice(c)).map(a=>" ".repeat(2*this.indent)+a))this.content.push(a)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(a=>`  ${a}`)].join("\n"))}}let dw={major:4,minor:1,patch:11},dx=ca("$ZodType",(a,b)=>{var c;a??(a={}),a._zod.def=b,a._zod.bag=a._zod.bag||{},a._zod.version=dw;let d=[...a._zod.def.checks??[]];for(let b of(a._zod.traits.has("$ZodCheck")&&d.unshift(a),d))for(let c of b._zod.onattach)c(a);if(0===d.length)(c=a._zod).deferred??(c.deferred=[]),a._zod.deferred?.push(()=>{a._zod.run=a._zod.parse});else{let b=(a,b,c)=>{let d,e=cz(a);for(let f of b){if(f._zod.def.when){if(!f._zod.def.when(a))continue}else if(e)continue;let b=a.issues.length,g=f._zod.check(a);if(g instanceof Promise&&c?.async===!1)throw new cb;if(d||g instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await g,a.issues.length!==b&&(e||(e=cz(a,b)))});else{if(a.issues.length===b)continue;e||(e=cz(a,b))}}return d?d.then(()=>a):a},c=(c,e,f)=>{if(cz(c))return c.aborted=!0,c;let g=b(e,d,f);if(g instanceof Promise){if(!1===f.async)throw new cb;return g.then(b=>a._zod.parse(b,f))}return a._zod.parse(g,f)};a._zod.run=(e,f)=>{if(f.skipChecks)return a._zod.parse(e,f);if("backward"===f.direction){let b=a._zod.parse({value:e.value,issues:[]},{...f,skipChecks:!0});return b instanceof Promise?b.then(a=>c(a,e,f)):c(b,e,f)}let g=a._zod.parse(e,f);if(g instanceof Promise){if(!1===f.async)throw new cb;return g.then(a=>b(a,d,f))}return b(g,d,f)}}a["~standard"]={validate:b=>{try{let c=cL(a,b);return c.success?{value:c.data}:{issues:c.error?.issues}}catch(c){return cN(a,b).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}}),dy=ca("$ZodString",(a,b)=>{dx.init(a,b),a._zod.pattern=[...a?._zod.bag?.patterns??[]].pop()??(a=>{let b=a?`[\\s\\S]{${a?.minimum??0},${a?.maximum??""}}`:"[\\s\\S]*";return RegExp(`^${b}$`)})(a._zod.bag),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=String(c.value)}catch(a){}return"string"==typeof c.value||c.issues.push({expected:"string",code:"invalid_type",input:c.value,inst:a}),c}}),dz=ca("$ZodStringFormat",(a,b)=>{dm.init(a,b),dy.init(a,b)}),dA=ca("$ZodGUID",(a,b)=>{b.pattern??(b.pattern=cV),dz.init(a,b)}),dB=ca("$ZodUUID",(a,b)=>{if(b.version){let a={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[b.version];if(void 0===a)throw Error(`Invalid UUID version: "${b.version}"`);b.pattern??(b.pattern=cW(a))}else b.pattern??(b.pattern=cW());dz.init(a,b)}),dC=ca("$ZodEmail",(a,b)=>{b.pattern??(b.pattern=cX),dz.init(a,b)}),dD=ca("$ZodURL",(a,b)=>{dz.init(a,b),a._zod.check=c=>{try{let d=c.value.trim(),e=new URL(d);b.hostname&&(b.hostname.lastIndex=0,b.hostname.test(e.hostname)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:c2.source,input:c.value,inst:a,continue:!b.abort})),b.protocol&&(b.protocol.lastIndex=0,b.protocol.test(e.protocol.endsWith(":")?e.protocol.slice(0,-1):e.protocol)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:b.protocol.source,input:c.value,inst:a,continue:!b.abort})),b.normalize?c.value=e.href:c.value=d;return}catch(d){c.issues.push({code:"invalid_format",format:"url",input:c.value,inst:a,continue:!b.abort})}}}),dE=ca("$ZodEmoji",(a,b)=>{b.pattern??(b.pattern=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),dz.init(a,b)}),dF=ca("$ZodNanoID",(a,b)=>{b.pattern??(b.pattern=cT),dz.init(a,b)}),dG=ca("$ZodCUID",(a,b)=>{b.pattern??(b.pattern=cO),dz.init(a,b)}),dH=ca("$ZodCUID2",(a,b)=>{b.pattern??(b.pattern=cP),dz.init(a,b)}),dI=ca("$ZodULID",(a,b)=>{b.pattern??(b.pattern=cQ),dz.init(a,b)}),dJ=ca("$ZodXID",(a,b)=>{b.pattern??(b.pattern=cR),dz.init(a,b)}),dK=ca("$ZodKSUID",(a,b)=>{b.pattern??(b.pattern=cS),dz.init(a,b)}),dL=ca("$ZodISODateTime",(a,b)=>{b.pattern??(b.pattern=function(a){let b=c6({precision:a.precision}),c=["Z"];a.local&&c.push(""),a.offset&&c.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let d=`${b}(?:${c.join("|")})`;return RegExp(`^${c4}T(?:${d})$`)}(b)),dz.init(a,b)}),dM=ca("$ZodISODate",(a,b)=>{b.pattern??(b.pattern=c5),dz.init(a,b)}),dN=ca("$ZodISOTime",(a,b)=>{b.pattern??(b.pattern=RegExp(`^${c6(b)}$`)),dz.init(a,b)}),dO=ca("$ZodISODuration",(a,b)=>{b.pattern??(b.pattern=cU),dz.init(a,b)}),dP=ca("$ZodIPv4",(a,b)=>{b.pattern??(b.pattern=cY),dz.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.format="ipv4"})}),dQ=ca("$ZodIPv6",(a,b)=>{b.pattern??(b.pattern=cZ),dz.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.format="ipv6"}),a._zod.check=c=>{try{new URL(`http://[${c.value}]`)}catch{c.issues.push({code:"invalid_format",format:"ipv6",input:c.value,inst:a,continue:!b.abort})}}}),dR=ca("$ZodCIDRv4",(a,b)=>{b.pattern??(b.pattern=c$),dz.init(a,b)}),dS=ca("$ZodCIDRv6",(a,b)=>{b.pattern??(b.pattern=c_),dz.init(a,b),a._zod.check=c=>{let d=c.value.split("/");try{if(2!==d.length)throw Error();let[a,b]=d;if(!b)throw Error();let c=Number(b);if(`${c}`!==b||c<0||c>128)throw Error();new URL(`http://[${a}]`)}catch{c.issues.push({code:"invalid_format",format:"cidrv6",input:c.value,inst:a,continue:!b.abort})}}});function dT(a){if(""===a)return!0;if(a.length%4!=0)return!1;try{return atob(a),!0}catch{return!1}}let dU=ca("$ZodBase64",(a,b)=>{b.pattern??(b.pattern=c0),dz.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.contentEncoding="base64"}),a._zod.check=c=>{dT(c.value)||c.issues.push({code:"invalid_format",format:"base64",input:c.value,inst:a,continue:!b.abort})}}),dV=ca("$ZodBase64URL",(a,b)=>{b.pattern??(b.pattern=c1),dz.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.contentEncoding="base64url"}),a._zod.check=c=>{!function(a){if(!c1.test(a))return!1;let b=a.replace(/[-_]/g,a=>"-"===a?"+":"/");return dT(b.padEnd(4*Math.ceil(b.length/4),"="))}(c.value)&&c.issues.push({code:"invalid_format",format:"base64url",input:c.value,inst:a,continue:!b.abort})}}),dW=ca("$ZodE164",(a,b)=>{b.pattern??(b.pattern=c3),dz.init(a,b)}),dX=ca("$ZodJWT",(a,b)=>{dz.init(a,b),a._zod.check=c=>{!function(a,b=null){try{let c=a.split(".");if(3!==c.length)return!1;let[d]=c;if(!d)return!1;let e=JSON.parse(atob(d));if("typ"in e&&e?.typ!=="JWT"||!e.alg||b&&(!("alg"in e)||e.alg!==b))return!1;return!0}catch{return!1}}(c.value,b.alg)&&c.issues.push({code:"invalid_format",format:"jwt",input:c.value,inst:a,continue:!b.abort})}}),dY=ca("$ZodNumber",(a,b)=>{dx.init(a,b),a._zod.pattern=a._zod.bag.pattern??c9,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=Number(c.value)}catch(a){}let e=c.value;if("number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e))return c;let f="number"==typeof e?Number.isNaN(e)?"NaN":Number.isFinite(e)?void 0:"Infinity":void 0;return c.issues.push({expected:"number",code:"invalid_type",input:e,inst:a,...f?{received:f}:{}}),c}}),dZ=ca("$ZodNumber",(a,b)=>{di.init(a,b),dY.init(a,b)}),d$=ca("$ZodBoolean",(a,b)=>{dx.init(a,b),a._zod.pattern=da,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=!!c.value}catch(a){}let e=c.value;return"boolean"==typeof e||c.issues.push({expected:"boolean",code:"invalid_type",input:e,inst:a}),c}}),d_=((a,b)=>{dx.init(a,b),a._zod.pattern=c7,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=BigInt(c.value)}catch(a){}return"bigint"==typeof c.value||c.issues.push({expected:"bigint",code:"invalid_type",input:c.value,inst:a}),c}},ca("$ZodAny",(a,b)=>{dx.init(a,b),a._zod.parse=a=>a})),d0=ca("$ZodUnknown",(a,b)=>{dx.init(a,b),a._zod.parse=a=>a}),d1=ca("$ZodNever",(a,b)=>{dx.init(a,b),a._zod.parse=(b,c)=>(b.issues.push({expected:"never",code:"invalid_type",input:b.value,inst:a}),b)}),d2=ca("$ZodDate",(a,b)=>{dx.init(a,b),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=new Date(c.value)}catch(a){}let e=c.value,f=e instanceof Date;return f&&!Number.isNaN(e.getTime())||c.issues.push({expected:"date",code:"invalid_type",input:e,...f?{received:"Invalid Date"}:{},inst:a}),c}});function d3(a,b,c){a.issues.length&&b.issues.push(...cA(c,a.issues)),b.value[c]=a.value}let d4=ca("$ZodArray",(a,b)=>{dx.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!Array.isArray(e))return c.issues.push({expected:"array",code:"invalid_type",input:e,inst:a}),c;c.value=Array(e.length);let f=[];for(let a=0;a<e.length;a++){let g=e[a],h=b.element._zod.run({value:g,issues:[]},d);h instanceof Promise?f.push(h.then(b=>d3(b,c,a))):d3(h,c,a)}return f.length?Promise.all(f).then(()=>c):c}});function d5(a,b,c,d){a.issues.length&&b.issues.push(...cA(c,a.issues)),void 0===a.value?c in d&&(b.value[c]=void 0):b.value[c]=a.value}function d6(a){var b;let c=Object.keys(a.shape);for(let b of c)if(!a.shape?.[b]?._zod?.traits?.has("$ZodType"))throw Error(`Invalid element at key "${b}": expected a Zod schema`);let d=Object.keys(b=a.shape).filter(a=>"optional"===b[a]._zod.optin&&"optional"===b[a]._zod.optout);return{...a,keys:c,keySet:new Set(c),numKeys:c.length,optionalKeys:new Set(d)}}function d7(a,b,c,d,e,f){let g=[],h=e.keySet,i=e.catchall._zod,j=i.def.type;for(let e of Object.keys(b)){if(h.has(e))continue;if("never"===j){g.push(e);continue}let f=i.run({value:b[e],issues:[]},d);f instanceof Promise?a.push(f.then(a=>d5(a,c,e,b))):d5(f,c,e,b)}return(g.length&&c.issues.push({code:"unrecognized_keys",keys:g,input:b,inst:f}),a.length)?Promise.all(a).then(()=>c):c}let d8=ca("$ZodObject",(a,b)=>{let c;dx.init(a,b);let d=Object.getOwnPropertyDescriptor(b,"shape");if(!d?.get){let a=b.shape;Object.defineProperty(b,"shape",{get:()=>{let c={...a};return Object.defineProperty(b,"shape",{value:c}),c}})}let e=ch(()=>d6(b));ck(a._zod,"propValues",()=>{let a=b.shape,c={};for(let b in a){let d=a[b]._zod;if(d.values)for(let a of(c[b]??(c[b]=new Set),d.values))c[b].add(a)}return c});let f=b.catchall;a._zod.parse=(b,d)=>{c??(c=e.value);let g=b.value;if(!cp(g))return b.issues.push({expected:"object",code:"invalid_type",input:g,inst:a}),b;b.value={};let h=[],i=c.shape;for(let a of c.keys){let c=i[a]._zod.run({value:g[a],issues:[]},d);c instanceof Promise?h.push(c.then(c=>d5(c,b,a,g))):d5(c,b,a,g)}return f?d7(h,g,b,d,e.value,a):h.length?Promise.all(h).then(()=>b):b}}),d9=ca("$ZodObjectJIT",(a,b)=>{let c,d;d8.init(a,b);let e=a._zod.parse,f=ch(()=>d6(b)),g=!cd.jitless,h=g&&cq.value,i=b.catchall;a._zod.parse=(j,k)=>{d??(d=f.value);let l=j.value;return cp(l)?g&&h&&k?.async===!1&&!0!==k.jitless?(c||(c=(a=>{let b=new dv(["shape","payload","ctx"]),c=f.value,d=a=>{let b=cn(a);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};b.write("const input = payload.value;");let e=Object.create(null),g=0;for(let a of c.keys)e[a]=`key_${g++}`;for(let a of(b.write("const newResult = {};"),c.keys)){let c=e[a],f=cn(a);b.write(`const ${c} = ${d(a)};`),b.write(`
        if (${c}.issues.length) {
          payload.issues = payload.issues.concat(${c}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${f}, ...iss.path] : [${f}]
          })));
        }
        
        
        if (${c}.value === undefined) {
          if (${f} in input) {
            newResult[${f}] = undefined;
          }
        } else {
          newResult[${f}] = ${c}.value;
        }
        
      `)}b.write("payload.value = newResult;"),b.write("return payload;");let h=b.compile();return(b,c)=>h(a,b,c)})(b.shape)),j=c(j,k),i)?d7([],l,j,k,d,a):j:e(j,k):(j.issues.push({expected:"object",code:"invalid_type",input:l,inst:a}),j)}});function ea(a,b,c,d){for(let c of a)if(0===c.issues.length)return b.value=c.value,b;let e=a.filter(a=>!cz(a));return 1===e.length?(b.value=e[0].value,e[0]):(b.issues.push({code:"invalid_union",input:b.value,inst:c,errors:a.map(a=>a.issues.map(a=>cC(a,d,ce())))}),b)}let eb=ca("$ZodUnion",(a,b)=>{dx.init(a,b),ck(a._zod,"optin",()=>b.options.some(a=>"optional"===a._zod.optin)?"optional":void 0),ck(a._zod,"optout",()=>b.options.some(a=>"optional"===a._zod.optout)?"optional":void 0),ck(a._zod,"values",()=>{if(b.options.every(a=>a._zod.values))return new Set(b.options.flatMap(a=>Array.from(a._zod.values)))}),ck(a._zod,"pattern",()=>{if(b.options.every(a=>a._zod.pattern)){let a=b.options.map(a=>a._zod.pattern);return RegExp(`^(${a.map(a=>ci(a.source)).join("|")})$`)}});let c=1===b.options.length,d=b.options[0]._zod.run;a._zod.parse=(e,f)=>{if(c)return d(e,f);let g=!1,h=[];for(let a of b.options){let b=a._zod.run({value:e.value,issues:[]},f);if(b instanceof Promise)h.push(b),g=!0;else{if(0===b.issues.length)return b;h.push(b)}}return g?Promise.all(h).then(b=>ea(b,e,a,f)):ea(h,e,a,f)}}),ec=ca("$ZodIntersection",(a,b)=>{dx.init(a,b),a._zod.parse=(a,c)=>{let d=a.value,e=b.left._zod.run({value:d,issues:[]},c),f=b.right._zod.run({value:d,issues:[]},c);return e instanceof Promise||f instanceof Promise?Promise.all([e,f]).then(([b,c])=>ed(a,b,c)):ed(a,e,f)}});function ed(a,b,c){if(b.issues.length&&a.issues.push(...b.issues),c.issues.length&&a.issues.push(...c.issues),cz(a))return a;let d=function a(b,c){if(b===c||b instanceof Date&&c instanceof Date&&+b==+c)return{valid:!0,data:b};if(cr(b)&&cr(c)){let d=Object.keys(c),e=Object.keys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1,mergeErrorPath:[d,...e.mergeErrorPath]};f[d]=e.data}return{valid:!0,data:f}}if(Array.isArray(b)&&Array.isArray(c)){if(b.length!==c.length)return{valid:!1,mergeErrorPath:[]};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1,mergeErrorPath:[e,...f.mergeErrorPath]};d.push(f.data)}return{valid:!0,data:d}}return{valid:!1,mergeErrorPath:[]}}(b.value,c.value);if(!d.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(d.mergeErrorPath)}`);return a.value=d.data,a}let ee=ca("$ZodRecord",(a,b)=>{dx.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!cr(e))return c.issues.push({expected:"record",code:"invalid_type",input:e,inst:a}),c;let f=[];if(b.keyType._zod.values){let g,h=b.keyType._zod.values;for(let a of(c.value={},h))if("string"==typeof a||"number"==typeof a||"symbol"==typeof a){let g=b.valueType._zod.run({value:e[a],issues:[]},d);g instanceof Promise?f.push(g.then(b=>{b.issues.length&&c.issues.push(...cA(a,b.issues)),c.value[a]=b.value})):(g.issues.length&&c.issues.push(...cA(a,g.issues)),c.value[a]=g.value)}for(let a in e)h.has(a)||(g=g??[]).push(a);g&&g.length>0&&c.issues.push({code:"unrecognized_keys",input:e,inst:a,keys:g})}else for(let g of(c.value={},Reflect.ownKeys(e))){if("__proto__"===g)continue;let h=b.keyType._zod.run({value:g,issues:[]},d);if(h instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(h.issues.length){c.issues.push({code:"invalid_key",origin:"record",issues:h.issues.map(a=>cC(a,d,ce())),input:g,path:[g],inst:a}),c.value[h.value]=h.value;continue}let i=b.valueType._zod.run({value:e[g],issues:[]},d);i instanceof Promise?f.push(i.then(a=>{a.issues.length&&c.issues.push(...cA(g,a.issues)),c.value[h.value]=a.value})):(i.issues.length&&c.issues.push(...cA(g,i.issues)),c.value[h.value]=i.value)}return f.length?Promise.all(f).then(()=>c):c}}),ef=ca("$ZodEnum",(a,b)=>{dx.init(a,b);let c=function(a){let b=Object.values(a).filter(a=>"number"==typeof a);return Object.entries(a).filter(([a,c])=>-1===b.indexOf(+a)).map(([a,b])=>b)}(b.entries),d=new Set(c);a._zod.values=d,a._zod.pattern=RegExp(`^(${c.filter(a=>ct.has(typeof a)).map(a=>"string"==typeof a?cu(a):a.toString()).join("|")})$`),a._zod.parse=(b,e)=>{let f=b.value;return d.has(f)||b.issues.push({code:"invalid_value",values:c,input:f,inst:a}),b}}),eg=ca("$ZodTransform",(a,b)=>{dx.init(a,b),a._zod.parse=(c,d)=>{if("backward"===d.direction)throw new cc(a.constructor.name);let e=b.transform(c.value,c);if(d.async)return(e instanceof Promise?e:Promise.resolve(e)).then(a=>(c.value=a,c));if(e instanceof Promise)throw new cb;return c.value=e,c}});function eh(a,b){return a.issues.length&&void 0===b?{issues:[],value:void 0}:a}let ei=ca("$ZodOptional",(a,b)=>{dx.init(a,b),a._zod.optin="optional",a._zod.optout="optional",ck(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,void 0]):void 0),ck(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${ci(a.source)})?$`):void 0}),a._zod.parse=(a,c)=>{if("optional"===b.innerType._zod.optin){let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(b=>eh(b,a.value)):eh(d,a.value)}return void 0===a.value?a:b.innerType._zod.run(a,c)}}),ej=ca("$ZodNullable",(a,b)=>{dx.init(a,b),ck(a._zod,"optin",()=>b.innerType._zod.optin),ck(a._zod,"optout",()=>b.innerType._zod.optout),ck(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${ci(a.source)}|null)$`):void 0}),ck(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,null]):void 0),a._zod.parse=(a,c)=>null===a.value?a:b.innerType._zod.run(a,c)}),ek=ca("$ZodDefault",(a,b)=>{dx.init(a,b),a._zod.optin="optional",ck(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if("backward"===c.direction)return b.innerType._zod.run(a,c);if(void 0===a.value)return a.value=b.defaultValue,a;let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(a=>el(a,b)):el(d,b)}});function el(a,b){return void 0===a.value&&(a.value=b.defaultValue),a}let em=ca("$ZodPrefault",(a,b)=>{dx.init(a,b),a._zod.optin="optional",ck(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>("backward"===c.direction||void 0===a.value&&(a.value=b.defaultValue),b.innerType._zod.run(a,c))}),en=ca("$ZodNonOptional",(a,b)=>{dx.init(a,b),ck(a._zod,"values",()=>{let a=b.innerType._zod.values;return a?new Set([...a].filter(a=>void 0!==a)):void 0}),a._zod.parse=(c,d)=>{let e=b.innerType._zod.run(c,d);return e instanceof Promise?e.then(b=>eo(b,a)):eo(e,a)}});function eo(a,b){return a.issues.length||void 0!==a.value||a.issues.push({code:"invalid_type",expected:"nonoptional",input:a.value,inst:b}),a}let ep=ca("$ZodCatch",(a,b)=>{dx.init(a,b),ck(a._zod,"optin",()=>b.innerType._zod.optin),ck(a._zod,"optout",()=>b.innerType._zod.optout),ck(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if("backward"===c.direction)return b.innerType._zod.run(a,c);let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(d=>(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>cC(a,c,ce()))},input:a.value}),a.issues=[]),a)):(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>cC(a,c,ce()))},input:a.value}),a.issues=[]),a)}}),eq=ca("$ZodPipe",(a,b)=>{dx.init(a,b),ck(a._zod,"values",()=>b.in._zod.values),ck(a._zod,"optin",()=>b.in._zod.optin),ck(a._zod,"optout",()=>b.out._zod.optout),ck(a._zod,"propValues",()=>b.in._zod.propValues),a._zod.parse=(a,c)=>{if("backward"===c.direction){let d=b.out._zod.run(a,c);return d instanceof Promise?d.then(a=>er(a,b.in,c)):er(d,b.in,c)}let d=b.in._zod.run(a,c);return d instanceof Promise?d.then(a=>er(a,b.out,c)):er(d,b.out,c)}});function er(a,b,c){return a.issues.length?(a.aborted=!0,a):b._zod.run({value:a.value,issues:a.issues},c)}let es=ca("$ZodReadonly",(a,b)=>{dx.init(a,b),ck(a._zod,"propValues",()=>b.innerType._zod.propValues),ck(a._zod,"values",()=>b.innerType._zod.values),ck(a._zod,"optin",()=>b.innerType._zod.optin),ck(a._zod,"optout",()=>b.innerType._zod.optout),a._zod.parse=(a,c)=>{if("backward"===c.direction)return b.innerType._zod.run(a,c);let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(et):et(d)}});function et(a){return a.value=Object.freeze(a.value),a}let eu=ca("$ZodCustom",(a,b)=>{dd.init(a,b),dx.init(a,b),a._zod.parse=(a,b)=>a,a._zod.check=c=>{let d=c.value,e=b.fn(d);if(e instanceof Promise)return e.then(b=>ev(b,c,d,a));ev(e,c,d,a)}});function ev(a,b,c,d){if(!a){let a={code:"custom",input:c,inst:d,path:[...d._zod.def.path??[]],continue:!d._zod.def.abort};d._zod.def.params&&(a.params=d._zod.def.params),b.issues.push(cE(a))}}Symbol("ZodOutput"),Symbol("ZodInput");class ew{constructor(){this._map=new WeakMap,this._idmap=new Map}add(a,...b){let c=b[0];if(this._map.set(a,c),c&&"object"==typeof c&&"id"in c){if(this._idmap.has(c.id))throw Error(`ID ${c.id} already exists in the registry`);this._idmap.set(c.id,a)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(a){let b=this._map.get(a);return b&&"object"==typeof b&&"id"in b&&this._idmap.delete(b.id),this._map.delete(a),this}get(a){let b=a._zod.parent;if(b){let c={...this.get(b)??{}};delete c.id;let d={...c,...this._map.get(a)};return Object.keys(d).length?d:void 0}return this._map.get(a)}has(a){return this._map.has(a)}}let ex=new ew;function ey(a,b){return new a({type:"string",format:"email",check:"string_format",abort:!1,...cw(b)})}function ez(a,b){return new a({type:"string",format:"guid",check:"string_format",abort:!1,...cw(b)})}function eA(a,b){return new df({check:"less_than",...cw(b),value:a,inclusive:!1})}function eB(a,b){return new df({check:"less_than",...cw(b),value:a,inclusive:!0})}function eC(a,b){return new dg({check:"greater_than",...cw(b),value:a,inclusive:!1})}function eD(a,b){return new dg({check:"greater_than",...cw(b),value:a,inclusive:!0})}function eE(a,b){return new dh({check:"multiple_of",...cw(b),value:a})}function eF(a,b){return new dj({check:"max_length",...cw(b),maximum:a})}function eG(a,b){return new dk({check:"min_length",...cw(b),minimum:a})}function eH(a,b){return new dl({check:"length_equals",...cw(b),length:a})}function eI(a){return new du({check:"overwrite",tx:a})}let eJ=ca("ZodISODateTime",(a,b)=>{dL.init(a,b),e3.init(a,b)}),eK=ca("ZodISODate",(a,b)=>{dM.init(a,b),e3.init(a,b)}),eL=ca("ZodISOTime",(a,b)=>{dN.init(a,b),e3.init(a,b)}),eM=ca("ZodISODuration",(a,b)=>{dO.init(a,b),e3.init(a,b)}),eN=(a,b)=>{cG.init(a,b),a.name="ZodError",Object.defineProperties(a,{format:{value:b=>(function(a,b){let c=b||function(a){return a.message},d={_errors:[]},e=a=>{for(let b of a.issues)if("invalid_union"===b.code&&b.errors.length)b.errors.map(a=>e({issues:a}));else if("invalid_key"===b.code)e({issues:b.issues});else if("invalid_element"===b.code)e({issues:b.issues});else if(0===b.path.length)d._errors.push(c(b));else{let a=d,e=0;for(;e<b.path.length;){let d=b.path[e];e===b.path.length-1?(a[d]=a[d]||{_errors:[]},a[d]._errors.push(c(b))):a[d]=a[d]||{_errors:[]},a=a[d],e++}}};return e(a),d})(a,b)},flatten:{value:b=>(function(a,b=a=>a.message){let c={},d=[];for(let e of a.issues)e.path.length>0?(c[e.path[0]]=c[e.path[0]]||[],c[e.path[0]].push(b(e))):d.push(b(e));return{formErrors:d,fieldErrors:c}})(a,b)},addIssue:{value:b=>{a.issues.push(b),a.message=JSON.stringify(a.issues,cg,2)}},addIssues:{value:b=>{a.issues.push(...b),a.message=JSON.stringify(a.issues,cg,2)}},isEmpty:{get:()=>0===a.issues.length}})};ca("ZodError",eN);let eO=ca("ZodError",eN,{Parent:Error}),eP=cI(eO),eQ=cJ(eO),eR=cK(eO),eS=cM(eO),eT=(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return cI(eO)(a,b,d)},eU=(a,b,c)=>cI(eO)(a,b,c),eV=async(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return cJ(eO)(a,b,d)},eW=async(a,b,c)=>cJ(eO)(a,b,c),eX=(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return cK(eO)(a,b,d)},eY=(a,b,c)=>cK(eO)(a,b,c),eZ=async(a,b,c)=>{let d=c?Object.assign(c,{direction:"backward"}):{direction:"backward"};return cM(eO)(a,b,d)},e$=async(a,b,c)=>cM(eO)(a,b,c),e_=ca("ZodType",(a,b)=>(dx.init(a,b),a.def=b,a.type=b.type,Object.defineProperty(a,"_def",{value:b}),a.check=(...c)=>a.clone(cm(b,{checks:[...b.checks??[],...c.map(a=>"function"==typeof a?{_zod:{check:a,def:{check:"custom"},onattach:[]}}:a)]})),a.clone=(b,c)=>cv(a,b,c),a.brand=()=>a,a.register=(b,c)=>(b.add(a,c),a),a.parse=(b,c)=>eP(a,b,c,{callee:a.parse}),a.safeParse=(b,c)=>eR(a,b,c),a.parseAsync=async(b,c)=>eQ(a,b,c,{callee:a.parseAsync}),a.safeParseAsync=async(b,c)=>eS(a,b,c),a.spa=a.safeParseAsync,a.encode=(b,c)=>eT(a,b,c),a.decode=(b,c)=>eU(a,b,c),a.encodeAsync=async(b,c)=>eV(a,b,c),a.decodeAsync=async(b,c)=>eW(a,b,c),a.safeEncode=(b,c)=>eX(a,b,c),a.safeDecode=(b,c)=>eY(a,b,c),a.safeEncodeAsync=async(b,c)=>eZ(a,b,c),a.safeDecodeAsync=async(b,c)=>e$(a,b,c),a.refine=(b,c)=>a.check(function(a,b={}){return new fX({type:"custom",check:"custom",fn:a,...cw(b)})}(b,c)),a.superRefine=b=>a.check(function(a){let b=function(a,b){let c=new dd({check:"custom",...cw(void 0)});return c._zod.check=a,c}(c=>(c.addIssue=a=>{"string"==typeof a?c.issues.push(cE(a,c.value,b._zod.def)):(a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=c.value),a.inst??(a.inst=b),a.continue??(a.continue=!b._zod.def.abort),c.issues.push(cE(a)))},a(c.value,c)));return b}(b)),a.overwrite=b=>a.check(eI(b)),a.optional=()=>fN(a),a.nullable=()=>fP(a),a.nullish=()=>fN(fP(a)),a.nonoptional=b=>new fS({type:"nonoptional",innerType:a,...cw(b)}),a.array=()=>fB(a),a.or=b=>fF([a,b]),a.and=b=>new fG({type:"intersection",left:a,right:b}),a.transform=b=>fV(a,new fL({type:"transform",transform:b})),a.default=b=>(function(a,b){return new fQ({type:"default",innerType:a,get defaultValue(){return"function"==typeof b?b():cs(b)}})})(a,b),a.prefault=b=>(function(a,b){return new fR({type:"prefault",innerType:a,get defaultValue(){return"function"==typeof b?b():cs(b)}})})(a,b),a.catch=b=>(function(a,b){return new fT({type:"catch",innerType:a,catchValue:"function"==typeof b?b:()=>b})})(a,b),a.pipe=b=>fV(a,b),a.readonly=()=>new fW({type:"readonly",innerType:a}),a.describe=b=>{let c=a.clone();return ex.add(c,{description:b}),c},Object.defineProperty(a,"description",{get:()=>ex.get(a)?.description,configurable:!0}),a.meta=(...b)=>{if(0===b.length)return ex.get(a);let c=a.clone();return ex.add(c,b[0]),c},a.isOptional=()=>a.safeParse(void 0).success,a.isNullable=()=>a.safeParse(null).success,a)),e0=ca("_ZodString",(a,b)=>{dy.init(a,b),e_.init(a,b);let c=a._zod.bag;a.format=c.format??null,a.minLength=c.minimum??null,a.maxLength=c.maximum??null,a.regex=(...b)=>a.check(function(a,b){return new dn({check:"string_format",format:"regex",...cw(b),pattern:a})}(...b)),a.includes=(...b)=>a.check(function(a,b){return new dr({check:"string_format",format:"includes",...cw(b),includes:a})}(...b)),a.startsWith=(...b)=>a.check(function(a,b){return new ds({check:"string_format",format:"starts_with",...cw(b),prefix:a})}(...b)),a.endsWith=(...b)=>a.check(function(a,b){return new dt({check:"string_format",format:"ends_with",...cw(b),suffix:a})}(...b)),a.min=(...b)=>a.check(eG(...b)),a.max=(...b)=>a.check(eF(...b)),a.length=(...b)=>a.check(eH(...b)),a.nonempty=(...b)=>a.check(eG(1,...b)),a.lowercase=b=>a.check(new dp({check:"string_format",format:"lowercase",...cw(b)})),a.uppercase=b=>a.check(new dq({check:"string_format",format:"uppercase",...cw(b)})),a.trim=()=>a.check(eI(a=>a.trim())),a.normalize=(...b)=>a.check(function(a){return eI(b=>b.normalize(a))}(...b)),a.toLowerCase=()=>a.check(eI(a=>a.toLowerCase())),a.toUpperCase=()=>a.check(eI(a=>a.toUpperCase()))}),e1=ca("ZodString",(a,b)=>{dy.init(a,b),e0.init(a,b),a.email=b=>a.check(ey(e4,b)),a.url=b=>a.check(new e7({type:"string",format:"url",check:"string_format",abort:!1,...cw(b)})),a.jwt=b=>a.check(new fm({type:"string",format:"jwt",check:"string_format",abort:!1,...cw(b)})),a.emoji=b=>a.check(new e8({type:"string",format:"emoji",check:"string_format",abort:!1,...cw(b)})),a.guid=b=>a.check(ez(e5,b)),a.uuid=b=>a.check(new e6({type:"string",format:"uuid",check:"string_format",abort:!1,...cw(b)})),a.uuidv4=b=>a.check(new e6({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...cw(b)})),a.uuidv6=b=>a.check(new e6({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...cw(b)})),a.uuidv7=b=>a.check(new e6({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...cw(b)})),a.nanoid=b=>a.check(new e9({type:"string",format:"nanoid",check:"string_format",abort:!1,...cw(b)})),a.guid=b=>a.check(ez(e5,b)),a.cuid=b=>a.check(new fa({type:"string",format:"cuid",check:"string_format",abort:!1,...cw(b)})),a.cuid2=b=>a.check(new fb({type:"string",format:"cuid2",check:"string_format",abort:!1,...cw(b)})),a.ulid=b=>a.check(new fc({type:"string",format:"ulid",check:"string_format",abort:!1,...cw(b)})),a.base64=b=>a.check(new fj({type:"string",format:"base64",check:"string_format",abort:!1,...cw(b)})),a.base64url=b=>a.check(new fk({type:"string",format:"base64url",check:"string_format",abort:!1,...cw(b)})),a.xid=b=>a.check(new fd({type:"string",format:"xid",check:"string_format",abort:!1,...cw(b)})),a.ksuid=b=>a.check(new fe({type:"string",format:"ksuid",check:"string_format",abort:!1,...cw(b)})),a.ipv4=b=>a.check(new ff({type:"string",format:"ipv4",check:"string_format",abort:!1,...cw(b)})),a.ipv6=b=>a.check(new fg({type:"string",format:"ipv6",check:"string_format",abort:!1,...cw(b)})),a.cidrv4=b=>a.check(new fh({type:"string",format:"cidrv4",check:"string_format",abort:!1,...cw(b)})),a.cidrv6=b=>a.check(new fi({type:"string",format:"cidrv6",check:"string_format",abort:!1,...cw(b)})),a.e164=b=>a.check(new fl({type:"string",format:"e164",check:"string_format",abort:!1,...cw(b)})),a.datetime=b=>a.check(new eJ({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...cw(b)})),a.date=b=>a.check(new eK({type:"string",format:"date",check:"string_format",...cw(b)})),a.time=b=>a.check(new eL({type:"string",format:"time",check:"string_format",precision:null,...cw(b)})),a.duration=b=>a.check(new eM({type:"string",format:"duration",check:"string_format",...cw(b)}))});function e2(a){return new e1({type:"string",...cw(a)})}let e3=ca("ZodStringFormat",(a,b)=>{dz.init(a,b),e0.init(a,b)}),e4=ca("ZodEmail",(a,b)=>{dC.init(a,b),e3.init(a,b)}),e5=ca("ZodGUID",(a,b)=>{dA.init(a,b),e3.init(a,b)}),e6=ca("ZodUUID",(a,b)=>{dB.init(a,b),e3.init(a,b)}),e7=ca("ZodURL",(a,b)=>{dD.init(a,b),e3.init(a,b)}),e8=ca("ZodEmoji",(a,b)=>{dE.init(a,b),e3.init(a,b)}),e9=ca("ZodNanoID",(a,b)=>{dF.init(a,b),e3.init(a,b)}),fa=ca("ZodCUID",(a,b)=>{dG.init(a,b),e3.init(a,b)}),fb=ca("ZodCUID2",(a,b)=>{dH.init(a,b),e3.init(a,b)}),fc=ca("ZodULID",(a,b)=>{dI.init(a,b),e3.init(a,b)}),fd=ca("ZodXID",(a,b)=>{dJ.init(a,b),e3.init(a,b)}),fe=ca("ZodKSUID",(a,b)=>{dK.init(a,b),e3.init(a,b)}),ff=ca("ZodIPv4",(a,b)=>{dP.init(a,b),e3.init(a,b)}),fg=ca("ZodIPv6",(a,b)=>{dQ.init(a,b),e3.init(a,b)}),fh=ca("ZodCIDRv4",(a,b)=>{dR.init(a,b),e3.init(a,b)}),fi=ca("ZodCIDRv6",(a,b)=>{dS.init(a,b),e3.init(a,b)}),fj=ca("ZodBase64",(a,b)=>{dU.init(a,b),e3.init(a,b)}),fk=ca("ZodBase64URL",(a,b)=>{dV.init(a,b),e3.init(a,b)}),fl=ca("ZodE164",(a,b)=>{dW.init(a,b),e3.init(a,b)}),fm=ca("ZodJWT",(a,b)=>{dX.init(a,b),e3.init(a,b)}),fn=ca("ZodNumber",(a,b)=>{dY.init(a,b),e_.init(a,b),a.gt=(b,c)=>a.check(eC(b,c)),a.gte=(b,c)=>a.check(eD(b,c)),a.min=(b,c)=>a.check(eD(b,c)),a.lt=(b,c)=>a.check(eA(b,c)),a.lte=(b,c)=>a.check(eB(b,c)),a.max=(b,c)=>a.check(eB(b,c)),a.int=b=>a.check(fq(b)),a.safe=b=>a.check(fq(b)),a.positive=b=>a.check(eC(0,b)),a.nonnegative=b=>a.check(eD(0,b)),a.negative=b=>a.check(eA(0,b)),a.nonpositive=b=>a.check(eB(0,b)),a.multipleOf=(b,c)=>a.check(eE(b,c)),a.step=(b,c)=>a.check(eE(b,c)),a.finite=()=>a;let c=a._zod.bag;a.minValue=Math.max(c.minimum??-1/0,c.exclusiveMinimum??-1/0)??null,a.maxValue=Math.min(c.maximum??1/0,c.exclusiveMaximum??1/0)??null,a.isInt=(c.format??"").includes("int")||Number.isSafeInteger(c.multipleOf??.5),a.isFinite=!0,a.format=c.format??null});function fo(a){return new fn({type:"number",checks:[],...cw(a)})}let fp=ca("ZodNumberFormat",(a,b)=>{dZ.init(a,b),fn.init(a,b)});function fq(a){return new fp({type:"number",check:"number_format",abort:!1,format:"safeint",...cw(a)})}let fr=ca("ZodBoolean",(a,b)=>{d$.init(a,b),e_.init(a,b)});function fs(a){return new fr({type:"boolean",...cw(a)})}let ft=ca("ZodAny",(a,b)=>{d_.init(a,b),e_.init(a,b)});function fu(){return new ft({type:"any"})}let fv=ca("ZodUnknown",(a,b)=>{d0.init(a,b),e_.init(a,b)});function fw(){return new fv({type:"unknown"})}let fx=ca("ZodNever",(a,b)=>{d1.init(a,b),e_.init(a,b)}),fy=ca("ZodDate",(a,b)=>{d2.init(a,b),e_.init(a,b),a.min=(b,c)=>a.check(eD(b,c)),a.max=(b,c)=>a.check(eB(b,c));let c=a._zod.bag;a.minDate=c.minimum?new Date(c.minimum):null,a.maxDate=c.maximum?new Date(c.maximum):null});function fz(a){return new fy({type:"date",...cw(a)})}let fA=ca("ZodArray",(a,b)=>{d4.init(a,b),e_.init(a,b),a.element=b.element,a.min=(b,c)=>a.check(eG(b,c)),a.nonempty=b=>a.check(eG(1,b)),a.max=(b,c)=>a.check(eF(b,c)),a.length=(b,c)=>a.check(eH(b,c)),a.unwrap=()=>a.element});function fB(a,b){return new fA({type:"array",element:a,...cw(b)})}let fC=ca("ZodObject",(a,b)=>{d9.init(a,b),e_.init(a,b),ck(a,"shape",()=>b.shape),a.keyof=()=>fK(Object.keys(a._zod.def.shape)),a.catchall=b=>a.clone({...a._zod.def,catchall:b}),a.passthrough=()=>a.clone({...a._zod.def,catchall:fw()}),a.loose=()=>a.clone({...a._zod.def,catchall:fw()}),a.strict=()=>a.clone({...a._zod.def,catchall:new fx({type:"never",...cw(void 0)})}),a.strip=()=>a.clone({...a._zod.def,catchall:void 0}),a.extend=b=>(function(a,b){if(!cr(b))throw Error("Invalid input to extend: expected a plain object");let c=a._zod.def.checks;if(c&&c.length>0)throw Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");let d=cm(a._zod.def,{get shape(){let c={...a._zod.def.shape,...b};return cl(this,"shape",c),c},checks:[]});return cv(a,d)})(a,b),a.safeExtend=b=>(function(a,b){if(!cr(b))throw Error("Invalid input to safeExtend: expected a plain object");let c={...a._zod.def,get shape(){let c={...a._zod.def.shape,...b};return cl(this,"shape",c),c},checks:a._zod.def.checks};return cv(a,c)})(a,b),a.merge=b=>(function(a,b){let c=cm(a._zod.def,{get shape(){let c={...a._zod.def.shape,...b._zod.def.shape};return cl(this,"shape",c),c},get catchall(){return b._zod.def.catchall},checks:[]});return cv(a,c)})(a,b),a.pick=b=>(function(a,b){let c=a._zod.def,d=cm(a._zod.def,{get shape(){let a={};for(let d in b){if(!(d in c.shape))throw Error(`Unrecognized key: "${d}"`);b[d]&&(a[d]=c.shape[d])}return cl(this,"shape",a),a},checks:[]});return cv(a,d)})(a,b),a.omit=b=>(function(a,b){let c=a._zod.def,d=cm(a._zod.def,{get shape(){let d={...a._zod.def.shape};for(let a in b){if(!(a in c.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&delete d[a]}return cl(this,"shape",d),d},checks:[]});return cv(a,d)})(a,b),a.partial=(...b)=>(function(a,b,c){let d=cm(b._zod.def,{get shape(){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in d))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=a?new a({type:"optional",innerType:d[b]}):d[b])}else for(let b in d)e[b]=a?new a({type:"optional",innerType:d[b]}):d[b];return cl(this,"shape",e),e},checks:[]});return cv(b,d)})(fM,a,b[0]),a.required=(...b)=>(function(a,b,c){let d=cm(b._zod.def,{get shape(){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in e))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=new a({type:"nonoptional",innerType:d[b]}))}else for(let b in d)e[b]=new a({type:"nonoptional",innerType:d[b]});return cl(this,"shape",e),e},checks:[]});return cv(b,d)})(fS,a,b[0])});function fD(a,b){return new fC({type:"object",shape:a??{},...cw(b)})}let fE=ca("ZodUnion",(a,b)=>{eb.init(a,b),e_.init(a,b),a.options=b.options});function fF(a,b){return new fE({type:"union",options:a,...cw(b)})}let fG=ca("ZodIntersection",(a,b)=>{ec.init(a,b),e_.init(a,b)}),fH=ca("ZodRecord",(a,b)=>{ee.init(a,b),e_.init(a,b),a.keyType=b.keyType,a.valueType=b.valueType});function fI(a,b,c){return new fH({type:"record",keyType:a,valueType:b,...cw(c)})}let fJ=ca("ZodEnum",(a,b)=>{ef.init(a,b),e_.init(a,b),a.enum=b.entries,a.options=Object.values(b.entries);let c=new Set(Object.keys(b.entries));a.extract=(a,d)=>{let e={};for(let d of a)if(c.has(d))e[d]=b.entries[d];else throw Error(`Key ${d} not found in enum`);return new fJ({...b,checks:[],...cw(d),entries:e})},a.exclude=(a,d)=>{let e={...b.entries};for(let b of a)if(c.has(b))delete e[b];else throw Error(`Key ${b} not found in enum`);return new fJ({...b,checks:[],...cw(d),entries:e})}});function fK(a,b){return new fJ({type:"enum",entries:Array.isArray(a)?Object.fromEntries(a.map(a=>[a,a])):a,...cw(b)})}let fL=ca("ZodTransform",(a,b)=>{eg.init(a,b),e_.init(a,b),a._zod.parse=(c,d)=>{if("backward"===d.direction)throw new cc(a.constructor.name);c.addIssue=d=>{"string"==typeof d?c.issues.push(cE(d,c.value,b)):(d.fatal&&(d.continue=!1),d.code??(d.code="custom"),d.input??(d.input=c.value),d.inst??(d.inst=a),c.issues.push(cE(d)))};let e=b.transform(c.value,c);return e instanceof Promise?e.then(a=>(c.value=a,c)):(c.value=e,c)}}),fM=ca("ZodOptional",(a,b)=>{ei.init(a,b),e_.init(a,b),a.unwrap=()=>a._zod.def.innerType});function fN(a){return new fM({type:"optional",innerType:a})}let fO=ca("ZodNullable",(a,b)=>{ej.init(a,b),e_.init(a,b),a.unwrap=()=>a._zod.def.innerType});function fP(a){return new fO({type:"nullable",innerType:a})}let fQ=ca("ZodDefault",(a,b)=>{ek.init(a,b),e_.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeDefault=a.unwrap}),fR=ca("ZodPrefault",(a,b)=>{em.init(a,b),e_.init(a,b),a.unwrap=()=>a._zod.def.innerType}),fS=ca("ZodNonOptional",(a,b)=>{en.init(a,b),e_.init(a,b),a.unwrap=()=>a._zod.def.innerType}),fT=ca("ZodCatch",(a,b)=>{ep.init(a,b),e_.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeCatch=a.unwrap}),fU=ca("ZodPipe",(a,b)=>{eq.init(a,b),e_.init(a,b),a.in=b.in,a.out=b.out});function fV(a,b){return new fU({type:"pipe",in:a,out:b})}let fW=ca("ZodReadonly",(a,b)=>{es.init(a,b),e_.init(a,b),a.unwrap=()=>a._zod.def.innerType}),fX=ca("ZodCustom",(a,b)=>{eu.init(a,b),e_.init(a,b)});function fY(a,b){let c=cw(b);return c.abort??(c.abort=!0),new fX({type:"custom",check:"custom",fn:a??(()=>!0),...c})}function fZ(a){return new e1({type:"string",coerce:!0,...cw(a)})}function f$(a){return new fr({type:"boolean",coerce:!0,...cw(a)})}i||(i={}),ce({localeError:(()=>{let a={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}},b={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return c=>{switch(c.code){case"invalid_type":return`Invalid input: expected ${c.expected}, received ${(a=>{let b=typeof a;switch(b){case"number":return Number.isNaN(a)?"NaN":"number";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(Object.getPrototypeOf(a)!==Object.prototype&&a.constructor)return a.constructor.name}return b})(c.input)}`;case"invalid_value":if(1===c.values.length)return`Invalid input: expected ${cx(c.values[0])}`;return`Invalid option: expected one of ${cf(c.values,"|")}`;case"too_big":{let b=c.inclusive?"<=":"<",d=a[c.origin]??null;if(d)return`Too big: expected ${c.origin??"value"} to have ${b}${c.maximum.toString()} ${d.unit??"elements"}`;return`Too big: expected ${c.origin??"value"} to be ${b}${c.maximum.toString()}`}case"too_small":{let b=c.inclusive?">=":">",d=a[c.origin]??null;if(d)return`Too small: expected ${c.origin} to have ${b}${c.minimum.toString()} ${d.unit}`;return`Too small: expected ${c.origin} to be ${b}${c.minimum.toString()}`}case"invalid_format":if("starts_with"===c.format)return`Invalid string: must start with "${c.prefix}"`;if("ends_with"===c.format)return`Invalid string: must end with "${c.suffix}"`;if("includes"===c.format)return`Invalid string: must include "${c.includes}"`;if("regex"===c.format)return`Invalid string: must match pattern ${c.pattern}`;return`Invalid ${b[c.format]??c.format}`;case"not_multiple_of":return`Invalid number: must be a multiple of ${c.divisor}`;case"unrecognized_keys":return`Unrecognized key${c.keys.length>1?"s":""}: ${cf(c.keys,", ")}`;case"invalid_key":return`Invalid key in ${c.origin}`;case"invalid_union":default:return"Invalid input";case"invalid_element":return`Invalid value in ${c.origin}`}}})()});let f_=(a,b="ms")=>new Date(Date.now()+("sec"===b?1e3*a:a));class f0 extends Error{constructor(a,b){super(a),this.name="BetterAuthError",this.message=a,this.cause=b,this.stack=""}}let f1=Object.create(null),f2=a=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(a?f1:globalThis),f3=new Proxy(f1,{get:(a,b)=>f2()[b]??f1[b],has:(a,b)=>b in f2()||b in f1,set:(a,b,c)=>(f2(!0)[b]=c,!0),deleteProperty(a,b){if(!b)return!1;let c=f2(!0);return delete c[b],!0},ownKeys:()=>Object.keys(f2(!0))}),f4="undefined"!=typeof process&&process.env&&"production"||"",f5="production"===f4,f6="dev"===f4||"development"===f4,f7=()=>"test"===f4||function(a){return!!a&&"false"!==a}(f3.TEST);function f8(a,b){return"undefined"!=typeof process&&process.env?process.env[a]??b:"undefined"!=typeof Deno?Deno.env.get(a)??b:"undefined"!=typeof Bun?Bun.env[a]??b:b}function f9(a,b=!0){let c=f8(a);return c?"0"!==c&&"false"!==c.toLowerCase()&&""!==c:b}let ga={get BETTER_AUTH_TELEMETRY_ENDPOINT(){return f8("BETTER_AUTH_TELEMETRY_ENDPOINT","https://telemetry.better-auth.com/v1/track")}};function gb(a){return a?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function gc(a,b,c){let d="",e=0,f=0;for(let c of a)for(e=e<<8|c,f+=8;f>=6;)f-=6,d+=b[e>>f&63];if(f>0&&(d+=b[e<<6-f&63]),c){let a=(4-d.length%4)%4;d+="=".repeat(a)}return d}function gd(a,b){let c=new Map;for(let a=0;a<b.length;a++)c.set(b[a],a);let d=[],e=0,f=0;for(let b of a){if("="===b)break;let a=c.get(b);if(void 0===a)throw Error(`Invalid Base64 character: ${b}`);e=e<<6|a,(f+=6)>=8&&(f-=8,d.push(e>>f&255))}return Uint8Array.from(d)}let ge={encode(a,b={}){let c=gb(!1);return gc("string"==typeof a?new TextEncoder().encode(a):new Uint8Array(a),c,b.padding??!0)},decode(a){"string"!=typeof a&&(a=new TextDecoder().decode(a));let b=gb(a.includes("-")||a.includes("_"));return gd(a,b)}},gf={encode(a,b={}){let c=gb(!0);return gc("string"==typeof a?new TextEncoder().encode(a):new Uint8Array(a),c,b.padding??!0)},decode(a){let b=gb(a.includes("-")||a.includes("_"));return gd(a,b)}},gg={encode:a=>{if("string"==typeof a&&(a=new TextEncoder().encode(a)),0===a.byteLength)return"";let b=new Uint8Array(a),c="";for(let a of b)c+=a.toString(16).padStart(2,"0");return c},decode:a=>{if(!a)return"";if("string"==typeof a){if(a.length%2!=0||!RegExp("^[0123456789abcdef]+$").test(a))throw Error("Invalid hexadecimal string");let b=new Uint8Array(a.length/2);for(let c=0;c<a.length;c+=2)b[c/2]=parseInt(a.slice(c,c+2),16);return new TextDecoder().decode(b)}return new TextDecoder().decode(a)}},gh=(a="SHA-256",b="none")=>{let c={importKey:async(b,c)=>A().importKey("raw","string"==typeof b?new TextEncoder().encode(b):b,{name:"HMAC",hash:{name:a}},!1,[c]),sign:async(a,d)=>{"string"==typeof a&&(a=await c.importKey(a,"sign"));let e=await A().sign("HMAC",a,"string"==typeof d?new TextEncoder().encode(d):d);return"hex"===b?gg.encode(e):"base64"===b||"base64url"===b||"base64urlnopad"===b?gf.encode(e,{padding:"base64urlnopad"!==b}):e},verify:async(a,d,e)=>("string"==typeof a&&(a=await c.importKey(a,"verify")),"hex"===b&&(e=gg.decode(e)),("base64"===b||"base64url"===b||"base64urlnopad"===b)&&(e=await ge.decode(e)),A().verify("HMAC",a,"string"==typeof e?new TextEncoder().encode(e):e,"string"==typeof d?new TextEncoder().encode(d):d))};return c},gi={eterm:4,cons25:4,console:4,cygwin:4,dtterm:4,gnome:4,hurd:4,jfbterm:4,konsole:4,kterm:4,mlterm:4,mosh:24,putty:4,st:4,"rxvt-unicode-24bit":24,terminator:24,"xterm-kitty":24},gj=new Map(Object.entries({APPVEYOR:8,BUILDKITE:8,CIRCLECI:24,DRONE:8,GITEA_ACTIONS:24,GITHUB_ACTIONS:24,GITLAB_CI:8,TRAVIS:8})),gk=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/],gl=["info","success","warn","error","debug"];function gm(a,b){return gl.indexOf(b)<=gl.indexOf(a)}let gn={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",fg:{red:"\x1b[31m",green:"\x1b[32m",yellow:"\x1b[33m",blue:"\x1b[34m",magenta:"\x1b[35m"}},go={info:gn.fg.blue,success:gn.fg.green,warn:gn.fg.yellow,error:gn.fg.red,debug:gn.fg.magenta},gp=a=>{let b=a?.disabled!==!0,c=a?.level??"error",d=a?.disableColors!==void 0?!a.disableColors:1!==function(){if(void 0!==f8("FORCE_COLOR"))switch(f8("FORCE_COLOR")){case"":case"1":case"true":return 4;case"2":return 8;case"3":return 24;default:return 1}if(void 0!==f8("NODE_DISABLE_COLORS")&&""!==f8("NODE_DISABLE_COLORS")||void 0!==f8("NO_COLOR")&&""!==f8("NO_COLOR")||"dumb"===f8("TERM"))return 1;if("undefined"!=typeof process&&"win32"===process.platform||f8("TMUX"))return 24;if("TF_BUILD"in f3&&"AGENT_NAME"in f3)return 4;if("CI"in f3){for(let{0:a,1:b}of gj)if(a in f3)return b;return"codeship"===f8("CI_NAME")?8:1}if("TEAMCITY_VERSION"in f3)return null!==/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(f8("TEAMCITY_VERSION"))?4:1;switch(f8("TERM_PROGRAM")){case"iTerm.app":if(!f8("TERM_PROGRAM_VERSION")||null!==/^[0-2]\./.exec(f8("TERM_PROGRAM_VERSION")))return 8;return 24;case"HyperTerm":case"MacTerm":return 24;case"Apple_Terminal":return 8}if("truecolor"===f8("COLORTERM")||"24bit"===f8("COLORTERM"))return 24;if(f8("TERM")){if(null!==/truecolor/.exec(f8("TERM")))return 24;if(null!==/^xterm-256/.exec(f8("TERM")))return 8;let a=f8("TERM").toLowerCase();if(gi[a])return gi[a];if(gk.some(b=>null!==b.exec(a)))return 4}return f8("COLORTERM")?4:1}();return{...Object.fromEntries(gl.map(e=>[e,(...[f,...g])=>((e,f,g=[])=>{if(!b||!gm(c,e))return;let h=((a,b,c)=>{let d=new Date().toISOString();return c?`${gn.dim}${d}${gn.reset} ${go[a]}${a.toUpperCase()}${gn.reset} ${gn.bright}[Better Auth]:${gn.reset} ${b}`:`${d} ${a.toUpperCase()} [Better Auth]: ${b}`})(e,f,d);if(!a||"function"!=typeof a.log)return void("error"===e?console.error(h,...g):"warn"===e?console.warn(h,...g):console.log(h,...g));a.log("success"===e?"info":e,f,...g)})(e,f,g)])),get level(){return c}}},gq=gp();function gr(a){try{if("string"!=typeof a)return a;return JSON.parse(a,function(a,b){if("string"==typeof b&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(b)){let a=new Date(b);if(!isNaN(a.getTime()))return a}return b})}catch(a){return gq.error("Error parsing JSON",{error:a}),null}}function gs(a,b="/api/auth"){return!function(a){try{let b=new URL(a);return"/"!==b.pathname}catch(b){throw new f0(`Invalid base URL: ${a}. Please provide a valid base URL.`)}}(a)?(b=b.startsWith("/")?b:`/${b}`,`${a.replace(/\/+$/,"")}${b}`):a}function gt(a,b,c,d){if(a)return gs(a,b);if(!1!==d){let a=f3.BETTER_AUTH_URL||f3.NEXT_PUBLIC_BETTER_AUTH_URL||f3.PUBLIC_BETTER_AUTH_URL||f3.NUXT_PUBLIC_BETTER_AUTH_URL||f3.NUXT_PUBLIC_AUTH_URL||("/"!==f3.BASE_URL?f3.BASE_URL:void 0);if(a)return gs(a,b)}let e=c?.headers.get("x-forwarded-host"),f=c?.headers.get("x-forwarded-proto");if(e&&f)return gs(`${f}://${e}`,b);if(c){let a=gu(c.url);if(!a)throw new f0("Could not get origin from request. Please provide a valid base URL.");return gs(a,b)}if("undefined"!=typeof window&&window.location)return gs(window.location.origin,b)}function gu(a){try{return new URL(a).origin}catch(a){return null}}function gv(a){try{return new URL(a).protocol}catch(a){return null}}function gw(a){try{return new URL(a).host}catch(b){return a}}let gx=new Map,gy={decode:(a,b="utf-8")=>(gx.has(b)||gx.set(b,new TextDecoder(b)),gx.get(b).decode(a)),encode:new TextEncoder().encode};function gz(a,b){if("string"==typeof a){var c=a;if("string"!=typeof c||0===c.length||c.length>100)throw Error(`Value provided to ms.parse() must be a string with length between 1 and 99. value=${JSON.stringify(c)}`);let b=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec(c);if(!b?.groups)return NaN;let{value:d,unit:e="ms"}=b.groups,f=parseFloat(d),g=e.toLowerCase();switch(g){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*f;case"months":case"month":case"mo":return 26298e5*f;case"weeks":case"week":case"w":return 6048e5*f;case"days":case"day":case"d":return 864e5*f;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*f;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*f;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*f;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:throw Error(`Unknown unit "${g}" provided to ms.parse(). value=${JSON.stringify(c)}`)}}if("number"==typeof a){var d=a;if("number"!=typeof d||!Number.isFinite(d))throw Error("Value provided to ms.format() must be of type number.");let b=Math.abs(d);return b>=315576e5?`${Math.round(d/315576e5)}y`:b>=26298e5?`${Math.round(d/26298e5)}mo`:b>=6048e5?`${Math.round(d/6048e5)}w`:b>=864e5?`${Math.round(d/864e5)}d`:b>=36e5?`${Math.round(d/36e5)}h`:b>=6e4?`${Math.round(d/6e4)}m`:b>=1e3?`${Math.round(d/1e3)}s`:`${d}ms`}throw Error(`Value provided to ms() must be a string or number. value=${JSON.stringify(a)}`)}function gA(a){let b=(a.advanced?.useSecureCookies!==void 0?a.advanced?.useSecureCookies:void 0!==a.baseURL?!!a.baseURL.startsWith("https://"):f5)?"__Secure-":"",c=!!a.advanced?.crossSubDomainCookies?.enabled,d=c?a.advanced?.crossSubDomainCookies?.domain||(a.baseURL?new URL(a.baseURL).hostname:void 0):void 0;if(c&&!d)throw new f0("baseURL is required when crossSubdomainCookies are enabled");return function(e,f={}){let g=a.advanced?.cookiePrefix||"better-auth",h=a.advanced?.cookies?.[e]?.name||`${g}.${e}`,i=a.advanced?.cookies?.[e]?.attributes;return{name:`${b}${h}`,attributes:{secure:!!b,sameSite:"lax",path:"/",httpOnly:!0,...c?{domain:d}:{},...a.advanced?.defaultCookieAttributes,...f,...i}}}}async function gB(a,b,c){if(a.context.options.session?.cookieCache?.enabled){let d={session:Object.entries(b.session).reduce((b,[c,d])=>{let e=a.context.options.session?.additionalFields?.[c];return e&&!1===e.returned||(b[c]=d),b},{}),user:b.user},e={...a.context.authCookies.sessionData.options,maxAge:c?void 0:a.context.authCookies.sessionData.options.maxAge},f=f_(e.maxAge||60,"sec").getTime(),g=gf.encode(JSON.stringify({session:d,expiresAt:f,signature:await gh("SHA-256","base64urlnopad").sign(a.context.secret,JSON.stringify({...d,expiresAt:f}))}),{padding:!1});if(g.length>4093)throw new f0("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");a.setCookie(a.context.authCookies.sessionData.name,g,e)}}async function gC(a,b,c,d){let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);c=void 0!==c?c:!!e;let f=a.context.authCookies.sessionToken.options,g=c?void 0:a.context.sessionConfig.expiresIn;await a.setSignedCookie(a.context.authCookies.sessionToken.name,b.session.token,a.context.secret,{...f,maxAge:g,...d}),c&&await a.setSignedCookie(a.context.authCookies.dontRememberToken.name,"true",a.context.secret,a.context.authCookies.dontRememberToken.options),await gB(a,b,c),a.context.setNewSession(b),a.context.options.secondaryStorage&&await a.context.secondaryStorage?.set(b.session.token,JSON.stringify({user:b.user,session:b.session}),Math.floor((new Date(b.session.expiresAt).getTime()-Date.now())/1e3))}function gD(a,b){a.setCookie(a.context.authCookies.sessionToken.name,"",{...a.context.authCookies.sessionToken.options,maxAge:0}),a.setCookie(a.context.authCookies.sessionData.name,"",{...a.context.authCookies.sessionData.options,maxAge:0}),b||a.setCookie(a.context.authCookies.dontRememberToken.name,"",{...a.context.authCookies.dontRememberToken.options,maxAge:0})}let gE=X(async()=>({})),gF=X.create({use:[gE,X(async()=>({}))]}),gG=Y.create({use:[gE]}),gH={USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"Invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists.",USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL:"User already exists. Use another email.",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found",USER_ALREADY_HAS_PASSWORD:"User already has a password. Provide that to delete the account."},gI=fN(fD({disableCookieCache:f$().meta({description:"Disable cookie cache and fetch session from database"}).optional(),disableRefresh:f$().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()})),gJ=()=>gG("/get-session",{method:"GET",query:gI,requireHeaders:!0,metadata:{openapi:{description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async a=>{try{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(!b)return null;let c=a.getCookie(a.context.authCookies.sessionData.name),d=c?gr(gy.decode(gf.decode(c))):null;if(d&&!await gh("SHA-256","base64urlnopad").verify(a.context.secret,JSON.stringify({...d.session,expiresAt:d.expiresAt}),d.signature)){let b=a.context.authCookies.sessionData.name;return a.setCookie(b,"",{maxAge:0}),a.json(null)}let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);if(d?.session&&a.context.options.session?.cookieCache?.enabled&&!a.query?.disableCookieCache){let b=d.session;if(!(d.expiresAt<Date.now()||b.session.expiresAt<new Date))return a.context.session=b,a.json(b);{let b=a.context.authCookies.sessionData.name;a.setCookie(b,"",{maxAge:0})}}let f=await a.context.internalAdapter.findSession(b);if(a.context.session=f,!f||f.session.expiresAt<new Date)return gD(a),f&&await a.context.internalAdapter.deleteSession(f.session.token),a.json(null);if(e||a.query?.disableRefresh)return a.json(f);let g=a.context.sessionConfig.expiresIn,h=a.context.sessionConfig.updateAge;if(f.session.expiresAt.valueOf()-1e3*g+1e3*h<=Date.now()&&(!a.query?.disableRefresh||!a.context.options.session?.disableSessionRefresh)){let b=await a.context.internalAdapter.updateSession(f.session.token,{expiresAt:f_(a.context.sessionConfig.expiresIn,"sec"),updatedAt:new Date});if(!b)return gD(a),a.json(null,{status:401});let c=(b.expiresAt.valueOf()-Date.now())/1e3;return await gC(a,{session:b,user:f.user},!1,{maxAge:c}),a.json({session:b,user:f.user})}return await gB(a,f,!!e),a.json(f)}catch(b){throw a.context.logger.error("INTERNAL_SERVER_ERROR",b),new I("INTERNAL_SERVER_ERROR",{message:gH.FAILED_TO_GET_SESSION})}}),gK=async(a,b)=>{if(a.context.session)return a.context.session;let c=await gJ()({...a,asResponse:!1,headers:a.headers,returnHeaders:!1,query:{...b,...a.query}}).catch(a=>null);return a.context.session=c,c},gL=gF(async a=>{let b=await gK(a);if(!b?.session)throw new I("UNAUTHORIZED");return{session:b}}),gM=gF(async a=>{let b=await gK(a,{disableCookieCache:!0});if(!b?.session)throw new I("UNAUTHORIZED");return{session:b}});gF(async a=>{let b=await gK(a);if(!b?.session&&(a.request||a.headers))throw new I("UNAUTHORIZED");return{session:b}});let gN=gF(async a=>{let b=await gK(a);if(!b?.session)throw new I("UNAUTHORIZED");if(0===a.context.sessionConfig.freshAge)return{session:b};let c=a.context.sessionConfig.freshAge,d=b.session.updatedAt?.valueOf()||b.session.createdAt.valueOf();if(!(Date.now()-d<1e3*c))throw new I("FORBIDDEN",{message:"Session is not fresh"});return{session:b}}),gO=gG("/revoke-session",{method:"POST",body:fD({token:e2().meta({description:"The token to revoke"})}),use:[gM],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.body.token,c=await a.context.internalAdapter.findSession(b);if(!c)throw new I("BAD_REQUEST",{message:"Session not found"});if(c.session.userId!==a.context.session.user.id)throw new I("UNAUTHORIZED");try{await a.context.internalAdapter.deleteSession(b)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new I("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),gP=gG("/revoke-sessions",{method:"POST",use:[gM],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{try{await a.context.internalAdapter.deleteSessions(a.context.session.user.id)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new I("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),gQ=gG("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[gM],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.context.session;if(!b.user)throw new I("UNAUTHORIZED");let c=(await a.context.internalAdapter.listSessions(b.user.id)).filter(a=>a.expiresAt>new Date).filter(b=>b.token!==a.context.session.session.token);return await Promise.all(c.map(b=>a.context.internalAdapter.deleteSession(b.token))),a.json({status:!0})});function gR(a,b){return{digest:async c=>{let d=new TextEncoder,e="string"==typeof c?d.encode(c):c,f=await A().digest(a,e);return"hex"===b?Array.from(new Uint8Array(f)).map(a=>a.toString(16).padStart(2,"0")).join(""):"base64"===b||"base64url"===b||"base64urlnopad"===b?b.includes("url")?gf.encode(f,{padding:"base64urlnopad"!==b}):ge.encode(f):f}}}function gS(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function gT(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function gU(a,b,c=""){let d=a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name,e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function gV(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function gW(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function gX(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let gY=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],gZ="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,g$=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0")),g_={_0:48,_9:57,A:65,F:70,a:97,f:102};function g0(a){return a>=g_._0&&a<=g_._9?a-g_._0:a>=g_.A&&a<=g_.F?a-(g_.A-10):a>=g_.a&&a<=g_.f?a-(g_.a-10):void 0}function g1(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error('"output" expected Uint8Array of length '+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function g2(a){return Uint8Array.from(a)}function g3(a=32){let b="object"==typeof globalThis?globalThis.crypto:null;if("function"!=typeof b?.getRandomValues)throw Error("crypto.getRandomValues must be defined");return b.getRandomValues(new Uint8Array(a))}function g4(a,b=g3){let{nonceLength:c}=a;gT(c);let d=(a,b)=>{let c=function(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];gU(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}(a,b);return b.fill(0),c};return(e,...f)=>({encrypt(g){gU(g);let h=b(c),i=a(e,h,...f).encrypt(g);return i instanceof Promise?i.then(a=>d(h,a)):d(h,i)},decrypt(b){gU(b);let d=b.subarray(0,c),g=b.subarray(c);return a(e,d,...f).decrypt(g)}})}let g5=a=>Uint8Array.from(a.split(""),a=>a.charCodeAt(0)),g6=g5("expand 16-byte k"),g7=g5("expand 32-byte k"),g8=gW(g6),g9=gW(g7);function ha(a,b){return a<<b|a>>>32-b}function hb(a){return a.byteOffset%4==0}let hc=0x100000000-1,hd=Uint32Array.of();function he(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return gT(e),gT(g),gS(f),gS(c),(b,h,i,j,k=0)=>{let l,m;gU(b,void 0,"key"),gU(h,void 0,"nonce"),gU(i,void 0,"data");let n=i.length;if(void 0===j&&(j=new Uint8Array(n)),gU(j,void 0,"output"),gT(k),k<0||k>=hc)throw Error("arx: counter overflow");if(j.length<n)throw Error(`arx: output (${j.length}) is shorter than data (${n})`);let o=[],p=b.length;if(32===p)o.push(l=g2(b)),m=g9;else if(16===p&&c)(l=new Uint8Array(32)).set(b),l.set(b,16),m=g8,o.push(l);else throw gU(b,32,"arx key"),Error("invalid key size");hb(h)||o.push(h=g2(h));let q=gW(l);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(m,q,gW(h.subarray(0,16)),q),h=h.subarray(16)}let r=16-e;if(r!==h.length)throw Error(`arx: nonce must be ${r} or 16 bytes`);if(12!==r){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,o.push(h)}return!function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=gW(j),l=hb(e)&&hb(f),m=l?gW(e):hd,n=l?gW(f):hd;for(let o=0;o<i;g++){if(a(b,c,d,k,g,h),g>=hc)throw Error("arx: counter overflow");let p=Math.min(64,i-o);if(l&&64===p){let a=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)n[c=a+b]=m[c]^k[b];o+=64;continue}for(let a=0,b;a<p;a++)f[b=o+a]=e[b]^j[a];o+=p}}(a,m,q,gW(h),i,j,k,g),gX(...o),j}}function hf(a,b){return 255&a[b++]|(255&a[b++])<<8}class hg{blockLen=16;outputLen=16;buffer=new Uint8Array(16);r=new Uint16Array(10);h=new Uint16Array(10);pad=new Uint16Array(8);pos=0;finished=!1;constructor(a){let b=hf(a=g2(gU(a,32,"key")),0),c=hf(a,2),d=hf(a,4),e=hf(a,6),f=hf(a,8),g=hf(a,10),h=hf(a,12),i=hf(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=hf(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=hf(a,b+0),q=hf(a,b+2),r=hf(a,b+4),s=hf(a,b+6),t=hf(a,b+8),u=hf(a,b+10),v=hf(a,b+12),w=hf(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),D=d[6]+((t>>>14|u<<2)&8191),E=d[7]+((u>>>11|v<<5)&8191),F=d[8]+((v>>>8|w<<8)&8191),G=d[9]+(w>>>5|2048*!c),H=0,I=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;H=I>>>13,I&=8191,I+=5*k*C+5*j*D+5*i*E+5*h*F+5*g*G,H+=I>>>13,I&=8191;let J=H+x*g+y*f+5*o*z+5*n*A+5*m*B;H=J>>>13,J&=8191,J+=5*l*C+5*k*D+5*j*E+5*i*F+5*h*G,H+=J>>>13,J&=8191;let K=H+x*h+y*g+z*f+5*o*A+5*n*B;H=K>>>13,K&=8191,K+=5*m*C+5*l*D+5*k*E+5*j*F+5*i*G,H+=K>>>13,K&=8191;let L=H+x*i+y*h+z*g+A*f+5*o*B;H=L>>>13,L&=8191,L+=5*n*C+5*m*D+5*l*E+5*k*F+5*j*G,H+=L>>>13,L&=8191;let M=H+x*j+y*i+z*h+A*g+B*f;H=M>>>13,M&=8191,M+=5*o*C+5*n*D+5*m*E+5*l*F+5*k*G,H+=M>>>13,M&=8191;let N=H+x*k+y*j+z*i+A*h+B*g;H=N>>>13,N&=8191,N+=C*f+5*o*D+5*n*E+5*m*F+5*l*G,H+=N>>>13,N&=8191;let O=H+x*l+y*k+z*j+A*i+B*h;H=O>>>13,O&=8191,O+=C*g+D*f+5*o*E+5*n*F+5*m*G,H+=O>>>13,O&=8191;let P=H+x*m+y*l+z*k+A*j+B*i;H=P>>>13,P&=8191,P+=C*h+D*g+E*f+5*o*F+5*n*G,H+=P>>>13,P&=8191;let Q=H+x*n+y*m+z*l+A*k+B*j;H=Q>>>13,Q&=8191,Q+=C*i+D*h+E*g+F*f+5*o*G,H+=Q>>>13,Q&=8191;let R=H+x*o+y*n+z*m+A*l+B*k;H=R>>>13,R&=8191,R+=C*j+D*i+E*h+F*g+G*f,H+=R>>>13,R&=8191,I=8191&(H=(H=(H<<2)+H|0)+I|0),H>>>=13,J+=H,d[0]=I,d[1]=J,d[2]=K,d[3]=L,d[4]=M,d[5]=N,d[6]=O,d[7]=P,d[8]=Q,d[9]=R}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;gX(c)}update(a){gV(this),gU(a);let{buffer:b,blockLen:c}=this,d=(a=g2(a)).length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){gX(this.h,this.r,this.buffer,this.pad)}digestInto(a){gV(this);gU(a,void 0,"output");let b=this.outputLen;if(a.length<b)throw Error("digestInto() expects output buffer of length at least "+b);this.finished=!0;let{buffer:c,h:d}=this,{pos:e}=this;if(e){for(c[e++]=1;e<16;e++)c[e]=0;this.process(c,0,!0)}this.finalize();let f=0;for(let b=0;b<8;b++)a[f++]=d[b]>>>0,a[f++]=d[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let hh=function(a){let b=(b,c)=>a(c).update(b).digest(),c=a(new Uint8Array(32));return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=b=>a(b),b}(a=>new hg(a));function hi(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,y=j,z=k,A=l,B=m,C=n,D=o,E=p,F=q,G=r,H=e,I=s,J=t,K=u;for(let a=0;a<f;a+=2)D=D+(H=ha(H^(v=v+z|0),16))|0,v=v+(z=ha(z^D,12))|0,D=D+(H=ha(H^v,8))|0,z=ha(z^D,7),E=E+(I=ha(I^(w=w+A|0),16))|0,w=w+(A=ha(A^E,12))|0,E=E+(I=ha(I^w,8))|0,A=ha(A^E,7),F=F+(J=ha(J^(x=x+B|0),16))|0,x=x+(B=ha(B^F,12))|0,F=F+(J=ha(J^x,8))|0,B=ha(B^F,7),G=G+(K=ha(K^(y=y+C|0),16))|0,y=y+(C=ha(C^G,12))|0,G=G+(K=ha(K^y,8))|0,C=ha(C^G,7),F=F+(K=ha(K^(v=v+A|0),16))|0,v=v+(A=ha(A^F,12))|0,F=F+(K=ha(K^v,8))|0,A=ha(A^F,7),G=G+(H=ha(H^(w=w+B|0),16))|0,w=w+(B=ha(B^G,12))|0,G=G+(H=ha(H^w,8))|0,B=ha(B^G,7),D=D+(I=ha(I^(x=x+C|0),16))|0,x=x+(C=ha(C^D,12))|0,D=D+(I=ha(I^x,8))|0,C=ha(C^D,7),E=E+(J=ha(J^(y=y+z|0),16))|0,y=y+(z=ha(z^E,12))|0,E=E+(J=ha(J^y,8))|0,z=ha(z^E,7);let L=0;d[L++]=g+v|0,d[L++]=h+w|0,d[L++]=i+x|0,d[L++]=j+y|0,d[L++]=k+z|0,d[L++]=l+A|0,d[L++]=m+B|0,d[L++]=n+C|0,d[L++]=o+D|0,d[L++]=p+E|0,d[L++]=q+F|0,d[L++]=r+G|0,d[L++]=e+H|0,d[L++]=s+I|0,d[L++]=t+J|0,d[L++]=u+K|0}let hj=he(hi,{counterRight:!1,counterLength:4,allowShortKeys:!1}),hk=he(hi,{counterRight:!1,counterLength:8,extendNonceFn:function(a,b,c,d){let e=a[0],f=a[1],g=a[2],h=a[3],i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=c[0],r=c[1],s=c[2],t=c[3];for(let a=0;a<20;a+=2)m=m+(q=ha(q^(e=e+i|0),16))|0,e=e+(i=ha(i^m,12))|0,m=m+(q=ha(q^e,8))|0,i=ha(i^m,7),n=n+(r=ha(r^(f=f+j|0),16))|0,f=f+(j=ha(j^n,12))|0,n=n+(r=ha(r^f,8))|0,j=ha(j^n,7),o=o+(s=ha(s^(g=g+k|0),16))|0,g=g+(k=ha(k^o,12))|0,o=o+(s=ha(s^g,8))|0,k=ha(k^o,7),p=p+(t=ha(t^(h=h+l|0),16))|0,h=h+(l=ha(l^p,12))|0,p=p+(t=ha(t^h,8))|0,l=ha(l^p,7),o=o+(t=ha(t^(e=e+j|0),16))|0,e=e+(j=ha(j^o,12))|0,o=o+(t=ha(t^e,8))|0,j=ha(j^o,7),p=p+(q=ha(q^(f=f+k|0),16))|0,f=f+(k=ha(k^p,12))|0,p=p+(q=ha(q^f,8))|0,k=ha(k^p,7),m=m+(r=ha(r^(g=g+l|0),16))|0,g=g+(l=ha(l^m,12))|0,m=m+(r=ha(r^g,8))|0,l=ha(l^m,7),n=n+(s=ha(s^(h=h+i|0),16))|0,h=h+(i=ha(i^n,12))|0,n=n+(s=ha(s^h,8))|0,i=ha(i^n,7);let u=0;d[u++]=e,d[u++]=f,d[u++]=g,d[u++]=h,d[u++]=q,d[u++]=r,d[u++]=s,d[u++]=t},allowShortKeys:!1}),hl=new Uint8Array(16),hm=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(hl.subarray(c))},hn=new Uint8Array(32);function ho(a,b,c,d,e){void 0!==e&&gU(e,void 0,"AAD");let f=a(b,c,hn),g=function(a,b,c){gS(c);let d=new Uint8Array(16),e=new DataView(d.buffer,d.byteOffset,d.byteLength);return e.setBigUint64(0,BigInt(b),c),e.setBigUint64(8,BigInt(a),c),d}(d.length,e?e.length:0,!0),h=hh.create(f);e&&hm(h,e),hm(h,d),h.update(g);let i=h.digest();return gX(f,g),i}let hp=a=>(b,c,d)=>({encrypt(e,f){let g=e.length;(f=g1(g+16,f,!1)).set(e);let h=f.subarray(0,-16);a(b,c,h,h,1);let i=ho(a,b,c,h,d);return f.set(i,g),gX(i),f},decrypt(e,f){f=g1(e.length-16,f,!1);let g=e.subarray(0,-16),h=e.subarray(-16),i=ho(a,b,c,g,d);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(h,i))throw Error("invalid tag");return f.set(e.subarray(0,-16)),a(b,c,f,f,1),gX(i),f}});hp(hj);let hq=((a,b)=>{function c(d,...e){if(gU(d,void 0,"key"),!gY)throw Error("Non little-endian hardware is not yet supported");void 0!==a.nonceLength&&gU(e[0],a.varSizeNonce?void 0:a.nonceLength,"nonce");let f=a.tagLength;f&&void 0!==e[1]&&gU(e[1],void 0,"AAD");let g=b(d,...e),h=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");gU(b,void 0,"output")}},i=!1;return{encrypt(a,b){if(i)throw Error("cannot encrypt() twice with same key + nonce");return i=!0,gU(a),h(g.encrypt.length,b),g.encrypt(a,b)},decrypt(a,b){if(gU(a),f&&a.length<f)throw Error('"ciphertext" expected length bigger than tagLength='+f);return h(g.decrypt.length,b),g.decrypt(a,b)}}}return Object.assign(c,a),c})({blockSize:64,nonceLength:24,tagLength:16},hp(hk)),hr=new TextEncoder,hs=new TextDecoder;function ht(...a){let b=new Uint8Array(a.reduce((a,{length:b})=>a+b,0)),c=0;for(let d of a)b.set(d,c),c+=d.length;return b}function hu(a){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof a?a:hs.decode(a),{alphabet:"base64url"});let b=a;b instanceof Uint8Array&&(b=hs.decode(b)),b=b.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{var c=b;if(Uint8Array.fromBase64)return Uint8Array.fromBase64(c);let a=atob(c),d=new Uint8Array(a.length);for(let b=0;b<a.length;b++)d[b]=a.charCodeAt(b);return d}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function hv(a){let b=a;return("string"==typeof b&&(b=hr.encode(b)),Uint8Array.prototype.toBase64)?b.toBase64({alphabet:"base64url",omitPadding:!0}):(function(a){if(Uint8Array.prototype.toBase64)return a.toBase64();let b=[];for(let c=0;c<a.length;c+=32768)b.push(String.fromCharCode.apply(null,a.subarray(c,c+32768)));return btoa(b.join(""))})(b).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class hw extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(a,b){super(a,b),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class hx extends hw{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class hy extends hw{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class hz extends hw{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class hA extends hw{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class hB extends hw{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class hC extends hw{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class hD extends hw{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class hE extends hw{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(a="no applicable key found in the JSON Web Key Set",b){super(a,b)}}class hF extends hw{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(a="multiple matching keys found in the JSON Web Key Set",b){super(a,b)}}class hG extends hw{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(a="request timed out",b){super(a,b)}}class hH extends hw{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(a="signature verification failed",b){super(a,b)}}let hI=(a,b)=>{let c=`SHA-${a.slice(-3)}`;switch(a){case"HS256":case"HS384":case"HS512":return{hash:c,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:c,name:"RSA-PSS",saltLength:parseInt(a.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:c,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:c,name:"ECDSA",namedCurve:b.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:a};default:throw new hA(`alg ${a} is not supported either by JOSE or your javascript runtime`)}},hJ=(a,b)=>{if(a.startsWith("RS")||a.startsWith("PS")){let{modulusLength:c}=b.algorithm;if("number"!=typeof c||c<2048)throw TypeError(`${a} requires key modulusLength to be 2048 bits or larger`)}};function hK(a,b="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${b} must be ${a}`)}function hL(a,b){return a.name===b}function hM(a){return parseInt(a.name.slice(4),10)}function hN(a,b,...c){if((c=c.filter(Boolean)).length>2){let b=c.pop();a+=`one of type ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of type ${c[0]} or ${c[1]}.`:a+=`of type ${c[0]}.`;return null==b?a+=` Received ${b}`:"function"==typeof b&&b.name?a+=` Received function ${b.name}`:"object"==typeof b&&null!=b&&b.constructor?.name&&(a+=` Received an instance of ${b.constructor.name}`),a}function hO(a,b,...c){return hN(`Key for the ${a} algorithm must be `,b,...c)}let hP=async(a,b,c)=>{if(b instanceof Uint8Array){if(!a.startsWith("HS"))throw TypeError(((a,...b)=>hN("Key must be ",a,...b))(b,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",b,{hash:`SHA-${a.slice(-3)}`,name:"HMAC"},!1,[c])}return!function(a,b,c){switch(b){case"HS256":case"HS384":case"HS512":{if(!hL(a.algorithm,"HMAC"))throw hK("HMAC");let c=parseInt(b.slice(2),10);if(hM(a.algorithm.hash)!==c)throw hK(`SHA-${c}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!hL(a.algorithm,"RSASSA-PKCS1-v1_5"))throw hK("RSASSA-PKCS1-v1_5");let c=parseInt(b.slice(2),10);if(hM(a.algorithm.hash)!==c)throw hK(`SHA-${c}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!hL(a.algorithm,"RSA-PSS"))throw hK("RSA-PSS");let c=parseInt(b.slice(2),10);if(hM(a.algorithm.hash)!==c)throw hK(`SHA-${c}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":if(!hL(a.algorithm,"Ed25519"))throw hK("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":if(!hL(a.algorithm,b))throw hK(b);break;case"ES256":case"ES384":case"ES512":{if(!hL(a.algorithm,"ECDSA"))throw hK("ECDSA");let c=function(a){switch(a){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(b);if(a.algorithm.namedCurve!==c)throw hK(c,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}if(c&&!a.usages.includes(c))throw TypeError(`CryptoKey does not support this operation, its usages must include ${c}.`)}(b,a,c),b},hQ=async(a,b,c)=>{let d=await hP(a,b,"sign");return hJ(a,d),new Uint8Array(await crypto.subtle.sign(hI(a,d.algorithm),d,c))},hR=(...a)=>{let b,c=a.filter(Boolean);if(0===c.length||1===c.length)return!0;for(let a of c){let c=Object.keys(a);if(!b||0===b.size){b=new Set(c);continue}for(let a of c){if(b.has(a))return!1;b.add(a)}}return!0};function hS(a){return a?.[Symbol.toStringTag]==="CryptoKey"}function hT(a){return a?.[Symbol.toStringTag]==="KeyObject"}let hU=a=>hS(a)||hT(a),hV=a=>{if(!function(a){return"object"==typeof a&&null!==a}(a)||"[object Object]"!==Object.prototype.toString.call(a))return!1;if(null===Object.getPrototypeOf(a))return!0;let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b};function hW(a){return hV(a)&&"string"==typeof a.kty}let hX=a=>a?.[Symbol.toStringTag],hY=(a,b,c)=>{if(void 0!==b.use){let a;switch(c){case"sign":case"verify":a="sig";break;case"encrypt":case"decrypt":a="enc"}if(b.use!==a)throw TypeError(`Invalid key for this operation, its "use" must be "${a}" when present`)}if(void 0!==b.alg&&b.alg!==a)throw TypeError(`Invalid key for this operation, its "alg" must be "${a}" when present`);if(Array.isArray(b.key_ops)){let d;switch(!0){case"sign"===c||"verify"===c:case"dir"===a:case a.includes("CBC-HS"):d=c;break;case a.startsWith("PBES2"):d="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(a):d=!a.includes("GCM")&&a.endsWith("KW")?"encrypt"===c?"wrapKey":"unwrapKey":c;break;case"encrypt"===c&&a.startsWith("RSA"):d="wrapKey";break;case"decrypt"===c:d=a.startsWith("RSA")?"unwrapKey":"deriveBits"}if(d&&b.key_ops?.includes?.(d)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${d}" when present`)}return!0},hZ=(a,b,c)=>{a.startsWith("HS")||"dir"===a||a.startsWith("PBES2")||/^A(?:128|192|256)(?:GCM)?(?:KW)?$/.test(a)||/^A(?:128|192|256)CBC-HS(?:256|384|512)$/.test(a)?((a,b,c)=>{if(!(b instanceof Uint8Array)){if(hW(b)){if(function(a){return"oct"===a.kty&&"string"==typeof a.k}(b)&&hY(a,b,c))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!hU(b))throw TypeError(hO(a,b,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==b.type)throw TypeError(`${hX(b)} instances for symmetric algorithms must be of type "secret"`)}})(a,b,c):((a,b,c)=>{if(hW(b))switch(c){case"decrypt":case"sign":if(function(a){return"oct"!==a.kty&&("AKP"===a.kty&&"string"==typeof a.priv||"string"==typeof a.d)}(b)&&hY(a,b,c))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(function(a){return"oct"!==a.kty&&void 0===a.d&&void 0===a.priv}(b)&&hY(a,b,c))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!hU(b))throw TypeError(hO(a,b,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===b.type)throw TypeError(`${hX(b)} instances for asymmetric algorithms must not be of type "secret"`);if("public"===b.type)switch(c){case"sign":throw TypeError(`${hX(b)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${hX(b)} instances for asymmetric algorithm decryption must be of type "private"`)}if("private"===b.type)switch(c){case"verify":throw TypeError(`${hX(b)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${hX(b)} instances for asymmetric algorithm encryption must be of type "public"`)}})(a,b,c)},h$=(a,b,c,d,e)=>{let f;if(void 0!==e.crit&&d?.crit===void 0)throw new a('"crit" (Critical) Header Parameter MUST be integrity protected');if(!d||void 0===d.crit)return new Set;if(!Array.isArray(d.crit)||0===d.crit.length||d.crit.some(a=>"string"!=typeof a||0===a.length))throw new a('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let g of(f=void 0!==c?new Map([...Object.entries(c),...b.entries()]):b,d.crit)){if(!f.has(g))throw new hA(`Extension Header Parameter "${g}" is not recognized`);if(void 0===e[g])throw new a(`Extension Header Parameter "${g}" is missing`);if(f.get(g)&&void 0===d[g])throw new a(`Extension Header Parameter "${g}" MUST be integrity protected`)}return new Set(d.crit)},h_=async a=>{if(!a.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:b,keyUsages:c}=function(a){let b,c;switch(a.kty){case"AKP":switch(a.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":b={name:a.alg},c=a.priv?["sign"]:["verify"];break;default:throw new hA('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(a.alg){case"PS256":case"PS384":case"PS512":b={name:"RSA-PSS",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":b={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":b={name:"RSA-OAEP",hash:`SHA-${parseInt(a.alg.slice(-3),10)||1}`},c=a.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new hA('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(a.alg){case"ES256":b={name:"ECDSA",namedCurve:"P-256"},c=a.d?["sign"]:["verify"];break;case"ES384":b={name:"ECDSA",namedCurve:"P-384"},c=a.d?["sign"]:["verify"];break;case"ES512":b={name:"ECDSA",namedCurve:"P-521"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:"ECDH",namedCurve:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new hA('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(a.alg){case"Ed25519":case"EdDSA":b={name:"Ed25519"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new hA('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new hA('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:b,keyUsages:c}}(a),d={...a};return"AKP"!==d.kty&&delete d.alg,delete d.use,crypto.subtle.importKey("jwk",d,b,a.ext??(!a.d&&!a.priv),a.key_ops??c)},h0=async(a,b,c,e=!1)=>{let f=(d||=new WeakMap).get(a);if(f?.[c])return f[c];let g=await h_({...b,alg:c});return e&&Object.freeze(a),f?f[c]=g:d.set(a,{[c]:g}),g},h1=async(a,b)=>{if(a instanceof Uint8Array||hS(a))return a;if(hT(a)){if("secret"===a.type)return a.export();if("toCryptoKey"in a&&"function"==typeof a.toCryptoKey)try{return((a,b)=>{let c,e=(d||=new WeakMap).get(a);if(e?.[b])return e[b];let f="public"===a.type,g=!!f;if("x25519"===a.asymmetricKeyType){switch(b){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}c=a.toCryptoKey(a.asymmetricKeyType,g,f?[]:["deriveBits"])}if("ed25519"===a.asymmetricKeyType){if("EdDSA"!==b&&"Ed25519"!==b)throw TypeError("given KeyObject instance cannot be used for this algorithm");c=a.toCryptoKey(a.asymmetricKeyType,g,[f?"verify":"sign"])}switch(a.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(b!==a.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");c=a.toCryptoKey(a.asymmetricKeyType,g,[f?"verify":"sign"])}if("rsa"===a.asymmetricKeyType){let d;switch(b){case"RSA-OAEP":d="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":d="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":d="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":d="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(b.startsWith("RSA-OAEP"))return a.toCryptoKey({name:"RSA-OAEP",hash:d},g,f?["encrypt"]:["decrypt"]);c=a.toCryptoKey({name:b.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:d},g,[f?"verify":"sign"])}if("ec"===a.asymmetricKeyType){let d=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(a.asymmetricKeyDetails?.namedCurve);if(!d)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===b&&"P-256"===d&&(c=a.toCryptoKey({name:"ECDSA",namedCurve:d},g,[f?"verify":"sign"])),"ES384"===b&&"P-384"===d&&(c=a.toCryptoKey({name:"ECDSA",namedCurve:d},g,[f?"verify":"sign"])),"ES512"===b&&"P-521"===d&&(c=a.toCryptoKey({name:"ECDSA",namedCurve:d},g,[f?"verify":"sign"])),b.startsWith("ECDH-ES")&&(c=a.toCryptoKey({name:"ECDH",namedCurve:d},g,f?[]:["deriveBits"]))}if(!c)throw TypeError("given KeyObject instance cannot be used for this algorithm");return e?e[b]=c:d.set(a,{[b]:c}),c})(a,b)}catch(a){if(a instanceof TypeError)throw a}let c=a.export({format:"jwk"});return h0(a,c,b)}if(hW(a))return a.k?hu(a.k):h0(a,a,b,!0);throw Error("unreachable")};class h2{#b;#c;#d;constructor(a){if(!(a instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this.#b=a}setProtectedHeader(a){if(this.#c)throw TypeError("setProtectedHeader can only be called once");return this.#c=a,this}setUnprotectedHeader(a){if(this.#d)throw TypeError("setUnprotectedHeader can only be called once");return this.#d=a,this}async sign(a,b){let c;if(!this.#c&&!this.#d)throw new hB("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!hR(this.#c,this.#d))throw new hB("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let d={...this.#c,...this.#d},e=h$(hB,new Map([["b64",!0]]),b?.crit,this.#c,d),f=!0;if(e.has("b64")&&"boolean"!=typeof(f=this.#c.b64))throw new hB('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:g}=d;if("string"!=typeof g||!g)throw new hB('JWS "alg" (Algorithm) Header Parameter missing or invalid');hZ(g,a,"sign");let h=this.#b;f&&(h=hr.encode(hv(h)));let i=ht(c=this.#c?hr.encode(hv(JSON.stringify(this.#c))):hr.encode(""),hr.encode("."),h),j=await h1(a,g),k={signature:hv(await hQ(g,j,i)),payload:""};return f&&(k.payload=hs.decode(h)),this.#d&&(k.header=this.#d),this.#c&&(k.protected=hs.decode(c)),k}}class h3{#e;constructor(a){this.#e=new h2(a)}setProtectedHeader(a){return this.#e.setProtectedHeader(a),this}async sign(a,b){let c=await this.#e.sign(a,b);if(void 0===c.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${c.protected}.${c.payload}.${c.signature}`}}let h4=a=>Math.floor(a.getTime()/1e3),h5=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,h6=a=>{let b,c=h5.exec(a);if(!c||c[4]&&c[1])throw TypeError("Invalid time period format");let d=parseFloat(c[2]);switch(c[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":b=Math.round(d);break;case"minute":case"minutes":case"min":case"mins":case"m":b=Math.round(60*d);break;case"hour":case"hours":case"hr":case"hrs":case"h":b=Math.round(3600*d);break;case"day":case"days":case"d":b=Math.round(86400*d);break;case"week":case"weeks":case"w":b=Math.round(604800*d);break;default:b=Math.round(0x1e187e0*d)}return"-"===c[1]||"ago"===c[4]?-b:b};function h7(a,b){if(!Number.isFinite(b))throw TypeError(`Invalid ${a} input`);return b}let h8=a=>a.includes("/")?a.toLowerCase():`application/${a.toLowerCase()}`;class h9{#b;constructor(a){if(!hV(a))throw TypeError("JWT Claims Set MUST be an object");this.#b=structuredClone(a)}data(){return hr.encode(JSON.stringify(this.#b))}get iss(){return this.#b.iss}set iss(a){this.#b.iss=a}get sub(){return this.#b.sub}set sub(a){this.#b.sub=a}get aud(){return this.#b.aud}set aud(a){this.#b.aud=a}set jti(a){this.#b.jti=a}set nbf(a){"number"==typeof a?this.#b.nbf=h7("setNotBefore",a):a instanceof Date?this.#b.nbf=h7("setNotBefore",h4(a)):this.#b.nbf=h4(new Date)+h6(a)}set exp(a){"number"==typeof a?this.#b.exp=h7("setExpirationTime",a):a instanceof Date?this.#b.exp=h7("setExpirationTime",h4(a)):this.#b.exp=h4(new Date)+h6(a)}set iat(a){void 0===a?this.#b.iat=h4(new Date):a instanceof Date?this.#b.iat=h7("setIssuedAt",h4(a)):"string"==typeof a?this.#b.iat=h7("setIssuedAt",h4(new Date)+h6(a)):this.#b.iat=h7("setIssuedAt",a)}}class ia{#c;#f;constructor(a={}){this.#f=new h9(a)}setIssuer(a){return this.#f.iss=a,this}setSubject(a){return this.#f.sub=a,this}setAudience(a){return this.#f.aud=a,this}setJti(a){return this.#f.jti=a,this}setNotBefore(a){return this.#f.nbf=a,this}setExpirationTime(a){return this.#f.exp=a,this}setIssuedAt(a){return this.#f.iat=a,this}setProtectedHeader(a){return this.#c=a,this}async sign(a,b){let c=new h3(this.#f.data());if(c.setProtectedHeader(this.#c),Array.isArray(this.#c?.crit)&&this.#c.crit.includes("b64")&&!1===this.#c.b64)throw new hC("JWTs MUST NOT use unencoded payload");return c.sign(a,b)}}function ib(a,b=""){if(!Number.isSafeInteger(a)||a<0){let c=b&&`"${b}" `;throw Error(`${c}expected integer >= 0, got ${a}`)}}function ic(a,b,c=""){let d=a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name,e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function id(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash must wrapped by utils.createHasher");ib(a.outputLen),ib(a.blockLen)}function ie(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function ig(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function ih(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function ii(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function ij(a,b){return a<<32-b|a>>>b}function ik(a,b){return a<<b|a>>>32-b>>>0}let il=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]?a=>a:function(a){for(let c=0;c<a.length;c++){var b;a[c]=(b=a[c])<<24&0xff000000|b<<8&0xff0000|b>>>8&65280|b>>>24&255}return a},im="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,io={_0:48,_9:57,A:65,F:70,a:97,f:102};function ip(a){return a>=io._0&&a<=io._9?a-io._0:a>=io.A&&a<=io.F?a-(io.A-10):a>=io.a&&a<=io.f?a-(io.a-10):void 0}let iq=async()=>{};async function ir(a,b,c){let d=Date.now();for(let e=0;e<a;e++){c(e);let a=Date.now()-d;a>=0&&a<b||(await iq(),d+=a)}}function is(a,b=""){if("string"==typeof a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}return ic(a,void 0,b)}function it(a,b){if(void 0!==b&&"[object Object]"!==({}).toString.call(b))throw Error("options must be object or undefined");return Object.assign(a,b)}class iu{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(a,b){if(id(a),ic(b,void 0,"key"),this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let c=this.blockLen,d=new Uint8Array(c);d.set(b.length>c?a.create().update(b).digest():b);for(let a=0;a<d.length;a++)d[a]^=54;this.iHash.update(d),this.oHash=a.create();for(let a=0;a<d.length;a++)d[a]^=106;this.oHash.update(d),ih(d)}update(a){return ie(this),this.iHash.update(a),this}digestInto(a){ie(this),ic(a,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||=Object.create(Object.getPrototypeOf(this),{});let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let iv=(a,b,c)=>new iu(a,b).update(c).digest();function iw(a,b,c,d){var e;let f,{c:g,dkLen:h,DK:i,PRF:j,PRFSalt:k}=function(a,b,c,d){id(a);let{c:e,dkLen:f,asyncTick:g}=it({dkLen:32,asyncTick:10},d);if(ib(e,"c"),ib(f,"dkLen"),ib(g,"asyncTick"),e<1)throw Error("iterations (c) must be >= 1");let h=is(b,"password"),i=is(c,"salt"),j=new Uint8Array(f),k=iv.create(a,h),l=k._cloneInto().update(i);return{c:e,dkLen:f,asyncTick:g,DK:j,PRF:k,PRFSalt:l}}(a,b,c,d),l=new Uint8Array(4),m=ii(l),n=new Uint8Array(j.outputLen);for(let a=1,b=0;b<h;a++,b+=j.outputLen){let c=i.subarray(b,b+j.outputLen);m.setInt32(0,a,!1),(f=k._cloneInto(f)).update(l).digestInto(n),c.set(n.subarray(0,c.length));for(let a=1;a<g;a++){j._cloneInto(f).update(n).digestInto(n);for(let a=0;a<c.length;a++)c[a]^=n[a]}}return e=f,j.destroy(),k.destroy(),e&&e.destroy(),ih(n),i}iv.create=(a,b)=>new iu(a,b);class ix{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(a,b,c,d){this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=ii(this.buffer)}update(a){ie(this),ic(a);let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=ii(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){ie(this);ic(a,void 0,"digestInto() output");let b=this.outputLen;if(a.length<b)throw Error('"digestInto() output" expected to be of length >='+b);this.finished=!0;let{buffer:c,view:d,blockLen:e,isLE:f}=this,{pos:g}=this;c[g++]=128,ih(this.buffer.subarray(g)),this.padOffset>e-g&&(this.process(d,0),g=0);for(let a=g;a<e;a++)c[a]=0;d.setBigUint64(e-8,BigInt(8*this.length),f),this.process(d,0);let h=ii(a),i=this.outputLen;if(i%4)throw Error("_sha2: outputLen must be aligned to 32bit");let j=i/4,k=this.get();if(j>k.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<j;a++)h.setUint32(4*a,k[a],f)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){(a||=new this.constructor).set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let iy=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),iz=BigInt(0x100000000-1),iA=BigInt(32),iB=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),iC=new Uint32Array(64);class iD extends ix{constructor(a){super(64,a,8,!1)}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)iC[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=iC[a-15],c=iC[a-2],d=ij(b,7)^ij(b,18)^b>>>3,e=ij(c,17)^ij(c,19)^c>>>10;iC[a]=e+iC[a-7]+d+iC[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(ij(g,6)^ij(g,11)^ij(g,25))+((k=g)&h^~k&i)+iB[a]+iC[a]|0,o=(ij(c,2)^ij(c,13)^ij(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){ih(iC)}destroy(){this.set(0,0,0,0,0,0,0,0),ih(this.buffer)}}class iE extends iD{A=0|iy[0];B=0|iy[1];C=0|iy[2];D=0|iy[3];E=0|iy[4];F=0|iy[5];G=0|iy[6];H=0|iy[7];constructor(){super(32)}}let iF=function(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=function(a,b=!1){return b?{h:Number(a&iz),l:Number(a>>iA&iz)}:{h:0|Number(a>>iA&iz),l:0|Number(a&iz)}}(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),iG=iF[0],iH=iF[1],iI=new Uint32Array(80),iJ=new Uint32Array(80),iK=function(a,b={}){let c=(b,c)=>a(c).update(b).digest(),d=a(void 0);return c.outputLen=d.outputLen,c.blockLen=d.blockLen,c.create=b=>a(b),Object.assign(c,b),Object.freeze(c)}(()=>new iE,{oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,1])});function iL(a,b,c,d,e,f){let g=a[b++]^c[d++],h=a[b++]^c[d++],i=a[b++]^c[d++],j=a[b++]^c[d++],k=a[b++]^c[d++],l=a[b++]^c[d++],m=a[b++]^c[d++],n=a[b++]^c[d++],o=a[b++]^c[d++],p=a[b++]^c[d++],q=a[b++]^c[d++],r=a[b++]^c[d++],s=a[b++]^c[d++],t=a[b++]^c[d++],u=a[b++]^c[d++],v=a[b++]^c[d++],w=g,x=h,y=i,z=j,A=k,B=l,C=m,D=n,E=o,F=p,G=q,H=r,I=s,J=t,K=u,L=v;for(let a=0;a<8;a+=2)A^=ik(w+I|0,7),E^=ik(A+w|0,9),I^=ik(E+A|0,13),w^=ik(I+E|0,18),F^=ik(B+x|0,7),J^=ik(F+B|0,9),x^=ik(J+F|0,13),B^=ik(x+J|0,18),K^=ik(G+C|0,7),y^=ik(K+G|0,9),C^=ik(y+K|0,13),G^=ik(C+y|0,18),z^=ik(L+H|0,7),D^=ik(z+L|0,9),H^=ik(D+z|0,13),L^=ik(H+D|0,18),x^=ik(w+z|0,7),y^=ik(x+w|0,9),z^=ik(y+x|0,13),w^=ik(z+y|0,18),C^=ik(B+A|0,7),D^=ik(C+B|0,9),A^=ik(D+C|0,13),B^=ik(A+D|0,18),H^=ik(G+F|0,7),E^=ik(H+G|0,9),F^=ik(E+H|0,13),G^=ik(F+E|0,18),I^=ik(L+K|0,7),J^=ik(I+L|0,9),K^=ik(J+I|0,13),L^=ik(K+J|0,18);e[f++]=g+w|0,e[f++]=h+x|0,e[f++]=i+y|0,e[f++]=j+z|0,e[f++]=k+A|0,e[f++]=l+B|0,e[f++]=m+C|0,e[f++]=n+D|0,e[f++]=o+E|0,e[f++]=p+F|0,e[f++]=q+G|0,e[f++]=r+H|0,e[f++]=s+I|0,e[f++]=t+J|0,e[f++]=u+K|0,e[f++]=v+L|0}function iM(a,b,c,d,e){let f=d+0,g=d+16*e;for(let d=0;d<16;d++)c[g+d]=a[b+(2*e-1)*16+d];for(let d=0;d<e;d++,f+=16,b+=16)iL(c,g,a,b,c,f),d>0&&(g+=16),iL(c,f,a,b+=16,c,g)}async function iN(a,b,c){let{N:d,r:e,p:f,dkLen:g,blockSize32:h,V:i,B32:j,B:k,tmp:l,blockMixCb:m,asyncTick:n}=function(a,b,c){let{N:d,r:e,p:f,dkLen:g,asyncTick:h,maxmem:i,onProgress:j}=it({dkLen:32,asyncTick:10,maxmem:0x40000400},c);if(ib(d,"N"),ib(e,"r"),ib(f,"p"),ib(g,"dkLen"),ib(h,"asyncTick"),ib(i,"maxmem"),void 0!==j&&"function"!=typeof j)throw Error("progressCb must be a function");let k=128*e,l=k/4;if(d<=1||(d&d-1)!=0||d>0x100000000)throw Error('"N" expected a power of 2, and 2^1 <= N <= 2^32');if(f<1||f>0x1fffffffe0/k)throw Error('"p" expected integer 1..((2^32 - 1) * 32) / (128 * r)');if(g<1||g>0x1fffffffe0)throw Error('"dkLen" expected integer 1..(2^32 - 1) * 32');if(k*(d+f)>i)throw Error('"maxmem" limit was hit, expected 128*r*(N+p) <= "maxmem"='+i);let m=iw(iK,a,b,{c:1,dkLen:k*f}),n=ig(m),o=ig(new Uint8Array(k*d)),p=ig(new Uint8Array(k)),q=()=>{};if(j){let a=2*d*f,b=Math.max(Math.floor(a/1e4),1),c=0;q=()=>{c++,j&&(!(c%b)||c===a)&&j(c/a)}}return{N:d,r:e,p:f,dkLen:g,blockSize32:l,V:o,B32:n,B:m,tmp:p,blockMixCb:q,asyncTick:h}}(a,b,c);il(j);for(let a=0;a<f;a++){let b=h*a;for(let a=0;a<h;a++)i[a]=j[b+a];let c=0;await ir(d-1,n,()=>{iM(i,c,i,c+=h,e),m()}),iM(i,(d-1)*h,j,b,e),m(),await ir(d,n,()=>{let a=(j[b+h-16]&d-1)>>>0;for(let c=0;c<h;c++)l[c]=j[b+c]^i[a*h+c];iM(l,0,j,b,e),m()})}il(j);let o=iw(iK,a,k,{c:1,dkLen:g});return ih(k,i,l),o}function iO(a){switch(a){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw Error(`Unsupported alphabet: ${a}`)}}function iP(...a){let b=a.map(iO).join("");if(0===b.length)throw Error("No valid characters provided for random string generation.");let c=b.length;return(a,...d)=>{let e;if(a<=0)throw Error("Length must be a positive integer.");let f=b,g=c;d.length>0&&(g=(f=d.map(iO).join("")).length);let h=Math.floor(256/g)*g,i=new Uint8Array(2*a),j=i.length,k="",l=j;for(;k.length<a;)l>=j&&(crypto.getRandomValues(i),l=0),(e=i[l++])<h&&(k+=f[e%g]);return k}}let iQ=iP("a-z","0-9","A-Z","-_");async function iR(a,b,c=3600){return await new ia(a).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+c).sign(new TextEncoder().encode(b))}async function iS(a){let b=await gR("SHA-256").digest(a);return ge.encode(b)}let iT={N:16384,r:16,p:1,dkLen:64};async function iU(a,b){return await iN(a.normalize("NFKC"),b,{N:iT.N,p:iT.p,r:iT.r,dkLen:iT.dkLen,maxmem:128*iT.N*iT.r*2})}let iV=async a=>{let b=gg.encode(crypto.getRandomValues(new Uint8Array(16))),c=await iU(a,b);return`${b}:${gg.encode(c)}`},iW=async({hash:a,password:b})=>{let[c,d]=a.split(":");if(!c||!d)throw new f0("Invalid password hash");return function(a,b){let c=new Uint8Array(a),d=new Uint8Array(b),e=c.length^d.length,f=Math.max(c.length,d.length);for(let a=0;a<f;a++)e|=(a<c.length?c[a]:0)^(a<d.length?d[a]:0);return 0===e}(await iU(b,c),function(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(im)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=ip(a.charCodeAt(e)),f=ip(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}(d))},iX=async({key:a,data:b})=>{let c=await gR("SHA-256").digest(a),d=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(b);return function(a){if(gU(a),gZ)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=g$[a[c]];return b}(g4(hq)(new Uint8Array(c)).encrypt(d))},iY=async({key:a,data:b})=>{let c=await gR("SHA-256").digest(a),d=function(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(gZ)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=g0(a.charCodeAt(e)),f=g0(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}(b),e=g4(hq)(new Uint8Array(c));return new TextDecoder().decode(e.decrypt(d))};var iZ=Object.defineProperty,i$=Object.defineProperties,i_=Object.getOwnPropertyDescriptors,i0=Object.getOwnPropertySymbols,i1=Object.prototype.hasOwnProperty,i2=Object.prototype.propertyIsEnumerable,i3=(a,b,c)=>b in a?iZ(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,i4=(a,b)=>{for(var c in b||(b={}))i1.call(b,c)&&i3(a,c,b[c]);if(i0)for(var c of i0(b))i2.call(b,c)&&i3(a,c,b[c]);return a},i5=(a,b)=>i$(a,i_(b)),i6=class extends Error{constructor(a,b,c){super(b||a.toString(),{cause:c}),this.status=a,this.statusText=b,this.error=c}},i7=async(a,b)=>{var c,d,e,f,g,h;let i=b||{},j={onRequest:[null==b?void 0:b.onRequest],onResponse:[null==b?void 0:b.onResponse],onSuccess:[null==b?void 0:b.onSuccess],onError:[null==b?void 0:b.onError],onRetry:[null==b?void 0:b.onRetry]};if(!b||!(null==b?void 0:b.plugins))return{url:a,options:i,hooks:j};for(let k of(null==b?void 0:b.plugins)||[]){if(k.init){let d=await (null==(c=k.init)?void 0:c.call(k,a.toString(),b));i=d.options||i,a=d.url}j.onRequest.push(null==(d=k.hooks)?void 0:d.onRequest),j.onResponse.push(null==(e=k.hooks)?void 0:e.onResponse),j.onSuccess.push(null==(f=k.hooks)?void 0:f.onSuccess),j.onError.push(null==(g=k.hooks)?void 0:g.onError),j.onRetry.push(null==(h=k.hooks)?void 0:h.onRetry)}return{url:a,options:i,hooks:j}},i8=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(){return this.options.delay}},i9=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(a){return Math.min(this.options.maxDelay,this.options.baseDelay*2**a)}},ja=async a=>{let b={},c=async a=>"function"==typeof a?await a():a;if(null==a?void 0:a.auth){if("Bearer"===a.auth.type){let d=await c(a.auth.token);if(!d)return b;b.authorization=`Bearer ${d}`}else if("Basic"===a.auth.type){let d=c(a.auth.username),e=c(a.auth.password);if(!d||!e)return b;b.authorization=`Basic ${btoa(`${d}:${e}`)}`}else if("Custom"===a.auth.type){let d=c(a.auth.value);if(!d)return b;b.authorization=`${c(a.auth.prefix)} ${d}`}}return b},jb=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function jc(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}function jd(a){try{return JSON.parse(a)}catch(b){return a}}function je(a){return"function"==typeof a}async function jf(a){let b=new Headers(null==a?void 0:a.headers);for(let[c,d]of Object.entries(await ja(a)||{}))b.set(c,d);if(!b.has("content-type")){let c=jc(null==a?void 0:a.body)?"application/json":null;c&&b.set("content-type",c)}return b}var jg=class a extends Error{constructor(b,c){super(c||JSON.stringify(b,null,2)),this.issues=b,Object.setPrototypeOf(this,a.prototype)}};async function jh(a,b){let c=await a["~standard"].validate(b);if(c.issues)throw new jg(c.issues);return c.value}var ji=["get","post","put","patch","delete"],jj=async(a,b)=>{var c,d,e,f,g,h,i,j;let{hooks:k,url:l,options:m}=await i7(a,b),n=function(a){if(null==a?void 0:a.customFetchImpl)return a.customFetchImpl;if("undefined"!=typeof globalThis&&je(globalThis.fetch))return globalThis.fetch;if("undefined"!=typeof window&&je(window.fetch))return window.fetch;throw Error("No fetch implementation found")}(m),o=new AbortController,p=null!=(c=m.signal)?c:o.signal,q=function(a,b){let{baseURL:c,params:d,query:e}=b||{query:{},params:{},baseURL:""},f=a.startsWith("http")?a.split("/").slice(0,3).join("/"):c||"";if(a.startsWith("@")){let b=a.toString().split("@")[1].split("/")[0];ji.includes(b)&&(a=a.replace(`@${b}/`,"/"))}f.endsWith("/")||(f+="/");let[g,h]=a.replace(f,"").split("?"),i=new URLSearchParams(h);for(let[a,b]of Object.entries(e||{}))null!=b&&i.set(a,String(b));if(d)if(Array.isArray(d))for(let[a,b]of g.split("/").filter(a=>a.startsWith(":")).entries()){let c=d[a];g=g.replace(b,c)}else for(let[a,b]of Object.entries(d))g=g.replace(`:${a}`,String(b));(g=g.split("/").map(encodeURIComponent).join("/")).startsWith("/")&&(g=g.slice(1));let j=i.toString();return(j=j.length>0?`?${j}`.replace(/\+/g,"%20"):"",f.startsWith("http"))?new URL(`${g}${j}`,f):`${f}${g}${j}`}(l,m),r=function(a){if(!(null==a?void 0:a.body))return null;let b=new Headers(null==a?void 0:a.headers);if(jc(a.body)&&!b.has("content-type")){for(let[b,c]of Object.entries(null==a?void 0:a.body))c instanceof Date&&(a.body[b]=c.toISOString());return JSON.stringify(a.body)}return a.body}(m),s=await jf(m),t=function(a,b){var c;if(null==b?void 0:b.method)return b.method.toUpperCase();if(a.startsWith("@")){let d=null==(c=a.split("@")[1])?void 0:c.split("/")[0];return ji.includes(d)?d.toUpperCase():(null==b?void 0:b.body)?"POST":"GET"}return(null==b?void 0:b.body)?"POST":"GET"}(l,m),u=i5(i4({},m),{url:q,headers:s,body:r,method:t,signal:p});for(let a of k.onRequest)if(a){let b=await a(u);b instanceof Object&&(u=b)}("pipeTo"in u&&"function"==typeof u.pipeTo||"function"==typeof(null==(d=null==b?void 0:b.body)?void 0:d.pipe))&&!("duplex"in u)&&(u.duplex="half");let{clearTimeout:v}=function(a,b){let c;return!(null==a?void 0:a.signal)&&(null==a?void 0:a.timeout)&&(c=setTimeout(()=>null==b?void 0:b.abort(),null==a?void 0:a.timeout)),{abortTimeout:c,clearTimeout:()=>{c&&clearTimeout(c)}}}(m,o),w=await n(u.url,u);v();let x={response:w,request:u};for(let a of k.onResponse)if(a){let c=await a(i5(i4({},x),{response:(null==(e=null==b?void 0:b.hookOptions)?void 0:e.cloneResponse)?w.clone():w}));c instanceof Response?w=c:c instanceof Object&&(w=c.response)}if(w.ok){if("HEAD"===u.method)return{data:"",error:null};let a=function(a){let b=a.headers.get("content-type"),c=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!b)return"json";let d=b.split(";").shift()||"";return jb.test(d)?"json":c.has(d)||d.startsWith("text/")?"text":"blob"}(w),c={data:"",response:w,request:u};if("json"===a||"text"===a){let a=await w.text(),b=null!=(f=u.jsonParser)?f:jd;c.data=await b(a)}else c.data=await w[a]();for(let a of((null==u?void 0:u.output)&&u.output&&!u.disableValidation&&(c.data=await jh(u.output,c.data)),k.onSuccess))a&&await a(i5(i4({},c),{response:(null==(g=null==b?void 0:b.hookOptions)?void 0:g.cloneResponse)?w.clone():w}));return(null==b?void 0:b.throw)?c.data:{data:c.data,error:null}}let y=null!=(h=null==b?void 0:b.jsonParser)?h:jd,z=await w.text(),A=function(a){try{return JSON.parse(a),!0}catch(a){return!1}}(z),B=A?await y(z):null,C={response:w,responseText:z,request:u,error:i5(i4({},B),{status:w.status,statusText:w.statusText})};for(let a of k.onError)a&&await a(i5(i4({},C),{response:(null==(i=null==b?void 0:b.hookOptions)?void 0:i.cloneResponse)?w.clone():w}));if(null==b?void 0:b.retry){let c=function(a){if("number"==typeof a)return new i8({type:"linear",attempts:a,delay:1e3});switch(a.type){case"linear":return new i8(a);case"exponential":return new i9(a);default:throw Error("Invalid retry strategy")}}(b.retry),d=null!=(j=b.retryAttempt)?j:0;if(await c.shouldAttemptRetry(d,w)){for(let a of k.onRetry)a&&await a(x);let e=c.getDelay(d);return await new Promise(a=>setTimeout(a,e)),await jj(a,i5(i4({},b),{retryAttempt:d+1}))}}if(null==b?void 0:b.throw)throw new i6(w.status,w.statusText,A?B:z);return{data:null,error:i5(i4({},B),{status:w.status,statusText:w.statusText})}};let jk=async(a,b,c,d)=>{let e=await hP(a,b,"verify");hJ(a,e);let f=hI(a,e.algorithm);try{return await crypto.subtle.verify(f,e,c,d)}catch{return!1}};async function jl(a,b,c){let d,e;if(!hV(a))throw new hB("Flattened JWS must be an object");if(void 0===a.protected&&void 0===a.header)throw new hB('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==a.protected&&"string"!=typeof a.protected)throw new hB("JWS Protected Header incorrect type");if(void 0===a.payload)throw new hB("JWS Payload missing");if("string"!=typeof a.signature)throw new hB("JWS Signature missing or incorrect type");if(void 0!==a.header&&!hV(a.header))throw new hB("JWS Unprotected Header incorrect type");let f={};if(a.protected)try{let b=hu(a.protected);f=JSON.parse(hs.decode(b))}catch{throw new hB("JWS Protected Header is invalid")}if(!hR(f,a.header))throw new hB("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let g={...f,...a.header},h=h$(hB,new Map([["b64",!0]]),c?.crit,f,g),i=!0;if(h.has("b64")&&"boolean"!=typeof(i=f.b64))throw new hB('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:j}=g;if("string"!=typeof j||!j)throw new hB('JWS "alg" (Algorithm) Header Parameter missing or invalid');let k=c&&((a,b)=>{if(void 0!==b&&(!Array.isArray(b)||b.some(a=>"string"!=typeof a)))throw TypeError(`"${a}" option must be an array of strings`);if(b)return new Set(b)})("algorithms",c.algorithms);if(k&&!k.has(j))throw new hz('"alg" (Algorithm) Header Parameter value not allowed');if(i){if("string"!=typeof a.payload)throw new hB("JWS Payload must be a string")}else if("string"!=typeof a.payload&&!(a.payload instanceof Uint8Array))throw new hB("JWS Payload must be a string or an Uint8Array instance");let l=!1;"function"==typeof b&&(b=await b(f,a),l=!0),hZ(j,b,"verify");let m=ht(hr.encode(a.protected??""),hr.encode("."),"string"==typeof a.payload?hr.encode(a.payload):a.payload);try{d=hu(a.signature)}catch{throw new hB("Failed to base64url decode the signature")}let n=await h1(b,j);if(!await jk(j,n,d,m))throw new hH;if(i)try{e=hu(a.payload)}catch{throw new hB("Failed to base64url decode the payload")}else e="string"==typeof a.payload?hr.encode(a.payload):a.payload;let o={payload:e};return(void 0!==a.protected&&(o.protectedHeader=f),void 0!==a.header&&(o.unprotectedHeader=a.header),l)?{...o,key:n}:o}async function jm(a,b,c){if(a instanceof Uint8Array&&(a=hs.decode(a)),"string"!=typeof a)throw new hB("Compact JWS must be a string or Uint8Array");let{0:d,1:e,2:f,length:g}=a.split(".");if(3!==g)throw new hB("Invalid Compact JWS");let h=await jl({payload:e,protected:d,signature:f},b,c),i={payload:h.payload,protectedHeader:h.protectedHeader};return"function"==typeof b?{...i,key:h.key}:i}async function jn(a,b,c){let d=await jm(a,b,c);if(d.protectedHeader.crit?.includes("b64")&&!1===d.protectedHeader.b64)throw new hC("JWTs MUST NOT use unencoded payload");let e={payload:function(a,b,c={}){var d,e;let f,g;try{f=JSON.parse(hs.decode(b))}catch{}if(!hV(f))throw new hC("JWT Claims Set must be a top-level JSON object");let{typ:h}=c;if(h&&("string"!=typeof a.typ||h8(a.typ)!==h8(h)))throw new hx('unexpected "typ" JWT header value',f,"typ","check_failed");let{requiredClaims:i=[],issuer:j,subject:k,audience:l,maxTokenAge:m}=c,n=[...i];for(let a of(void 0!==m&&n.push("iat"),void 0!==l&&n.push("aud"),void 0!==k&&n.push("sub"),void 0!==j&&n.push("iss"),new Set(n.reverse())))if(!(a in f))throw new hx(`missing required "${a}" claim`,f,a,"missing");if(j&&!(Array.isArray(j)?j:[j]).includes(f.iss))throw new hx('unexpected "iss" claim value',f,"iss","check_failed");if(k&&f.sub!==k)throw new hx('unexpected "sub" claim value',f,"sub","check_failed");if(l&&(d=f.aud,e="string"==typeof l?[l]:l,"string"==typeof d?!e.includes(d):!(Array.isArray(d)&&e.some(Set.prototype.has.bind(new Set(d))))))throw new hx('unexpected "aud" claim value',f,"aud","check_failed");switch(typeof c.clockTolerance){case"string":g=h6(c.clockTolerance);break;case"number":g=c.clockTolerance;break;case"undefined":g=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:o}=c,p=h4(o||new Date);if((void 0!==f.iat||m)&&"number"!=typeof f.iat)throw new hx('"iat" claim must be a number',f,"iat","invalid");if(void 0!==f.nbf){if("number"!=typeof f.nbf)throw new hx('"nbf" claim must be a number',f,"nbf","invalid");if(f.nbf>p+g)throw new hx('"nbf" claim timestamp check failed',f,"nbf","check_failed")}if(void 0!==f.exp){if("number"!=typeof f.exp)throw new hx('"exp" claim must be a number',f,"exp","invalid");if(f.exp<=p-g)throw new hy('"exp" claim timestamp check failed',f,"exp","check_failed")}if(m){let a=p-f.iat;if(a-g>("number"==typeof m?m:h6(m)))throw new hy('"iat" claim timestamp check failed (too far in the past)',f,"iat","check_failed");if(a<0-g)throw new hx('"iat" claim timestamp check failed (it should be in the past)',f,"iat","check_failed")}return f}(d.protectedHeader,d.payload,c),protectedHeader:d.protectedHeader};return"function"==typeof b?{...e,key:d.key}:e}function jo(a){let b;if("string"==typeof a){let c=a.split(".");(3===c.length||5===c.length)&&([b]=c)}else if("object"==typeof a&&a)if("protected"in a)b=a.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof b||!b)throw Error();let a=JSON.parse(hs.decode(hu(b)));if(!hV(a))throw Error();return a}catch{throw TypeError("Invalid Token or Protected Header formatting")}}function jp(a){let b,c;if("string"!=typeof a)throw new hC("JWTs must use Compact JWS serialization, JWT must be a string");let{1:d,length:e}=a.split(".");if(5===e)throw new hC("Only JWTs using Compact JWS serialization can be decoded");if(3!==e)throw new hC("Invalid JWT");if(!d)throw new hC("JWTs must contain a payload");try{b=hu(d)}catch{throw new hC("Failed to base64url decode the payload")}try{c=JSON.parse(hs.decode(b))}catch{throw new hC("Failed to parse the decoded payload as JSON")}if(!hV(c))throw new hC("Invalid JWT Claims Set");return c}async function jq(a,b,c){let d;if(!hV(a))throw TypeError("JWK must be an object");switch(b??=a.alg,d??=c?.extractable??a.ext,a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw TypeError('missing "k" (Key Value) Parameter value');return hu(a.k);case"RSA":if("oth"in a&&void 0!==a.oth)throw new hA('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return h_({...a,alg:b,ext:d});case"AKP":if("string"!=typeof a.alg||!a.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==b&&b!==a.alg)throw TypeError("JWK alg and alg option value mismatch");return h_({...a,ext:d});case"EC":case"OKP":return h_({...a,alg:b,ext:d});default:throw new hA('Unsupported "kty" (Key Type) Parameter value')}}function jr(a){return hV(a)}class js{#g;#h=new WeakMap;constructor(a){if(!function(a){return a&&"object"==typeof a&&Array.isArray(a.keys)&&a.keys.every(jr)}(a))throw new hD("JSON Web Key Set malformed");this.#g=structuredClone(a)}jwks(){return this.#g}async getKey(a,b){let{alg:c,kid:d}={...a,...b?.header},e=function(a){switch("string"==typeof a&&a.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new hA('Unsupported "alg" value for a JSON Web Key Set')}}(c),f=this.#g.keys.filter(a=>{let b=e===a.kty;if(b&&"string"==typeof d&&(b=d===a.kid),b&&("string"==typeof a.alg||"AKP"===e)&&(b=c===a.alg),b&&"string"==typeof a.use&&(b="sig"===a.use),b&&Array.isArray(a.key_ops)&&(b=a.key_ops.includes("verify")),b)switch(c){case"ES256":b="P-256"===a.crv;break;case"ES384":b="P-384"===a.crv;break;case"ES512":b="P-521"===a.crv;break;case"Ed25519":case"EdDSA":b="Ed25519"===a.crv}return b}),{0:g,length:h}=f;if(0===h)throw new hE;if(1!==h){let a=new hF,b=this.#h;throw a[Symbol.asyncIterator]=async function*(){for(let a of f)try{yield await jt(b,a,c)}catch{}},a}return jt(this.#h,g,c)}}async function jt(a,b,c){let d=a.get(b)||a.set(b,{}).get(b);if(void 0===d[c]){let a=await jq({...b,ext:!0},c);if(a instanceof Uint8Array||"public"!==a.type)throw new hD("JSON Web Key Set members must be public keys");d[c]=a}return d[c]}function ju(a){let b=new js(a),c=async(a,c)=>b.getKey(a,c);return Object.defineProperties(c,{jwks:{value:()=>structuredClone(b.jwks()),enumerable:!1,configurable:!1,writable:!1}}),c}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(e="jose/v6.1.0");let jv=Symbol();async function jw(a,b,c,d=fetch){let e=await d(a,{method:"GET",signal:c,redirect:"manual",headers:b}).catch(a=>{if("TimeoutError"===a.name)throw new hG;throw a});if(200!==e.status)throw new hw("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await e.json()}catch{throw new hw("Failed to parse the JSON Web Key Set HTTP response as JSON")}}let jx=Symbol();class jy{#i;#j;#k;#l;#m;#n;#o;#p;#q;#r;constructor(a,b){if(!(a instanceof URL))throw TypeError("url must be an instance of URL");this.#i=new URL(a.href),this.#j="number"==typeof b?.timeoutDuration?b?.timeoutDuration:5e3,this.#k="number"==typeof b?.cooldownDuration?b?.cooldownDuration:3e4,this.#l="number"==typeof b?.cacheMaxAge?b?.cacheMaxAge:6e5,this.#o=new Headers(b?.headers),e&&!this.#o.has("User-Agent")&&this.#o.set("User-Agent",e),this.#o.has("accept")||(this.#o.set("accept","application/json"),this.#o.append("accept","application/jwk-set+json")),this.#p=b?.[jv],b?.[jx]!==void 0&&(this.#r=b?.[jx],function(a,b){return!("object"!=typeof a||null===a||!("uat"in a)||"number"!=typeof a.uat||Date.now()-a.uat>=b)&&"jwks"in a&&!!hV(a.jwks)&&!!Array.isArray(a.jwks.keys)&&!!Array.prototype.every.call(a.jwks.keys,hV)}(b?.[jx],this.#l)&&(this.#m=this.#r.uat,this.#q=ju(this.#r.jwks)))}pendingFetch(){return!!this.#n}coolingDown(){return"number"==typeof this.#m&&Date.now()<this.#m+this.#k}fresh(){return"number"==typeof this.#m&&Date.now()<this.#m+this.#l}jwks(){return this.#q?.jwks()}async getKey(a,b){this.#q&&this.fresh()||await this.reload();try{return await this.#q(a,b)}catch(c){if(c instanceof hE&&!1===this.coolingDown())return await this.reload(),this.#q(a,b);throw c}}async reload(){this.#n&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this.#n=void 0),this.#n||=jw(this.#i.href,this.#o,AbortSignal.timeout(this.#j),this.#p).then(a=>{this.#q=ju(a),this.#r&&(this.#r.uat=Date.now(),this.#r.jwks=a),this.#m=Date.now(),this.#n=void 0}).catch(a=>{throw this.#n=void 0,a}),await this.#n}}let jz=a=>iP("a-z","A-Z","0-9")(a||32),jA=fD({id:e2(),createdAt:fz().default(()=>new Date),updatedAt:fz().default(()=>new Date)});function jB(a,b){let c=b.fields,d={};for(let b in a){let e=c[b];if(!e){d[b]=a[b];continue}!1!==e.returned&&(d[b]=a[b])}return d}function jC(a,b){let c={..."user"===b?a.user?.additionalFields:{},..."session"===b?a.session?.additionalFields:{}};for(let d of a.plugins||[])d.schema&&d.schema[b]&&(c={...c,...d.schema[b].fields});return c}function jD(a,b){return jB(b,{fields:jC(a,"user")})}function jE(a,b){return jB(b,{fields:jC(a,"session")})}function jF(a,b,c){return function(a,b){let c=b.action||"create",d=b.fields,e={};for(let b in d){if(b in a){if(!1===d[b].input){d[b].defaultValue&&(e[b]=d[b].defaultValue);continue}if(d[b].validator?.input&&void 0!==a[b]){e[b]=d[b].validator.input.parse(a[b]);continue}if(d[b].transform?.input&&void 0!==a[b]){e[b]=d[b].transform?.input(a[b]);continue}e[b]=a[b];continue}if(d[b].defaultValue&&"create"===c){e[b]=d[b].defaultValue;continue}if(d[b].required&&"create"===c)throw new I("BAD_REQUEST",{message:`${b} is required`})}return e}(b||{},{fields:jC(a,"user"),action:c})}function jG(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.iterator in a)&&(!(Symbol.toStringTag in a)||"[object Module]"===Object.prototype.toString.call(a))}function jH(a){return(...b)=>b.reduce((b,c)=>(function a(b,c,d=".",e){if(!jG(c))return a(b,{},d,e);let f=Object.assign({},c);for(let c in b){if("__proto__"===c||"constructor"===c)continue;let g=b[c];null!=g&&(e&&e(f,c,g,d)||(Array.isArray(g)&&Array.isArray(f[c])?f[c]=[...g,...f[c]]:jG(g)&&jG(f[c])?f[c]=a(g,f[c],(d?`${d}.`:"")+c.toString(),e):f[c]=g))}return f})(b,c,"",a),{})}jA.extend({providerId:e2(),accountId:e2(),userId:fZ(),accessToken:e2().nullish(),refreshToken:e2().nullish(),idToken:e2().nullish(),accessTokenExpiresAt:fz().nullish(),refreshTokenExpiresAt:fz().nullish(),scope:e2().nullish(),password:e2().nullish()}),jA.extend({email:e2().transform(a=>a.toLowerCase()),emailVerified:fs().default(!1),name:e2(),image:e2().nullish()}),jA.extend({userId:fZ(),expiresAt:fz(),token:e2(),ipAddress:e2().nullish(),userAgent:e2().nullish()}),jA.extend({value:e2(),expiresAt:fz(),identifier:e2()});let jI=jH();function jJ(a){return"-"===a||"^"===a||"$"===a||"+"===a||"."===a||"("===a||")"===a||"|"===a||"["===a||"]"===a||"{"===a||"}"===a||"*"===a||"?"===a||"\\"===a?`\\${a}`:a}function jK(a,b){if("string"!=typeof b)throw TypeError(`Sample must be a string, but ${typeof b} given`);return a.test(b)}function jL(a,b){if("string"!=typeof a&&!Array.isArray(a))throw TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof a} given`);if(("string"==typeof b||"boolean"==typeof b)&&(b={separator:b}),2==arguments.length&&!(void 0===b||"object"==typeof b&&null!==b&&!Array.isArray(b)))throw TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof b} given`);if("\\"===(b=b||{}).separator)throw Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let c=function a(b,c=!0){if(Array.isArray(b)){let d=b.map(b=>`^${a(b,c)}$`);return`(?:${d.join("|")})`}let d="",e="",f=".";!0===c?(d="/",e="[/\\\\]",f="[^/\\\\]"):c&&((e=function(a){let b="";for(let c=0;c<a.length;c++)b+=jJ(a[c]);return b}(d=c)).length>1?(e=`(?:${e})`,f=`((?!${e}).)`):f=`[^${e}]`);let g=c?`${e}+?`:"",h=c?`${e}*?`:"",i=c?b.split(d):[b],j="";for(let a=0;a<i.length;a++){let b=i[a],d=i[a+1],e="";if(b||!(a>0)){if(c&&(e=a===i.length-1?h:"**"!==d?g:""),c&&"**"===b){e&&(j+=0===a?"":e,j+=`(?:${f}*?${e})*?`);continue}for(let a=0;a<b.length;a++){let c=b[a];"\\"===c?a<b.length-1&&(j+=jJ(b[a+1]),a++):"?"===c?j+=f:"*"===c?j+=`${f}*?`:j+=jJ(c)}j+=e}}return j}(a,b.separator),d=RegExp(`^${c}$`,b.flags),e=jK.bind(null,d);return e.options=b,e.pattern=a,e.regexp=d,e}jH((a,b,c)=>{if(void 0!==a[b]&&"function"==typeof c)return a[b]=c(a[b]),!0}),jH((a,b,c)=>{if(Array.isArray(a[b])&&"function"==typeof c)return a[b]=c(a[b]),!0});let jM=gF(async a=>{if(a.request?.method!=="POST"||!a.request)return;let{body:b,query:c,context:d}=a,e=a.headers?.get("origin")||a.headers?.get("referer")||"",f=b?.callbackURL||c?.callbackURL,g=b?.redirectTo,h=b?.errorCallbackURL,i=b?.newUserCallbackURL,j=Array.isArray(d.options.trustedOrigins)?d.trustedOrigins:[...d.trustedOrigins,...await d.options.trustedOrigins?.(a.request)||[]],k=a.headers?.has("cookie"),l=(b,c)=>{if(b&&!j.some(a=>((a,b)=>{if(a.startsWith("/"))return!1;if(b.includes("*"))return b.includes("://")?jL(b)(gu(a)||a):jL(b)(gw(a));let c=gv(a);return"http:"!==c&&"https:"!==c&&c?a.startsWith(b):b===gu(a)})(b,a)||b?.startsWith("/")&&"origin"!==c&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(b)))throw a.context.logger.error(`Invalid ${c}: ${b}`),a.context.logger.info(`If it's a valid URL, please add ${b} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${j}`),new I("FORBIDDEN",{message:`Invalid ${c}`})};k&&!a.context.options.advanced?.disableCSRFCheck&&l(e,"origin"),f&&l(f,"callbackURL"),g&&l(g,"redirectURL"),h&&l(h,"errorCallbackURL"),i&&l(i,"newUserCallbackURL")}),jN=a=>gF(async b=>{if(!b.request)return;let{context:c}=b,d=a(b),e=Array.isArray(c.options.trustedOrigins)?c.trustedOrigins:[...c.trustedOrigins,...await c.options.trustedOrigins?.(b.request)||[]],f=(a,c)=>{if(a&&!e.some(b=>((a,b)=>{if(a.startsWith("/"))return!1;if(b.includes("*"))return b.includes("://")?jL(b)(gu(a)||a):jL(b)(gw(a));let c=gv(a);return"http:"!==c&&"https:"!==c&&c?a.startsWith(b):b===gu(a)})(a,b)||a?.startsWith("/")&&"origin"!==c&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(a)))throw b.context.logger.error(`Invalid ${c}: ${a}`),b.context.logger.info(`If it's a valid URL, please add ${a} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${e}`),new I("FORBIDDEN",{message:`Invalid ${c}`})};for(let a of Array.isArray(d)?d:[d])f(a,"callbackURL")});async function jO(a,b,c,d=3600){return await iR({email:b.toLowerCase(),updateTo:c},a,d)}async function jP(a,b){if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new I("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await jO(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:b,url:d,token:c},a.request)}let jQ=gG("/send-verification-email",{method:"POST",body:fD({email:ey(e4,void 0).meta({description:"The email to send the verification email to"}),callbackURL:e2().meta({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async a=>{if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new I("BAD_REQUEST",{message:"Verification email isn't enabled"});let{email:b}=a.body,c=await gK(a);if(!c){let c=await a.context.internalAdapter.findUserByEmail(b);return c&&await jP(a,c.user),a.json({status:!0})}if(c?.user.emailVerified)throw new I("BAD_REQUEST",{message:"You can only send a verification email to an unverified email"});if(c?.user.email!==b)throw new I("BAD_REQUEST",{message:"You can only send a verification email to your own email"});return await jP(a,c.user),a.json({status:!0})}),jR=gG("/verify-email",{method:"GET",query:fD({token:e2().meta({description:"The token to verify the email"}),callbackURL:e2().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[jN(a=>a.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string",description:"User ID"},email:{type:"string",description:"User email"},name:{type:"string",description:"User name"},image:{type:"string",description:"User image URL"},emailVerified:{type:"boolean",description:"Indicates if the user email is verified"},createdAt:{type:"string",description:"User creation date"},updatedAt:{type:"string",description:"User update date"}},required:["id","email","name","image","emailVerified","createdAt","updatedAt"]},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async a=>{let b;function c(b){if(a.query.callbackURL){if(a.query.callbackURL.includes("?"))throw a.redirect(`${a.query.callbackURL}&error=${b}`);throw a.redirect(`${a.query.callbackURL}?error=${b}`)}throw new I("UNAUTHORIZED",{message:b})}let{token:d}=a.query;try{b=await jn(d,new TextEncoder().encode(a.context.secret),{algorithms:["HS256"]})}catch(a){if(a instanceof hy)return c("token_expired");return c("invalid_token")}let e=fD({email:e2().email(),updateTo:e2().optional()}).parse(b.payload),f=await a.context.internalAdapter.findUserByEmail(e.email);if(!f)return c("user_not_found");if(e.updateTo){let b=await gK(a);if(!b||b.user.email!==e.email){if(a.query.callbackURL)throw a.redirect(`${a.query.callbackURL}?error=unauthorized`);return c("unauthorized")}let d=await a.context.internalAdapter.updateUserByEmail(e.email,{email:e.updateTo,emailVerified:!1},a),f=await jO(a.context.secret,e.updateTo);if(await a.context.options.emailVerification?.sendVerificationEmail?.({user:d,url:`${a.context.baseURL}/verify-email?token=${f}&callbackURL=${a.query.callbackURL||"/"}`,token:f},a.request),await gC(a,{session:b.session,user:{...b.user,email:e.updateTo,emailVerified:!1}}),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:{id:d.id,email:d.email,name:d.name,image:d.image,emailVerified:d.emailVerified,createdAt:d.createdAt,updatedAt:d.updatedAt}})}a.context.options.emailVerification?.onEmailVerification&&await a.context.options.emailVerification.onEmailVerification(f.user,a.request);let g=await a.context.internalAdapter.updateUserByEmail(e.email,{emailVerified:!0},a);if(a.context.options.emailVerification?.afterEmailVerification&&await a.context.options.emailVerification.afterEmailVerification(g,a.request),a.context.options.emailVerification?.autoSignInAfterVerification){let b=await gK(a);if(b&&b.user.email===e.email)await gC(a,{session:b.session,user:{...b.user,emailVerified:!0}});else{let b=await a.context.internalAdapter.createSession(f.user.id,a);if(!b)throw new I("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await gC(a,{session:b,user:{...f.user,emailVerified:!0}})}}if(a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:null})}),jS={isAction:!1};async function jT(a,b){let c=a.body?.callbackURL||a.context.options.baseURL;if(!c)throw new I("BAD_REQUEST",{message:"callbackURL is required"});let d=iQ(128),e=iQ(32),f=a.context.createAuthCookie("state",{maxAge:3e5});await a.setSignedCookie(f.name,e,a.context.secret,f.attributes);let g=JSON.stringify({callbackURL:c,codeVerifier:d,errorURL:a.body?.errorCallbackURL,newUserURL:a.body?.newUserCallbackURL,link:b,expiresAt:Date.now()+6e5,requestSignUp:a.body?.requestSignUp}),h=new Date;h.setMinutes(h.getMinutes()+10);let i=await a.context.internalAdapter.createVerificationValue({value:g,identifier:e,expiresAt:h},a);if(!i)throw a.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"),new I("INTERNAL_SERVER_ERROR",{message:"Unable to create verification"});return{state:i.identifier,codeVerifier:d}}async function jU(a){let b=a.query.state||a.body.state,c=await a.context.internalAdapter.findVerificationValue(b);if(!c){a.context.logger.error("State Mismatch. Verification not found",{state:b});let c=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${c}?error=please_restart_the_process`)}let d=fD({callbackURL:e2(),codeVerifier:e2(),errorURL:e2().optional(),newUserURL:e2().optional(),expiresAt:fo(),link:fD({email:e2(),userId:fZ()}).optional(),requestSignUp:fs().optional()}).parse(JSON.parse(c.value));d.errorURL||(d.errorURL=`${a.context.baseURL}/error`);let e=a.context.createAuthCookie("state"),f=await a.getSignedCookie(e.name,a.context.secret);if(!f||f!==b){let b=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${b}?error=state_mismatch`)}if(a.setCookie(e.name,"",{maxAge:0}),d.expiresAt<Date.now()){await a.context.internalAdapter.deleteVerificationValue(c.id);let b=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${b}?error=please_restart_the_process`)}return await a.context.internalAdapter.deleteVerificationValue(c.id),d}async function jV(a){let b=await gR("SHA-256").digest(a);return gf.encode(new Uint8Array(b),{padding:!1})}function jW(a){return{tokenType:a.token_type,accessToken:a.access_token,refreshToken:a.refresh_token,accessTokenExpiresAt:a.expires_in?f_(a.expires_in,"sec"):void 0,refreshTokenExpiresAt:a.refresh_token_expires_in?f_(a.refresh_token_expires_in,"sec"):void 0,scopes:a?.scope?"string"==typeof a.scope?a.scope.split(" "):a.scope:[],idToken:a.id_token}}function jX(a,b){return b.options.account?.encryptOAuthTokens&&a?iX({key:b.secret,data:a}):a}async function jY(a,{userInfo:b,account:c,callbackURL:d,disableSignUp:e,overrideUserInfo:f}){let g=await a.context.internalAdapter.findOAuthUser(b.email.toLowerCase(),c.accountId,c.providerId).catch(b=>{gq.error("Better auth was unable to query your database.\nError: ",b);let c=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${c}?error=internal_server_error`)}),h=g?.user,i=!h;if(g){let d=g.accounts.find(a=>a.providerId===c.providerId&&a.accountId===c.accountId);if(d){if(a.context.options.account?.updateAccountOnSignIn!==!1){let b=Object.fromEntries(Object.entries({idToken:c.idToken,accessToken:await jX(c.accessToken,a.context),refreshToken:await jX(c.refreshToken,a.context),accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope}).filter(([a,b])=>void 0!==b));Object.keys(b).length>0&&await a.context.internalAdapter.updateAccount(d.id,b,a)}b.emailVerified&&!g.user.emailVerified&&b.email.toLowerCase()===g.user.email&&await a.context.internalAdapter.updateUser(g.user.id,{emailVerified:!0})}else{let d=a.context.options.account?.accountLinking?.trustedProviders;if(!d?.includes(c.providerId)&&!b.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return f6&&gq.warn(`User already exist but account isn't linked to ${c.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await a.context.internalAdapter.linkAccount({providerId:c.providerId,accountId:b.id.toString(),userId:g.user.id,accessToken:await jX(c.accessToken,a.context),refreshToken:await jX(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope},a)}catch(a){return gq.error("Unable to link account",a),{error:"unable to link account",data:null}}b.emailVerified&&!g.user.emailVerified&&b.email.toLowerCase()===g.user.email&&await a.context.internalAdapter.updateUser(g.user.id,{emailVerified:!0})}if(f){let{id:c,...d}=b;await a.context.internalAdapter.updateUser(g.user.id,{...d,email:b.email.toLowerCase(),emailVerified:b.email.toLowerCase()===g.user.email&&g.user.emailVerified||b.emailVerified})}}else{if(e)return{error:"signup disabled",data:null,isRegister:!1};try{let{id:e,...f}=b;if(h=await a.context.internalAdapter.createOAuthUser({...f,email:b.email.toLowerCase()},{accessToken:await jX(c.accessToken,a.context),refreshToken:await jX(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope,providerId:c.providerId,accountId:b.id.toString()},a).then(a=>a?.user),!b.emailVerified&&h&&a.context.options.emailVerification?.sendOnSignUp){let b=await jO(a.context.secret,h.email,void 0,a.context.options.emailVerification?.expiresIn),c=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${d}`;await a.context.options.emailVerification?.sendVerificationEmail?.({user:h,url:c,token:b},a.request)}}catch(a){if(gq.error(a),a instanceof I)return{error:a.message,data:null,isRegister:!1};return{error:"unable to create user",data:null,isRegister:!1}}}if(!h)return{error:"unable to create user",data:null,isRegister:!1};let j=await a.context.internalAdapter.createSession(h.id,a);return j?{data:{session:j,user:h},error:null,isRegister:i}:{error:"unable to create session",data:null,isRegister:!1}}async function jZ({id:a,options:b,authorizationEndpoint:c,state:d,codeVerifier:e,scopes:f,claims:g,redirectURI:h,duration:i,prompt:j,accessType:k,responseType:l,display:m,loginHint:n,hd:o,responseMode:p,additionalParams:q,scopeJoiner:r}){let s=new URL(c);s.searchParams.set("response_type",l||"code");let t=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;if(s.searchParams.set("client_id",t),s.searchParams.set("state",d),s.searchParams.set("scope",f.join(r||" ")),s.searchParams.set("redirect_uri",b.redirectURI||h),i&&s.searchParams.set("duration",i),m&&s.searchParams.set("display",m),n&&s.searchParams.set("login_hint",n),j&&s.searchParams.set("prompt",j),o&&s.searchParams.set("hd",o),k&&s.searchParams.set("access_type",k),p&&s.searchParams.set("response_mode",p),e){let a=await jV(e);s.searchParams.set("code_challenge_method","S256"),s.searchParams.set("code_challenge",a)}if(g){let a=g.reduce((a,b)=>(a[b]=null,a),{});s.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...a}}))}return q&&Object.entries(q).forEach(([a,b])=>{s.searchParams.set(a,b)}),s}async function j$({code:a,codeVerifier:b,redirectURI:c,options:d,tokenEndpoint:e,authentication:f,deviceId:g,headers:h,additionalParams:i={},resource:j}){let{body:k,headers:l}=function({code:a,codeVerifier:b,redirectURI:c,options:d,authentication:e,deviceId:f,headers:g,additionalParams:h={},resource:i}){let j=new URLSearchParams,k={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth",...g};if(j.set("grant_type","authorization_code"),j.set("code",a),b&&j.set("code_verifier",b),d.clientKey&&j.set("client_key",d.clientKey),f&&j.set("device_id",f),j.set("redirect_uri",d.redirectURI||c),i)if("string"==typeof i)j.append("resource",i);else for(let a of i)j.append("resource",a);if("basic"===e){let a=Array.isArray(d.clientId)?d.clientId[0]:d.clientId,b=ge.encode(`${a}:${d.clientSecret??""}`);k.authorization=`Basic ${b}`}else{let a=Array.isArray(d.clientId)?d.clientId[0]:d.clientId;j.set("client_id",a),d.clientSecret&&j.set("client_secret",d.clientSecret)}for(let[a,b]of Object.entries(h))j.has(a)||j.append(a,b);return{body:j,headers:k}}({code:a,codeVerifier:b,redirectURI:c,options:d,authentication:f,deviceId:g,headers:h,additionalParams:i,resource:j}),{data:m,error:n}=await jj(e,{method:"POST",body:k,headers:l});if(n)throw n;return jW(m)}async function j_({refreshToken:a,options:b,tokenEndpoint:c,authentication:d,extraParams:e}){let{body:f,headers:g}=function({refreshToken:a,options:b,authentication:c,extraParams:d,resource:e}){let f=new URLSearchParams,g={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(f.set("grant_type","refresh_token"),f.set("refresh_token",a),"basic"===c){let a=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;a?g.authorization="Basic "+ge.encode(`${a}:${b.clientSecret??""}`):g.authorization="Basic "+ge.encode(`:${b.clientSecret??""}`)}else{let a=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;f.set("client_id",a),b.clientSecret&&f.set("client_secret",b.clientSecret)}if(e)if("string"==typeof e)f.append("resource",e);else for(let a of e)f.append("resource",a);if(d)for(let[a,b]of Object.entries(d))f.set(a,b);return{body:f,headers:g}}({refreshToken:a,options:b,authentication:d,extraParams:e}),{data:h,error:i}=await jj(c,{method:"POST",body:f,headers:g});if(i)throw i;let j={accessToken:h.access_token,refreshToken:h.refresh_token,tokenType:h.token_type,scopes:h.scope?.split(" "),idToken:h.id_token};return h.expires_in&&(j.accessTokenExpiresAt=new Date(new Date().getTime()+1e3*h.expires_in)),j}let j0=async a=>{let{data:b}=await jj("https://appleid.apple.com/auth/keys");if(!b?.keys)throw new I("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await jq(c,c.alg)},j1=async(a,b,c)=>{let d=`https://cognito-idp.${b}.amazonaws.com/${c}/.well-known/jwks.json`;try{let{data:b}=await jj(d);if(!b?.keys)throw new I("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await jq(c,c.alg)}catch(a){throw gq.error("Failed to fetch Cognito public key:",a),a}},j2=(a="")=>a.split("://").map(a=>a.replace(/\/{2,}/g,"/")).join("://"),j3={apple:a=>({id:"apple",name:"Apple",async createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["email","name"];return a.scope&&e.push(...a.scope),c&&e.push(...c),await jZ({id:"apple",options:a,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:e,state:b,redirectURI:d,responseMode:"form_post",responseType:"code id_token"})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>j$({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://appleid.apple.com/auth/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let{kid:d,alg:e}=jo(b);if(!d||!e)return!1;let f=await j0(d),{payload:g}=await jn(b,f,{algorithms:[e],issuer:"https://appleid.apple.com",audience:a.audience&&a.audience.length?a.audience:a.appBundleIdentifier?a.appBundleIdentifier:a.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(a=>{void 0!==g[a]&&(g[a]=!!g[a])}),(!c||g.nonce===c)&&!!g},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=jp(b.idToken);if(!c)return null;let d=b.user?`${b.user.name?.firstName} ${b.user.name?.lastName}`:c.name||c.email,e="boolean"==typeof c.email_verified?c.email_verified:"true"===c.email_verified,f={...c,name:d},g=await a.mapProfileToUser?.(f);return{user:{id:c.sub,name:f.name,emailVerified:e,email:c.email,...g},data:f}},options:a}),atlassian:a=>({id:"atlassian",name:"Atlassian",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw gq.error("Client Id and Secret are required for Atlassian"),new f0("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new f0("codeVerifier is required for Atlassian");let f=a.disableDefaultScope?[]:["read:jira-user","offline_access"];return a.scope&&f.push(...a.scope),c&&f.push(...c),jZ({id:"atlassian",options:a,authorizationEndpoint:"https://auth.atlassian.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e,additionalParams:{audience:"api.atlassian.com"},prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>j$({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;try{let{data:c}=await jj("https://api.atlassian.com/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name,email:c.email,image:c.picture,emailVerified:!1,...d},data:c}}catch(a){return gq.error("Failed to fetch user info from Figma:",a),null}},options:a}),cognito:a=>{if(!a.domain||!a.region||!a.userPoolId)throw gq.error("Domain, region and userPoolId are required for Amazon Cognito. Make sure to provide them in the options."),new f0("DOMAIN_AND_REGION_REQUIRED");let b=a.domain.replace(/^https?:\/\//,""),c=`https://${b}/oauth2/authorize`,d=`https://${b}/oauth2/token`,e=`https://${b}/oauth2/userinfo`;return{id:"cognito",name:"Cognito",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f}){if(!a.clientId)throw gq.error("ClientId is required for Amazon Cognito. Make sure to provide them in the options."),new f0("CLIENT_ID_AND_SECRET_REQUIRED");if(a.requireClientSecret&&!a.clientSecret)throw gq.error("Client Secret is required when requireClientSecret is true. Make sure to provide it in the options."),new f0("CLIENT_SECRET_REQUIRED");let g=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&g.push(...a.scope),d&&g.push(...d),await jZ({id:"cognito",options:{...a},authorizationEndpoint:c,scopes:g,state:b,codeVerifier:e,redirectURI:f,prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>j$({code:b,codeVerifier:c,redirectURI:e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{let{kid:d,alg:e}=jo(b);if(!d||!e)return!1;let f=await j1(d,a.region,a.userPoolId),g=`https://cognito-idp.${a.region}.amazonaws.com/${a.userPoolId}`,{payload:h}=await jn(b,f,{algorithms:[e],issuer:g,audience:a.clientId,maxTokenAge:"1h"});if(c&&h.nonce!==c)return!1;return!0}catch(a){return gq.error("Failed to verify ID token:",a),!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken)try{let c=jp(b.idToken);if(!c)return null;let d=c.name||c.given_name||c.username||c.email,e={...c,name:d},f=await a.mapProfileToUser?.(e);return{user:{id:c.sub,name:e.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...f},data:e}}catch(a){gq.error("Failed to decode ID token:",a)}if(b.accessToken)try{let{data:c}=await jj(e,{headers:{Authorization:`Bearer ${b.accessToken}`}});if(c){let b=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.given_name||c.username,email:c.email,image:c.picture,emailVerified:c.email_verified,...b},data:c}}}catch(a){gq.error("Failed to fetch user info from Cognito:",a)}return null},options:a}},discord:a=>({id:"discord",name:"Discord",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identify","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=e.includes("bot")&&void 0!==a.permissions?`&permissions=${a.permissions}`:"";return new URL(`https://discord.com/api/oauth2/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"none"}${f}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>j$({code:b,redirectURI:c,options:a,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;if(null===c.avatar){let a="0"===c.discriminator?Number(BigInt(c.id)>>BigInt(22))%6:parseInt(c.discriminator)%5;c.image_url=`https://cdn.discordapp.com/embed/avatars/${a}.png`}else{let a=c.avatar.startsWith("a_")?"gif":"png";c.image_url=`https://cdn.discordapp.com/avatars/${c.id}/${c.avatar}.${a}`}let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.global_name||c.username||"",email:c.email,emailVerified:c.verified,image:c.image_url,...e},data:c}},options:a}),facebook:a=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:b,scopes:c,redirectURI:d,loginHint:e}){let f=a.disableDefaultScope?[]:["email","public_profile"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await jZ({id:"facebook",options:a,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:f,state:b,redirectURI:d,loginHint:e,additionalParams:a.configId?{config_id:a.configId}:{}})},validateAuthorizationCode:async({code:b,redirectURI:c})=>j$({code:b,redirectURI:c,options:a,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);if(3===b.split(".").length)try{let{payload:d}=await jn(b,function(a,b){let c=new jy(a,void 0),d=async(a,b)=>c.getKey(a,b);return Object.defineProperties(d,{coolingDown:{get:()=>c.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>c.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>c.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>c.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>c.jwks(),enumerable:!0,configurable:!1,writable:!1}}),d}(new URL("https://limited.facebook.com/.well-known/oauth/openid/jwks/")),{algorithms:["RS256"],audience:a.clientId,issuer:"https://www.facebook.com"});if(c&&d.nonce!==c)return!1;return!!d}catch(a){return!1}return!0},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://graph.facebook.com/v18.0/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken&&3===b.idToken.split(".").length){let c=jp(b.idToken),d={id:c.sub,name:c.name,email:c.email,picture:{data:{url:c.picture,height:100,width:100,is_silhouette:!1}}},e=await a.mapProfileToUser?.({...d,email_verified:!0});return{user:{...d,emailVerified:!0,...e},data:c}}let c=["id","name","email","picture",...a?.fields||[]],{data:d,error:e}=await jj("https://graph.facebook.com/me?fields="+c.join(","),{auth:{type:"Bearer",token:b.accessToken}});if(e)return null;let f=await a.mapProfileToUser?.(d);return{user:{id:d.id,name:d.name,email:d.email,image:d.picture.data.url,emailVerified:d.email_verified,...f},data:d}},options:a}),figma:a=>({id:"figma",name:"Figma",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw gq.error("Client Id and Client Secret are required for Figma. Make sure to provide them in the options."),new f0("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new f0("codeVerifier is required for Figma");let f=a.disableDefaultScope?[]:["file_read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await jZ({id:"figma",options:a,authorizationEndpoint:"https://www.figma.com/oauth",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>j$({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://www.figma.com/api/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://www.figma.com/api/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);try{let{data:c}=await jj("https://api.figma.com/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return gq.error("Failed to fetch user from Figma"),null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.handle,email:c.email,image:c.img_url,emailVerified:!!c.email,...d},data:c}}catch(a){return gq.error("Failed to fetch user info from Figma:",a),null}},options:a}),github:a=>({id:"github",name:"GitHub",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["read:user","user:email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),jZ({id:"github",options:a,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d,prompt:a.prompt})},validateAuthorizationCode:async({code:b,redirectURI:c})=>j$({code:b,redirectURI:c,options:a,tokenEndpoint:"https://github.com/login/oauth/access_token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://github.com/login/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e}=await jj("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});!c.email&&e&&(c.email=(e.find(a=>a.primary)??e[0])?.email);let f=e?.find(a=>a.email===c.email)?.verified??!1,g=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name||c.login,email:c.email,image:c.avatar_url,emailVerified:f,...g},data:c}},options:a}),microsoft:a=>{let b=a.tenantId||"common",c=a.authority||"https://login.microsoftonline.com",d=`${c}/${b}/oauth2/v2.0/authorize`,e=`${c}/${b}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),jZ({id:"microsoft",options:a,authorizationEndpoint:d,state:b.state,codeVerifier:b.codeVerifier,scopes:c,redirectURI:b.redirectURI,prompt:a.prompt,loginHint:b.loginHint})},validateAuthorizationCode:({code:b,codeVerifier:c,redirectURI:d})=>j$({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:e}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=jp(b.idToken),d=a.profilePhotoSize||48;await jj(`https://graph.microsoft.com/v1.0/me/photos/${d}x${d}/$value`,{headers:{Authorization:`Bearer ${b.accessToken}`},async onResponse(b){if(!a.disableProfilePhoto&&b.response.ok)try{let a=b.response.clone(),d=await a.arrayBuffer(),e=ge.encode(d);c.picture=`data:image/jpeg;base64, ${e}`}catch(a){gq.error(a&&"object"==typeof a&&"name"in a?a.name:"",a)}}});let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:!0,...e},data:c}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),j_({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},extraParams:{scope:c.join(" ")},tokenEndpoint:e})},options:a}},google:a=>({id:"google",name:"Google",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f,display:g}){if(!a.clientId||!a.clientSecret)throw gq.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new f0("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new f0("codeVerifier is required for Google");let h=a.disableDefaultScope?[]:["email","profile","openid"];return a.scope&&h.push(...a.scope),c&&h.push(...c),await jZ({id:"google",options:a,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:h,state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt,accessType:a.accessType,display:g||a.display,loginHint:f,hd:a.hd,additionalParams:{include_granted_scopes:"true"}})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>j$({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://www.googleapis.com/oauth2/v4/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let d=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${b}`,{data:e}=await jj(d);return!!e&&e.aud===a.clientId&&("https://accounts.google.com"===e.iss||"accounts.google.com"===e.iss)},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=jp(b.idToken),d=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...d},data:c}},options:a}),huggingface:a=>({id:"huggingface",name:"Hugging Face",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),jZ({id:"huggingface",options:a,authorizationEndpoint:"https://huggingface.co/oauth/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>j$({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://huggingface.co/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://huggingface.co/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://huggingface.co/oauth/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.preferred_username,email:c.email,image:c.picture,emailVerified:c.email_verified??!1,...e},data:c}},options:a}),slack:a=>({id:"slack",name:"Slack",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=new URL("https://slack.com/openid/connect/authorize");return f.searchParams.set("scope",e.join(" ")),f.searchParams.set("response_type","code"),f.searchParams.set("client_id",a.clientId),f.searchParams.set("redirect_uri",a.redirectURI||d),f.searchParams.set("state",b),f},validateAuthorizationCode:async({code:b,redirectURI:c})=>j$({code:b,redirectURI:c,options:a,tokenEndpoint:"https://slack.com/api/openid.connect.token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://slack.com/api/openid.connect.token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://slack.com/api/openid.connect.userInfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c["https://slack.com/user_id"],name:c.name||"",email:c.email,emailVerified:c.email_verified,image:c.picture||c["https://slack.com/user_image_512"],...e},data:c}},options:a}),spotify:a=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["user-read-email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),jZ({id:"spotify",options:a,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>j$({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,email:c.email,image:c.images[0]?.url,emailVerified:!1,...e},data:c}},options:a}),twitch:a=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user:read:email","openid"];return a.scope&&e.push(...a.scope),c&&e.push(...c),jZ({id:"twitch",redirectURI:d,options:a,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:e,state:b,claims:a.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:b,redirectURI:c})=>j$({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=b.idToken;if(!c)return gq.error("No idToken found in token"),null;let d=jp(c),e=await a.mapProfileToUser?.(d);return{user:{id:d.sub,name:d.preferred_username,email:d.email,image:d.picture,emailVerified:d.email_verified,...e},data:d}},options:a}),twitter:a=>({id:"twitter",name:"Twitter",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),jZ({id:"twitter",options:a,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:c,state:b.state,codeVerifier:b.codeVerifier,redirectURI:b.redirectURI})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>j$({code:b,codeVerifier:c,authentication:"basic",redirectURI:d,options:a,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},authentication:"basic",tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e,error:f}=await jj("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}}),g=!1;!f&&e?.data?.confirmed_email&&(c.data.email=e.data.confirmed_email,g=!0);let h=await a.mapProfileToUser?.(c);return{user:{id:c.data.id,name:c.data.name,email:c.data.email||c.data.username||null,image:c.data.profile_image_url,emailVerified:g,...h},data:c}},options:a}),dropbox:a=>({id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:b,scopes:c,codeVerifier:d,redirectURI:e})=>{let f=a.disableDefaultScope?[]:["account_info.read"];a.scope&&f.push(...a.scope),c&&f.push(...c);let g={};return a.accessType&&(g.token_access_type=a.accessType),await jZ({id:"dropbox",options:a,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d,additionalParams:g})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>await j$({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.dropboxapi.com/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name?.display_name,email:c.email,emailVerified:c.email_verified||!1,image:c.profile_photo_url,...e},data:c}},options:a}),kick:a=>({id:"kick",name:"Kick",createAuthorizationURL({state:b,scopes:c,redirectURI:d,codeVerifier:e}){let f=a.disableDefaultScope?[]:["user:read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),jZ({id:"kick",redirectURI:d,options:a,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:f,codeVerifier:e,state:b})},validateAuthorizationCode:async({code:b,redirectURI:c,codeVerifier:d})=>j$({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=c.data[0],f=await a.mapProfileToUser?.(e);return{user:{id:e.user_id,name:e.name,email:e.email,image:e.profile_picture,emailVerified:!0,...f},data:e}},options:a}),linear:a=>{let b="https://api.linear.app/oauth/token";return{id:"linear",name:"Linear",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),jZ({id:"linear",options:a,authorizationEndpoint:"https://linear.app/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>j$({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>j_({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://api.linear.app/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.accessToken}`},body:JSON.stringify({query:`
							query {
								viewer {
									id
									name
									email
									avatarUrl
									active
									createdAt
									updatedAt
								}
							}
						`})});if(d||!c?.data?.viewer)return null;let e=c.data.viewer,f=await a.mapProfileToUser?.(e);return{user:{id:c.data.viewer.id,name:c.data.viewer.name,email:c.data.viewer.email,image:c.data.viewer.avatarUrl,emailVerified:!0,...f},data:e}},options:a}},linkedin:a=>{let b="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:b,scopes:c,redirectURI:d,loginHint:e})=>{let f=a.disableDefaultScope?[]:["profile","email","openid"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await jZ({id:"linkedin",options:a,authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",scopes:f,state:b,loginHint:e,redirectURI:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>await j$({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>j_({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,emailVerified:c.email_verified||!1,image:c.picture,...e},data:c}},options:a}},gitlab:a=>{let{authorizationEndpoint:b,tokenEndpoint:c,userinfoEndpoint:d}=(a=>{let b=a||"https://gitlab.com";return{authorizationEndpoint:j2(`${b}/oauth/authorize`),tokenEndpoint:j2(`${b}/oauth/token`),userinfoEndpoint:j2(`${b}/api/v4/user`)}})(a.issuer),e="gitlab";return{id:e,name:"Gitlab",createAuthorizationURL:async({state:c,scopes:d,codeVerifier:f,loginHint:g,redirectURI:h})=>{let i=a.disableDefaultScope?[]:["read_user"];return a.scope&&i.push(...a.scope),d&&i.push(...d),await jZ({id:e,options:a,authorizationEndpoint:b,scopes:i,state:c,redirectURI:h,codeVerifier:f,loginHint:g})},validateAuthorizationCode:async({code:b,redirectURI:d,codeVerifier:e})=>j$({code:b,redirectURI:d,options:a,codeVerifier:e,tokenEndpoint:c}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://gitlab.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:e}=await jj(d,{headers:{authorization:`Bearer ${b.accessToken}`}});if(e||"active"!==c.state||c.locked)return null;let f=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name??c.username,email:c.email,image:c.avatar_url,emailVerified:!0,...f},data:c}},options:a}},tiktok:a=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user.info.profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${e.join(",")}&response_type=code&client_key=${a.clientKey}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>j$({code:b,redirectURI:a.redirectURI||c,options:{clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/",authentication:"post",extraParams:{client_key:a.clientKey}}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://open.tiktokapis.com/v2/user/info/?fields=open_id,avatar_large_url,display_name,username",{headers:{authorization:`Bearer ${b.accessToken}`}});return d?null:{user:{email:c.data.user.email||c.data.user.username,id:c.data.user.open_id,name:c.data.user.display_name||c.data.user.username,image:c.data.user.avatar_large_url,emailVerified:!!c.data.user.email},data:c}},options:a}),reddit:a=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identity"];return a.scope&&e.push(...a.scope),c&&e.push(...c),jZ({id:"reddit",options:a,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:e,state:b,redirectURI:d,duration:a.duration})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let d=new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:a.redirectURI||c}),e={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${ge.encode(`${a.clientId}:${a.clientSecret}`)}`},{data:f,error:g}=await jj("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:e,body:d.toString()});if(g)throw g;return jW(f)},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},authentication:"basic",tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name,email:c.oauth_client_id,emailVerified:c.has_verified_email,image:c.icon_img?.split("?")[0],...e},data:c}},options:a}),roblox:a=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"select_account consent"}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>j$({code:b,redirectURI:a.redirectURI||c,options:a,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.nickname||c.preferred_username||"",image:c.picture,email:c.preferred_username||null,emailVerified:!0,...e},data:{...c}}},options:a}),salesforce:a=>{let b="sandbox"===(a.environment??"production"),c=a.loginUrl?`https://${a.loginUrl}/services/oauth2/authorize`:b?"https://test.salesforce.com/services/oauth2/authorize":"https://login.salesforce.com/services/oauth2/authorize",d=a.loginUrl?`https://${a.loginUrl}/services/oauth2/token`:b?"https://test.salesforce.com/services/oauth2/token":"https://login.salesforce.com/services/oauth2/token",e=a.loginUrl?`https://${a.loginUrl}/services/oauth2/userinfo`:b?"https://test.salesforce.com/services/oauth2/userinfo":"https://login.salesforce.com/services/oauth2/userinfo";return{id:"salesforce",name:"Salesforce",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f}){if(!a.clientId||!a.clientSecret)throw gq.error("Client Id and Client Secret are required for Salesforce. Make sure to provide them in the options."),new f0("CLIENT_ID_AND_SECRET_REQUIRED");if(!e)throw new f0("codeVerifier is required for Salesforce");let g=a.disableDefaultScope?[]:["openid","email","profile"];return a.scope&&g.push(...a.scope),d&&g.push(...d),jZ({id:"salesforce",options:a,authorizationEndpoint:c,scopes:g,state:b,codeVerifier:e,redirectURI:a.redirectURI||f})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>j$({code:b,codeVerifier:c,redirectURI:a.redirectURI||e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);try{let{data:c}=await jj(e,{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return gq.error("Failed to fetch user info from Salesforce"),null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.user_id,name:c.name,email:c.email,image:c.photos?.picture||c.photos?.thumbnail,emailVerified:c.email_verified??!1,...d},data:c}}catch(a){return gq.error("Failed to fetch user info from Salesforce:",a),null}},options:a}},vk:a=>({id:"vk",name:"VK",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["email","phone"];return a.scope&&f.push(...a.scope),c&&f.push(...c),jZ({id:"vk",options:a,authorizationEndpoint:"https://id.vk.com/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d,deviceId:e})=>j$({code:b,codeVerifier:c,redirectURI:a.redirectURI||d,options:a,deviceId:e,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;let c=new URLSearchParams({access_token:b.accessToken,client_id:a.clientId}).toString(),{data:d,error:e}=await jj("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c});if(e||!d.user.email)return null;let f=await a.mapProfileToUser?.(d);return{user:{id:d.user.user_id,first_name:d.user.first_name,last_name:d.user.last_name,email:d.user.email,image:d.user.avatar,emailVerified:!!d.user.email,birthday:d.user.birthday,sex:d.user.sex,name:`${d.user.first_name} ${d.user.last_name}`,...f},data:d}},options:a}),zoom:a=>{let b={pkce:!0,...a};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:a,redirectURI:c,codeVerifier:d})=>{let e=new URLSearchParams({response_type:"code",redirect_uri:b.redirectURI?b.redirectURI:c,client_id:b.clientId,state:a});if(b.pkce){let a=await jV(d);e.set("code_challenge_method","S256"),e.set("code_challenge",a)}let f=new URL("https://zoom.us/oauth/authorize");return f.search=e.toString(),f},validateAuthorizationCode:async({code:a,redirectURI:c,codeVerifier:d})=>j$({code:a,redirectURI:b.redirectURI||c,codeVerifier:d,options:b,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),async getUserInfo(a){if(b.getUserInfo)return b.getUserInfo(a);let{data:c,error:d}=await jj("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${a.accessToken}`}});if(d)return null;let e=await b.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,image:c.pic_url,email:c.email,emailVerified:!!c.verified,...e},data:{...c}}}}},notion:a=>{let b="https://api.notion.com/v1/oauth/token";return{id:"notion",name:"Notion",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=(a.disableDefaultScope,[]);return a.scope&&f.push(...a.scope),c&&f.push(...c),jZ({id:"notion",options:a,authorizationEndpoint:"https://api.notion.com/v1/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d,additionalParams:{owner:"user"}})},validateAuthorizationCode:async({code:c,redirectURI:d})=>j$({code:c,redirectURI:d,options:a,tokenEndpoint:b,authentication:"basic"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>j_({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://api.notion.com/v1/users/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"Notion-Version":"2022-06-28"}});if(d||!c)return null;let e=c.bot?.owner?.user;if(!e)return null;let f=await a.mapProfileToUser?.(e);return{user:{id:e.id,name:e.name||"Notion User",email:e.person?.email||null,image:e.avatar_url,emailVerified:!!e.person?.email,...f},data:e}},options:a}},kakao:a=>({id:"kakao",name:"Kakao",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["account_email","profile_image","profile_nickname"];return a.scope&&e.push(...a.scope),c&&e.push(...c),jZ({id:"kakao",options:a,authorizationEndpoint:"https://kauth.kakao.com/oauth/authorize",scopes:e,state:b,redirectURI:d})},validateAuthorizationCode:async({code:b,redirectURI:c})=>j$({code:b,redirectURI:c,options:a,tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://kapi.kakao.com/v2/user/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c)return null;let e=await a.mapProfileToUser?.(c),f=c.kakao_account||{},g=f.profile||{};return{user:{id:String(c.id),name:g.nickname||f.name||void 0,email:f.email,image:g.profile_image_url||g.thumbnail_image_url,emailVerified:!!f.is_email_valid&&!!f.is_email_verified,...e},data:c}},options:a}),naver:a=>({id:"naver",name:"Naver",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["profile","email"];return a.scope&&e.push(...a.scope),c&&e.push(...c),jZ({id:"naver",options:a,authorizationEndpoint:"https://nid.naver.com/oauth2.0/authorize",scopes:e,state:b,redirectURI:d})},validateAuthorizationCode:async({code:b,redirectURI:c})=>j$({code:b,redirectURI:c,options:a,tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>j_({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await jj("https://openapi.naver.com/v1/nid/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c||"00"!==c.resultcode)return null;let e=await a.mapProfileToUser?.(c),f=c.response||{};return{user:{id:f.id,name:f.name||f.nickname,email:f.email,image:f.profile_image,emailVerified:!1,...e},data:c}},options:a}),line:a=>{let b="https://api.line.me/oauth2/v2.1/token";return{id:"line",name:"LINE",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f}){let g=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&g.push(...a.scope),c&&g.push(...c),await jZ({id:"line",options:a,authorizationEndpoint:"https://access.line.me/oauth2/v2.1/authorize",scopes:g,state:b,codeVerifier:d,redirectURI:e,loginHint:f})},validateAuthorizationCode:async({code:c,codeVerifier:d,redirectURI:e})=>j$({code:c,codeVerifier:d,redirectURI:e,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>j_({refreshToken:c,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:b}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let d=new URLSearchParams;d.set("id_token",b),d.set("client_id",a.clientId),c&&d.set("nonce",c);let{data:e,error:f}=await jj("https://api.line.me/oauth2/v2.1/verify",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:d});return!f&&!!e&&e.aud===a.clientId&&(!c||!e.nonce||e.nonce===c)},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=null;if(b.idToken)try{c=jp(b.idToken)}catch{}if(!c){let{data:a}=await jj("https://api.line.me/oauth2/v2.1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});c=a||null}if(!c)return null;let d=await a.mapProfileToUser?.(c),e=c.sub||c.userId,f=c.name||c.displayName,g=c.picture||c.pictureUrl||void 0;return{user:{id:e,name:f,email:c.email,image:g,emailVerified:!1,...d},data:c}},options:a}},paypal:a=>{let b="sandbox"===(a.environment||"sandbox"),c=b?"https://www.sandbox.paypal.com/signin/authorize":"https://www.paypal.com/signin/authorize",d=b?"https://api-m.sandbox.paypal.com/v1/oauth2/token":"https://api-m.paypal.com/v1/oauth2/token",e=b?"https://api-m.sandbox.paypal.com/v1/identity/oauth2/userinfo":"https://api-m.paypal.com/v1/identity/oauth2/userinfo";return{id:"paypal",name:"PayPal",async createAuthorizationURL({state:b,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw gq.error("Client Id and Client Secret is required for PayPal. Make sure to provide them in the options."),new f0("CLIENT_ID_AND_SECRET_REQUIRED");return await jZ({id:"paypal",options:a,authorizationEndpoint:c,scopes:[],state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let e=ge.encode(`${a.clientId}:${a.clientSecret}`);try{let a=await jj(d,{method:"POST",headers:{Authorization:`Basic ${e}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:c}).toString()});if(!a.data)throw new f0("FAILED_TO_GET_ACCESS_TOKEN");let f=a.data;return{accessToken:f.access_token,refreshToken:f.refresh_token,accessTokenExpiresAt:f.expires_in?new Date(Date.now()+1e3*f.expires_in):void 0,idToken:f.id_token}}catch(a){throw gq.error("PayPal token exchange failed:",a),new f0("FAILED_TO_GET_ACCESS_TOKEN")}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=ge.encode(`${a.clientId}:${a.clientSecret}`);try{let a=await jj(d,{method:"POST",headers:{Authorization:`Basic ${c}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:b}).toString()});if(!a.data)throw new f0("FAILED_TO_REFRESH_ACCESS_TOKEN");let e=a.data;return{accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?new Date(Date.now()+1e3*e.expires_in):void 0}}catch(a){throw gq.error("PayPal token refresh failed:",a),new f0("FAILED_TO_REFRESH_ACCESS_TOKEN")}},async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{return!!jp(b).sub}catch(a){return gq.error("Failed to verify PayPal ID token:",a),!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return gq.error("Access token is required to fetch PayPal user info"),null;try{let c=await jj(`${e}?schema=paypalv1.1`,{headers:{Authorization:`Bearer ${b.accessToken}`,Accept:"application/json"}});if(!c.data)return gq.error("Failed to fetch user info from PayPal"),null;let d=c.data,f=await a.mapProfileToUser?.(d);return{user:{id:d.user_id,name:d.name,email:d.email,image:d.picture,emailVerified:d.email_verified,...f},data:d}}catch(a){return gq.error("Failed to fetch user info from PayPal:",a),null}},options:a}}},j4=fK(Object.keys(j3)).or(e2()),j5=gG("/sign-in/social",{method:"POST",body:fD({callbackURL:e2().meta({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:e2().optional(),errorCallbackURL:e2().meta({description:"Callback URL to redirect to if an error happens"}).optional(),provider:j4,disableRedirect:fs().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:fN(fD({token:e2().meta({description:"ID token from the provider"}),nonce:e2().meta({description:"Nonce used to generate the token"}).optional(),accessToken:e2().meta({description:"Access token from the provider"}).optional(),refreshToken:e2().meta({description:"Refresh token from the provider"}).optional(),expiresAt:fo().meta({description:"Expiry date of the token"}).optional()})),scopes:fB(e2()).meta({description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:fs().meta({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:e2().meta({description:"The login hint to use for the authorization code request"}).optional()}),metadata:{openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token",url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}}},required:["redirect","token","user"]}}}}}}}},async a=>{let b=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!b)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new I("NOT_FOUND",{message:gH.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!b.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new I("NOT_FOUND",{message:gH.ID_TOKEN_NOT_SUPPORTED});let{token:c,nonce:d}=a.body.idToken;if(!await b.verifyIdToken(c,d))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new I("UNAUTHORIZED",{message:gH.INVALID_TOKEN});let e=await b.getUserInfo({idToken:c,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!e||!e?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new I("UNAUTHORIZED",{message:gH.FAILED_TO_GET_USER_INFO});if(!e.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new I("UNAUTHORIZED",{message:gH.USER_EMAIL_NOT_FOUND});let f=await jY(a,{userInfo:{...e.user,email:e.user.email,id:String(e.user.id),name:e.user.name||"",image:e.user.image,emailVerified:e.user.emailVerified||!1},account:{providerId:b.id,accountId:String(e.user.id),accessToken:a.body.idToken.accessToken},callbackURL:a.body.callbackURL,disableSignUp:b.disableImplicitSignUp&&!a.body.requestSignUp||b.disableSignUp});if(f.error)throw new I("UNAUTHORIZED",{message:f.error});return await gC(a,f.data),a.json({redirect:!1,token:f.data.session.token,url:void 0,user:{id:f.data.user.id,email:f.data.user.email,name:f.data.user.name,image:f.data.user.image,emailVerified:f.data.user.emailVerified,createdAt:f.data.user.createdAt,updatedAt:f.data.user.updatedAt}})}let{codeVerifier:c,state:d}=await jT(a),e=await b.createAuthorizationURL({state:d,codeVerifier:c,redirectURI:`${a.context.baseURL}/callback/${b.id}`,scopes:a.body.scopes,loginHint:a.body.loginHint});return a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),j6=gG("/sign-in/email",{method:"POST",body:fD({email:e2().meta({description:"Email of the user"}),password:e2().meta({description:"Password of the user"}),callbackURL:e2().meta({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:fs().meta({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{openapi:{description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}},required:["redirect","token","user"]}}}}}}}},async a=>{if(!a.context.options?.emailAndPassword?.enabled)throw a.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new I("BAD_REQUEST",{message:"Email and password is not enabled"});let{email:b,password:c}=a.body;if(!e2().email().safeParse(b).success)throw new I("BAD_REQUEST",{message:gH.INVALID_EMAIL});let d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)throw await a.context.password.hash(c),a.context.logger.error("User not found",{email:b}),new I("UNAUTHORIZED",{message:gH.INVALID_EMAIL_OR_PASSWORD});let e=d.accounts.find(a=>"credential"===a.providerId);if(!e)throw a.context.logger.error("Credential account not found",{email:b}),new I("UNAUTHORIZED",{message:gH.INVALID_EMAIL_OR_PASSWORD});let f=e?.password;if(!f)throw a.context.logger.error("Password not found",{email:b}),new I("UNAUTHORIZED",{message:gH.INVALID_EMAIL_OR_PASSWORD});if(!await a.context.password.verify({hash:f,password:c}))throw a.context.logger.error("Invalid password"),new I("UNAUTHORIZED",{message:gH.INVALID_EMAIL_OR_PASSWORD});if(a.context.options?.emailAndPassword?.requireEmailVerification&&!d.user.emailVerified){if(!a.context.options?.emailVerification?.sendVerificationEmail)throw new I("FORBIDDEN",{message:gH.EMAIL_NOT_VERIFIED});if(a.context.options?.emailVerification?.sendOnSignIn){let b=await jO(a.context.secret,d.user.email,void 0,a.context.options.emailVerification?.expiresIn),c=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:d.user,url:c,token:b},a.request)}throw new I("FORBIDDEN",{message:gH.EMAIL_NOT_VERIFIED})}let g=await a.context.internalAdapter.createSession(d.user.id,a,!1===a.body.rememberMe);if(!g)throw a.context.logger.error("Failed to create session"),new I("UNAUTHORIZED",{message:gH.FAILED_TO_CREATE_SESSION});return await gC(a,{session:g,user:d.user},!1===a.body.rememberMe),a.json({redirect:!!a.body.callbackURL,token:g.token,url:a.body.callbackURL,user:{id:d.user.id,email:d.user.email,name:d.user.name,image:d.user.image,emailVerified:d.user.emailVerified,createdAt:d.user.createdAt,updatedAt:d.user.updatedAt}})}),j7=fD({code:e2().optional(),error:e2().optional(),device_id:e2().optional(),error_description:e2().optional(),state:e2().optional(),user:e2().optional()}),j8=gG("/callback/:id",{method:["GET","POST"],body:j7.optional(),query:j7.optional(),metadata:jS},async a=>{let b,c,d,e=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;try{if("GET"===a.method)b=j7.parse(a.query);else if("POST"===a.method)b=j7.parse(a.body);else throw Error("Unsupported method")}catch(b){throw a.context.logger.error("INVALID_CALLBACK_REQUEST",b),a.redirect(`${e}?error=invalid_callback_request`)}let{code:f,error:g,state:h,error_description:i,device_id:j}=b;if(!h){a.context.logger.error("State not found",g);let b=e.includes("?")?"&":"?",c=`${e}${b}state=state_not_found`;throw a.redirect(c)}let{codeVerifier:k,callbackURL:l,link:m,errorURL:n,newUserURL:o,requestSignUp:p}=await jU(a);function q(b,c){let d=n??e,f=new URLSearchParams({error:b});c&&f.set("error_description",c);let g=d.includes("?")?"&":"?",h=`${d}${g}${f.toString()}`;throw a.redirect(h)}if(g&&q(g,i),!f)throw a.context.logger.error("Code not found"),q("no_code");let r=a.context.socialProviders.find(b=>b.id===a.params.id);if(!r)throw a.context.logger.error("Oauth provider with id",a.params.id,"not found"),q("oauth_provider_not_found");try{c=await r.validateAuthorizationCode({code:f,codeVerifier:k,deviceId:j,redirectURI:`${a.context.baseURL}/callback/${r.id}`})}catch(b){throw a.context.logger.error("",b),q("invalid_code")}let s=await r.getUserInfo({...c,user:a.body?.user?gr(a.body.user):void 0}).then(a=>a?.user);if(!s)return a.context.logger.error("Unable to get user info"),q("unable_to_get_user_info");if(!l)throw a.context.logger.error("No callback URL found"),q("no_callback_url");if(m){let b,d=a.context.options.account?.accountLinking?.trustedProviders;if(!d?.includes(r.id)&&!s.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return a.context.logger.error("Unable to link account - untrusted provider"),q("unable_to_link_account");if(s.email!==m.email&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)return q("email_doesn't_match");let e=await a.context.internalAdapter.findAccount(String(s.id));if(e){if(e.userId.toString()!==m.userId.toString())return q("account_already_linked_to_different_user");let b=Object.fromEntries(Object.entries({accessToken:await jX(c.accessToken,a.context),refreshToken:await jX(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scopes?.join(",")}).filter(([a,b])=>void 0!==b));await a.context.internalAdapter.updateAccount(e.id,b)}else if(!await a.context.internalAdapter.createAccount({userId:m.userId,providerId:r.id,accountId:String(s.id),...c,accessToken:await jX(c.accessToken,a.context),refreshToken:await jX(c.refreshToken,a.context),scope:c.scopes?.join(",")},a))return q("unable_to_link_account");try{b=l.toString()}catch{b=l}throw a.redirect(b)}if(!s.email)return a.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),q("email_not_found");let t=await jY(a,{userInfo:{...s,id:String(s.id),email:s.email,name:s.name||s.email},account:{providerId:r.id,accountId:String(s.id),...c,scope:c.scopes?.join(",")},callbackURL:l,disableSignUp:r.disableImplicitSignUp&&!p||r.options?.disableSignUp,overrideUserInfo:r.options?.overrideUserInfoOnSignIn});if(t.error)return a.context.logger.error(t.error.split(" ").join("_")),q(t.error.split(" ").join("_"));let{session:u,user:v}=t.data;await gC(a,{session:u,user:v});try{d=(t.isRegister&&o||l).toString()}catch{d=t.isRegister&&o||l}throw a.redirect(d)}),j9=gG("/sign-out",{method:"POST",requireHeaders:!0,metadata:{openapi:{description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async a=>{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(!b)throw gD(a),new I("BAD_REQUEST",{message:gH.FAILED_TO_GET_SESSION});return await a.context.internalAdapter.deleteSession(b),gD(a),a.json({success:!0})});function ka(a,b,c){let d=b?new URL(b,a.baseURL):new URL(`${a.baseURL}/error`);return c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href}let kb=gG("/request-password-reset",{method:"POST",body:fD({email:ey(e4,void 0).meta({description:"The email address of the user to send a password reset email to"}),redirectTo:e2().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.emailAndPassword?.sendResetPassword)throw a.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new I("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:b,redirectTo:c}=a.body,d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)return a.context.logger.error("Reset Password: User not found",{email:b}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let e=f_(a.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),f=jz(24);await a.context.internalAdapter.createVerificationValue({value:d.user.id,identifier:`reset-password:${f}`,expiresAt:e},a);let g=c?encodeURIComponent(c):"",h=`${a.context.baseURL}/reset-password/${f}?callbackURL=${g}`;return await a.context.options.emailAndPassword.sendResetPassword({user:d.user,url:h,token:f},a.request),a.json({status:!0})}),kc=gG("/forget-password",{method:"POST",body:fD({email:e2().email().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:e2().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.emailAndPassword?.sendResetPassword)throw a.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new I("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:b,redirectTo:c}=a.body,d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)return a.context.logger.error("Reset Password: User not found",{email:b}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let e=f_(a.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),f=jz(24);await a.context.internalAdapter.createVerificationValue({value:d.user.id,identifier:`reset-password:${f}`,expiresAt:e},a);let g=c?encodeURIComponent(c):"",h=`${a.context.baseURL}/reset-password/${f}?callbackURL=${g}`;return await a.context.options.emailAndPassword.sendResetPassword({user:d.user,url:h,token:f},a.request),a.json({status:!0})}),kd=gG("/reset-password/:token",{method:"GET",query:fD({callbackURL:e2().meta({description:"The URL to redirect the user to reset their password"})}),use:[jN(a=>a.query.callbackURL)],metadata:{openapi:{description:"Redirects the user to the callback URL with the token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async a=>{let{token:b}=a.params,{callbackURL:c}=a.query;if(!b||!c)throw a.redirect(ka(a.context,c,{error:"INVALID_TOKEN"}));let d=await a.context.internalAdapter.findVerificationValue(`reset-password:${b}`);if(!d||d.expiresAt<new Date)throw a.redirect(ka(a.context,c,{error:"INVALID_TOKEN"}));throw a.redirect(function(a,b,c){let d=new URL(b,a.baseURL);return c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href}(a.context,c,{token:b}))}),ke=gG("/reset-password",{method:"POST",query:fD({token:e2().optional()}).optional(),body:fD({newPassword:e2().meta({description:"The new password to set"}),token:e2().meta({description:"The token to reset the password"}).optional()}),metadata:{openapi:{description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let b=a.body.token||a.query?.token;if(!b)throw new I("BAD_REQUEST",{message:gH.INVALID_TOKEN});let{newPassword:c}=a.body,d=a.context.password?.config.minPasswordLength,e=a.context.password?.config.maxPasswordLength;if(c.length<d)throw new I("BAD_REQUEST",{message:gH.PASSWORD_TOO_SHORT});if(c.length>e)throw new I("BAD_REQUEST",{message:gH.PASSWORD_TOO_LONG});let f=`reset-password:${b}`,g=await a.context.internalAdapter.findVerificationValue(f);if(!g||g.expiresAt<new Date)throw new I("BAD_REQUEST",{message:gH.INVALID_TOKEN});let h=g.value,i=await a.context.password.hash(c);if((await a.context.internalAdapter.findAccounts(h)).find(a=>"credential"===a.providerId)?await a.context.internalAdapter.updatePassword(h,i,a):await a.context.internalAdapter.createAccount({userId:h,providerId:"credential",password:i,accountId:h},a),await a.context.internalAdapter.deleteVerificationValue(g.id),a.context.options.emailAndPassword?.onPasswordReset){let b=await a.context.internalAdapter.findUserById(h);b&&await a.context.options.emailAndPassword.onPasswordReset({user:b},a.request)}return a.context.options.emailAndPassword?.revokeSessionsOnPasswordReset&&await a.context.internalAdapter.deleteSessions(h),a.json({status:!0})}),kf=gG("/change-password",{method:"POST",body:fD({newPassword:e2().meta({description:"The new password to set"}),currentPassword:e2().meta({description:"The current password is required"}),revokeOtherSessions:fs().meta({description:"Must be a boolean value"}).optional()}),use:[gM],metadata:{openapi:{description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async a=>{let{newPassword:b,currentPassword:c,revokeOtherSessions:d}=a.body,e=a.context.session,f=a.context.password.config.minPasswordLength;if(b.length<f)throw a.context.logger.error("Password is too short"),new I("BAD_REQUEST",{message:gH.PASSWORD_TOO_SHORT});let g=a.context.password.config.maxPasswordLength;if(b.length>g)throw a.context.logger.error("Password is too long"),new I("BAD_REQUEST",{message:gH.PASSWORD_TOO_LONG});let h=(await a.context.internalAdapter.findAccounts(e.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!h||!h.password)throw new I("BAD_REQUEST",{message:gH.CREDENTIAL_ACCOUNT_NOT_FOUND});let i=await a.context.password.hash(b);if(!await a.context.password.verify({hash:h.password,password:c}))throw new I("BAD_REQUEST",{message:gH.INVALID_PASSWORD});await a.context.internalAdapter.updateAccount(h.id,{password:i});let j=null;if(d){await a.context.internalAdapter.deleteSessions(e.user.id);let b=await a.context.internalAdapter.createSession(e.user.id,a);if(!b)throw new I("INTERNAL_SERVER_ERROR",{message:gH.FAILED_TO_GET_SESSION});await gC(a,{session:b,user:e.user}),j=b.token}return a.json({token:j,user:{id:e.user.id,email:e.user.email,name:e.user.name,image:e.user.image,emailVerified:e.user.emailVerified,createdAt:e.user.createdAt,updatedAt:e.user.updatedAt}})}),kg=gG("/set-password",{method:"POST",body:fD({newPassword:e2().meta({description:"The new password to set is required"})}),metadata:{SERVER_ONLY:!0},use:[gM]},async a=>{let{newPassword:b}=a.body,c=a.context.session,d=a.context.password.config.minPasswordLength;if(b.length<d)throw a.context.logger.error("Password is too short"),new I("BAD_REQUEST",{message:gH.PASSWORD_TOO_SHORT});let e=a.context.password.config.maxPasswordLength;if(b.length>e)throw a.context.logger.error("Password is too long"),new I("BAD_REQUEST",{message:gH.PASSWORD_TOO_LONG});let f=(await a.context.internalAdapter.findAccounts(c.user.id)).find(a=>"credential"===a.providerId&&a.password),g=await a.context.password.hash(b);if(!f)return await a.context.internalAdapter.linkAccount({userId:c.user.id,providerId:"credential",accountId:c.user.id,password:g},a),a.json({status:!0});throw new I("BAD_REQUEST",{message:"user already has a password"})}),kh=gG("/delete-user",{method:"POST",use:[gM],body:fD({callbackURL:e2().meta({description:"The callback URL to redirect to after the user is deleted"}).optional(),password:e2().meta({description:"The password of the user is required to delete the user"}).optional(),token:e2().meta({description:"The token to delete the user is required"}).optional()}),metadata:{openapi:{description:"Delete the user",responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options",{session:a.context.session}),new I("NOT_FOUND");let b=a.context.session;if(a.body.password){let c=(await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!c||!c.password)throw new I("BAD_REQUEST",{message:gH.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await a.context.password.verify({hash:c.password,password:a.body.password}))throw new I("BAD_REQUEST",{message:gH.INVALID_PASSWORD})}if(a.body.token)return await ki({...a,query:{token:a.body.token}}),a.json({success:!0,message:"User deleted"});if(a.context.options.user.deleteUser?.sendDeleteAccountVerification){let c=iQ(32,"0-9","a-z");await a.context.internalAdapter.createVerificationValue({value:b.user.id,identifier:`delete-account-${c}`,expiresAt:new Date(Date.now()+1e3*(a.context.options.user.deleteUser?.deleteTokenExpiresIn||86400))},a);let d=`${a.context.baseURL}/delete-user/callback?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.options.user.deleteUser.sendDeleteAccountVerification({user:b.user,url:d,token:c},a.request),a.json({success:!0,message:"Verification email sent"})}if(!a.body.password&&0!==a.context.sessionConfig.freshAge){let c=new Date(b.session.createdAt).getTime(),d=1e3*a.context.sessionConfig.freshAge;if(Date.now()-c>1e3*d)throw new I("BAD_REQUEST",{message:gH.SESSION_EXPIRED})}let c=a.context.options.user.deleteUser?.beforeDelete;c&&await c(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),await a.context.internalAdapter.deleteAccounts(b.user.id),gD(a);let d=a.context.options.user.deleteUser?.afterDelete;return d&&await d(b.user,a.request),a.json({success:!0,message:"User deleted"})}),ki=gG("/delete-user/callback",{method:"GET",query:fD({token:e2().meta({description:"The token to verify the deletion request"}),callbackURL:e2().meta({description:"The URL to redirect to after deletion"}).optional()}),use:[jN(a=>a.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options"),new I("NOT_FOUND");let b=await gK(a);if(!b)throw new I("NOT_FOUND",{message:gH.FAILED_TO_GET_USER_INFO});let c=await a.context.internalAdapter.findVerificationValue(`delete-account-${a.query.token}`);if(!c||c.expiresAt<new Date||c.value!==b.user.id)throw new I("NOT_FOUND",{message:gH.INVALID_TOKEN});let d=a.context.options.user.deleteUser?.beforeDelete;d&&await d(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),await a.context.internalAdapter.deleteAccounts(b.user.id),await a.context.internalAdapter.deleteVerificationValue(c.id),gD(a);let e=a.context.options.user.deleteUser?.afterDelete;if(e&&await e(b.user,a.request),a.query.callbackURL)throw a.redirect(a.query.callbackURL||"/");return a.json({success:!0,message:"User deleted"})}),kj=gG("/change-email",{method:"POST",body:fD({newEmail:ey(e4,void 0).meta({description:"The new email address to set must be a valid email address"}),callbackURL:e2().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[gM],metadata:{openapi:{responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}},422:{description:"Unprocessable Entity. Email already exists",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.user?.changeEmail?.enabled)throw a.context.logger.error("Change email is disabled."),new I("BAD_REQUEST",{message:"Change email is disabled"});let b=a.body.newEmail.toLowerCase();if(b===a.context.session.user.email)throw a.context.logger.error("Email is the same"),new I("BAD_REQUEST",{message:"Email is the same"});if(await a.context.internalAdapter.findUserByEmail(b))throw a.context.logger.error("Email already exists"),new I("BAD_REQUEST",{message:"Couldn't update your email"});if(!0!==a.context.session.user.emailVerified){if(await a.context.internalAdapter.findUserByEmail(b))throw new I("UNPROCESSABLE_ENTITY",{message:gH.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});if(await a.context.internalAdapter.updateUserByEmail(a.context.session.user.email,{email:b},a),await gC(a,{session:a.context.session.session,user:{...a.context.session.user,email:b}}),a.context.options.emailVerification?.sendVerificationEmail){let c=await jO(a.context.secret,b,void 0,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:{...a.context.session.user,email:b},url:d,token:c},a.request)}return a.json({status:!0})}if(!a.context.options.user.changeEmail.sendChangeEmailVerification)throw a.context.logger.error("Verification email isn't enabled."),new I("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await jO(a.context.secret,a.context.session.user.email,b,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.options.user.changeEmail.sendChangeEmailVerification({user:a.context.session.user,newEmail:b,url:d,token:c},a.request),a.json({status:!0})}),kk=gG("/error",{method:"GET",metadata:{...jS,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async a=>new Response(((a="Unknown")=>`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Error</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #000000;
            --error-color: #dc3545;
            --border-color: #e9ecef;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.5;
        }
        .error-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 {
            color: var(--error-color);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        p {
            margin-bottom: 1.5rem;
            color: #495057;
        }
        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-block;
            font-weight: 500;
            border: 2px solid var(--accent-color);
        }
        .btn:hover {
            background-color: #131721;
        }
        .error-code {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="icon">\u26A0\uFE0F</div>
        <h1>Better Auth Error</h1>
        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>
        <a href="/" id="returnLink" class="btn">Return to Application</a>
        <div class="error-code">Error Code: <span id="errorCode">${a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}</span></div>
    </div>
</body>
</html>`)(new URL(a.request?.url||"").searchParams.get("error")||"Unknown"),{headers:{"Content-Type":"text/html"}})),kl=gG("/ok",{method:"GET",metadata:{...jS,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async a=>a.json({ok:!0})),km=gG("/list-accounts",{method:"GET",use:[gL],metadata:{openapi:{description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},providerId:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"},accountId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","providerId","createdAt","updatedAt","accountId","scopes"]}}}}}}}}},async a=>{let b=a.context.session,c=await a.context.internalAdapter.findAccounts(b.user.id);return a.json(c.map(a=>({id:a.id,providerId:a.providerId,createdAt:a.createdAt,updatedAt:a.updatedAt,accountId:a.accountId,scopes:a.scope?.split(",")||[]})))}),kn=gG("/link-social",{method:"POST",requireHeaders:!0,body:fD({callbackURL:e2().meta({description:"The URL to redirect to after the user has signed in"}).optional(),provider:j4,idToken:fD({token:e2(),nonce:e2().optional(),accessToken:e2().optional(),refreshToken:e2().optional(),scopes:fB(e2()).optional()}).optional(),requestSignUp:fs().optional(),scopes:fB(e2()).meta({description:"Additional scopes to request from the provider"}).optional(),errorCallbackURL:e2().meta({description:"The URL to redirect to if there is an error during the link process"}).optional(),disableRedirect:fs().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional()}),use:[gL],metadata:{openapi:{description:"Link a social account to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"},status:{type:"boolean"}},required:["redirect"]}}}}}}}},async a=>{let b=a.context.session,c=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!c)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new I("NOT_FOUND",{message:gH.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!c.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new I("NOT_FOUND",{message:gH.ID_TOKEN_NOT_SUPPORTED});let{token:d,nonce:e}=a.body.idToken;if(!await c.verifyIdToken(d,e))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new I("UNAUTHORIZED",{message:gH.INVALID_TOKEN});let f=await c.getUserInfo({idToken:d,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!f||!f?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new I("UNAUTHORIZED",{message:gH.FAILED_TO_GET_USER_INFO});let g=String(f.user.id);if(!f.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new I("UNAUTHORIZED",{message:gH.USER_EMAIL_NOT_FOUND});if((await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>a.providerId===c.id&&a.accountId===g))return a.json({url:"",status:!0,redirect:!1});let h=a.context.options.account?.accountLinking?.trustedProviders;if(!h?.includes(c.id)&&!f.user.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)throw new I("UNAUTHORIZED",{message:"Account not linked - linking not allowed"});if(f.user.email!==b.user.email&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)throw new I("UNAUTHORIZED",{message:"Account not linked - different emails not allowed"});try{await a.context.internalAdapter.createAccount({userId:b.user.id,providerId:c.id,accountId:g,accessToken:a.body.idToken.accessToken,idToken:d,refreshToken:a.body.idToken.refreshToken,scope:a.body.idToken.scopes?.join(",")},a)}catch(a){throw new I("EXPECTATION_FAILED",{message:"Account not linked - unable to create account"})}if(a.context.options.account?.accountLinking?.updateUserInfoOnLink===!0)try{await a.context.internalAdapter.updateUser(b.user.id,{name:f.user?.name,image:f.user?.image})}catch(a){console.warn("Could not update user - "+a.toString())}return a.json({url:"",status:!0,redirect:!1})}let d=await jT(a,{userId:b.user.id,email:b.user.email}),e=await c.createAuthorizationURL({state:d.state,codeVerifier:d.codeVerifier,redirectURI:`${a.context.baseURL}/callback/${c.id}`,scopes:a.body.scopes});return a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),ko=gG("/unlink-account",{method:"POST",body:fD({providerId:e2(),accountId:e2().optional()}),use:[gN],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let{providerId:b,accountId:c}=a.body,d=await a.context.internalAdapter.findAccounts(a.context.session.user.id);if(1===d.length&&!a.context.options.account?.accountLinking?.allowUnlinkingAll)throw new I("BAD_REQUEST",{message:gH.FAILED_TO_UNLINK_LAST_ACCOUNT});let e=d.find(a=>c?a.accountId===c&&a.providerId===b:a.providerId===b);if(!e)throw new I("BAD_REQUEST",{message:gH.ACCOUNT_NOT_FOUND});return await a.context.internalAdapter.deleteAccount(e.id),a.json({status:!0})}),kp=gG("/get-access-token",{method:"POST",body:fD({providerId:e2().meta({description:"The provider ID for the OAuth provider"}),accountId:e2().meta({description:"The account ID associated with the refresh token"}).optional(),userId:e2().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let{providerId:b,accountId:c,userId:d}=a.body,e=a.request,f=await gK(a);if(e&&!f)throw a.error("UNAUTHORIZED");let g=f?.user?.id||d;if(!g)throw new I("BAD_REQUEST",{message:"Either userId or session is required"});if(!a.context.socialProviders.find(a=>a.id===b))throw new I("BAD_REQUEST",{message:`Provider ${b} is not supported.`});let h=(await a.context.internalAdapter.findAccounts(g)).find(a=>c?a.id===c&&a.providerId===b:a.providerId===b);if(!h)throw new I("BAD_REQUEST",{message:"Account not found"});let i=a.context.socialProviders.find(a=>a.id===b);if(!i)throw new I("BAD_REQUEST",{message:`Provider ${b} not found.`});try{let b=null,c=h.accessTokenExpiresAt&&new Date(h.accessTokenExpiresAt).getTime()-Date.now()<5e3;h.refreshToken&&c&&i.refreshAccessToken&&(b=await i.refreshAccessToken(h.refreshToken),await a.context.internalAdapter.updateAccount(h.id,{accessToken:await jX(b.accessToken,a.context),accessTokenExpiresAt:b.accessTokenExpiresAt,refreshToken:await jX(b.refreshToken,a.context),refreshTokenExpiresAt:b.refreshTokenExpiresAt}));let d={accessToken:await function(a,b){return a&&b.options.account?.encryptOAuthTokens?iY({key:b.secret,data:a}):a}(b?.accessToken??h.accessToken??"",a.context),accessTokenExpiresAt:b?.accessTokenExpiresAt??h.accessTokenExpiresAt??void 0,scopes:h.scope?.split(",")??[],idToken:b?.idToken??h.idToken??void 0};return a.json(d)}catch(a){throw new I("BAD_REQUEST",{message:"Failed to get a valid access token",cause:a})}}),kq=gG("/refresh-token",{method:"POST",body:fD({providerId:e2().meta({description:"The provider ID for the OAuth provider"}),accountId:e2().meta({description:"The account ID associated with the refresh token"}).optional(),userId:e2().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let{providerId:b,accountId:c,userId:d}=a.body,e=a.request,f=await gK(a);if(e&&!f)throw a.error("UNAUTHORIZED");let g=f?.user?.id||d;if(!g)throw new I("BAD_REQUEST",{message:"Either userId or session is required"});let h=(await a.context.internalAdapter.findAccounts(g)).find(a=>c?a.id===c&&a.providerId===b:a.providerId===b);if(!h)throw new I("BAD_REQUEST",{message:"Account not found"});let i=a.context.socialProviders.find(a=>a.id===b);if(!i)throw new I("BAD_REQUEST",{message:`Provider ${b} not found.`});if(!i.refreshAccessToken)throw new I("BAD_REQUEST",{message:`Provider ${b} does not support token refreshing.`});try{let b=await i.refreshAccessToken(h.refreshToken);return await a.context.internalAdapter.updateAccount(h.id,{accessToken:await jX(b.accessToken,a.context),refreshToken:await jX(b.refreshToken,a.context),accessTokenExpiresAt:b.accessTokenExpiresAt,refreshTokenExpiresAt:b.refreshTokenExpiresAt}),a.json(b)}catch(a){throw new I("BAD_REQUEST",{message:"Failed to refresh access token",cause:a})}}),kr=gG("/account-info",{method:"POST",use:[gL],metadata:{openapi:{description:"Get the account info provided by the provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"},image:{type:"string"},emailVerified:{type:"boolean"}},required:["id","emailVerified"]},data:{type:"object",properties:{},additionalProperties:!0}},required:["user","data"],additionalProperties:!1}}}}}}},body:fD({accountId:e2().meta({description:"The provider given account id for which to get the account info"})})},async a=>{let b=await a.context.internalAdapter.findAccount(a.body.accountId);if(!b||b.userId!==a.context.session.user.id)throw new I("BAD_REQUEST",{message:"Account not found"});let c=a.context.socialProviders.find(a=>a.id===b.providerId);if(!c)throw new I("INTERNAL_SERVER_ERROR",{message:`Provider account provider is ${b.providerId} but it is not configured`});let d=await kp({...a,body:{accountId:b.id,providerId:b.providerId},returnHeaders:!1});if(!d.accessToken)throw new I("BAD_REQUEST",{message:"Access token not found"});let e=await c.getUserInfo({...d,accessToken:d.accessToken});return a.json(e)}),ks=jH((a,b,c)=>{if(Array.isArray(a[b])&&Array.isArray(c))return a[b]=c,!0});async function kt(a,b){let c={};for(let d of b)if(d.matcher(a)){let b=await d.handler({...a,returnHeaders:!1}).catch(b=>{throw b instanceof I&&gm(a.context.logger.level,"debug")&&(b.stack=b.errorStack),b});if(b&&"object"==typeof b){if("context"in b&&"object"==typeof b.context){let{headers:a,...d}=b.context;a instanceof Headers&&(c.headers?a.forEach((a,b)=>{c.headers?.set(b,a)}):c.headers=a),c=ks(d,c);continue}return b}}return{context:c}}async function ku(a,b){for(let c of b)if(c.matcher(a)){let b=await c.handler(a).catch(b=>{if(b instanceof I)return gm(a.context.logger.level,"debug")&&(b.stack=b.errorStack),{response:b,headers:b.headers?new Headers(b.headers):null};throw b});b.headers&&b.headers.forEach((b,c)=>{a.context.responseHeaders?"set-cookie"===c.toLowerCase()?a.context.responseHeaders.append(c,b):a.context.responseHeaders.set(c,b):a.context.responseHeaders=new Headers({[c]:b})}),b.response&&(a.context.returned=b.response)}return{response:a.context.returned,headers:a.context.responseHeaders}}function kv(a,b){if(b.advanced?.ipAddress?.disableIpTracking)return null;if(f7()||f6)return"127.0.0.1";let c="headers"in a?a.headers:a;for(let a of b.advanced?.ipAddress?.ipAddressHeaders||["x-forwarded-for"]){let b="get"in c?c.get(a):c[a];if("string"==typeof b){var d;let a=b.split(",")[0].trim();if(d=a,/^(\d{1,3}\.){3}\d{1,3}$/.test(d)?d.split(".").map(Number).every(a=>a>=0&&a<=255):/^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(d))return a}}return null}let kw=new Map;async function kx(a,b){if(!b.rateLimit.enabled)return;let c=new URL(a.url).pathname.replace(b.options.basePath||"/api/auth",""),d=b.rateLimit.window,e=b.rateLimit.max,f=kv(a,b.options);if(!f)return;let g=f+c,h=[{pathMatcher:a=>a.startsWith("/sign-in")||a.startsWith("/sign-up")||a.startsWith("/change-password")||a.startsWith("/change-email"),window:10,max:3}].find(a=>a.pathMatcher(c));for(let a of(h&&(d=h.window,e=h.max),b.options.plugins||[]))if(a.rateLimit){let b=a.rateLimit.find(a=>a.pathMatcher(c));if(b){d=b.window,e=b.max;break}}if(b.rateLimit.customRules){let f=Object.keys(b.rateLimit.customRules).find(a=>a.includes("*")?jL(a)(c):a===c);if(f){let c=b.rateLimit.customRules[f],g="function"==typeof c?await c(a):c;if(g&&(d=g.window,e=g.max),!1===g)return}}let i=function(a){if(a.options.rateLimit?.customStorage)return a.options.rateLimit.customStorage;if("secondary-storage"===a.rateLimit.storage)return{get:async b=>{let c=await a.options.secondaryStorage?.get(b);return c?gr(c):void 0},set:async(b,c)=>{await a.options.secondaryStorage?.set?.(b,JSON.stringify(c))}};if("memory"===a.rateLimit.storage)return{get:async a=>kw.get(a),async set(a,b,c){kw.set(a,b)}};let b="rateLimit",c=a.adapter;return{get:async a=>{let d=(await c.findMany({model:b,where:[{field:"key",value:a}]}))[0];return"bigint"==typeof d?.lastRequest&&(d.lastRequest=Number(d.lastRequest)),d},set:async(d,e,f)=>{try{f?await c.updateMany({model:b,where:[{field:"key",value:d}],update:{count:e.count,lastRequest:e.lastRequest}}):await c.create({model:b,data:{key:d,count:e.count,lastRequest:e.lastRequest}})}catch(b){a.logger.error("Error setting rate limit",b)}}}}(b),j=await i.get(g),k=Date.now();if(j){var l,m,n,o;let a=k-j.lastRequest;if(l=e,m=d,n=j,Date.now()-n.lastRequest<1e3*m&&n.count>=l){return o=Math.ceil((j.lastRequest+1e3*d-Date.now())/1e3),new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests",headers:{"X-Retry-After":o.toString()}})}a>1e3*d?await i.set(g,{...j,count:1,lastRequest:k},!0):await i.set(g,{...j,count:j.count+1,lastRequest:k},!0)}else await i.set(g,{key:g,count:1,lastRequest:k})}function ky(a,b){let c=b.plugins?.reduce((a,b)=>({...a,...b.endpoints}),{}),d=b.plugins?.map(b=>b.middlewares?.map(b=>{let c=async c=>{let d=await a;return b.middleware({...c,context:{...d,...c.context}})};return c.options=b.middleware.options,{path:b.path,middleware:c}})).filter(a=>void 0!==a).flat()||[];return{api:function(a,b){let c={};for(let[d,e]of Object.entries(a))c[d]=async a=>{let c=await b,d={...a,context:{...c,returned:void 0,responseHeaders:void 0,session:null},path:e.path,headers:a?.headers?new Headers(a?.headers):void 0},{beforeHooks:f,afterHooks:g}=function(a){let b=a.options.plugins||[],c=[],d=[];a.options.hooks?.before&&c.push({matcher:()=>!0,handler:a.options.hooks.before}),a.options.hooks?.after&&d.push({matcher:()=>!0,handler:a.options.hooks.after});let e=b.map(a=>{if(a.hooks?.before)return a.hooks.before}).filter(a=>void 0!==a).flat(),f=b.map(a=>{if(a.hooks?.after)return a.hooks.after}).filter(a=>void 0!==a).flat();return e.length&&c.push(...e),f.length&&d.push(...f),{beforeHooks:c,afterHooks:d}}(c),h=await kt(d,f);if("context"in h&&h.context&&"object"==typeof h.context){let{headers:a,...b}=h.context;a&&a.forEach((a,b)=>{d.headers.set(b,a)}),d=ks(b,d)}else if(h)return a?.asResponse?L(h,{headers:a?.headers}):a?.returnHeaders?{headers:a?.headers,response:h}:h;d.asResponse=!1,d.returnHeaders=!0;let i=await e(d).catch(a=>{if(a instanceof I)return{response:a,headers:a.headers?new Headers(a.headers):null};throw a});if(i&&i instanceof Response)return i;d.context.returned=i.response,d.context.responseHeaders=i.headers;let j=await ku(d,g);if(j.response&&(i.response=j.response),i.response instanceof I&&gm(c.logger.level,"debug")&&(i.response.stack=i.response.errorStack),i.response instanceof I&&!a?.asResponse)throw i.response;return a?.asResponse?L(i.response,{headers:i.headers}):a?.returnHeaders?{headers:i.headers,response:i.response}:i.response},c[d].path=e.path,c[d].options=e.options;return c}({...{signInSocial:j5,callbackOAuth:j8,getSession:gJ(),signOut:j9,signUpEmail:gG("/sign-up/email",{method:"POST",body:fI(e2(),fu()),metadata:{$Infer:{body:{}},openapi:{description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},image:{type:"string",description:"The profile image URL of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"},rememberMe:{type:"boolean",description:"If this is false, the session will not be remembered. Default is `true`."}},required:["name","email","password"]}}}},responses:{200:{description:"Successfully created user",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"Authentication token for the session"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}},422:{description:"Unprocessable Entity. User already exists or failed to create user.",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async a=>{let b;if(!a.context.options.emailAndPassword?.enabled||a.context.options.emailAndPassword?.disableSignUp)throw new I("BAD_REQUEST",{message:"Email and password sign up is not enabled"});let c=a.body,{name:d,email:e,password:f,image:g,callbackURL:h,rememberMe:i,...j}=c;if(!ey(e4,void 0).safeParse(e).success)throw new I("BAD_REQUEST",{message:gH.INVALID_EMAIL});let k=a.context.password.config.minPasswordLength;if(f.length<k)throw a.context.logger.error("Password is too short"),new I("BAD_REQUEST",{message:gH.PASSWORD_TOO_SHORT});let l=a.context.password.config.maxPasswordLength;if(f.length>l)throw a.context.logger.error("Password is too long"),new I("BAD_REQUEST",{message:gH.PASSWORD_TOO_LONG});let m=await a.context.internalAdapter.findUserByEmail(e);if(m?.user)throw a.context.logger.info(`Sign-up attempt for existing email: ${e}`),new I("UNPROCESSABLE_ENTITY",{message:gH.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});let n=jF(a.context.options,j),o=await a.context.password.hash(f);try{if(!(b=await a.context.internalAdapter.createUser({email:e.toLowerCase(),name:d,image:g,...n,emailVerified:!1},a)))throw new I("BAD_REQUEST",{message:gH.FAILED_TO_CREATE_USER})}catch(b){if(f6&&a.context.logger.error("Failed to create user",b),b instanceof I)throw b;throw new I("UNPROCESSABLE_ENTITY",{message:gH.FAILED_TO_CREATE_USER,details:b})}if(!b)throw new I("UNPROCESSABLE_ENTITY",{message:gH.FAILED_TO_CREATE_USER});if(await a.context.internalAdapter.linkAccount({userId:b.id,providerId:"credential",accountId:b.id,password:o},a),a.context.options.emailVerification?.sendOnSignUp||a.context.options.emailAndPassword.requireEmailVerification){let d=await jO(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),e=`${a.context.baseURL}/verify-email?token=${d}&callbackURL=${c.callbackURL||"/"}`;await a.context.options.emailVerification?.sendVerificationEmail?.({user:b,url:e,token:d},a.request)}if(!1===a.context.options.emailAndPassword.autoSignIn||a.context.options.emailAndPassword.requireEmailVerification)return a.json({token:null,user:{id:b.id,email:b.email,name:b.name,image:b.image,emailVerified:b.emailVerified,createdAt:b.createdAt,updatedAt:b.updatedAt}});let p=await a.context.internalAdapter.createSession(b.id,a,!1===i);if(!p)throw new I("BAD_REQUEST",{message:gH.FAILED_TO_CREATE_SESSION});return await gC(a,{session:p,user:b},!1===i),a.json({token:p.token,user:{id:b.id,email:b.email,name:b.name,image:b.image,emailVerified:b.emailVerified,createdAt:b.createdAt,updatedAt:b.updatedAt}})}),signInEmail:j6,forgetPassword:kc,resetPassword:ke,verifyEmail:jR,sendVerificationEmail:jQ,changeEmail:kj,changePassword:kf,setPassword:kg,updateUser:gG("/update-user",{method:"POST",body:fI(e2().meta({description:"Field name must be a string"}),fu()),use:[gL],metadata:{$Infer:{body:{}},openapi:{description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user"}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the update was successful"}}}}}}}}}},async a=>{let b=a.body;if(b.email)throw new I("BAD_REQUEST",{message:gH.EMAIL_CAN_NOT_BE_UPDATED});let{name:c,image:d,...e}=b,f=a.context.session;if(void 0===d&&void 0===c&&0===Object.keys(e).length)return a.json({status:!0});let g=jF(a.context.options,e,"update"),h=await a.context.internalAdapter.updateUser(f.user.id,{name:c,image:d,...g},a);return await gC(a,{session:f.session,user:h}),a.json({status:!0})}),deleteUser:kh,forgetPasswordCallback:kd,requestPasswordReset:kb,requestPasswordResetCallback:kd,listSessions:gG("/list-sessions",{method:"GET",use:[gL],requireHeaders:!0,metadata:{openapi:{description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}},async a=>{try{let b=(await a.context.internalAdapter.listSessions(a.context.session.user.id)).filter(a=>a.expiresAt>new Date);return a.json(b)}catch(b){throw a.context.logger.error(b),a.error("INTERNAL_SERVER_ERROR")}}),revokeSession:gO,revokeSessions:gP,revokeOtherSessions:gQ,linkSocialAccount:kn,listUserAccounts:km,deleteUserCallback:ki,unlinkAccount:ko,refreshToken:kq,getAccessToken:kp,accountInfo:kr},...c,ok:kl,error:kk},a),middlewares:d}}let kz=a=>{let b=(a.plugins??[]).reduce((a,b)=>{let c=b.schema;if(!c)return a;for(let[b,d]of Object.entries(c))a[b]={fields:{...a[b]?.fields,...d.fields},modelName:d.modelName||b};return a},{}),c=a.rateLimit?.storage==="database",d={rateLimit:{modelName:a.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:a.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:a.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",bigint:!0,fieldName:a.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:e,session:f,account:g,...h}=b,i={session:{modelName:a.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:a.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:a.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:a.session?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:a.session?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},ipAddress:{type:"string",required:!1,fieldName:a.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:a.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:a.session?.fields?.userId||"userId",references:{model:a.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...f?.fields,...a.session?.additionalFields},order:2}};return{user:{modelName:a.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:a.user?.fields?.name||"name",sortable:!0},email:{type:"string",unique:!0,required:!0,fieldName:a.user?.fields?.email||"email",sortable:!0},emailVerified:{type:"boolean",defaultValue:!1,required:!0,fieldName:a.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:a.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:a.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,onUpdate:()=>new Date,required:!0,fieldName:a.user?.fields?.updatedAt||"updatedAt"},...e?.fields,...a.user?.additionalFields},order:1},...!a.secondaryStorage||a.session?.storeSessionInDatabase?i:{},account:{modelName:a.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:a.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:a.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:a.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:a.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:a.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:a.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:a.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:a.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:a.account?.fields?.refreshTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:a.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:a.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:a.account?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:a.account?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},...g?.fields},order:3},verification:{modelName:a.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:a.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:a.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:a.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!0,defaultValue:()=>new Date,fieldName:a.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,defaultValue:()=>new Date,onUpdate:()=>new Date,fieldName:a.verification?.fields?.updatedAt||"updatedAt"}},order:4},...h,...c?d:{}}};var kA=c(18804),kB=c(81266),kC=c(31575);function kD(a,b){return kC.z.createWithChildren([kC.z.createWithSql(`${a} `),kB.O.create(b)])}var kE=c(23090),kF=c(60353),kG=c(31700);class kH{#s;#t=new kJ;#u;#v;constructor(a){this.#s=(0,kF.CN)({...a})}async init(){this.#u=(0,kF.Tn)(this.#s.database)?await this.#s.database():this.#s.database,this.#v=new kI(this.#u),this.#s.onCreateConnection&&await this.#s.onCreateConnection(this.#v)}async acquireConnection(){return await this.#t.lock(),this.#v}async beginTransaction(a){await a.executeQuery(kE.E.raw("begin"))}async commitTransaction(a){await a.executeQuery(kE.E.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(kE.E.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(kD("savepoint",b),(0,kG.a)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(kD("rollback to",b),(0,kG.a)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(kD("release",b),(0,kG.a)()))}async releaseConnection(){this.#t.unlock()}async destroy(){this.#u?.close()}}class kI{#u;constructor(a){this.#u=a}executeQuery(a){let{sql:b,parameters:c}=a,d=this.#u.prepare(b);if(d.reader)return Promise.resolve({rows:d.all(c)});let{changes:e,lastInsertRowid:f}=d.run(c);return Promise.resolve({numAffectedRows:null!=e?BigInt(e):void 0,insertId:null!=f?BigInt(f):void 0,rows:[]})}async *streamQuery(a,b){let{sql:c,parameters:d,query:e}=a,f=this.#u.prepare(c);if(kA.L.is(e))for(let a of f.iterate(d))yield{rows:[a]};else throw Error("Sqlite driver only supports streaming of select queries")}}class kJ{#w;#x;async lock(){for(;this.#w;)await this.#w;this.#w=new Promise(a=>{this.#x=a})}unlock(){let a=this.#x;this.#w=void 0,this.#x=void 0,a?.()}}var kK=c(68558);let kL=/"/g;class kM extends kK.n{visitOrAction(a){this.append("or "),this.append(a.action)}getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(a){return a.replace(kL,'""')}visitDefaultInsertValue(a){this.append("null")}}var kN=c(78329),kO=c(34220);class kP{#u;constructor(a){this.#u=a}async getSchemas(){return[]}async getTables(a={withInternalKyselyTables:!1}){return await this.#y(a)}async getMetadata(a){return{tables:await this.getTables(a)}}#z(a,b){let c=a.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select(["name","sql","type"]).orderBy("name");return b.withInternalKyselyTables||(c=c.where("name","!=",kN.kQ).where("name","!=",kN.sy)),c}async #y(a){let b=await this.#z(this.#u,a).execute(),c=await this.#u.with("table_list",b=>this.#z(b,a)).selectFrom(["table_list as tl",(0,kO.l)`pragma_table_info(tl.name)`.as("p")]).select(["tl.name as table","p.cid","p.name","p.type","p.notnull","p.dflt_value","p.pk"]).orderBy("tl.name").orderBy("p.cid").execute(),d={};for(let a of c)d[a.table]??=[],d[a.table].push(a);return b.map(({name:a,sql:b,type:c})=>{let e=b?.split(/[\(\),]/)?.find(a=>a.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),f=d[a]??[];if(!e){let a=f.filter(a=>a.pk>0);1===a.length&&"integer"===a[0].type.toLowerCase()&&(e=a[0].name)}return{name:a,isView:"view"===c,columns:f.map(a=>({name:a.name,dataType:a.type,isNullable:!a.notnull,isAutoIncrementing:a.name===e,hasDefaultValue:null!=a.dflt_value,comment:void 0}))}})}}class kQ{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}class kR extends kQ{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(a,b){}async releaseMigrationLock(a,b){}}class kS{#s;constructor(a){this.#s=(0,kF.CN)({...a})}createDriver(){return new kH(this.#s)}createQueryCompiler(){return new kM}createAdapter(){return new kR}createIntrospector(a){return new kP(a)}}function kT(a,b){var c;if(c=a,(0,kF.Gv)(c)&&(0,kF.Kg)(c.stack)&&b.stack){let c=b.stack.split("\n").slice(1).join("\n");a.stack+=`
${c}`}return a}let kU=Symbol();class kV{#s;#A=new WeakMap;#B;constructor(a){this.#s=(0,kF.CN)({...a})}async init(){this.#B=(0,kF.Tn)(this.#s.pool)?await this.#s.pool():this.#s.pool}async acquireConnection(){let a=await this.#C(),b=this.#A.get(a);return!b&&(b=new kW(a),this.#A.set(a,b),this.#s?.onCreateConnection&&await this.#s.onCreateConnection(b)),this.#s?.onReserveConnection&&await this.#s.onReserveConnection(b),b}async #C(){return new Promise((a,b)=>{this.#B.getConnection(async(c,d)=>{c?b(c):a(d)})})}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c=[];b.isolationLevel&&c.push(`isolation level ${b.isolationLevel}`),b.accessMode&&c.push(b.accessMode);let d=`set transaction ${c.join(", ")}`;await a.executeQuery(kE.E.raw(d))}await a.executeQuery(kE.E.raw("begin"))}async commitTransaction(a){await a.executeQuery(kE.E.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(kE.E.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(kD("savepoint",b),(0,kG.a)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(kD("rollback to",b),(0,kG.a)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(kD("release savepoint",b),(0,kG.a)()))}async releaseConnection(a){a[kU]()}async destroy(){return new Promise((a,b)=>{this.#B.end(c=>{c?b(c):a()})})}}class kW{#D;constructor(a){this.#D=a}async executeQuery(a){try{let b=await this.#E(a);if((0,kF.Gv)(b)&&"insertId"in b&&"affectedRows"in b){let{insertId:a,affectedRows:c,changedRows:d}=b;return{insertId:null!=a&&"0"!==a.toString()?BigInt(a):void 0,numAffectedRows:null!=c?BigInt(c):void 0,numChangedRows:null!=d?BigInt(d):void 0,rows:[]}}if(Array.isArray(b))return{rows:b};return{rows:[]}}catch(a){throw kT(a,Error())}}#E(a){return new Promise((b,c)=>{this.#D.query(a.sql,a.parameters,(a,d)=>{a?c(a):b(d)})})}async *streamQuery(a,b){let c=this.#D.query(a.sql,a.parameters).stream({objectMode:!0});try{for await(let a of c)yield{rows:[a]}}catch(a){if(a&&"object"==typeof a&&"code"in a&&"ERR_STREAM_PREMATURE_CLOSE"===a.code)return;throw a}}[kU](){this.#D.release()}}let kX=/`/g;class kY extends kK.n{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getExplainOptionAssignment(){return"="}getExplainOptionsDelimiter(){return" "}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return"`"}getRightIdentifierWrapper(){return"`"}sanitizeIdentifier(a){return a.replace(kX,"``")}visitCreateIndex(a){this.append("create "),a.unique&&this.append("unique "),this.append("index "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),a.using&&(this.append(" using "),this.visitNode(a.using)),a.table&&(this.append(" on "),this.visitNode(a.table)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.where&&(this.append(" "),this.visitNode(a.where))}}class kZ{#u;constructor(a){this.#u=a}async getSchemas(){return(await this.#u.selectFrom("information_schema.schemata").select("schema_name").$castTo().execute()).map(a=>({name:a.SCHEMA_NAME}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#u.selectFrom("information_schema.columns as columns").innerJoin("information_schema.tables as tables",a=>a.onRef("columns.TABLE_CATALOG","=","tables.TABLE_CATALOG").onRef("columns.TABLE_SCHEMA","=","tables.TABLE_SCHEMA").onRef("columns.TABLE_NAME","=","tables.TABLE_NAME")).select(["columns.COLUMN_NAME","columns.COLUMN_DEFAULT","columns.TABLE_NAME","columns.TABLE_SCHEMA","tables.TABLE_TYPE","columns.IS_NULLABLE","columns.DATA_TYPE","columns.EXTRA","columns.COLUMN_COMMENT"]).where("columns.TABLE_SCHEMA","=",(0,kO.l)`database()`).orderBy("columns.TABLE_NAME").orderBy("columns.ORDINAL_POSITION").$castTo();a.withInternalKyselyTables||(b=b.where("columns.TABLE_NAME","!=",kN.kQ).where("columns.TABLE_NAME","!=",kN.sy));let c=await b.execute();return this.#F(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#F(a){return a.reduce((a,b)=>{let c=a.find(a=>a.name===b.TABLE_NAME);return c||(c=(0,kF.CN)({name:b.TABLE_NAME,isView:"VIEW"===b.TABLE_TYPE,schema:b.TABLE_SCHEMA,columns:[]}),a.push(c)),c.columns.push((0,kF.CN)({name:b.COLUMN_NAME,dataType:b.DATA_TYPE,isNullable:"YES"===b.IS_NULLABLE,isAutoIncrementing:b.EXTRA.toLowerCase().includes("auto_increment"),hasDefaultValue:null!==b.COLUMN_DEFAULT,comment:""===b.COLUMN_COMMENT?void 0:b.COLUMN_COMMENT})),a},[])}}let k$="ea586330-2c93-47c8-908d-981d9d270f9d";class k_ extends kQ{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}async acquireMigrationLock(a,b){await (0,kO.l)`select get_lock(${kO.l.lit(k$)}, ${kO.l.lit(3600)})`.execute(a)}async releaseMigrationLock(a,b){await (0,kO.l)`select release_lock(${kO.l.lit(k$)})`.execute(a)}}class k0{#s;constructor(a){this.#s=a}createDriver(){return new kV(this.#s)}createQueryCompiler(){return new kY}createAdapter(){return new k_}createIntrospector(a){return new kZ(a)}}let k1=Symbol();class k2{#s;#A=new WeakMap;#B;constructor(a){this.#s=(0,kF.CN)({...a})}async init(){this.#B=(0,kF.Tn)(this.#s.pool)?await this.#s.pool():this.#s.pool}async acquireConnection(){let a=await this.#B.connect(),b=this.#A.get(a);return!b&&(b=new k3(a,{cursor:this.#s.cursor??null}),this.#A.set(a,b),this.#s.onCreateConnection&&await this.#s.onCreateConnection(b)),this.#s.onReserveConnection&&await this.#s.onReserveConnection(b),b}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c="start transaction";b.isolationLevel&&(c+=` isolation level ${b.isolationLevel}`),b.accessMode&&(c+=` ${b.accessMode}`),await a.executeQuery(kE.E.raw(c))}else await a.executeQuery(kE.E.raw("begin"))}async commitTransaction(a){await a.executeQuery(kE.E.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(kE.E.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(kD("savepoint",b),(0,kG.a)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(kD("rollback to",b),(0,kG.a)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(kD("release",b),(0,kG.a)()))}async releaseConnection(a){a[k1]()}async destroy(){if(this.#B){let a=this.#B;this.#B=void 0,await a.end()}}}class k3{#G;#H;constructor(a,b){this.#G=a,this.#H=b}async executeQuery(a){try{let{command:b,rowCount:c,rows:d}=await this.#G.query(a.sql,[...a.parameters]);return{numAffectedRows:"INSERT"===b||"UPDATE"===b||"DELETE"===b||"MERGE"===b?BigInt(c):void 0,rows:d??[]}}catch(a){throw kT(a,Error())}}async *streamQuery(a,b){if(!this.#H.cursor)throw Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=this.#G.query(new this.#H.cursor(a.sql,a.parameters.slice()));try{for(;;){let a=await c.read(b);if(0===a.length)break;yield{rows:a}}}finally{await c.close()}}[k1](){this.#G.release()}}class k4{#u;constructor(a){this.#u=a}async getSchemas(){return(await this.#u.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(a=>({name:a.nspname}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#u.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",(0,kO.l)`col_description(a.attrelid, a.attnum)`.as("column_description"),(0,kO.l)`pg_get_serial_sequence(quote_ident(ns.nspname) || '.' || quote_ident(c.relname), a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("ns.nspname","!=","crdb_internal").where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();a.withInternalKyselyTables||(b=b.where("c.relname","!=",kN.kQ).where("c.relname","!=",kN.sy));let c=await b.execute();return this.#F(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#F(a){return a.reduce((a,b)=>{let c=a.find(a=>a.name===b.table&&a.schema===b.schema);return c||(c=(0,kF.CN)({name:b.table,isView:"v"===b.table_type,schema:b.schema,columns:[]}),a.push(c)),c.columns.push((0,kF.CN)({name:b.column,dataType:b.type,dataTypeSchema:b.type_schema,isNullable:!b.not_null,isAutoIncrementing:null!==b.auto_incrementing,hasDefaultValue:b.has_default,comment:b.column_description??void 0})),a},[])}}let k5=/"/g;class k6 extends kK.n{sanitizeIdentifier(a){return a.replace(k5,'""')}}let k7=BigInt("3853314791062309107");class k8 extends kQ{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(a,b){await (0,kO.l)`select pg_advisory_xact_lock(${kO.l.lit(k7)})`.execute(a)}async releaseMigrationLock(a,b){}}class k9{#s;constructor(a){this.#s=a}createDriver(){return new k2(this.#s)}createQueryCompiler(){return new k6}createAdapter(){return new k8}createIntrospector(a){return new k4(a)}}class la extends kQ{get supportsCreateIfNotExists(){return!1}get supportsTransactionalDdl(){return!0}get supportsOutput(){return!0}async acquireMigrationLock(a){await (0,kO.l)`exec sp_getapplock @DbPrincipal = ${kO.l.lit("dbo")}, @Resource = ${kO.l.lit(kN.kQ)}, @LockMode = ${kO.l.lit("Exclusive")}`.execute(a)}async releaseMigrationLock(){}}var lb=c(96931),lc=c(37381);let ld=Symbol(),le=Symbol(),lf=Symbol();class lg{#s;#B;constructor(a){this.#s=(0,kF.CN)({...a});let{tarn:b,tedious:c,validateConnections:d}=this.#s,{validateConnections:e,...f}=b.options;this.#B=new b.Pool({...f,create:async()=>{let a=await c.connectionFactory();return await new lh(a,c).connect()},destroy:async a=>{await a[le]()},validate:!1===d||!1===e?void 0:a=>a[lf]()})}async init(){}async acquireConnection(){return await this.#B.acquire().promise}async beginTransaction(a,b){await a.beginTransaction(b)}async commitTransaction(a){await a.commitTransaction()}async rollbackTransaction(a){await a.rollbackTransaction()}async savepoint(a,b){await a.savepoint(b)}async rollbackToSavepoint(a,b){await a.rollbackTransaction(b)}async releaseConnection(a){(this.#s.resetConnectionsOnRelease||this.#s.tedious.resetConnectionOnRelease)&&await a[ld](),this.#B.release(a)}async destroy(){await this.#B.destroy()}}class lh{#v;#I;#J;constructor(a,b){this.#v=a,this.#I=!1,this.#J=b}async beginTransaction(a){let{isolationLevel:b}=a;await new Promise((a,c)=>this.#v.beginTransaction(b=>{b?c(b):a(void 0)},b?(0,lb.D)(8):void 0,b?this.#K(b):void 0))}async commitTransaction(){await new Promise((a,b)=>this.#v.commitTransaction(c=>{c?b(c):a(void 0)}))}async connect(){let{promise:a,reject:b,resolve:c}=new lc.c;function d(){b(Error("The connection ended without ever completing the connection"))}return this.#v.connect(a=>{if(a)return b(a);c()}),this.#v.on("error",a=>{a instanceof Error&&"code"in a&&"ESOCKET"===a.code&&(this.#I=!0),console.error(a),b(a)}),this.#v.once("end",d),await a,this.#v.off("end",d),this}async executeQuery(a){try{let b=new lc.c,c=new li({compiledQuery:a,tedious:this.#J,onDone:b});this.#v.execSql(c.request);let{rowCount:d,rows:e}=await b.promise;return{numAffectedRows:void 0!==d?BigInt(d):void 0,rows:e}}catch(a){throw kT(a,Error())}}async rollbackTransaction(a){await new Promise((b,c)=>this.#v.rollbackTransaction(a=>{a?c(a):b(void 0)},a))}async savepoint(a){await new Promise((b,c)=>this.#v.saveTransaction(a=>{a?c(a):b(void 0)},a))}async *streamQuery(a,b){if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=new li({compiledQuery:a,streamChunkSize:b,tedious:this.#J});this.#v.execSql(c.request);try{for(;;){let a=await c.readChunk();if(0===a.length||(yield{rows:a},a.length<b))break}}finally{await this.#L(c)}}#K(a){let{ISOLATION_LEVEL:b}=this.#J,c={"read committed":b.READ_COMMITTED,"read uncommitted":b.READ_UNCOMMITTED,"repeatable read":b.REPEATABLE_READ,serializable:b.SERIALIZABLE,snapshot:b.SNAPSHOT}[a];if(void 0===c)throw Error(`Unknown isolation level: ${a}`);return c}#L(a){return new Promise(b=>{a.request.once("requestCompleted",b),this.#v.cancel()||(a.request.off("requestCompleted",b),b())})}[le](){return"closed"in this.#v&&this.#v.closed?Promise.resolve():new Promise(a=>{this.#v.once("end",a),this.#v.close()})}async [ld](){await new Promise((a,b)=>{this.#v.reset(c=>{if(c)return b(c);a()})})}async [lf](){if(this.#I||this.#M())return!1;try{let a=new lc.c,b=new li({compiledQuery:kE.E.raw("select 1"),onDone:a,tedious:this.#J});return this.#v.execSql(b.request),await a.promise,!0}catch{return!1}}#M(){return"closed"in this.#v&&!!this.#v.closed}}class li{#N;#O;#P;#Q;#J;#R;constructor(a){let{compiledQuery:b,onDone:c,streamChunkSize:d,tedious:e}=a;if(this.#O=[],this.#P=d,this.#Q={},this.#J=e,c){let a="onDone";this.#Q[a]=(b,d)=>{if("chunkReady"!==b){if(delete this.#Q[a],"error"===b)return c.reject(d);c.resolve({rowCount:this.#R,rows:this.#O})}}}this.#N=new this.#J.Request(b.sql,(a,b)=>{if(a)return Object.values(this.#Q).forEach(b=>b("error",a instanceof AggregateError?a.errors:a));this.#R=b}),this.#S(b.parameters),this.#T()}get request(){return this.#N}readChunk(){let a=this.readChunk.name;return new Promise((b,c)=>{this.#Q[a]=(d,e)=>{if(delete this.#Q[a],"error"===d)return c(e);b(this.#O.splice(0,this.#P))},this.#N.resume()})}#S(a){for(let b=0;b<a.length;b++){let c=a[b];this.#N.addParameter(String(b+1),this.#U(c),c)}}#T(){let a=this.#P?()=>{this.#P<=this.#O.length&&(this.#N.pause(),Object.values(this.#Q).forEach(a=>a("chunkReady")))}:()=>{},b=b=>{let c={};for(let a of b)c[a.metadata.colName]=a.value;this.#O.push(c),a()};this.#N.on("row",b),this.#N.once("requestCompleted",()=>{Object.values(this.#Q).forEach(a=>a("completed")),this.#N.off("row",b)})}#U(a){if((0,kF.kZ)(a)||(0,kF.b0)(a)||(0,kF.Kg)(a))return this.#J.TYPES.NVarChar;if((0,kF.sI)(a)||(0,kF.Et)(a)&&a%1==0)if(a<-0x80000000||a>0x7fffffff)return this.#J.TYPES.BigInt;else return this.#J.TYPES.Int;return(0,kF.Et)(a)?this.#J.TYPES.Float:(0,kF.Lm)(a)?this.#J.TYPES.Bit:(0,kF.$P)(a)?this.#J.TYPES.DateTime:(0,kF.Pe)(a)?this.#J.TYPES.VarBinary:this.#J.TYPES.NVarChar}}class lj{#u;constructor(a){this.#u=a}async getSchemas(){return await this.#u.selectFrom("sys.schemas").select("name").execute()}async getTables(a={withInternalKyselyTables:!1}){let b=await this.#u.selectFrom("sys.tables as tables").leftJoin("sys.schemas as table_schemas","table_schemas.schema_id","tables.schema_id").innerJoin("sys.columns as columns","columns.object_id","tables.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",a=>a.onRef("comments.major_id","=","tables.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).$if(!a.withInternalKyselyTables,a=>a.where("tables.name","!=",kN.kQ).where("tables.name","!=",kN.sy)).select(["tables.name as table_name",a=>a.ref("tables.type").$castTo().as("table_type"),"table_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"]).unionAll(this.#u.selectFrom("sys.views as views").leftJoin("sys.schemas as view_schemas","view_schemas.schema_id","views.schema_id").innerJoin("sys.columns as columns","columns.object_id","views.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",a=>a.onRef("comments.major_id","=","views.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).select(["views.name as table_name","views.type as table_type","view_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"])).orderBy("table_schema_name").orderBy("table_name").orderBy("column_name").execute(),c={};for(let a of b){let b=`${a.table_schema_name}.${a.table_name}`;(c[b]=c[b]||(0,kF.CN)({columns:[],isView:"V "===a.table_type,name:a.table_name,schema:a.table_schema_name??void 0})).columns.push((0,kF.CN)({dataType:a.type_name,dataTypeSchema:a.type_schema_name??void 0,hasDefaultValue:a.column_default_object_id>0||"NOT_APPLICABLE"!==a.column_generated_always_type||a.column_is_identity||a.column_is_computed||a.column_is_rowguidcol,isAutoIncrementing:a.column_is_identity,isNullable:a.column_is_nullable&&a.type_is_nullable,name:a.column_name,comment:a.column_comment??void 0}))}return Object.values(c)}async getMetadata(a){return{tables:await this.getTables(a)}}}let lk=/^[a-z0-9_]$/i;class ll extends kK.n{getCurrentParameterPlaceholder(){return`@${this.numParameters}`}visitOffset(a){super.visitOffset(a),this.append(" rows")}compileColumnAlterations(a){let b={};for(let c of a)b[c.kind]||(b[c.kind]=[]),b[c.kind].push(c);let c=!0;b.AddColumnNode&&(this.append("add "),this.compileList(b.AddColumnNode),c=!1),b.AlterColumnNode&&(c||this.append(", "),this.compileList(b.AlterColumnNode)),b.DropColumnNode&&(c||this.append(", "),this.append("drop column "),this.compileList(b.DropColumnNode)),b.ModifyColumnNode&&(c||this.append(", "),this.compileList(b.ModifyColumnNode)),b.RenameColumnNode&&(c||this.append(", "),this.compileList(b.RenameColumnNode))}visitAddColumn(a){this.visitNode(a.column)}visitDropColumn(a){this.visitNode(a.column)}visitMergeQuery(a){super.visitMergeQuery(a),this.append(";")}visitCollate(a){this.append("collate ");let{name:b}=a.collation;for(let a of b)if(!lk.test(a))throw Error(`Invalid collation: ${b}`);this.append(b)}announcesNewColumnDataType(){return!1}}class lm{#s;constructor(a){this.#s=a}createDriver(){return new lg(this.#s)}createQueryCompiler(){return new ll}createAdapter(){return new la}createIntrospector(a){return new lj(a)}}let ln=(0,kF.CN)({is:a=>"AlterTableNode"===a.kind,create:a=>(0,kF.CN)({kind:"AlterTableNode",table:a}),cloneWithTableProps:(a,b)=>(0,kF.CN)({...a,...b}),cloneWithColumnAlteration:(a,b)=>(0,kF.CN)({...a,columnAlterations:a.columnAlterations?[...a.columnAlterations,b]:[b]})}),lo=(0,kF.CN)({is:a=>"CreateIndexNode"===a.kind,create:a=>(0,kF.CN)({kind:"CreateIndexNode",name:kB.O.create(a)}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b}),cloneWithColumns:(a,b)=>(0,kF.CN)({...a,columns:[...a.columns||[],...b]})}),lp=(0,kF.CN)({is:a=>"CreateSchemaNode"===a.kind,create:(a,b)=>(0,kF.CN)({kind:"CreateSchemaNode",schema:kB.O.create(a),...b}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b})});var lq=c(93092),lr=c(36923);let ls=(0,kF.CN)({is:a=>"DropIndexNode"===a.kind,create:(a,b)=>(0,kF.CN)({kind:"DropIndexNode",name:lr.y.create(a),...b}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b})}),lt=(0,kF.CN)({is:a=>"DropSchemaNode"===a.kind,create:(a,b)=>(0,kF.CN)({kind:"DropSchemaNode",schema:kB.O.create(a),...b}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b})}),lu=(0,kF.CN)({is:a=>"DropTableNode"===a.kind,create:(a,b)=>(0,kF.CN)({kind:"DropTableNode",table:a,...b}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b})});var lv=c(19795);let lw=(0,kF.CN)({is:a=>"AddColumnNode"===a.kind,create:a=>(0,kF.CN)({kind:"AddColumnNode",column:a})});var lx=c(31009);let ly=(0,kF.CN)({is:a=>"ColumnDefinitionNode"===a.kind,create:(a,b)=>(0,kF.CN)({kind:"ColumnDefinitionNode",column:lx.Z.create(a),dataType:b}),cloneWithFrontModifier:(a,b)=>(0,kF.CN)({...a,frontModifiers:a.frontModifiers?(0,kF.CN)([...a.frontModifiers,b]):[b]}),cloneWithEndModifier:(a,b)=>(0,kF.CN)({...a,endModifiers:a.endModifiers?(0,kF.CN)([...a.endModifiers,b]):[b]}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b})}),lz=(0,kF.CN)({is:a=>"DropColumnNode"===a.kind,create:a=>(0,kF.CN)({kind:"DropColumnNode",column:lx.Z.create(a)})}),lA=(0,kF.CN)({is:a=>"RenameColumnNode"===a.kind,create:(a,b)=>(0,kF.CN)({kind:"RenameColumnNode",column:lx.Z.create(a),renameTo:lx.Z.create(b)})}),lB=(0,kF.CN)({is:a=>"CheckConstraintNode"===a.kind,create:(a,b)=>(0,kF.CN)({kind:"CheckConstraintNode",expression:a,name:b?kB.O.create(b):void 0})}),lC=["no action","restrict","cascade","set null","set default"],lD=(0,kF.CN)({is:a=>"ReferencesNode"===a.kind,create:(a,b)=>(0,kF.CN)({kind:"ReferencesNode",table:a,columns:(0,kF.CN)([...b])}),cloneWithOnDelete:(a,b)=>(0,kF.CN)({...a,onDelete:b}),cloneWithOnUpdate:(a,b)=>(0,kF.CN)({...a,onUpdate:b})});var lE=c(9005),lF=c(2952),lG=c(39450),lH=c(90350);function lI(a){return(0,lG.N)(a)?a.toOperationNode():lH.q.createImmediate(a)}let lJ=(0,kF.CN)({is:a=>"GeneratedNode"===a.kind,create:a=>(0,kF.CN)({kind:"GeneratedNode",...a}),createWithExpression:a=>(0,kF.CN)({kind:"GeneratedNode",always:!0,expression:a}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b})}),lK=(0,kF.CN)({is:a=>"DefaultValueNode"===a.kind,create:a=>(0,kF.CN)({kind:"DefaultValueNode",defaultValue:a})});function lL(a){if(lC.includes(a))return a;throw Error(`invalid OnModifyForeignAction ${a}`)}class lM{#V;constructor(a){this.#V=a}autoIncrement(){return new lM(ly.cloneWith(this.#V,{autoIncrement:!0}))}identity(){return new lM(ly.cloneWith(this.#V,{identity:!0}))}primaryKey(){return new lM(ly.cloneWith(this.#V,{primaryKey:!0}))}references(a){let b=(0,lF.q5)(a);if(!b.table||lE.U.is(b.column))throw Error(`invalid call references('${a}'). The reference must have format table.column or schema.table.column`);return new lM(ly.cloneWith(this.#V,{references:lD.create(b.table,[b.column])}))}onDelete(a){if(!this.#V.references)throw Error("on delete constraint can only be added for foreign keys");return new lM(ly.cloneWith(this.#V,{references:lD.cloneWithOnDelete(this.#V.references,lL(a))}))}onUpdate(a){if(!this.#V.references)throw Error("on update constraint can only be added for foreign keys");return new lM(ly.cloneWith(this.#V,{references:lD.cloneWithOnUpdate(this.#V.references,lL(a))}))}unique(){return new lM(ly.cloneWith(this.#V,{unique:!0}))}notNull(){return new lM(ly.cloneWith(this.#V,{notNull:!0}))}unsigned(){return new lM(ly.cloneWith(this.#V,{unsigned:!0}))}defaultTo(a){return new lM(ly.cloneWith(this.#V,{defaultTo:lK.create(lI(a))}))}check(a){return new lM(ly.cloneWith(this.#V,{check:lB.create(a.toOperationNode())}))}generatedAlwaysAs(a){return new lM(ly.cloneWith(this.#V,{generated:lJ.createWithExpression(a.toOperationNode())}))}generatedAlwaysAsIdentity(){return new lM(ly.cloneWith(this.#V,{generated:lJ.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new lM(ly.cloneWith(this.#V,{generated:lJ.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#V.generated)throw Error("stored() can only be called after generatedAlwaysAs");return new lM(ly.cloneWith(this.#V,{generated:lJ.cloneWith(this.#V.generated,{stored:!0})}))}modifyFront(a){return new lM(ly.cloneWithFrontModifier(this.#V,a.toOperationNode()))}nullsNotDistinct(){return new lM(ly.cloneWith(this.#V,{nullsNotDistinct:!0}))}ifNotExists(){return new lM(ly.cloneWith(this.#V,{ifNotExists:!0}))}modifyEnd(a){return new lM(ly.cloneWithEndModifier(this.#V,a.toOperationNode()))}$call(a){return a(this)}toOperationNode(){return this.#V}}let lN=(0,kF.CN)({is:a=>"ModifyColumnNode"===a.kind,create:a=>(0,kF.CN)({kind:"ModifyColumnNode",column:a})});var lO=c(43926);let lP=(0,kF.CN)({is:a=>"ForeignKeyConstraintNode"===a.kind,create:(a,b,c,d)=>(0,kF.CN)({kind:"ForeignKeyConstraintNode",columns:a,references:lD.create(b,c),name:d?kB.O.create(d):void 0}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b})});class lQ{#V;constructor(a){this.#V=a}onDelete(a){return new lQ(lP.cloneWith(this.#V,{onDelete:lL(a)}))}onUpdate(a){return new lQ(lP.cloneWith(this.#V,{onUpdate:lL(a)}))}deferrable(){return new lQ(lP.cloneWith(this.#V,{deferrable:!0}))}notDeferrable(){return new lQ(lP.cloneWith(this.#V,{deferrable:!1}))}initiallyDeferred(){return new lQ(lP.cloneWith(this.#V,{initiallyDeferred:!0}))}initiallyImmediate(){return new lQ(lP.cloneWith(this.#V,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#V}}let lR=(0,kF.CN)({is:a=>"AddConstraintNode"===a.kind,create:a=>(0,kF.CN)({kind:"AddConstraintNode",constraint:a})}),lS=(0,kF.CN)({is:a=>"UniqueConstraintNode"===a.kind,create:(a,b,c)=>(0,kF.CN)({kind:"UniqueConstraintNode",columns:(0,kF.CN)(a.map(lx.Z.create)),name:b?kB.O.create(b):void 0,nullsNotDistinct:c}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b})}),lT=(0,kF.CN)({is:a=>"DropConstraintNode"===a.kind,create:a=>(0,kF.CN)({kind:"DropConstraintNode",constraintName:kB.O.create(a)}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b})}),lU=(0,kF.CN)({is:a=>"AlterColumnNode"===a.kind,create:(a,b,c)=>(0,kF.CN)({kind:"AlterColumnNode",column:lx.Z.create(a),[b]:c})});class lV{#W;constructor(a){this.#W=a}setDataType(a){return new lW(lU.create(this.#W,"dataType",(0,lO.Q)(a)))}setDefault(a){return new lW(lU.create(this.#W,"setDefault",lI(a)))}dropDefault(){return new lW(lU.create(this.#W,"dropDefault",!0))}setNotNull(){return new lW(lU.create(this.#W,"setNotNull",!0))}dropNotNull(){return new lW(lU.create(this.#W,"dropNotNull",!0))}$call(a){return a(this)}}class lW{#X;constructor(a){this.#X=a}toOperationNode(){return this.#X}}class lX{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}class lY{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}onDelete(a){return new lY({...this.#Y,constraintBuilder:this.#Y.constraintBuilder.onDelete(a)})}onUpdate(a){return new lY({...this.#Y,constraintBuilder:this.#Y.constraintBuilder.onUpdate(a)})}deferrable(){return new lY({...this.#Y,constraintBuilder:this.#Y.constraintBuilder.deferrable()})}notDeferrable(){return new lY({...this.#Y,constraintBuilder:this.#Y.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new lY({...this.#Y,constraintBuilder:this.#Y.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new lY({...this.#Y,constraintBuilder:this.#Y.constraintBuilder.initiallyImmediate()})}$call(a){return a(this)}toOperationNode(){return this.#Y.executor.transformQuery(ln.cloneWithTableProps(this.#Y.node,{addConstraint:lR.create(this.#Y.constraintBuilder.toOperationNode())}),this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}class lZ{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}ifExists(){return new lZ({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{dropConstraint:lT.cloneWith(this.#Y.node.dropConstraint,{ifExists:!0})})})}cascade(){return new lZ({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{dropConstraint:lT.cloneWith(this.#Y.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new lZ({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{dropConstraint:lT.cloneWith(this.#Y.node.dropConstraint,{modifier:"restrict"})})})}$call(a){return a(this)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}let l$=(0,kF.CN)({is:a=>"PrimaryKeyConstraintNode"===a.kind,create:(a,b)=>(0,kF.CN)({kind:"PrimaryKeyConstraintNode",columns:(0,kF.CN)(a.map(lx.Z.create)),name:b?kB.O.create(b):void 0}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b})}),l_=(0,kF.CN)({is:a=>"AddIndexNode"===a.kind,create:a=>(0,kF.CN)({kind:"AddIndexNode",name:kB.O.create(a)}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b}),cloneWithColumns:(a,b)=>(0,kF.CN)({...a,columns:[...a.columns||[],...b]})});class l0{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}unique(){return new l0({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{addIndex:l_.cloneWith(this.#Y.node.addIndex,{unique:!0})})})}column(a){return new l0({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{addIndex:l_.cloneWithColumns(this.#Y.node.addIndex,[(0,lF.Ow)(a)])})})}columns(a){return new l0({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{addIndex:l_.cloneWithColumns(this.#Y.node.addIndex,a.map(lF.Ow))})})}expression(a){return new l0({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{addIndex:l_.cloneWithColumns(this.#Y.node.addIndex,[a.toOperationNode()])})})}using(a){return new l0({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{addIndex:l_.cloneWith(this.#Y.node.addIndex,{using:kC.z.createWithSql(a)})})})}$call(a){return a(this)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}class l1{#V;constructor(a){this.#V=a}nullsNotDistinct(){return new l1(lS.cloneWith(this.#V,{nullsNotDistinct:!0}))}deferrable(){return new l1(lS.cloneWith(this.#V,{deferrable:!0}))}notDeferrable(){return new l1(lS.cloneWith(this.#V,{deferrable:!1}))}initiallyDeferred(){return new l1(lS.cloneWith(this.#V,{initiallyDeferred:!0}))}initiallyImmediate(){return new l1(lS.cloneWith(this.#V,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#V}}class l2{#V;constructor(a){this.#V=a}deferrable(){return new l2(l$.cloneWith(this.#V,{deferrable:!0}))}notDeferrable(){return new l2(l$.cloneWith(this.#V,{deferrable:!1}))}initiallyDeferred(){return new l2(l$.cloneWith(this.#V,{initiallyDeferred:!0}))}initiallyImmediate(){return new l2(l$.cloneWith(this.#V,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#V}}class l3{#V;constructor(a){this.#V=a}$call(a){return a(this)}toOperationNode(){return this.#V}}let l4=(0,kF.CN)({is:a=>"RenameConstraintNode"===a.kind,create:(a,b)=>(0,kF.CN)({kind:"RenameConstraintNode",oldName:kB.O.create(a),newName:kB.O.create(b)})});class l5{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}renameTo(a){return new lX({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{renameTo:(0,lv.M$)(a)})})}setSchema(a){return new lX({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{setSchema:kB.O.create(a)})})}alterColumn(a,b){let c=b(new lV(a));return new l6({...this.#Y,node:ln.cloneWithColumnAlteration(this.#Y.node,c.toOperationNode())})}dropColumn(a){return new l6({...this.#Y,node:ln.cloneWithColumnAlteration(this.#Y.node,lz.create(a))})}renameColumn(a,b){return new l6({...this.#Y,node:ln.cloneWithColumnAlteration(this.#Y.node,lA.create(a,b))})}addColumn(a,b,c=kF.lQ){let d=c(new lM(ly.create(a,(0,lO.Q)(b))));return new l6({...this.#Y,node:ln.cloneWithColumnAlteration(this.#Y.node,lw.create(d.toOperationNode()))})}modifyColumn(a,b,c=kF.lQ){let d=c(new lM(ly.create(a,(0,lO.Q)(b))));return new l6({...this.#Y,node:ln.cloneWithColumnAlteration(this.#Y.node,lN.create(d.toOperationNode()))})}addUniqueConstraint(a,b,c=kF.lQ){let d=c(new l1(lS.create(b,a)));return new lX({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{addConstraint:lR.create(d.toOperationNode())})})}addCheckConstraint(a,b,c=kF.lQ){let d=c(new l3(lB.create(b.toOperationNode(),a)));return new lX({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{addConstraint:lR.create(d.toOperationNode())})})}addForeignKeyConstraint(a,b,c,d,e=kF.lQ){let f=e(new lQ(lP.create(b.map(lx.Z.create),(0,lv.M$)(c),d.map(lx.Z.create),a)));return new lY({...this.#Y,constraintBuilder:f})}addPrimaryKeyConstraint(a,b,c=kF.lQ){let d=c(new l2(l$.create(b,a)));return new lX({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{addConstraint:lR.create(d.toOperationNode())})})}dropConstraint(a){return new lZ({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{dropConstraint:lT.create(a)})})}renameConstraint(a,b){return new lZ({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{renameConstraint:l4.create(a,b)})})}addIndex(a){return new l0({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{addIndex:l_.create(a)})})}dropIndex(a){return new lX({...this.#Y,node:ln.cloneWithTableProps(this.#Y.node,{dropIndex:ls.create(a)})})}$call(a){return a(this)}}class l6{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}alterColumn(a,b){let c=b(new lV(a));return new l6({...this.#Y,node:ln.cloneWithColumnAlteration(this.#Y.node,c.toOperationNode())})}dropColumn(a){return new l6({...this.#Y,node:ln.cloneWithColumnAlteration(this.#Y.node,lz.create(a))})}renameColumn(a,b){return new l6({...this.#Y,node:ln.cloneWithColumnAlteration(this.#Y.node,lA.create(a,b))})}addColumn(a,b,c=kF.lQ){let d=c(new lM(ly.create(a,(0,lO.Q)(b))));return new l6({...this.#Y,node:ln.cloneWithColumnAlteration(this.#Y.node,lw.create(d.toOperationNode()))})}modifyColumn(a,b,c=kF.lQ){let d=c(new lM(ly.create(a,(0,lO.Q)(b))));return new l6({...this.#Y,node:ln.cloneWithColumnAlteration(this.#Y.node,lN.create(d.toOperationNode()))})}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}var l7=c(53284),l8=c(4315),l9=c(42437),ma=c(93159);class mb extends l9.V{transformPrimitiveValueList(a){return ma.s.create(a.values.map(lH.q.createImmediate))}transformValue(a){return lH.q.createImmediate(a.value)}}class mc{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}ifNotExists(){return new mc({...this.#Y,node:lo.cloneWith(this.#Y.node,{ifNotExists:!0})})}unique(){return new mc({...this.#Y,node:lo.cloneWith(this.#Y.node,{unique:!0})})}nullsNotDistinct(){return new mc({...this.#Y,node:lo.cloneWith(this.#Y.node,{nullsNotDistinct:!0})})}on(a){return new mc({...this.#Y,node:lo.cloneWith(this.#Y.node,{table:(0,lv.M$)(a)})})}column(a){return new mc({...this.#Y,node:lo.cloneWithColumns(this.#Y.node,[(0,lF.Ow)(a)])})}columns(a){return new mc({...this.#Y,node:lo.cloneWithColumns(this.#Y.node,a.map(lF.Ow))})}expression(a){return new mc({...this.#Y,node:lo.cloneWithColumns(this.#Y.node,[a.toOperationNode()])})}using(a){return new mc({...this.#Y,node:lo.cloneWith(this.#Y.node,{using:kC.z.createWithSql(a)})})}where(...a){let b=new mb;return new mc({...this.#Y,node:l8.L.cloneWithWhere(this.#Y.node,b.transformNode((0,l7.GB)(a),this.#Y.queryId))})}$call(a){return a(this)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}class md{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}ifNotExists(){return new md({...this.#Y,node:lp.cloneWith(this.#Y.node,{ifNotExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}var me=c(57105);class mf{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}temporary(){return new mf({...this.#Y,node:lq.B.cloneWith(this.#Y.node,{temporary:!0})})}onCommit(a){return new mf({...this.#Y,node:lq.B.cloneWith(this.#Y.node,{onCommit:function(a){if(lq.o.includes(a))return a;throw Error(`invalid OnCommitAction ${a}`)}(a)})})}ifNotExists(){return new mf({...this.#Y,node:lq.B.cloneWith(this.#Y.node,{ifNotExists:!0})})}addColumn(a,b,c=kF.lQ){let d=c(new lM(ly.create(a,(0,lO.Q)(b))));return new mf({...this.#Y,node:lq.B.cloneWithColumn(this.#Y.node,d.toOperationNode())})}addPrimaryKeyConstraint(a,b,c=kF.lQ){let d=c(new l2(l$.create(b,a)));return new mf({...this.#Y,node:lq.B.cloneWithConstraint(this.#Y.node,d.toOperationNode())})}addUniqueConstraint(a,b,c=kF.lQ){let d=c(new l1(lS.create(b,a)));return new mf({...this.#Y,node:lq.B.cloneWithConstraint(this.#Y.node,d.toOperationNode())})}addCheckConstraint(a,b,c=kF.lQ){let d=c(new l3(lB.create(b.toOperationNode(),a)));return new mf({...this.#Y,node:lq.B.cloneWithConstraint(this.#Y.node,d.toOperationNode())})}addForeignKeyConstraint(a,b,c,d,e=kF.lQ){let f=e(new lQ(lP.create(b.map(lx.Z.create),(0,lv.M$)(c),d.map(lx.Z.create),a)));return new mf({...this.#Y,node:lq.B.cloneWithConstraint(this.#Y.node,f.toOperationNode())})}modifyFront(a){return new mf({...this.#Y,node:lq.B.cloneWithFrontModifier(this.#Y.node,a.toOperationNode())})}modifyEnd(a){return new mf({...this.#Y,node:lq.B.cloneWithEndModifier(this.#Y.node,a.toOperationNode())})}as(a){return new mf({...this.#Y,node:lq.B.cloneWith(this.#Y.node,{selectQuery:(0,me.YK)(a)})})}$call(a){return a(this)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}class mg{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}on(a){return new mg({...this.#Y,node:ls.cloneWith(this.#Y.node,{table:(0,lv.M$)(a)})})}ifExists(){return new mg({...this.#Y,node:ls.cloneWith(this.#Y.node,{ifExists:!0})})}cascade(){return new mg({...this.#Y,node:ls.cloneWith(this.#Y.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}class mh{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}ifExists(){return new mh({...this.#Y,node:lt.cloneWith(this.#Y.node,{ifExists:!0})})}cascade(){return new mh({...this.#Y,node:lt.cloneWith(this.#Y.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}class mi{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}ifExists(){return new mi({...this.#Y,node:lu.cloneWith(this.#Y.node,{ifExists:!0})})}cascade(){return new mi({...this.#Y,node:lu.cloneWith(this.#Y.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}var mj=c(19151),mk=c(88487);class ml{#Z=new mb;transformQuery(a){return this.#Z.transformNode(a.node,a.queryId)}transformResult(a){return Promise.resolve(a.result)}}class mm{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}temporary(){return new mm({...this.#Y,node:mk.Y.cloneWith(this.#Y.node,{temporary:!0})})}materialized(){return new mm({...this.#Y,node:mk.Y.cloneWith(this.#Y.node,{materialized:!0})})}ifNotExists(){return new mm({...this.#Y,node:mk.Y.cloneWith(this.#Y.node,{ifNotExists:!0})})}orReplace(){return new mm({...this.#Y,node:mk.Y.cloneWith(this.#Y.node,{orReplace:!0})})}columns(a){return new mm({...this.#Y,node:mk.Y.cloneWith(this.#Y.node,{columns:a.map(lF.RY)})})}as(a){let b=a.withPlugin(new ml).toOperationNode();return new mm({...this.#Y,node:mk.Y.cloneWith(this.#Y.node,{as:b})})}$call(a){return a(this)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}let mn=(0,kF.CN)({is:a=>"DropViewNode"===a.kind,create:a=>(0,kF.CN)({kind:"DropViewNode",name:lr.y.create(a)}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b})});class mo{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}materialized(){return new mo({...this.#Y,node:mn.cloneWith(this.#Y.node,{materialized:!0})})}ifExists(){return new mo({...this.#Y,node:mn.cloneWith(this.#Y.node,{ifExists:!0})})}cascade(){return new mo({...this.#Y,node:mn.cloneWith(this.#Y.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}let mp=(0,kF.CN)({is:a=>"CreateTypeNode"===a.kind,create:a=>(0,kF.CN)({kind:"CreateTypeNode",name:a}),cloneWithEnum:(a,b)=>(0,kF.CN)({...a,enum:ma.s.create(b.map(lH.q.createImmediate))})});class mq{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}asEnum(a){return new mq({...this.#Y,node:mp.cloneWithEnum(this.#Y.node,a)})}$call(a){return a(this)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}let mr=(0,kF.CN)({is:a=>"DropTypeNode"===a.kind,create:a=>(0,kF.CN)({kind:"DropTypeNode",name:a}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b})});class ms{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}ifExists(){return new ms({...this.#Y,node:mr.cloneWith(this.#Y.node,{ifExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}function mt(a){if(!a.includes("."))return lr.y.create(a);{let b=a.split(".").map(mu);if(2===b.length)return lr.y.createWithSchema(b[0],b[1]);throw Error(`invalid schemable identifier ${a}`)}}function mu(a){return a.trim()}let mv=(0,kF.CN)({is:a=>"RefreshMaterializedViewNode"===a.kind,create:a=>(0,kF.CN)({kind:"RefreshMaterializedViewNode",name:lr.y.create(a)}),cloneWith:(a,b)=>(0,kF.CN)({...a,...b})});class mw{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}concurrently(){return new mw({...this.#Y,node:mv.cloneWith(this.#Y.node,{concurrently:!0,withNoData:!1})})}withData(){return new mw({...this.#Y,node:mv.cloneWith(this.#Y.node,{withNoData:!1})})}withNoData(){return new mw({...this.#Y,node:mv.cloneWith(this.#Y.node,{withNoData:!0,concurrently:!1})})}$call(a){return a(this)}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.node,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){await this.#Y.executor.executeQuery(this.compile())}}class mx{#$;constructor(a){this.#$=a}createTable(a){return new mf({queryId:(0,kG.a)(),executor:this.#$,node:lq.B.create((0,lv.M$)(a))})}dropTable(a){return new mi({queryId:(0,kG.a)(),executor:this.#$,node:lu.create((0,lv.M$)(a))})}createIndex(a){return new mc({queryId:(0,kG.a)(),executor:this.#$,node:lo.create(a)})}dropIndex(a){return new mg({queryId:(0,kG.a)(),executor:this.#$,node:ls.create(a)})}createSchema(a){return new md({queryId:(0,kG.a)(),executor:this.#$,node:lp.create(a)})}dropSchema(a){return new mh({queryId:(0,kG.a)(),executor:this.#$,node:lt.create(a)})}alterTable(a){return new l5({queryId:(0,kG.a)(),executor:this.#$,node:ln.create((0,lv.M$)(a))})}createView(a){return new mm({queryId:(0,kG.a)(),executor:this.#$,node:mk.Y.create(a)})}refreshMaterializedView(a){return new mw({queryId:(0,kG.a)(),executor:this.#$,node:mv.create(a)})}dropView(a){return new mo({queryId:(0,kG.a)(),executor:this.#$,node:mn.create(a)})}createType(a){return new mq({queryId:(0,kG.a)(),executor:this.#$,node:mp.create(mt(a))})}dropType(a){return new ms({queryId:(0,kG.a)(),executor:this.#$,node:mr.create(mt(a))})}withPlugin(a){return new mx(this.#$.withPlugin(a))}withoutPlugins(){return new mx(this.#$.withoutPlugins())}withSchema(a){return new mx(this.#$.withPluginAtFront(new mj.B(a)))}}var my=c(27646),mz=c(20527);class mA{ref(a){return new my.g(a)}table(a){return new mz.bj(a)}}class mB{#_;constructor(a){this.#_=a}async provideConnection(a){let b=await this.#_.acquireConnection();try{return await a(b)}finally{await this.#_.releaseConnection(b)}}}var mC=c(65966),mD=c(12034);class mE extends mD.R{#aa;#ab;#ac;constructor(a,b,c,d=[]){super(d),this.#aa=a,this.#ab=b,this.#ac=c}get adapter(){return this.#ab}compileQuery(a,b){return this.#aa.compileQuery(a,b)}provideConnection(a){return this.#ac.provideConnection(a)}withPlugins(a){return new mE(this.#aa,this.#ab,this.#ac,[...this.plugins,...a])}withPlugin(a){return new mE(this.#aa,this.#ab,this.#ac,[...this.plugins,a])}withPluginAtFront(a){return new mE(this.#aa,this.#ab,this.#ac,[a,...this.plugins])}withConnectionProvider(a){return new mE(this.#aa,this.#ab,a,[...this.plugins])}withoutPlugins(){return new mE(this.#aa,this.#ab,this.#ac,[])}}function mF(){return"undefined"!=typeof performance&&(0,kF.Tn)(performance.now)?performance.now():Date.now()}class mG{#_;#ad;#ae;#af;#ag;#A=new WeakSet;constructor(a,b){this.#af=!1,this.#_=a,this.#ad=b}async init(){if(this.#ag)throw Error("driver has already been destroyed");this.#ae||(this.#ae=this.#_.init().then(()=>{this.#af=!0}).catch(a=>(this.#ae=void 0,Promise.reject(a)))),await this.#ae}async acquireConnection(){if(this.#ag)throw Error("driver has already been destroyed");this.#af||await this.init();let a=await this.#_.acquireConnection();return this.#A.has(a)||(this.#ah()&&this.#ai(a),this.#A.add(a)),a}async releaseConnection(a){await this.#_.releaseConnection(a)}beginTransaction(a,b){return this.#_.beginTransaction(a,b)}commitTransaction(a){return this.#_.commitTransaction(a)}rollbackTransaction(a){return this.#_.rollbackTransaction(a)}savepoint(a,b,c){if(this.#_.savepoint)return this.#_.savepoint(a,b,c);throw Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(a,b,c){if(this.#_.rollbackToSavepoint)return this.#_.rollbackToSavepoint(a,b,c);throw Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(a,b,c){if(this.#_.releaseSavepoint)return this.#_.releaseSavepoint(a,b,c);throw Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#ae&&(await this.#ae,this.#ag||(this.#ag=this.#_.destroy().catch(a=>(this.#ag=void 0,Promise.reject(a)))),await this.#ag)}#ah(){return this.#ad.isLevelEnabled("query")||this.#ad.isLevelEnabled("error")}#ai(a){let b=a.executeQuery,c=a.streamQuery,d=this;a.executeQuery=async c=>{let e,f=mF();try{return await b.call(a,c)}catch(a){throw e=a,await d.#aj(a,c,f),a}finally{e||await d.#ak(c,f)}},a.streamQuery=async function*(b,e){let f,g=mF();try{for await(let d of c.call(a,b,e))yield d}catch(a){throw f=a,await d.#aj(a,b,g),a}finally{f||await d.#ak(b,g,!0)}}}async #aj(a,b,c){await this.#ad.error(()=>({level:"error",error:a,query:b,queryDurationMillis:this.#al(c)}))}async #ak(a,b,c=!1){await this.#ad.query(()=>({level:"query",isStream:c,query:a,queryDurationMillis:this.#al(b)}))}#al(a){return mF()-a}}let mH=()=>{};class mI{#v;#am;constructor(a){this.#v=a}async provideConnection(a){for(;this.#am;)await this.#am.catch(mH);return this.#am=this.#an(a).finally(()=>{this.#am=void 0}),this.#am}async #an(a){return await a(this.#v)}}let mJ=["read only","read write"],mK=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function mL(a){if(a.accessMode&&!mJ.includes(a.accessMode))throw Error(`invalid transaction access mode ${a.accessMode}`);if(a.isolationLevel&&!mK.includes(a.isolationLevel))throw Error(`invalid transaction isolation level ${a.isolationLevel}`)}var mM=c(71644);(0,kF.CN)(["query","error"]);class mN{#ao;#ap;constructor(a){(0,kF.Tn)(a)?(this.#ap=a,this.#ao=(0,kF.CN)({query:!0,error:!0})):(this.#ap=mO,this.#ao=(0,kF.CN)({query:a.includes("query"),error:a.includes("error")}))}isLevelEnabled(a){return this.#ao[a]}async query(a){this.#ao.query&&await this.#ap(a())}async error(a){this.#ao.error&&await this.#ap(a())}}function mO(a){if("query"===a.level){let b=`kysely:query:${a.isStream?"stream:":""}`;console.log(`${b} ${a.query.sql}`),console.log(`${b} duration: ${a.queryDurationMillis.toFixed(1)}ms`)}else"error"===a.level&&(a.error instanceof Error?console.error(`kysely:error: ${a.error.stack??a.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:a.error,query:a.query.sql,queryDurationMillis:a.queryDurationMillis})}`))}var mP=c(61238),mQ=c(69079),mR=c(48137),mS=c(80234);Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class mT extends mC.n{#Y;constructor(a){let b,c;if(function(a){return(0,kF.Gv)(a)&&(0,kF.Gv)(a.config)&&(0,kF.Gv)(a.driver)&&(0,kF.Gv)(a.executor)&&(0,kF.Gv)(a.dialect)}(a))b={executor:a.executor},c={...a};else{let d=a.dialect,e=d.createDriver(),f=d.createQueryCompiler(),g=d.createAdapter(),h=new mG(e,new mN(a.log??[])),i=new mE(f,g,new mB(h),a.plugins??[]);b={executor:i},c={config:a,executor:i,dialect:d,driver:h}}super(b),this.#Y=(0,kF.CN)(c)}get schema(){return new mx(this.#Y.executor)}get dynamic(){return new mA}get introspection(){return this.#Y.dialect.createIntrospector(this.withoutPlugins())}case(a){return new mP.OU({node:mQ.P.create((0,kF.b0)(a)?void 0:(0,me.YK)(a))})}get fn(){return(0,mM.t)()}transaction(){return new mW({...this.#Y})}startTransaction(){return new mX({...this.#Y})}connection(){return new mV({...this.#Y})}withPlugin(a){return new mT({...this.#Y,executor:this.#Y.executor.withPlugin(a)})}withoutPlugins(){return new mT({...this.#Y,executor:this.#Y.executor.withoutPlugins()})}withSchema(a){return new mT({...this.#Y,executor:this.#Y.executor.withPluginAtFront(new mj.B(a))})}withTables(){return new mT({...this.#Y})}async destroy(){await this.#Y.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#Y.executor}executeQuery(a,b){void 0!==b&&(0,mS.u)("Passing `queryId` in `db.executeQuery` is deprecated and will result in a compile-time error in the future.");let c=(0,kF.Gv)(a)&&(0,kF.Tn)(a.compile)?a.compile():a;return this.getExecutor().executeQuery(c)}async [Symbol.asyncDispose](){await this.destroy()}}class mU extends mT{#Y;constructor(a){super(a),this.#Y=a}get isTransaction(){return!0}transaction(){throw Error("calling the transaction method for a Transaction is not supported")}connection(){throw Error("calling the connection method for a Transaction is not supported")}async destroy(){throw Error("calling the destroy method for a Transaction is not supported")}withPlugin(a){return new mU({...this.#Y,executor:this.#Y.executor.withPlugin(a)})}withoutPlugins(){return new mU({...this.#Y,executor:this.#Y.executor.withoutPlugins()})}withSchema(a){return new mU({...this.#Y,executor:this.#Y.executor.withPluginAtFront(new mj.B(a))})}withTables(){return new mU({...this.#Y})}}class mV{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}async execute(a){return this.#Y.executor.provideConnection(async b=>{let c=this.#Y.executor.withConnectionProvider(new mI(b)),d=new mT({...this.#Y,executor:c});return await a(d)})}}class mW{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}setAccessMode(a){return new mW({...this.#Y,accessMode:a})}setIsolationLevel(a){return new mW({...this.#Y,isolationLevel:a})}async execute(a){let{isolationLevel:b,accessMode:c,...d}=this.#Y,e={isolationLevel:b,accessMode:c};return mL(e),this.#Y.executor.provideConnection(async b=>{let c=this.#Y.executor.withConnectionProvider(new mI(b)),f=new mU({...d,executor:c}),g=!1;try{await this.#Y.driver.beginTransaction(b,e),g=!0;let c=await a(f);return await this.#Y.driver.commitTransaction(b),c}catch(a){throw g&&await this.#Y.driver.rollbackTransaction(b),a}})}}class mX{#Y;constructor(a){this.#Y=(0,kF.CN)(a)}setAccessMode(a){return new mX({...this.#Y,accessMode:a})}setIsolationLevel(a){return new mX({...this.#Y,isolationLevel:a})}async execute(){let{isolationLevel:a,accessMode:b,...c}=this.#Y,d={isolationLevel:a,accessMode:b};mL(d);let e=await (0,mR.G)(this.#Y.executor);return await this.#Y.driver.beginTransaction(e.connection,d),new mY({...c,connection:e,executor:this.#Y.executor.withConnectionProvider(new mI(e.connection))})}}class mY extends mU{#Y;#aq;#ar;constructor(a){let b={isCommitted:!1,isRolledBack:!1},{connection:c,...d}=a={...a,executor:new m_(a.executor,b)};super(d),this.#Y=(0,kF.CN)(a),this.#ar=b;let e=(0,kG.a)();this.#aq=b=>a.executor.compileQuery(b,e)}get isCommitted(){return this.#ar.isCommitted}get isRolledBack(){return this.#ar.isRolledBack}commit(){return m$(this.#ar),new mZ(async()=>{await this.#Y.driver.commitTransaction(this.#Y.connection.connection),this.#ar.isCommitted=!0,this.#Y.connection.release()})}rollback(){return m$(this.#ar),new mZ(async()=>{await this.#Y.driver.rollbackTransaction(this.#Y.connection.connection),this.#ar.isRolledBack=!0,this.#Y.connection.release()})}savepoint(a){return m$(this.#ar),new mZ(async()=>(await this.#Y.driver.savepoint?.(this.#Y.connection.connection,a,this.#aq),new mY({...this.#Y})))}rollbackToSavepoint(a){return m$(this.#ar),new mZ(async()=>(await this.#Y.driver.rollbackToSavepoint?.(this.#Y.connection.connection,a,this.#aq),new mY({...this.#Y})))}releaseSavepoint(a){return m$(this.#ar),new mZ(async()=>(await this.#Y.driver.releaseSavepoint?.(this.#Y.connection.connection,a,this.#aq),new mY({...this.#Y})))}withPlugin(a){return new mY({...this.#Y,executor:this.#Y.executor.withPlugin(a)})}withoutPlugins(){return new mY({...this.#Y,executor:this.#Y.executor.withoutPlugins()})}withSchema(a){return new mY({...this.#Y,executor:this.#Y.executor.withPluginAtFront(new mj.B(a))})}withTables(){return new mY({...this.#Y})}}class mZ{#as;constructor(a){this.#as=a}async execute(){return await this.#as()}}function m$(a){if(a.isCommitted)throw Error("Transaction is already committed");if(a.isRolledBack)throw Error("Transaction is already rolled back")}class m_{#$;#ar;constructor(a,b){a instanceof m_?this.#$=a.#$:this.#$=a,this.#ar=b}get adapter(){return this.#$.adapter}get plugins(){return this.#$.plugins}transformQuery(a,b){return this.#$.transformQuery(a,b)}compileQuery(a,b){return this.#$.compileQuery(a,b)}provideConnection(a){return this.#$.provideConnection(a)}executeQuery(a){return m$(this.#ar),this.#$.executeQuery(a)}stream(a,b){return m$(this.#ar),this.#$.stream(a,b)}withConnectionProvider(a){return new m_(this.#$.withConnectionProvider(a),this.#ar)}withPlugin(a){return new m_(this.#$.withPlugin(a),this.#ar)}withPlugins(a){return new m_(this.#$.withPlugins(a),this.#ar)}withPluginAtFront(a){return new m_(this.#$.withPluginAtFront(a),this.#ar)}withoutPlugins(){return new m_(this.#$.withoutPlugins(),this.#ar)}}let m0=[],m1=-1,m2={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",fg:{yellow:"\x1b[33m",magenta:"\x1b[35m"},bg:{black:"\x1b[40m"}},m3=({adapter:a,config:b})=>c=>{let d={...b,supportsBooleans:b.supportsBooleans??!0,supportsDates:b.supportsDates??!0,supportsJSON:b.supportsJSON??!1,adapterName:b.adapterName??b.adapterId,supportsNumericIds:b.supportsNumericIds??!0,transaction:b.transaction??!1};if(c.advanced?.database?.useNumberId===!0&&!1===d.supportsNumericIds)throw Error(`[${d.adapterName}] Your database or database adapter does not support numeric ids. Please disable "useNumberId" in your config.`);let e=kz(c),f=({field:a,model:b})=>{if("id"===a||"_id"===a)return"id";let c=g(b),d=e[c]?.fields[a];if(d||(d=Object.values(e[c]?.fields).find(b=>b.fieldName===a)),!d)throw j(`Field ${a} not found in model ${c}`),j("Schema:",e),Error(`Field ${a} not found in model ${c}`);return a},g=a=>{if(d.usePlural&&"s"===a.charAt(a.length-1)){let b=a.slice(0,-1),c=e[b]?b:void 0;if(c||(c=Object.entries(e).find(([a,c])=>c.modelName===b)?.[0]),c)return c}let b=e[a]?a:void 0;if(b||(b=Object.entries(e).find(([b,c])=>c.modelName===a)?.[0]),!b)throw j(`Model "${a}" not found in schema`),j("Schema:",e),Error(`Model "${a}" not found in schema`);return b},h=a=>{let b=g(a),c=d&&d.usePlural;return e&&e[b]&&e[b].modelName!==a?c?`${e[b].modelName}s`:e[b].modelName:c?`${a}s`:a};function i({model:a,field:b}){let c=g(a),d=f({model:c,field:b});return e[c]?.fields[d]?.fieldName||d}let j=(...a)=>{if(!0===d.debugLogs||"object"==typeof d.debugLogs){if("object"==typeof d.debugLogs&&"isRunningAdapterTests"in d.debugLogs){d.debugLogs.isRunningAdapterTests&&(a.shift(),m0.push(a));return}if("object"!=typeof d.debugLogs||!d.debugLogs.logCondition||d.debugLogs.logCondition?.())if("object"==typeof a[0]&&"method"in a[0]){let b=a.shift().method;if("object"==typeof d.debugLogs){if("create"===b&&!d.debugLogs.create)return;else if("update"===b&&!d.debugLogs.update)return;else if("updateMany"===b&&!d.debugLogs.updateMany)return;else if("findOne"===b&&!d.debugLogs.findOne)return;else if("findMany"===b&&!d.debugLogs.findMany)return;else if("delete"===b&&!d.debugLogs.delete)return;else if("deleteMany"===b&&!d.debugLogs.deleteMany)return;else if("count"===b&&!d.debugLogs.count)return}gq.info(`[${d.adapterName}]`,...a)}else gq.info(`[${d.adapterName}]`,...a)}},k=({customModelName:a,forceAllowId:b})=>{let e=!d.disableIdGeneration&&!c.advanced?.database?.useNumberId&&!b,f=g(a??"id");return{type:c.advanced?.database?.useNumberId?"number":"string",required:!!e,...e?{defaultValue(){if(d.disableIdGeneration)return;let a=c.advanced?.database?.useNumberId,b=c.advanced?.database?.generateId;if(c.advanced?.generateId!==void 0&&(gq.warn("Your Better Auth config includes advanced.generateId which is deprecated. Please use advanced.database.generateId instead. This will be removed in future releases."),b=c.advanced?.generateId),!1!==b&&!a)return b?b({model:f}):d.customIdGenerator?d.customIdGenerator({model:f}):jz()}}:{}}},l=({model:a,field:b})=>{let c=g(a),d=f({field:b,model:a}),h=e[c].fields;return h.id=k({customModelName:c}),h[d]},m=a({options:c,schema:e,debugLog:j,getFieldName:i,getModelName:h,getDefaultModelName:g,getDefaultFieldName:f,getFieldAttributes:l}),n=async(a,b,f,g)=>{let h={},i=e[b].fields,j=d.mapKeysTransformInput??{};for(let l in d.disableIdGeneration||c.advanced?.database?.useNumberId||(i.id=k({customModelName:b,forceAllowId:g&&"id"in a})),i){let g=a[l],k=i[l],m=j[l]||i[l].fieldName||l;if(void 0===g&&(void 0===k.defaultValue&&!k.transform?.input&&!("update"===f&&k.onUpdate)||"update"===f&&!k.onUpdate))continue;let n=function(a,b,c){if("update"===c)return void 0===a&&void 0!==b.onUpdate?"function"==typeof b.onUpdate?b.onUpdate():b.onUpdate:a;return null==a&&void 0!==b.defaultValue?"function"==typeof b.defaultValue?b.defaultValue():b.defaultValue:a}(g,k,f);k.transform?.input&&(n=await k.transform.input(n)),k.references?.field==="id"&&c.advanced?.database?.useNumberId?n=Array.isArray(n)?n.map(Number):Number(n):!1===d.supportsJSON&&"object"==typeof n&&"json"===k.type?n=JSON.stringify(n):!1===d.supportsDates&&n instanceof Date&&"date"===k.type?n=n.toISOString():!1===d.supportsBooleans&&"boolean"==typeof n&&(n=+!!n),d.customTransformInput&&(n=d.customTransformInput({data:n,action:f,field:m,fieldAttributes:k,model:b,schema:e,options:c})),void 0!==n&&(h[m]=n)}return h},o=async(a,b,f=[])=>{if(!a)return null;let g=d.mapKeysTransformOutput??{},h={},i=e[b].fields;for(let j in i[Object.entries(g).find(([a,b])=>"id"===b)?.[0]??"id"]={type:c.advanced?.database?.useNumberId?"number":"string"},i){if(f.length&&!f.includes(j))continue;let k=i[j];if(k){let i=k.fieldName||j,l=a[Object.entries(g).find(([a,b])=>b===i)?.[0]||i];k.transform?.output&&(l=await k.transform.output(l));let m=g[j]||j;"id"===i||k.references?.field==="id"?null!=l&&(l=String(l)):!1===d.supportsJSON&&"string"==typeof l&&"json"===k.type?l=gr(l):!1===d.supportsDates&&"string"==typeof l&&"date"===k.type?l=new Date(l):!1===d.supportsBooleans&&"number"==typeof l&&"boolean"===k.type&&(l=1===l),d.customTransformOutput&&(l=d.customTransformOutput({data:l,field:m,fieldAttributes:k,select:f,model:b,schema:e,options:c})),h[m]=l}}return h},p=({model:a,where:b})=>{if(!b)return;let e=d.mapKeysTransformInput??{};return b.map(b=>{let{field:d,value:h,operator:j="eq",connector:k="AND"}=b;if("in"===j&&!Array.isArray(h))throw Error("Value must be an array");let m=g(a),n=f({field:d,model:a}),o=e[n]||i({field:n,model:m}),p=l({field:n,model:m});return("id"===n||p.references?.field==="id")&&c.advanced?.database?.useNumberId?Array.isArray(h)?{operator:j,connector:k,field:o,value:h.map(Number)}:{operator:j,connector:k,field:o,value:Number(h)}:{operator:j,connector:k,field:o,value:h}})},q=null,r={transaction:async a=>{if(!q)if(d.transaction)gq.debug(`[${d.adapterName}] - Using provided transaction implementation.`),q=d.transaction;else gq.warn(`[${d.adapterName}] - Transactions are not supported. Executing operations sequentially.`),q=a=>a(r);return q(a)},create:async({data:a,model:b,select:c,forceAllowId:e=!1})=>{let f=++m1,g=h(b);if("id"in a&&!e){gq.warn(`[${d.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \`forceAllowId\` parameter. The id will be ignored.`);let b=Error();console.log(b.stack?.split("\n").filter((a,b)=>1!==b).join("\n").replace("Error:","Create method with `id` being called at:")),a.id=void 0}j({method:"create"},`${m4(f)} ${m5(1,4)}`,`${m6("create")} ${m7("Unsafe Input")}:`,{model:g,data:a});let i=await n(a,b,"create",e);j({method:"create"},`${m4(f)} ${m5(2,4)}`,`${m6("create")} ${m7("Parsed Input")}:`,{model:g,data:i});let k=await m.create({data:i,model:g});j({method:"create"},`${m4(f)} ${m5(3,4)}`,`${m6("create")} ${m7("DB Result")}:`,{model:g,res:k});let l=await o(k,b,c);return j({method:"create"},`${m4(f)} ${m5(4,4)}`,`${m6("create")} ${m7("Parsed Result")}:`,{model:g,data:l}),l},update:async({model:a,where:b,update:c})=>{let d=++m1,e=h(a),f=p({model:a,where:b});j({method:"update"},`${m4(d)} ${m5(1,4)}`,`${m6("update")} ${m7("Unsafe Input")}:`,{model:e,data:c});let g=await n(c,a,"update");j({method:"update"},`${m4(d)} ${m5(2,4)}`,`${m6("update")} ${m7("Parsed Input")}:`,{model:e,data:g});let i=await m.update({model:e,where:f,update:g});j({method:"update"},`${m4(d)} ${m5(3,4)}`,`${m6("update")} ${m7("DB Result")}:`,{model:e,data:i});let k=await o(i,a);return j({method:"update"},`${m4(d)} ${m5(4,4)}`,`${m6("update")} ${m7("Parsed Result")}:`,{model:e,data:k}),k},updateMany:async({model:a,where:b,update:c})=>{let d=++m1,e=h(a),f=p({model:a,where:b});j({method:"updateMany"},`${m4(d)} ${m5(1,4)}`,`${m6("updateMany")} ${m7("Unsafe Input")}:`,{model:e,data:c});let g=await n(c,a,"update");j({method:"updateMany"},`${m4(d)} ${m5(2,4)}`,`${m6("updateMany")} ${m7("Parsed Input")}:`,{model:e,data:g});let i=await m.updateMany({model:e,where:f,update:g});return j({method:"updateMany"},`${m4(d)} ${m5(3,4)}`,`${m6("updateMany")} ${m7("DB Result")}:`,{model:e,data:i}),j({method:"updateMany"},`${m4(d)} ${m5(4,4)}`,`${m6("updateMany")} ${m7("Parsed Result")}:`,{model:e,data:i}),i},findOne:async({model:a,where:b,select:c})=>{let d=++m1,e=h(a),f=p({model:a,where:b});j({method:"findOne"},`${m4(d)} ${m5(1,3)}`,`${m6("findOne")}:`,{model:e,where:f,select:c});let g=await m.findOne({model:e,where:f,select:c});j({method:"findOne"},`${m4(d)} ${m5(2,3)}`,`${m6("findOne")} ${m7("DB Result")}:`,{model:e,data:g});let i=await o(g,a,c);return j({method:"findOne"},`${m4(d)} ${m5(3,3)}`,`${m6("findOne")} ${m7("Parsed Result")}:`,{model:e,data:i}),i},findMany:async({model:a,where:b,limit:d,sortBy:e,offset:f})=>{let g=++m1,i=d??c.advanced?.database?.defaultFindManyLimit??100,k=h(a),l=p({model:a,where:b});j({method:"findMany"},`${m4(g)} ${m5(1,3)}`,`${m6("findMany")}:`,{model:k,where:l,limit:i,sortBy:e,offset:f});let n=await m.findMany({model:k,where:l,limit:i,sortBy:e,offset:f});j({method:"findMany"},`${m4(g)} ${m5(2,3)}`,`${m6("findMany")} ${m7("DB Result")}:`,{model:k,data:n});let q=await Promise.all(n.map(async b=>await o(b,a)));return j({method:"findMany"},`${m4(g)} ${m5(3,3)}`,`${m6("findMany")} ${m7("Parsed Result")}:`,{model:k,data:q}),q},delete:async({model:a,where:b})=>{let c=++m1,d=h(a),e=p({model:a,where:b});j({method:"delete"},`${m4(c)} ${m5(1,2)}`,`${m6("delete")}:`,{model:d,where:e}),await m.delete({model:d,where:e}),j({method:"delete"},`${m4(c)} ${m5(2,2)}`,`${m6("delete")} ${m7("DB Result")}:`,{model:d})},deleteMany:async({model:a,where:b})=>{let c=++m1,d=h(a),e=p({model:a,where:b});j({method:"deleteMany"},`${m4(c)} ${m5(1,2)}`,`${m6("deleteMany")} ${m7("DeleteMany")}:`,{model:d,where:e});let f=await m.deleteMany({model:d,where:e});return j({method:"deleteMany"},`${m4(c)} ${m5(2,2)}`,`${m6("deleteMany")} ${m7("DB Result")}:`,{model:d,data:f}),f},count:async({model:a,where:b})=>{let c=++m1,d=h(a),e=p({model:a,where:b});j({method:"count"},`${m4(c)} ${m5(1,2)}`,`${m6("count")}:`,{model:d,where:e});let f=await m.count({model:d,where:e});return j({method:"count"},`${m4(c)} ${m5(2,2)}`,`${m6("count")}:`,{model:d,data:f}),f},createSchema:m.createSchema?async(a,b)=>{let d=kz(c);return c.secondaryStorage&&!c.session?.storeSessionInDatabase&&delete d.session,c.rateLimit&&"database"===c.rateLimit.storage&&(void 0===c.rateLimit.enabled||!0===c.rateLimit.enabled)&&(d.ratelimit={modelName:c.rateLimit.modelName??"ratelimit",fields:{key:{type:"string",unique:!0,required:!0,fieldName:c.rateLimit.fields?.key??"key"},count:{type:"number",required:!0,fieldName:c.rateLimit.fields?.count??"count"},lastRequest:{type:"number",required:!0,bigint:!0,defaultValue:()=>Date.now(),fieldName:c.rateLimit.fields?.lastRequest??"lastRequest"}}}),m.createSchema({file:b,tables:d})}:void 0,options:{adapterConfig:d,...m.options??{}},id:d.adapterId,...d.debugLogs?.isRunningAdapterTests?{adapterTestDebugLogs:{resetDebugLogs(){m0=[]},printDebugLogs(){let a=`\u2500`.repeat(80);console.log(...m0.reverse().map(a=>(a[0]=`
${a[0]}`,[...a,"\n"])).reduce((a,b)=>[...b,...a],[`
${a}`]))}}}:{}};return r};function m4(a){return`${m2.fg.magenta}#${a}${m2.reset}`}function m5(a,b){return`${m2.bg.black}${m2.fg.yellow}[${a}/${b}]${m2.reset}`}function m6(a){return`${m2.bright}${a}${m2.reset}`}function m7(a){return`${m2.dim}(${a})${m2.reset}`}function m8(a){if(!a)return null;if("dialect"in a)return m8(a.dialect);if("createDriver"in a){if(a instanceof kS)return"sqlite";if(a instanceof k0)return"mysql";if(a instanceof k9)return"postgres";if(a instanceof lm)return"mssql"}return"aggregate"in a?"sqlite":"getConnection"in a?"mysql":"connect"in a?"postgres":"fileControl"in a||"open"in a&&"close"in a&&"prepare"in a?"sqlite":null}let m9=async a=>{let b,d=a.database;if(!d)return{kysely:null,databaseType:null,transaction:void 0};if("db"in d)return{kysely:d.db,databaseType:d.type,transaction:d.transaction};if("dialect"in d)return{kysely:new mT({dialect:d.dialect}),databaseType:d.type,transaction:d.transaction};let e=m8(d);if("createDriver"in d&&(b=d),"aggregate"in d&&!("createSession"in d)&&(b=new kS({database:d})),"getConnection"in d&&(b=new k0(d)),"connect"in d&&(b=new k9({pool:d})),"fileControl"in d){let{BunSqliteDialect:a}=await c.e(1684).then(c.bind(c,31684));b=new a({database:d})}if("createSession"in d&&"undefined"==typeof window){let a;try{({DatabaseSync:a}=await import("node:sqlite"))}catch(a){if(null!==a&&"object"==typeof a&&"code"in a&&"ERR_UNKNOWN_BUILTIN_MODULE"!==a.code)throw a}if(a&&d instanceof a){let{NodeSqliteDialect:a}=await c.e(2991).then(c.bind(c,62991));b=new a({database:d})}}return{kysely:b?new mT({dialect:b}):null,databaseType:e,transaction:void 0}},na=(a,b)=>{let c=b.logger,d=b.options,e=d.secondaryStorage,f=d.session?.expiresIn||604800,{createWithHooks:g,updateWithHooks:h,updateManyWithHooks:i}=function(a,b){let c=b.hooks;return{createWithHooks:async function(b,d,e,f,g){let h=b;for(let a of c||[]){let b=a[d]?.create?.before;if(b){let a=await b(h,f);if(!1===a)return null;"object"==typeof a&&"data"in a&&(h={...h,...a.data})}}let i=e?await e.fn(h):null,j=!e||e.executeMainFn?await (g||a).create({model:d,data:h,forceAllowId:!0}):i;for(let a of c||[]){let b=a[d]?.create?.after;b&&await b(j,f)}return j},updateWithHooks:async function(b,d,e,f,g,h){let i=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;i="object"==typeof a?a.data:a}}let j=f?await f.fn(i):null,k=!f||f.executeMainFn?await (h||a).update({model:e,update:i,where:d}):j;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(k,g)}return k},updateManyWithHooks:async function(b,d,e,f,g,h){let i=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;i="object"==typeof a?a.data:a}}let j=f?await f.fn(i):null,k=!f||f.executeMainFn?await (h||a).updateMany({model:e,update:i,where:d}):j;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(k,g)}return k}}}(a,b);async function j(a){if(!e)return;let b=await e.get(`active-sessions-${a.id}`);if(!b)return;let c=Date.now(),d=(gr(b)||[]).filter(a=>a.expiresAt>c);await Promise.all(d.map(async({token:b})=>{let d=await e.get(b);if(!d)return;let f=gr(d);if(!f)return;let g=Math.max(Math.floor((new Date(f.session.expiresAt).getTime()-c)/1e3),0);await e.set(b,JSON.stringify({session:f.session,user:a}),g)}))}return{createOAuthUser:async(b,c,d)=>a.transaction(async a=>{let e=await g({createdAt:new Date,updatedAt:new Date,...b},"user",void 0,d,a),f=await g({...c,userId:e.id,createdAt:new Date,updatedAt:new Date},"account",void 0,d,a);return{user:e,account:f}}),createUser:async(a,b,c)=>await g({createdAt:new Date,updatedAt:new Date,...a,email:a.email?.toLowerCase()},"user",void 0,b,c),createAccount:async(a,b,c)=>await g({createdAt:new Date,updatedAt:new Date,...a},"account",void 0,b,c),listSessions:async(c,d)=>{if(e){let a=await e.get(`active-sessions-${c}`);if(!a)return[];let d=gr(a)||[],f=Date.now(),g=d.filter(a=>a.expiresAt>f),h=[];for(let a of g){let c=await e.get(a.token);if(c){let a=gr(c);if(!a)return[];let d=jE(b.options,{...a.session,expiresAt:new Date(a.session.expiresAt)});h.push(d)}}return h}return await (d||a).findMany({model:"session",where:[{field:"userId",value:c}]})},listUsers:async(b,c,d,e,f)=>await (f||a).findMany({model:"user",limit:b,offset:c,sortBy:d,where:e}),countTotalUsers:async(b,c)=>{let d=await (c||a).count({model:"user",where:b});return"string"==typeof d?parseInt(d):d},deleteUser:async(b,c)=>{e&&await e.delete(`active-sessions-${b}`),(!e||d.session?.storeSessionInDatabase)&&await (c||a).deleteMany({model:"session",where:[{field:"userId",value:b}]}),await (c||a).deleteMany({model:"account",where:[{field:"userId",value:b}]}),await (c||a).delete({model:"user",where:[{field:"id",value:b}]})},createSession:async(b,c,h,i,j,k)=>{let l=c.headers||c.request?.headers,{id:m,...n}=i||{},o={ipAddress:(c.request||c.headers)&&kv(c.request||c.headers,c.context.options)||"",userAgent:l?.get("user-agent")||"",...n,expiresAt:h?f_(86400,"sec"):f_(f,"sec"),userId:b,token:jz(32),createdAt:new Date,updatedAt:new Date,...j?n:{}};return await g(o,"session",e?{fn:async c=>{let d=await e.get(`active-sessions-${b}`),f=[],g=Date.now();d&&(f=(f=gr(d)||[]).filter(a=>a.expiresAt>g));let h=f.sort((a,b)=>a.expiresAt-b.expiresAt),i=h.at(-1)?.expiresAt;h.push({token:o.token,expiresAt:o.expiresAt.getTime()}),(!i||i<o.expiresAt.getTime())&&(i=o.expiresAt.getTime());let j=Math.max(Math.floor((i-g)/1e3),0);j>0&&await e.set(`active-sessions-${b}`,JSON.stringify(h),j);let k=await a.findOne({model:"user",where:[{field:"id",value:b}]}),l=Math.max(Math.floor((o.expiresAt.getTime()-g)/1e3),0);return l>0&&await e.set(o.token,JSON.stringify({session:c,user:k}),l),c},executeMainFn:d.session?.storeSessionInDatabase}:void 0,c,k)},findSession:async(c,f)=>{if(e){let a=await e.get(c);if(!a&&!d.session?.storeSessionInDatabase)return null;if(a){let c=gr(a);return c?{session:jE(b.options,{...c.session,expiresAt:new Date(c.session.expiresAt),createdAt:new Date(c.session.createdAt),updatedAt:new Date(c.session.updatedAt)}),user:jD(b.options,{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)})}:null}}let g=await (f||a).findOne({model:"session",where:[{value:c,field:"token"}]});if(!g)return null;let h=await (f||a).findOne({model:"user",where:[{value:g.userId,field:"id"}]});return h?{session:jE(b.options,g),user:jD(b.options,h)}:null},findSessions:async(b,c)=>{if(e){let a=[];for(let c of b){let b=await e.get(c);if(b){let c=gr(b);if(!c)return[];let d={session:{...c.session,expiresAt:new Date(c.session.expiresAt)},user:{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)}};a.push(d)}}return a}let d=await (c||a).findMany({model:"session",where:[{field:"token",value:b,operator:"in"}]}),f=d.map(a=>a.userId);if(!f.length)return[];let g=await (c||a).findMany({model:"user",where:[{field:"id",value:f,operator:"in"}]});return d.map(a=>{let b=g.find(b=>b.id===a.userId);return b?{session:a,user:b}:null})},updateSession:async(a,b,c,f)=>await h(b,[{field:"token",value:a}],"session",e?{async fn(b){let c=await e.get(a);if(!c)return null;{let a=gr(c);return a?{...a.session,...b}:null}},executeMainFn:d.session?.storeSessionInDatabase}:void 0,c,f),deleteSession:async(f,g)=>{if(e){let a=await e.get(f);if(a){let{session:b}=gr(a)??{};if(!b)return void c.error("Session not found in secondary storage");let d=b.userId,g=await e.get(`active-sessions-${d}`);if(g){let a=gr(g)||[],b=Date.now(),c=a.filter(a=>a.expiresAt>b&&a.token!==f),h=c.sort((a,b)=>a.expiresAt-b.expiresAt),i=h.at(-1)?.expiresAt;c.length>0&&i&&i>Date.now()?await e.set(`active-sessions-${d}`,JSON.stringify(c),Math.floor((i-b)/1e3)):await e.delete(`active-sessions-${d}`)}else c.error("Active sessions list not found in secondary storage")}if(await e.delete(f),!d.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await (g||a).delete({model:"session",where:[{field:"token",value:f}]})},deleteAccounts:async(b,c)=>{await (c||a).deleteMany({model:"account",where:[{field:"userId",value:b}]})},deleteAccount:async(b,c)=>{await (c||a).delete({model:"account",where:[{field:"id",value:b}]})},deleteSessions:async(c,f)=>{if(e){if("string"==typeof c){let a=await e.get(`active-sessions-${c}`),b=a?gr(a):[];if(!b)return;for(let a of b)await e.delete(a.token)}else for(let a of c)await e.get(a)&&await e.delete(a);if(!d.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await (f||a).deleteMany({model:"session",where:[{field:Array.isArray(c)?"token":"userId",value:c,operator:Array.isArray(c)?"in":void 0}]})},findOAuthUser:async(b,c,d,e)=>{let f=await (e||a).findMany({model:"account",where:[{value:c,field:"accountId"}]}).then(a=>a.find(a=>a.providerId===d));if(f){let c=await (e||a).findOne({model:"user",where:[{value:f.userId,field:"id"}]});if(c)return{user:c,accounts:[f]};{let c=await (e||a).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});return c?{user:c,accounts:[f]}:null}}{let c=await (e||a).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});if(!c)return null;{let b=await (e||a).findMany({model:"account",where:[{value:c.id,field:"userId"}]});return{user:c,accounts:b||[]}}}},findUserByEmail:async(b,c,d)=>{let e=await (d||a).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});if(!e)return null;if(c?.includeAccounts){let b=await (d||a).findMany({model:"account",where:[{value:e.id,field:"userId"}]});return{user:e,accounts:b}}return{user:e,accounts:[]}},findUserById:async(b,c)=>await (c||a).findOne({model:"user",where:[{field:"id",value:b}]}),linkAccount:async(a,b,c)=>await g({createdAt:new Date,updatedAt:new Date,...a},"account",void 0,b,c),updateUser:async(a,b,c,d)=>{let e=await h(b,[{field:"id",value:a}],"user",void 0,c,d);return await j(e),e},updateUserByEmail:async(a,b,c,d)=>{let e=await h(b,[{field:"email",value:a.toLowerCase()}],"user",void 0,c,d);return await j(e),e},updatePassword:async(a,b,c,d)=>{await i({password:b},[{field:"userId",value:a},{field:"providerId",value:"credential"}],"account",void 0,c,d)},findAccounts:async(b,c)=>await (c||a).findMany({model:"account",where:[{field:"userId",value:b}]}),findAccount:async(b,c)=>await (c||a).findOne({model:"account",where:[{field:"accountId",value:b}]}),findAccountByProviderId:async(b,c,d)=>await (d||a).findOne({model:"account",where:[{field:"accountId",value:b},{field:"providerId",value:c}]}),findAccountByUserId:async(b,c)=>await (c||a).findMany({model:"account",where:[{field:"userId",value:b}]}),updateAccount:async(a,b,c,d)=>await h(b,[{field:"id",value:a}],"account",void 0,c,d),createVerificationValue:async(a,b,c)=>await g({createdAt:new Date,updatedAt:new Date,...a},"verification",void 0,b,c),findVerificationValue:async(b,c)=>{let e=await (c||a).findMany({model:"verification",where:[{field:"identifier",value:b}],sortBy:{field:"createdAt",direction:"desc"},limit:1});return d.verification?.disableCleanup||await (c||a).deleteMany({model:"verification",where:[{field:"expiresAt",value:new Date,operator:"lt"}]}),e[0]},deleteVerificationValue:async(b,c)=>{await (c||a).delete({model:"verification",where:[{field:"id",value:b}]})},deleteVerificationByIdentifier:async(b,c)=>{await (c||a).delete({model:"verification",where:[{field:"identifier",value:b}]})},updateVerificationValue:async(a,b,c,d)=>await h(b,[{field:"id",value:a}],"verification",void 0,c,d)}};async function nb(a){if(!a.database){var b;let c,d,e=Object.keys(kz(a)).reduce((a,b)=>(a[b]=[],a),{});return gq.warn("No database configuration provided. Using memory adapter in development"),(c=null,d=m3({config:{adapterId:"memory",adapterName:"Memory Adapter",usePlural:!1,debugLogs:b?.debugLogs||!1,customTransformInput:a=>a.options.advanced?.database?.useNumberId&&"id"===a.field&&"create"===a.action?e[a.model].length+1:a.data,transaction:async a=>{let b=structuredClone(e);try{return a(d(c))}catch{throw Object.keys(e).forEach(a=>{e[a]=b[a]}),Error("Transaction failed, rolling back changes")}}},adapter:({getFieldName:a,options:b,debugLog:c})=>{function d(a,b){let c=e[b];if(!c)throw gq.error(`[MemoryAdapter] Model ${b} not found in the DB`,Object.keys(e)),Error(`Model ${b} not found`);let d=(a,b)=>{let{field:c,value:d,operator:e}=b;switch(e){case"in":if(!Array.isArray(d))throw Error("Value must be an array");return d.includes(a[c]);case"not_in":if(!Array.isArray(d))throw Error("Value must be an array");return!d.includes(a[c]);case"contains":return a[c].includes(d);case"starts_with":return a[c].startsWith(d);case"ends_with":return a[c].endsWith(d);default:return a[c]===d}};return c.filter(b=>{if(!a.length||0===a.length)return!0;let c=d(b,a[0]);for(let e of a){let a=d(b,e);c="OR"===e.connector?c||a:c&&a}return c})}return{create:async({model:a,data:c})=>(b.advanced?.database?.useNumberId&&(c.id=e[a].length+1),e[a]||(e[a]=[]),e[a].push(c),c),findOne:async({model:a,where:b})=>d(b,a)[0]||null,findMany:async({model:b,where:c,sortBy:f,limit:g,offset:h})=>{let i=e[b];return c&&(i=d(c,b)),f&&(i=i.sort((c,d)=>{let e=a({model:b,field:f.field});return"asc"===f.direction?c[e]>d[e]?1:-1:c[e]<d[e]?1:-1})),void 0!==h&&(i=i.slice(h)),void 0!==g&&(i=i.slice(0,g)),i||[]},count:async({model:a})=>e[a].length,update:async({model:a,where:b,update:c})=>{let e=d(b,a);return e.forEach(a=>{Object.assign(a,c)}),e[0]||null},delete:async({model:a,where:b})=>{let c=e[a],f=d(b,a);e[a]=c.filter(a=>!f.includes(a))},deleteMany:async({model:a,where:b})=>{let c=e[a],f=d(b,a),g=0;return e[a]=c.filter(a=>f.includes(a)?(g++,!1):!f.includes(a)),g},updateMany({model:a,where:b,update:c}){let e=d(b,a);return e.forEach(a=>{Object.assign(a,c)}),e[0]||null}}}}),a=>(c=a,d(a)))(a)}if("function"==typeof a.database)return a.database(a);let{kysely:c,databaseType:d,transaction:e}=await m9(a);if(!c)throw new f0("Failed to initialize database adapter");return((a,b)=>{let c=null,d=a=>({getFieldName:c,schema:d})=>{let e=async(d,e,f,g)=>{if(b?.type==="mysql"){await e.execute();let b=d.id?"id":g.length>0&&g[0]?.field?g[0].field:"id";if(!d.id&&0===g.length)return await a.selectFrom(f).selectAll().orderBy(c({model:f,field:b}),"desc").limit(1).executeTakeFirst();let h=d[b]||g[0]?.value;return await a.selectFrom(f).selectAll().orderBy(c({model:f,field:b}),"desc").where(c({model:f,field:b}),"=",h).limit(1).executeTakeFirst()}return b?.type==="mssql"?await e.outputAll("inserted").executeTakeFirst():await e.returningAll().executeTakeFirst()};function f(a){function c(a){for(let d in a){if(!Object.prototype.hasOwnProperty.call(a,d))continue;let e=a[d];if(e instanceof Date&&b?.type==="mysql")a[d]=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));else"object"==typeof e&&null!==e&&c(e)}}if(Array.isArray(a))for(let b=0;b<a.length;b++){let d=a[b];"object"==typeof d&&null!==d&&c(d)}else"object"==typeof a&&null!==a&&c(a);return a}function g(a,e){if(!e)return{and:null,or:null};let f=[],g=[];return e.forEach(e=>{let{field:h,value:i,operator:j="=",connector:k="AND"}=e,l=c({model:a,field:h});i=function(a,c,e){if("id"===e)return a;let{type:f="sqlite"}=b||{},g=d[c]?.fields[e];return(g||(g=Object.values(d).find(a=>a.modelName===c)),"boolean"===g.type&&("sqlite"===f||"mssql"===f)&&null!=a)?+!!a:"date"===g.type&&a&&a instanceof Date&&"sqlite"===f?a.toISOString():a}(i,a,h);let m=a=>"in"===j.toLowerCase()?a(l,"in",Array.isArray(i)?i:[i]):"not_in"===j.toLowerCase()?a(l,"not in",Array.isArray(i)?i:[i]):"contains"===j?a(l,"like",`%${i}%`):"starts_with"===j?a(l,"like",`${i}%`):"ends_with"===j?a(l,"like",`%${i}`):a(l,"eq"===j?"=":"ne"===j?"<>":"gt"===j?">":"gte"===j?">=":"lt"===j?"<":"lte"===j?"<=":j,i);"OR"===k?g.push(m):f.push(m)}),{and:f.length?f:null,or:g.length?g:null}}return{async create({data:b,model:c}){let d=a.insertInto(c).values(b);return f(await e(b,d,c,[]))},async findOne({model:b,where:c,select:d}){let{and:e,or:h}=g(b,c),i=a.selectFrom(b).selectAll();e&&(i=i.where(a=>a.and(e.map(b=>b(a))))),h&&(i=i.where(a=>a.or(h.map(b=>b(a)))));let j=await i.executeTakeFirst();return j?f(j):null},async findMany({model:d,where:e,limit:h,offset:i,sortBy:j}){let{and:k,or:l}=g(d,e),m=a.selectFrom(d);k&&(m=m.where(a=>a.and(k.map(b=>b(a))))),l&&(m=m.where(a=>a.or(l.map(b=>b(a))))),b?.type==="mssql"?i||(m=m.top(h||100)):m=m.limit(h||100),j&&(m=m.orderBy(c({model:d,field:j.field}),j.direction)),i&&(b?.type==="mssql"?(j||(m=m.orderBy(c({model:d,field:"id"}))),m=m.offset(i).fetch(h||100)):m=m.offset(i));let n=await m.selectAll().execute();return n?f(n):[]},async update({model:b,where:c,update:d}){let{and:h,or:i}=g(b,c),j=a.updateTable(b).set(d);return h&&(j=j.where(a=>a.and(h.map(b=>b(a))))),i&&(j=j.where(a=>a.or(i.map(b=>b(a))))),f(await e(d,j,b,c))},async updateMany({model:b,where:c,update:d}){let{and:e,or:f}=g(b,c),h=a.updateTable(b).set(d);return e&&(h=h.where(a=>a.and(e.map(b=>b(a))))),f&&(h=h.where(a=>a.or(f.map(b=>b(a))))),(await h.execute()).length},async count({model:b,where:c}){let{and:d,or:e}=g(b,c),f=a.selectFrom(b).select(a.fn.count("id").as("count"));return d&&(f=f.where(a=>a.and(d.map(b=>b(a))))),e&&(f=f.where(a=>a.or(e.map(b=>b(a))))),(await f.execute())[0].count},async delete({model:b,where:c}){let{and:d,or:e}=g(b,c),f=a.deleteFrom(b);d&&(f=f.where(a=>a.and(d.map(b=>b(a))))),e&&(f=f.where(a=>a.or(e.map(b=>b(a))))),await f.execute()},async deleteMany({model:b,where:c}){let{and:d,or:e}=g(b,c),f=a.deleteFrom(b);return d&&(f=f.where(a=>a.and(d.map(b=>b(a))))),e&&(f=f.where(a=>a.or(e.map(b=>b(a))))),(await f.execute()).length},options:b}},e=null;e={config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:b?.usePlural,debugLogs:b?.debugLogs,supportsBooleans:b?.type!=="sqlite"&&b?.type!=="mssql"&&!!b?.type,supportsDates:b?.type!=="sqlite"&&b?.type!=="mssql"&&!!b?.type,supportsJSON:!1,transaction:!!b?.transaction&&(b=>a.transaction().execute(a=>b(m3({config:e.config,adapter:d(a)})(c))))},adapter:d(a)};let f=m3(e);return a=>(c=a,f(a))})(c,{type:d||"sqlite",debugLogs:"debugLogs"in a.database&&a.database.debugLogs,transaction:e})(a)}let nc={postgres:{string:["character varying","varchar","text"],number:["int4","integer","bigint","smallint","numeric","real","double precision"],boolean:["bool","boolean"],date:["timestamptz","timestamp","date"],json:["json","jsonb"]},mysql:{string:["varchar","text"],number:["integer","int","bigint","smallint","decimal","float","double"],boolean:["boolean","tinyint"],date:["timestamp","datetime","date"],json:["json"]},sqlite:{string:["TEXT"],number:["INTEGER","REAL"],boolean:["INTEGER","BOOLEAN"],date:["DATE","INTEGER"],json:["TEXT"]},mssql:{string:["varchar","nvarchar"],number:["int","bigint","smallint","decimal","float","double"],boolean:["bit","smallint"],date:["datetime","date"],json:["varchar","nvarchar"]}};async function nd(a){let b=function(a){let b=kz(a),c={};for(let a in b){let d=b[a],e=d.fields,f={};if(Object.entries(e).forEach(([a,c])=>{if(f[c.fieldName||a]=c,c.references){let d=b[c.references.model];d&&(f[c.fieldName||a].references={model:d.modelName,field:c.references.field})}}),c[d.modelName]){c[d.modelName].fields={...c[d.modelName].fields,...f};continue}c[d.modelName]={fields:f,order:d.order||1/0}}return c}(a),c=gp(a.logger),{kysely:d,databaseType:e}=await m9(a);e||(c.warn("Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this."),e="sqlite"),d||(c.error("Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter."),process.exit(1));let f=await d.introspection.getTables(),g=[],h=[];for(let[a,d]of Object.entries(b)){let b=f.find(b=>b.name===a);if(!b){let b=g.findIndex(b=>b.table===a),c={table:a,fields:d.fields,order:d.order||1/0},e=g.findIndex(a=>(a.order||1/0)>c.order);-1===e?-1===b?g.push(c):g[b].fields={...g[b].fields,...d.fields}:g.splice(e,0,c);continue}let i={};for(let[f,g]of Object.entries(d.fields)){let d=b.columns.find(a=>a.name===f);if(!d){i[f]=g;continue}!function(a,b,c){if("string[]"===b||"number[]"===b)return a.toLowerCase().includes("json");let d=nc[c];return(Array.isArray(b)?d.string.map(a=>a.toLowerCase()):d[b].map(a=>a.toLowerCase())).includes(a.toLowerCase().split("(")[0].trim())}(d.dataType,g.type,e)&&c.warn(`Field ${f} in table ${a} has a different type in the database. Expected ${g.type} but got ${d.dataType}.`)}Object.keys(i).length>0&&h.push({table:a,fields:i,order:d.order||1/0})}let i=[];function j(b,c){let d=b.type,f={string:{sqlite:"text",postgres:"text",mysql:b.unique?"varchar(255)":b.references?"varchar(36)":"text",mssql:b.unique||b.sortable?"varchar(255)":b.references?"varchar(36)":"varchar(8000)"},boolean:{sqlite:"integer",postgres:"boolean",mysql:"boolean",mssql:"smallint"},number:{sqlite:b.bigint?"bigint":"integer",postgres:b.bigint?"bigint":"integer",mysql:b.bigint?"bigint":"integer",mssql:b.bigint?"bigint":"integer"},date:{sqlite:"date",postgres:"timestamptz",mysql:"timestamp",mssql:"datetime"},json:{sqlite:"text",postgres:"jsonb",mysql:"json",mssql:"varchar(8000)"},id:{postgres:a.advanced?.database?.useNumberId?"serial":"text",mysql:a.advanced?.database?.useNumberId?"integer":"varchar(36)",mssql:a.advanced?.database?.useNumberId?"integer":"varchar(36)",sqlite:a.advanced?.database?.useNumberId?"integer":"text"}};return"id"===c||b.references?.field==="id"?f.id[e]:"sqlite"===e&&("string[]"===d||"number[]"===d)?"text":"string[]"===d||"number[]"===d?"jsonb":Array.isArray(d)?"text":f[d][e||"sqlite"]}if(h.length)for(let a of h)for(let[b,c]of Object.entries(a.fields)){let f=j(c,b),g=d.schema.alterTable(a.table).addColumn(b,f,a=>(a=!1!==c.required?a.notNull():a,c.references&&(a=a.references(`${c.references.model}.${c.references.field}`).onDelete(c.references.onDelete||"cascade")),c.unique&&(a=a.unique()),"date"===c.type&&"function"==typeof c.defaultValue&&("postgres"===e||"mysql"===e||"mssql"===e)&&(a=a.defaultTo((0,kO.l)`CURRENT_TIMESTAMP`)),a));i.push(g)}if(g.length)for(let b of g){let c=d.schema.createTable(b.table).addColumn("id",a.advanced?.database?.useNumberId?"postgres"===e?"serial":"integer":"mysql"===e||"mssql"===e?"varchar(36)":"text",b=>a.advanced?.database?.useNumberId?"postgres"===e||"sqlite"===e?b.primaryKey().notNull():b.autoIncrement().primaryKey().notNull():b.primaryKey().notNull());for(let[a,d]of Object.entries(b.fields)){let b=j(d,a);c=c.addColumn(a,b,a=>(a=!1!==d.required?a.notNull():a,d.references&&(a=a.references(`${d.references.model}.${d.references.field}`).onDelete(d.references.onDelete||"cascade")),d.unique&&(a=a.unique()),"date"===d.type&&"function"==typeof d.defaultValue&&("postgres"===e||"mysql"===e||"mssql"===e)&&(a=a.defaultTo((0,kO.l)`CURRENT_TIMESTAMP`)),a))}i.push(c)}return{toBeCreated:g,toBeAdded:h,runMigrations:async function(){for(let a of i)await a.execute()},compileMigrations:async function(){return i.map(a=>a.compile().sql).join(";\n\n")+";"}}}async function ne(a,b){let c=await b.context.internalAdapter.findAccounts(a),d=c?.find(a=>"credential"===a.providerId),e=d?.password;if(!d||!e||!b.body.password)throw new I("BAD_REQUEST",{message:"No password credential found"});if(!await b.context.password.verify({hash:e,password:b.body.password}))throw new I("BAD_REQUEST",{message:"Invalid password"});return!0}let nf="better-auth-secret-123456789";async function ng(){if(f)return f;try{let a="undefined"!=typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!a)return;let b=a=>Function("mm","return import(mm)")(a),[{default:c},{default:d}]=await Promise.all([b("fs/promises"),b("path")]),e=await c.readFile(d.join(a,"package.json"),"utf-8");return f=JSON.parse(e)}catch{}}async function nh(a){if(f)return f.dependencies?.[a]||f.devDependencies?.[a]||f.peerDependencies?.[a];try{let b="undefined"!=typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!b)throw Error("no-cwd");let c=a=>Function("mm","return import(mm)")(a),[{default:d},{default:e}]=await Promise.all([c("fs/promises"),c("path")]),f=e.join(b,"node_modules",a,"package.json"),g=await d.readFile(f,"utf-8");return JSON.parse(g).version||await ni(a)||void 0}catch{}return await ni(a)}async function ni(a){let b=await ng();if(b)return({...b.dependencies,...b.devDependencies,...b.peerDependencies})[a]}async function nj(){let a=await ng();return a?.name}let nk=null;async function nl(a){if(nk)return nk;let b=await nj();return nk=b?await iS(a?a+b:b):a?await iS(a):jz(32)}let nm=a=>Function("mm","return import(mm)")(a);function nn(){let a=(...a)=>a.some(a=>!!f3[a]);return a("CF_PAGES","CF_PAGES_URL","CF_ACCOUNT_ID")||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent?"cloudflare":a("VERCEL","VERCEL_URL","VERCEL_ENV")?"vercel":a("NETLIFY","NETLIFY_URL")?"netlify":a("RENDER","RENDER_URL","RENDER_INTERNAL_HOSTNAME","RENDER_SERVICE_ID")?"render":a("AWS_LAMBDA_FUNCTION_NAME","AWS_EXECUTION_ENV","LAMBDA_TASK_ROOT")?"aws":a("GOOGLE_CLOUD_FUNCTION_NAME","GOOGLE_CLOUD_PROJECT","GCP_PROJECT","K_SERVICE")?"gcp":a("AZURE_FUNCTION_NAME","FUNCTIONS_WORKER_RUNTIME","WEBSITE_INSTANCE_ID","WEBSITE_SITE_NAME")?"azure":a("DENO_DEPLOYMENT_ID","DENO_REGION")?"deno-deploy":a("FLY_APP_NAME","FLY_REGION","FLY_ALLOC_ID")?"fly-io":a("RAILWAY_STATIC_URL","RAILWAY_ENVIRONMENT_NAME")?"railway":a("DYNO","HEROKU_APP_NAME")?"heroku":a("DO_DEPLOYMENT_ID","DO_APP_NAME","DIGITALOCEAN")?"digitalocean":a("KOYEB","KOYEB_DEPLOYMENT_ID","KOYEB_APP_NAME")?"koyeb":null}async function no(){try{if("cloudflare"===nn())return"cloudflare";let a=await nm("os"),b=a.cpus();return{deploymentVendor:nn(),systemPlatform:a.platform(),systemRelease:a.release(),systemArchitecture:a.arch(),cpuCount:b.length,cpuModel:b.length?b[0].model:null,cpuSpeed:b.length?b[0].speed:null,memory:a.totalmem(),isWSL:await ns(),isDocker:await nr(),isTTY:"undefined"!=typeof process&&process.stdout?process.stdout.isTTY:null}}catch(a){return{systemPlatform:null,systemRelease:null,systemArchitecture:null,cpuCount:null,cpuModel:null,cpuSpeed:null,memory:null,isWSL:null,isDocker:null,isTTY:null}}}async function np(){if("cloudflare"===nn())return!1;try{return(await nm("fs")).statSync("/.dockerenv"),!0}catch{return!1}}async function nq(){if("cloudflare"===nn())return!1;try{return(await nm("fs")).readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}async function nr(){return"cloudflare"!==nn()&&(void 0===g&&(g=await np()||await nq()),g)}async function ns(){try{if("cloudflare"===nn()||"undefined"==typeof process||"linux"!==process.platform)return!1;let a=await nm("fs");if((await nm("os")).release().toLowerCase().includes("microsoft")){if(await nu())return!1;return!0}return!!a.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")&&!await nu()}catch{return!1}}let nt=async()=>{if("cloudflare"===nn())return!1;try{return(await nm("fs")).statSync("/run/.containerenv"),!0}catch{return!1}};async function nu(){return void 0===h&&(h=await nt()||await nr()),h}let nv={pg:"postgresql",mysql:"mysql",mariadb:"mariadb",sqlite3:"sqlite","better-sqlite3":"sqlite","@prisma/client":"prisma",mongoose:"mongodb",mongodb:"mongodb","drizzle-orm":"drizzle"};async function nw(){for(let[a,b]of Object.entries(nv)){let c=await nh(a);if(c)return{name:b,version:c}}}let nx={next:"next",nuxt:"nuxt","@remix-run/server-runtime":"remix",astro:"astro","@sveltejs/kit":"sveltekit","solid-start":"solid-start","tanstack-start":"tanstack-start",hono:"hono",express:"express",elysia:"elysia",expo:"expo"};async function ny(){for(let[a,b]of Object.entries(nx)){let c=await nh(a);if(c)return{name:b,version:c}}}async function nz(a,b){let c,d=a.telemetry?.debug||f9("BETTER_AUTH_TELEMETRY_DEBUG",!1),e=ga.BETTER_AUTH_TELEMETRY_ENDPOINT,f=async a=>{try{b?.customTrack?await b.customTrack(a):d?await Promise.resolve(gq.info("telemetry event",JSON.stringify(a,null,2))):await jj(e,{method:"POST",body:a})}catch{}},g=async()=>{let c=a.telemetry?.enabled!==void 0&&a.telemetry.enabled;return(f9("BETTER_AUTH_TELEMETRY",!1)||c)&&(b?.skipTestCheck||!f7())},h=await g();if(h){var i;c=await nl(a.baseURL),f({type:"init",payload:{config:{database:void 0,adapter:i?.adapter,emailVerification:{sendVerificationEmail:!!a.emailVerification?.sendVerificationEmail,sendOnSignUp:!!a.emailVerification?.sendOnSignUp,sendOnSignIn:!!a.emailVerification?.sendOnSignIn,autoSignInAfterVerification:!!a.emailVerification?.autoSignInAfterVerification,expiresIn:a.emailVerification?.expiresIn,onEmailVerification:!!a.emailVerification?.onEmailVerification,afterEmailVerification:!!a.emailVerification?.afterEmailVerification},emailAndPassword:{enabled:!!a.emailAndPassword?.enabled,disableSignUp:!!a.emailAndPassword?.disableSignUp,requireEmailVerification:!!a.emailAndPassword?.requireEmailVerification,maxPasswordLength:a.emailAndPassword?.maxPasswordLength,minPasswordLength:a.emailAndPassword?.minPasswordLength,sendResetPassword:!!a.emailAndPassword?.sendResetPassword,resetPasswordTokenExpiresIn:a.emailAndPassword?.resetPasswordTokenExpiresIn,onPasswordReset:!!a.emailAndPassword?.onPasswordReset,password:{hash:!!a.emailAndPassword?.password?.hash,verify:!!a.emailAndPassword?.password?.verify},autoSignIn:!!a.emailAndPassword?.autoSignIn,revokeSessionsOnPasswordReset:!!a.emailAndPassword?.revokeSessionsOnPasswordReset},socialProviders:Object.keys(a.socialProviders||{}).map(b=>{let c=a.socialProviders?.[b];return c?{id:b,mapProfileToUser:!!c.mapProfileToUser,disableDefaultScope:!!c.disableDefaultScope,disableIdTokenSignIn:!!c.disableIdTokenSignIn,disableImplicitSignUp:c.disableImplicitSignUp,disableSignUp:c.disableSignUp,getUserInfo:!!c.getUserInfo,overrideUserInfoOnSignIn:!!c.overrideUserInfoOnSignIn,prompt:c.prompt,verifyIdToken:!!c.verifyIdToken,scope:c.scope,refreshAccessToken:!!c.refreshAccessToken}:{}}),plugins:a.plugins?.map(a=>a.id.toString()),user:{modelName:a.user?.modelName,fields:a.user?.fields,additionalFields:a.user?.additionalFields,changeEmail:{enabled:a.user?.changeEmail?.enabled,sendChangeEmailVerification:!!a.user?.changeEmail?.sendChangeEmailVerification}},verification:{modelName:a.verification?.modelName,disableCleanup:a.verification?.disableCleanup,fields:a.verification?.fields},session:{modelName:a.session?.modelName,additionalFields:a.session?.additionalFields,cookieCache:{enabled:a.session?.cookieCache?.enabled,maxAge:a.session?.cookieCache?.maxAge},disableSessionRefresh:a.session?.disableSessionRefresh,expiresIn:a.session?.expiresIn,fields:a.session?.fields,freshAge:a.session?.freshAge,preserveSessionInDatabase:a.session?.preserveSessionInDatabase,storeSessionInDatabase:a.session?.storeSessionInDatabase,updateAge:a.session?.updateAge},account:{modelName:a.account?.modelName,fields:a.account?.fields,encryptOAuthTokens:a.account?.encryptOAuthTokens,updateAccountOnSignIn:a.account?.updateAccountOnSignIn,accountLinking:{enabled:a.account?.accountLinking?.enabled,trustedProviders:a.account?.accountLinking?.trustedProviders,updateUserInfoOnLink:a.account?.accountLinking?.updateUserInfoOnLink,allowUnlinkingAll:a.account?.accountLinking?.allowUnlinkingAll}},hooks:{after:!!a.hooks?.after,before:!!a.hooks?.before},secondaryStorage:!!a.secondaryStorage,advanced:{cookiePrefix:!!a.advanced?.cookiePrefix,cookies:!!a.advanced?.cookies,crossSubDomainCookies:{domain:!!a.advanced?.crossSubDomainCookies?.domain,enabled:a.advanced?.crossSubDomainCookies?.enabled,additionalCookies:a.advanced?.crossSubDomainCookies?.additionalCookies},database:{useNumberId:!!a.advanced?.database?.useNumberId,generateId:a.advanced?.database?.generateId,defaultFindManyLimit:a.advanced?.database?.defaultFindManyLimit},useSecureCookies:a.advanced?.useSecureCookies,ipAddress:{disableIpTracking:a.advanced?.ipAddress?.disableIpTracking,ipAddressHeaders:a.advanced?.ipAddress?.ipAddressHeaders},disableCSRFCheck:a.advanced?.disableCSRFCheck,cookieAttributes:{expires:a.advanced?.defaultCookieAttributes?.expires,secure:a.advanced?.defaultCookieAttributes?.secure,sameSite:a.advanced?.defaultCookieAttributes?.sameSite,domain:!!a.advanced?.defaultCookieAttributes?.domain,path:a.advanced?.defaultCookieAttributes?.path,httpOnly:a.advanced?.defaultCookieAttributes?.httpOnly}},trustedOrigins:a.trustedOrigins?.length,rateLimit:{storage:a.rateLimit?.storage,modelName:a.rateLimit?.modelName,window:a.rateLimit?.window,customStorage:!!a.rateLimit?.customStorage,enabled:a.rateLimit?.enabled,max:a.rateLimit?.max},onAPIError:{errorURL:a.onAPIError?.errorURL,onError:!!a.onAPIError?.onError,throw:a.onAPIError?.throw},logger:{disabled:a.logger?.disabled,level:a.logger?.level,log:!!a.logger?.log},databaseHooks:{user:{create:{after:!!a.databaseHooks?.user?.create?.after,before:!!a.databaseHooks?.user?.create?.before},update:{after:!!a.databaseHooks?.user?.update?.after,before:!!a.databaseHooks?.user?.update?.before}},session:{create:{after:!!a.databaseHooks?.session?.create?.after,before:!!a.databaseHooks?.session?.create?.before},update:{after:!!a.databaseHooks?.session?.update?.after,before:!!a.databaseHooks?.session?.update?.before}},account:{create:{after:!!a.databaseHooks?.account?.create?.after,before:!!a.databaseHooks?.account?.create?.before},update:{after:!!a.databaseHooks?.account?.update?.after,before:!!a.databaseHooks?.account?.update?.before}},verification:{create:{after:!!a.databaseHooks?.verification?.create?.after,before:!!a.databaseHooks?.verification?.create?.before},update:{after:!!a.databaseHooks?.verification?.update?.after,before:!!a.databaseHooks?.verification?.update?.before}}}},runtime:"undefined"!=typeof Deno?{name:"deno",version:Deno?.version?.deno??null}:"undefined"!=typeof Bun?{name:"bun",version:Bun?.version??null}:"undefined"!=typeof process&&process?.versions?.node?{name:"node",version:process.versions.node??null}:{name:"edge",version:null},database:await nw(),framework:await ny(),environment:"production"===f8("NODE_ENV")?"production":"false"!==f3.CI&&("BUILD_ID"in f3||"BUILD_NUMBER"in f3||"CI"in f3||"CI_APP_ID"in f3||"CI_BUILD_ID"in f3||"CI_BUILD_NUMBER"in f3||"CI_NAME"in f3||"CONTINUOUS_INTEGRATION"in f3||"RUN_ID"in f3)?"ci":f7()?"test":"development",systemInfo:await no(),packageManager:function(){let a=f3.npm_config_user_agent;if(!a)return;let b=a.split(" ")[0],c=b.lastIndexOf("/"),d=b.substring(0,c);return{name:"npminstall"===d?"cnpm":d,version:b.substring(c+1)}}()},anonymousId:c})}return{publish:async b=>{h&&(c||(c=await nl(a.baseURL)),await f({type:b.type,payload:b.payload,anonymousId:c}))}}}function nA(a){return!!a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof a.then}let nB=async a=>{var b;let c,d=await nb(a),e=a.plugins||[],f=(b=a,b.advanced?.crossSubDomainCookies?.enabled,[]),g=gp(a.logger),h=gt(a.baseURL,a.basePath),i=a.secret||f3.BETTER_AUTH_SECRET||f3.AUTH_SECRET||nf;i===nf&&f5&&g.error("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config."),function(a,b){let c=new Map;a.plugins?.forEach(a=>{if(a.endpoints){for(let[b,d]of Object.entries(a.endpoints))if(d&&"path"in d){let e=d.path,f=[];d.options&&"method"in d.options&&(Array.isArray(d.options.method)?f=d.options.method:"string"==typeof d.options.method&&(f=[d.options.method])),0===f.length&&(f=["*"]),c.has(e)||c.set(e,[]),c.get(e).push({pluginId:a.id,endpointKey:b,methods:f})}}});let d=[];for(let[a,b]of c.entries())if(b.length>1){let c=new Map,e=!1;for(let a of b)for(let d of a.methods)c.has(d)||c.set(d,[]),c.get(d).push(a.pluginId),c.get(d).length>1&&(e=!0),"*"===d&&b.length>1?e=!0:"*"!==d&&c.has("*")&&(e=!0);if(e){let e=[...new Set(b.map(a=>a.pluginId))],f=[];for(let[a,d]of c.entries())(d.length>1||"*"===a&&b.length>1||"*"!==a&&c.has("*"))&&f.push(a);d.push({path:a,plugins:e,conflictingMethods:f})}}if(d.length>0){let a=d.map(a=>`  - "${a.path}" [${a.conflictingMethods.join(", ")}] used by plugins: ${a.plugins.join(", ")}`).join("\n");b.error(`Endpoint path conflicts detected! Multiple plugins are trying to use the same endpoint paths with conflicting HTTP methods:
${a}

To resolve this, you can:
	1. Use only one of the conflicting plugins
	2. Configure the plugins to use different paths (if supported)
	3. Ensure plugins use different HTTP methods for the same path
`)}}(a={...a,secret:i,baseURL:h?new URL(h).origin:"",basePath:a.basePath||"/api/auth",plugins:e.concat(f)},g);let j=function(a){let b=gA(a),c=b("session_token",{maxAge:a.session?.expiresIn||gz("7d")/1e3}),d=b("session_data",{maxAge:a.session?.cookieCache?.maxAge||300}),e=b("dont_remember");return{sessionToken:{name:c.name,options:c.attributes},sessionData:{name:d.name,options:d.attributes},dontRememberToken:{name:e.name,options:e.attributes}}}(a),k=kz(a),l=Object.entries(a.socialProviders||{}).map(([a,b])=>{if(null==b||!1===b.enabled)return null;b.clientId||g.warn(`Social provider ${a} is missing clientId or clientSecret`);let c=j3[a](b);return c.disableImplicitSignUp=b.disableImplicitSignUp,c}).filter(a=>null!==a),{publish:m}=await nz(a,{adapter:d.id,database:"function"==typeof a.database?"adapter":m8(a.database)||"unknown"}),n={appName:a.appName||"Better Auth",socialProviders:l,options:a,tables:k,trustedOrigins:function(a){let b=gt(a.baseURL,a.basePath);if(!b)return[];let c=[new URL(b).origin];a.trustedOrigins&&Array.isArray(a.trustedOrigins)&&c.push(...a.trustedOrigins);let d=f3.BETTER_AUTH_TRUSTED_ORIGINS;if(d&&c.push(...d.split(",")),c.filter(a=>!a).length)throw new f0("A provided trusted origin is invalid, make sure your trusted origins list is properly defined.");return c}(a),baseURL:h||"",sessionConfig:{updateAge:a.session?.updateAge!==void 0?a.session.updateAge:86400,expiresIn:a.session?.expiresIn||604800,freshAge:a.session?.freshAge===void 0?86400:a.session.freshAge},secret:i,rateLimit:{...a.rateLimit,enabled:a.rateLimit?.enabled??f5,window:a.rateLimit?.window||10,max:a.rateLimit?.max||100,storage:a.rateLimit?.storage||(a.secondaryStorage?"secondary-storage":"memory")},authCookies:j,logger:g,generateId:({model:b,size:c})=>"function"==typeof a.advanced?.generateId?a.advanced.generateId({model:b,size:c}):"function"==typeof a?.advanced?.database?.generateId?a.advanced.database.generateId({model:b,size:c}):jz(c),session:null,secondaryStorage:a.secondaryStorage,password:{hash:a.emailAndPassword?.password?.hash||iV,verify:a.emailAndPassword?.password?.verify||iW,config:{minPasswordLength:a.emailAndPassword?.minPasswordLength||8,maxPasswordLength:a.emailAndPassword?.maxPasswordLength||128},checkPassword:ne},setNewSession(a){this.newSession=a},newSession:null,adapter:d,internalAdapter:na(d,{options:a,logger:g,hooks:a.databaseHooks?[a.databaseHooks]:[]}),createAuthCookie:gA(a),async runMigrations(){if(!a.database||"updateMany"in a.database)throw new f0("Database is not provided or it's an adapter. Migrations are only supported with a database instance.");let{runMigrations:b}=await nd(a);await b()},publishTelemetry:m},o=nC(n);return nA(o)?{context:c}=await o:{context:c}=o,c};async function nC(a){let b=a.options,c=b.plugins||[],d=a,e=[];for(let a of c)if(a.init){let c,f=a.init(d);if("object"==typeof(c=nA(f)?await f:f)){if(c.options){let{databaseHooks:a,...d}=c.options;a&&e.push(a),b=jI(b,d)}c.context&&(d={...d,...c.context})}}return e.push(b.databaseHooks),d.internalAdapter=na(a.adapter,{options:b,logger:a.logger,hooks:e.filter(a=>void 0!==a),generateId:a.generateId}),d.options=b,{context:d}}let nD=(a=>{let b=nB(a),{api:c}=ky(b,a),d=a.plugins?.reduce((a,b)=>b.$ERROR_CODES?{...a,...b.$ERROR_CODES}:a,{});return{handler:async c=>{let d=await b,e=d.options.basePath||"/api/auth";if(!d.options.baseURL){let a=gt(void 0,e,c);if(a)d.baseURL=a,d.options.baseURL=gu(d.baseURL)||void 0;else throw new f0("Could not get base URL from request. Please provide a valid base URL.")}d.trustedOrigins=[...a.trustedOrigins?Array.isArray(a.trustedOrigins)?a.trustedOrigins:await a.trustedOrigins(c):[],d.options.baseURL];let{handler:f}=((a,b)=>{let{api:c,middlewares:d}=ky(a,b),e=new URL(a.baseURL).pathname;return((a,b)=>{if(!b?.openapi?.disabled){let c={path:"/api/reference",...b?.openapi};a.openapi=Y(c.path,{method:"GET"},async b=>new Response(((a,b)=>`<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(a)}
    </script>
	 <script>
      var configuration = {
	  	favicon: ${b?.logo?`data:image/svg+xml;utf8,${encodeURIComponent(b.logo)}`:void 0} ,
	   	theme: ${b?.theme||"saturn"},
        metaData: {
			title: ${b?.title||"Open API Reference"},
			description: ${b?.description||"Better Call Open API"},
		}
      }
      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    </script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script>
  </body>
</html>`)(await b9(a),c.scalar),{headers:{"Content-Type":"text/html"}}))}let c=C(),d=C();for(let b of Object.values(a))if(!(!b.options||b.options?.metadata?.SERVER_ONLY))for(let a of Array.isArray(b.options?.method)?b.options.method:[b.options?.method])F(c,a,b.path,b);if(b?.routerMiddleware?.length)for(let{path:a,middleware:c}of b.routerMiddleware)F(d,"*",a,c);let e=async a=>{let e=new URL(a.url),f=b?.basePath?e.pathname.split(b.basePath).reduce((a,c,d)=>(0!==d&&(d>1?a.push(`${b.basePath}${c}`):a.push(c)),a),[]).join(""):e.pathname;if(!f?.length)return new Response(null,{status:404,statusText:"Not Found"});let g=function(a,b="",c,d){"/"===c[c.length-1]&&(c=c.slice(0,-1));let e=a.static[c];if(e&&e.methods){let a=e.methods[b]||e.methods[""];if(void 0!==a)return a[0]}let f=D(c),g=function a(b,c,d,e,f){if(f===e.length){if(c.methods){let a=c.methods[d]||c.methods[""];if(a)return a}if(c.param&&c.param.methods){let a=c.param.methods[d]||c.param.methods[""];if(a){let b=a[0].paramsMap;if(b?.[b?.length-1]?.[2])return a}}if(c.wildcard&&c.wildcard.methods){let a=c.wildcard.methods[d]||c.wildcard.methods[""];if(a){let b=a[0].paramsMap;if(b?.[b?.length-1]?.[2])return a}}return}let g=e[f];if(c.static){let h=c.static[g];if(h){let c=a(b,h,d,e,f+1);if(c)return c}}if(c.param){let g=a(b,c.param,d,e,f+1);if(g)return g}if(c.wildcard&&c.wildcard.methods)return c.wildcard.methods[d]||c.wildcard.methods[""]}(a,a.root,b,f,0)?.[0];if(void 0!==g)return{data:g.data,params:g.paramsMap?E(f,g.paramsMap):void 0}}(c,a.method,f);if(!g?.data)return new Response(null,{status:404,statusText:"Not Found"});let h={};e.searchParams.forEach((a,b)=>{b in h?Array.isArray(h[b])?h[b].push(a):h[b]=[h[b],a]:h[b]=a});let i=g.data,j={path:f,method:a.method,headers:a.headers,params:g.params?JSON.parse(JSON.stringify(g.params)):{},request:a,body:i.options.disableBody?void 0:await J(i.options.cloneRequest?a.clone():a),query:h,_flag:"router",asResponse:!0,context:b?.routerContext};try{let a=function(a,b="",c,d){"/"===c[c.length-1]&&(c=c.slice(0,-1));let e=D(c);return(function a(b,c,d,e,f,g=[]){let h=e[f];if(c.wildcard&&c.wildcard.methods){let a=c.wildcard.methods[d]||c.wildcard.methods[""];a&&g.push(...a)}if(c.param&&(a(b,c.param,d,e,f+1,g),f===e.length&&c.param.methods)){let a=c.param.methods[d]||c.param.methods[""];a&&g.push(...a)}let i=c.static?.[h];if(i&&a(b,i,d,e,f+1,g),f===e.length&&c.methods){let a=c.methods[d]||c.methods[""];a&&g.push(...a)}return g})(a,a.root,b,e,0).map(a=>({data:a.data,params:a.paramsMap?E(e,a.paramsMap):void 0}))}(d,"*",f);if(a?.length)for(let{data:b,params:c}of a){let a=await b({...j,params:c,asResponse:!1});if(a instanceof Response)return a}return await i(j)}catch(a){if(b?.onError)try{let c=await b.onError(a);if(c instanceof Response)return L(c)}catch(a){if(K(a))return L(a);throw a}if(b?.throwError)throw a;if(K(a))return L(a);return console.error("# SERVER_ERROR: ",a),new Response(null,{status:500,statusText:"Internal Server Error"})}};return{handler:async a=>{let c=await b?.onRequest?.(a);if(c instanceof Response)return c;let d=c instanceof Request?c:a,f=await e(d),g=await b?.onResponse?.(f);return g instanceof Response?g:f},endpoints:a}})(c,{routerContext:a,openapi:{disabled:!0},basePath:e,routerMiddleware:[{path:"/**",middleware:jM},...d],async onRequest(b){let c=a.options.disabledPaths||[],d=new URL(b.url).pathname.replace(e,"");if(c.includes(d))return new Response("Not Found",{status:404});for(let c of a.options.plugins||[])if(c.onRequest){let d=await c.onRequest(b,a);if(d&&"response"in d)return d.response}return kx(b,a)},async onResponse(b){for(let c of a.options.plugins||[])if(c.onResponse){let d=await c.onResponse(b,a);if(d)return d.response}return b},onError(c){if(c instanceof I&&"FOUND"===c.status)return;if(b.onAPIError?.throw)throw c;if(b.onAPIError?.onError)return void b.onAPIError.onError(c,a);let d=b.logger?.level,e="error"===d||"warn"===d||"debug"===d?gq:void 0;if(b.logger?.disabled!==!0){if(c&&"object"==typeof c&&"message"in c&&"string"==typeof c.message&&(c.message.includes("no column")||c.message.includes("column")||c.message.includes("relation")||c.message.includes("table")||c.message.includes("does not exist")))return void a.logger?.error(c.message);c instanceof I?("INTERNAL_SERVER_ERROR"===c.status&&a.logger.error(c.status,c),e?.error(c.message)):a.logger?.error(c&&"object"==typeof c&&"name"in c?c.name:"",c)}}})})(d,a);return f(c)},api:c,options:a,$context:b,$Infer:{},$ERROR_CODES:{...d,...gH}}})({database:{provider:"postgresql",url:"postgresql://neondb_owner:npg_MRLUf85DBNPv@ep-curly-meadow-aefoagku-pooler.c-2.us-east-2.aws.neon.tech/neondb?sslmode=require&channel_binding=require"},emailAndPassword:{enabled:!0,autoSignIn:!1,requireEmailVerification:!1},socialProviders:{github:{clientId:process.env.GITHUB_CLIENT_ID||"",clientSecret:process.env.GITHUB_CLIENT_SECRET||""}},baseURL:process.env.BETTER_AUTH_URL||"http://localhost:3000",secret:process.env.BETTER_AUTH_SECRET||"development-secret-key",session:{expiresIn:604800,updateAge:86400},trustedOrigins:["https://solosuccess.ai"]});gF(async()=>({})),gF({use:[gL]},async a=>({session:a.context.session}));let nE=e2(),nF=fK(["pending","accepted","rejected","canceled"]).default("pending");fD({id:e2().default(jz),name:e2(),slug:e2(),logo:e2().nullish().optional(),metadata:fI(e2(),fw()).or(e2().transform(a=>JSON.parse(a))).optional(),createdAt:fz()}),fD({id:e2().default(jz),organizationId:e2(),userId:fZ(),role:nE,createdAt:fz().default(()=>new Date)}),fD({id:e2().default(jz),organizationId:e2(),email:e2(),role:nE,status:nF,teamId:e2().nullish(),inviterId:e2(),expiresAt:fz()}),fD({id:e2().default(jz),name:e2().min(1),organizationId:e2(),createdAt:fz(),updatedAt:fz().optional()}),fD({id:e2().default(jz),teamId:e2(),userId:e2(),createdAt:fz().default(()=>new Date)}),fD({id:e2().default(jz),organizationId:e2(),role:e2(),permission:fI(e2(),fB(e2())),createdAt:fz().default(()=>new Date),updatedAt:fz().optional()});let nG=["admin","member","owner"];function nH(a){return{newRole:a=>{var b;return{authorize(a,c="AND"){let d=!1;for(let[e,f]of Object.entries(a)){let a=b[e];if(!a)return{success:!1,error:`You are not allowed to access resource: ${e}`};if(Array.isArray(f))d=f.every(b=>a.includes(b));else if("object"==typeof f)d="OR"===f.connector?f.actions.some(b=>a.includes(b)):f.actions.every(b=>a.includes(b));else throw new f0("Invalid access control request");if(d&&"OR"===c)return{success:d};if(!d&&"AND"===c)return{success:!1,error:`unauthorized to access resource "${e}"`}}return d?{success:d}:{success:!1,error:"Not authorized"}},statements:b=a}},statements:a}}fF([fK(nG),fB(fK(nG))]);let nI=nH({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"],ac:["create","read","update","delete"]});nI.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"],team:["create","update","delete"],ac:["create","read","update","delete"]}),nI.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"],ac:["create","read","update","delete"]}),nI.newRole({organization:[],member:[],invitation:[],team:[],ac:["read"]});let nJ=nH({user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]});nJ.newRole({user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]}),nJ.newRole({user:[],session:[]}),fN(fD({disableCookieCache:fs().meta({description:"Disable cookie cache and fetch session from database"}).or(e2().transform(a=>"true"===a)).optional(),disableRefresh:fs().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()})),fD({id:e2(),deviceCode:e2(),userCode:e2(),userId:e2().optional(),expiresAt:fz(),status:e2(),lastPolledAt:fz().optional(),pollingInterval:fo().optional(),clientId:e2().optional(),scope:e2().optional()});let nK=fY(a=>{try{gz(a)}catch(a){return!1}return!0},{message:"Invalid time string format. Use formats like '30m', '5s', '1h', etc."});fD({expiresIn:nK.default("30m").describe("Time in seconds until the device code expires. Use formats like '30m', '5s', '1h', etc."),interval:nK.default("5s").describe("Time in seconds between polling attempts. Use formats like '30m', '5s', '1h', etc."),deviceCodeLength:fo().int().positive().default(40).describe("Length of the device code to be generated. Default is 40 characters."),userCodeLength:fo().int().positive().default(8).describe("Length of the user code to be generated. Default is 8 characters."),generateDeviceCode:fY(a=>"function"==typeof a,{message:"generateDeviceCode must be a function that returns a string or a promise that resolves to a string."}).optional().describe("Function to generate a device code. If not provided, a default random string generator will be used."),generateUserCode:fY(a=>"function"==typeof a,{message:"generateUserCode must be a function that returns a string or a promise that resolves to a string."}).optional().describe("Function to generate a user code. If not provided, a default random string generator will be used."),validateClient:fY(a=>"function"==typeof a,{message:"validateClient must be a function that returns a boolean or a promise that resolves to a boolean."}).optional().describe("Function to validate the client ID. If not provided, no validation will be performed."),onDeviceAuthRequest:fY(a=>"function"==typeof a,{message:"onDeviceAuthRequest must be a function that returns void or a promise that resolves to void."}).optional().describe("Function to handle device authorization requests. If not provided, no additional actions will be taken."),schema:fY(()=>!0)});let nL=function(a){let b=async b=>"handler"in a?a.handler(b):a(b);return{GET:b,POST:b}}(nD),nM=new k.AppRouteRouteModule({definition:{kind:l.RouteKind.APP_ROUTE,page:"/api/auth/[...all]/route",pathname:"/api/auth/[...all]",filename:"route",bundlePath:"app/api/auth/[...all]/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"C:\\Users\\prett\\Desktop\\SoloSuccess AI\\app\\api\\auth\\[...all]\\route.ts",nextConfigOutput:"standalone",userland:j}),{workAsyncStorage:nN,workUnitAsyncStorage:nO,serverHooks:nP}=nM;function nQ(){return(0,m.patchFetch)({workAsyncStorage:nN,workUnitAsyncStorage:nO})}async function nR(a,b,c){var d;let e="/api/auth/[...all]/route";"/index"===e&&(e="/");let f=await nM.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!f)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:g,params:h,nextConfig:i,isDraftMode:j,prerenderManifest:k,routerServerContext:m,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=f,D=(0,p.normalizeAppPath)(e),E=!!(k.dynamicRoutes[D]||k.routes[C]);if(E&&!j){let a=!!k.routes[C],b=k.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new y.NoFallbackError}let F=null;!E||nM.isDev||j||(F="/index"===(F=C)?"/":F);let G=!0===nM.isDev||!E,H=E&&!G,I=a.method||"GET",J=(0,o.getTracer)(),K=J.getActiveScopeSpan(),L={params:h,prerenderManifest:k,renderOpts:{experimental:{cacheComponents:!!i.experimental.cacheComponents,authInterrupts:!!i.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,n.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=i.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>nM.onRequestError(a,b,d,m)},sharedContext:{buildId:g}},M=new q.NodeNextRequest(a),N=new q.NodeNextResponse(b),O=r.NextRequestAdapter.fromNodeNextRequest(M,(0,r.signalFromNodeResponse)(b));try{let d=async c=>nM.handle(O,L).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=J.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==s.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${I} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${I} ${a.url}`)}),f=async f=>{var g,h;let o=async({previousCacheEntry:g})=>{try{if(!(0,n.getRequestMeta)(a,"minimalMode")&&A&&B&&!g)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(f);a.fetchMetrics=L.renderOpts.fetchMetrics;let h=L.renderOpts.pendingWaitUntil;h&&c.waitUntil&&(c.waitUntil(h),h=void 0);let i=L.renderOpts.collectedTags;if(!E)return await (0,u.I)(M,N,e,L.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,v.toNodeOutgoingHttpHeaders)(e.headers);i&&(b[x.NEXT_CACHE_TAGS_HEADER]=i),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=x.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,d=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=x.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:z.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==g?void 0:g.isStale)&&await nM.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,t.c)({isRevalidate:H,isOnDemandRevalidate:A})},m),b}},p=await nM.handleResponse({req:a,nextConfig:i,cacheKey:F,routeKind:l.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:o,waitUntil:c.waitUntil});if(!E)return null;if((null==p||null==(g=p.value)?void 0:g.kind)!==z.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(h=p.value)?void 0:h.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,n.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),j&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let q=(0,v.fromNodeOutgoingHttpHeaders)(p.value.headers);return(0,n.getRequestMeta)(a,"minimalMode")&&E||q.delete(x.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||b.getHeader("Cache-Control")||q.get("Cache-Control")||q.set("Cache-Control",(0,w.getCacheControlHeader)(p.cacheControl)),await (0,u.I)(M,N,new Response(p.value.body,{headers:q,status:p.value.status||200})),null};K?await f(K):await J.withPropagatedContext(a.headers,()=>J.trace(s.BaseServerSpan.handleRequest,{spanName:`${I} ${a.url}`,kind:o.SpanKind.SERVER,attributes:{"http.method":I,"http.target":a.url}},f))}catch(b){if(K||b instanceof y.NoFallbackError||await nM.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,t.c)({isRevalidate:H,isOnDemandRevalidate:A})}),E)throw b;return await (0,u.I)(M,N,new Response(null,{status:500})),null}}},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12034:(a,b,c)=>{"use strict";c.d(b,{R:()=>h});var d=c(60353),e=c(48137),f=c(80234);let g=(0,d.CN)([]);class h{#at;constructor(a=g){this.#at=a}get plugins(){return this.#at}transformQuery(a,b){for(let c of this.#at){let d=c.transformQuery({node:a,queryId:b});if(d.kind===a.kind)a=d;else throw Error(`KyselyPlugin.transformQuery must return a node of the same kind that was given to it. The plugin was given a ${a.kind} but it returned a ${d.kind}`)}return a}async executeQuery(a){return await this.provideConnection(async b=>{let c=await b.executeQuery(a);return"numUpdatedOrDeletedRows"in c&&(0,f.u)("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await this.#au(c,a.queryId)})}async *stream(a,b){let{connection:c,release:d}=await (0,e.G)(this);try{for await(let d of c.streamQuery(a,b))yield await this.#au(d,a.queryId)}finally{d()}}async #au(a,b){for(let c of this.#at)a=await c.transformResult({result:a,queryId:b});return a}}},17793:(a,b,c)=>{"use strict";c.d(b,{b:()=>h});var d=c(60353),e=c(55914),f=c(28244);let g=(0,d.CN)({is:a=>"OnNode"===a.kind,create:a=>(0,d.CN)({kind:"OnNode",on:a}),cloneWithOperation:(a,b,c)=>(0,d.CN)({...a,on:"And"===b?e.s.create(a.on,c):f.K.create(a.on,c)})}),h=(0,d.CN)({is:a=>"JoinNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"JoinNode",joinType:a,table:b,on:void 0}),createWithOn:(a,b,c)=>(0,d.CN)({kind:"JoinNode",joinType:a,table:b,on:g.create(c)}),cloneWithOn:(a,b)=>(0,d.CN)({...a,on:a.on?g.cloneWithOperation(a.on,"And",b):g.create(b)})})},18804:(a,b,c)=>{"use strict";c.d(b,{L:()=>k});var d=c(60353),e=c(75227);let f=(0,d.CN)({is:a=>"GroupByNode"===a.kind,create:a=>(0,d.CN)({kind:"GroupByNode",items:(0,d.CN)(a)}),cloneWithItems:(a,b)=>(0,d.CN)({...a,items:(0,d.CN)([...a.items,...b])})});var g=c(55914),h=c(28244);let i=(0,d.CN)({is:a=>"HavingNode"===a.kind,create:a=>(0,d.CN)({kind:"HavingNode",having:a}),cloneWithOperation:(a,b,c)=>(0,d.CN)({...a,having:"And"===b?g.s.create(a.having,c):h.K.create(a.having,c)})});var j=c(4315);let k=(0,d.CN)({is:a=>"SelectQueryNode"===a.kind,create:a=>(0,d.CN)({kind:"SelectQueryNode",...a&&{with:a}}),createFrom:(a,b)=>(0,d.CN)({kind:"SelectQueryNode",from:e.N.create(a),...b&&{with:b}}),cloneWithSelections:(a,b)=>(0,d.CN)({...a,selections:a.selections?(0,d.CN)([...a.selections,...b]):(0,d.CN)(b)}),cloneWithDistinctOn:(a,b)=>(0,d.CN)({...a,distinctOn:a.distinctOn?(0,d.CN)([...a.distinctOn,...b]):(0,d.CN)(b)}),cloneWithFrontModifier:(a,b)=>(0,d.CN)({...a,frontModifiers:a.frontModifiers?(0,d.CN)([...a.frontModifiers,b]):(0,d.CN)([b])}),cloneWithOrderByItems:(a,b)=>j.L.cloneWithOrderByItems(a,b),cloneWithGroupByItems:(a,b)=>(0,d.CN)({...a,groupBy:a.groupBy?f.cloneWithItems(a.groupBy,b):f.create(b)}),cloneWithLimit:(a,b)=>(0,d.CN)({...a,limit:b}),cloneWithOffset:(a,b)=>(0,d.CN)({...a,offset:b}),cloneWithFetch:(a,b)=>(0,d.CN)({...a,fetch:b}),cloneWithHaving:(a,b)=>(0,d.CN)({...a,having:a.having?i.cloneWithOperation(a.having,"And",b):i.create(b)}),cloneWithSetOperations:(a,b)=>(0,d.CN)({...a,setOperations:a.setOperations?(0,d.CN)([...a.setOperations,...b]):(0,d.CN)([...b])}),cloneWithoutSelections:a=>(0,d.CN)({...a,selections:[]}),cloneWithoutLimit:a=>(0,d.CN)({...a,limit:void 0}),cloneWithoutOffset:a=>(0,d.CN)({...a,offset:void 0}),cloneWithoutOrderBy:a=>j.L.cloneWithoutOrderBy(a),cloneWithoutGroupBy:a=>(0,d.CN)({...a,groupBy:void 0})})},19151:(a,b,c)=>{"use strict";c.d(b,{B:()=>n});var d=c(44625),e=c(81266),f=c(17793),g=c(97831),h=c(42437),i=c(36923),j=c(69385);let k=(0,c(60353).CN)({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),l={json_agg:!0,to_json:!0};class m extends h.V{#av;#aw=new Set;#ax=new Set;constructor(a){super(),this.#av=a}transformNodeImpl(a,b){if(!this.#ay(a))return super.transformNodeImpl(a,b);let c=this.#az(a);for(let a of c)this.#ax.add(a);let d=this.#aA(a);for(let a of d)this.#aw.add(a);let e=super.transformNodeImpl(a,b);for(let a of d)this.#aw.delete(a);for(let a of c)this.#ax.delete(a);return e}transformSchemableIdentifier(a,b){let c=super.transformSchemableIdentifier(a,b);return c.schema||!this.#aw.has(a.identifier.name)?c:{...c,schema:e.O.create(this.#av)}}transformReferences(a,b){let c=super.transformReferences(a,b);return c.table.table.schema?c:{...c,table:j.H.createWithSchema(this.#av,c.table.table.identifier.name)}}transformAggregateFunction(a,b){return{...super.transformAggregateFunction({...a,aggregated:[]},b),aggregated:this.#aB(a,b,"aggregated")}}transformFunction(a,b){return{...super.transformFunction({...a,arguments:[]},b),arguments:this.#aB(a,b,"arguments")}}#aB(a,b,c){return l[a.func]?a[c].map(a=>!j.H.is(a)||a.table.schema?this.transformNode(a,b):{...a,table:this.transformIdentifier(a.table.identifier,b)}):this.transformNodeList(a[c],b)}#ay(a){return a.kind in k}#aA(a){let b=new Set;if("name"in a&&a.name&&i.y.is(a.name)&&this.#aC(a.name,b),"from"in a&&a.from)for(let c of a.from.froms)this.#aD(c,b);if("into"in a&&a.into&&this.#aD(a.into,b),"table"in a&&a.table&&this.#aD(a.table,b),"joins"in a&&a.joins)for(let c of a.joins)this.#aD(c.table,b);return"using"in a&&a.using&&(f.b.is(a.using)?this.#aD(a.using.table,b):this.#aD(a.using,b)),b}#az(a){let b=new Set;return"with"in a&&a.with&&this.#aE(a.with,b),b}#aD(a,b){if(j.H.is(a))this.#aC(a.table,b);else if(d.N.is(a)&&j.H.is(a.node))this.#aC(a.node.table,b);else if(g.v.is(a))for(let c of a.items)this.#aD(c,b)}#aC(a,b){let c=a.identifier.name;this.#aw.has(c)||this.#ax.has(c)||b.add(c)}#aE(a,b){for(let c of a.expressions){let a=c.name.table.table.identifier.name;this.#ax.has(a)||b.add(a)}}}class n{#Z;constructor(a){this.#Z=new m(a)}transformQuery(a){return this.#Z.transformNode(a.node,a.queryId)}async transformResult(a){return a.result}}},19795:(a,b,c)=>{"use strict";c.d(b,{JB:()=>j,M$:()=>m,Xm:()=>l,uJ:()=>k});var d=c(60353),e=c(44625),f=c(69385),g=c(57105),h=c(81266),i=c(20527);function j(a){return(0,d.MH)(a)?a.map(a=>k(a)):[k(a)]}function k(a){return(0,d.Kg)(a)?l(a):(0,i.uc)(a)?a.toOperationNode():(0,g.v0)(a)}function l(a){let b=" as ";if(!a.includes(b))return m(a);{let[c,d]=a.split(b).map(n);return e.N.create(m(c),h.O.create(d))}}function m(a){if(!a.includes("."))return f.H.create(a);{let[b,c]=a.split(".").map(n);return f.H.createWithSchema(b,c)}}function n(a){return a.trim()}},20527:(a,b,c)=>{"use strict";c.d(b,{bj:()=>i,uc:()=>k});var d=c(44625),e=c(81266),f=c(39450),g=c(19795),h=c(60353);class i{#aF;get table(){return this.#aF}constructor(a){this.#aF=a}as(a){return new j(this.#aF,a)}}class j{#aF;#aG;get table(){return this.#aF}get alias(){return this.#aG}constructor(a,b){this.#aF=a,this.#aG=b}toOperationNode(){return d.N.create((0,g.M$)(this.#aF),e.O.create(this.#aG))}}function k(a){return(0,h.Gv)(a)&&(0,f.N)(a)&&(0,h.Kg)(a.table)&&(0,h.Kg)(a.alias)}},22795:(a,b,c)=>{"use strict";c.d(b,{W:()=>f});var d=c(12034);class e extends d.R{get adapter(){throw Error("this query cannot be compiled to SQL")}compileQuery(){throw Error("this query cannot be compiled to SQL")}provideConnection(){throw Error("this query cannot be executed")}withConnectionProvider(){throw Error("this query cannot have a connection provider")}withPlugin(a){return new e([...this.plugins,a])}withPlugins(a){return new e([...this.plugins,...a])}withPluginAtFront(a){return new e([a,...this.plugins])}withoutPlugins(){return new e([])}}let f=new e},23090:(a,b,c)=>{"use strict";c.d(b,{E:()=>g});var d=c(31575),e=c(60353),f=c(31700);let g=(0,e.CN)({raw:(a,b=[])=>(0,e.CN)({sql:a,query:d.z.createWithSql(a),parameters:(0,e.CN)(b),queryId:(0,f.a)()})})},24118:(a,b,c)=>{"use strict";c.d(b,{r:()=>f});var d=c(60353),e=c(33423);let f=(0,d.CN)({is:a=>"MergeQueryNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"MergeQueryNode",into:a,...b&&{with:b}}),cloneWithUsing:(a,b)=>(0,d.CN)({...a,using:b}),cloneWithWhen:(a,b)=>(0,d.CN)({...a,whens:a.whens?(0,d.CN)([...a.whens,b]):(0,d.CN)([b])}),cloneWithThen:(a,b)=>(0,d.CN)({...a,whens:a.whens?(0,d.CN)([...a.whens.slice(0,-1),e.t.cloneWithResult(a.whens[a.whens.length-1],b)]):void 0})})},27646:(a,b,c)=>{"use strict";c.d(b,{C:()=>h,g:()=>g});var d=c(39450),e=c(2952),f=c(60353);class g{#aH;get dynamicReference(){return this.#aH}get refType(){}constructor(a){this.#aH=a}toOperationNode(){return(0,e.vd)(this.#aH)}}function h(a){return(0,f.Gv)(a)&&(0,d.N)(a)&&(0,f.Kg)(a.dynamicReference)}},28244:(a,b,c)=>{"use strict";c.d(b,{K:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"OrNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"OrNode",left:a,right:b})})},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31009:(a,b,c)=>{"use strict";c.d(b,{Z:()=>f});var d=c(60353),e=c(81266);let f=(0,d.CN)({is:a=>"ColumnNode"===a.kind,create:a=>(0,d.CN)({kind:"ColumnNode",column:e.O.create(a)})})},31575:(a,b,c)=>{"use strict";c.d(b,{z:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"RawNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"RawNode",sqlFragments:(0,d.CN)(a),parameters:(0,d.CN)(b)}),createWithSql:a=>e.create([a],[]),createWithChild:a=>e.create(["",""],[a]),createWithChildren:a=>e.create(Array(a.length+1).fill(""),a)})},31700:(a,b,c)=>{"use strict";c.d(b,{a:()=>e});var d=c(96931);function e(){return new f}class f{#aI;get queryId(){return void 0===this.#aI&&(this.#aI=(0,d.D)(8)),this.#aI}}},33423:(a,b,c)=>{"use strict";c.d(b,{t:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"WhenNode"===a.kind,create:a=>(0,d.CN)({kind:"WhenNode",condition:a}),cloneWithResult:(a,b)=>(0,d.CN)({...a,result:b})})},34220:(a,b,c)=>{"use strict";c.d(b,{l:()=>r});var d=c(81266),e=c(39450),f=c(31575),g=c(90350),h=c(2952),i=c(19795),j=c(82324),k=c(31700),l=c(44625),m=c(60353),n=c(22795);class o{#Y;constructor(a){this.#Y=(0,m.CN)(a)}get expressionType(){}get isRawBuilder(){return!0}as(a){return new q(this,a)}$castTo(){return new o({...this.#Y})}$notNull(){return new o(this.#Y)}withPlugin(a){return new o({...this.#Y,plugins:void 0!==this.#Y.plugins?(0,m.CN)([...this.#Y.plugins,a]):(0,m.CN)([a])})}toOperationNode(){return this.#aJ(this.#aK())}compile(a){return this.#aL(this.#aK(a))}async execute(a){let b=this.#aK(a);return b.executeQuery(this.#aL(b))}#aK(a){let b=void 0!==a?a.getExecutor():n.W;return void 0!==this.#Y.plugins?b.withPlugins(this.#Y.plugins):b}#aJ(a){return a.transformQuery(this.#Y.rawNode,this.#Y.queryId)}#aL(a){return a.compileQuery(this.#aJ(a),this.#Y.queryId)}}function p(a){return new o(a)}class q{#aM;#aG;constructor(a,b){this.#aM=a,this.#aG=b}get expression(){return this.#aM}get alias(){return this.#aG}get rawBuilder(){return this.#aM}toOperationNode(){return l.N.create(this.#aM.toOperationNode(),(0,e.N)(this.#aG)?this.#aG.toOperationNode():d.O.create(this.#aG))}}let r=Object.assign((a,...b)=>p({queryId:(0,k.a)(),rawNode:f.z.create(a,b?.map(s)??[])}),{ref:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild((0,h.q5)(a))}),val:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild((0,j.$s)(a))}),value(a){return this.val(a)},table:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild((0,i.M$)(a))}),id(...a){let b=Array(a.length+1).fill(".");return b[0]="",b[b.length-1]="",p({queryId:(0,k.a)(),rawNode:f.z.create(b,a.map(d.O.create))})},lit:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild(g.q.createImmediate(a))}),literal(a){return this.lit(a)},raw:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithSql(a)}),join(a,b=r`, `){let c=Array(Math.max(2*a.length-1,0)),d=b.toOperationNode();for(let b=0;b<a.length;++b)c[2*b]=s(a[b]),b!==a.length-1&&(c[2*b+1]=d);return p({queryId:(0,k.a)(),rawNode:f.z.createWithChildren(c)})}});function s(a){return(0,e.N)(a)?a.toOperationNode():(0,j.$s)(a)}},36903:(a,b,c)=>{"use strict";c.d(b,{f:()=>f});var d=c(60353);let e=(0,d.CN)({is:a=>"TopNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"TopNode",expression:a,modifiers:b})});function f(a,b){var c;if(!(0,d.Et)(a)&&!(0,d.sI)(a))throw Error(`Invalid top expression: ${a}`);if(!(0,d.b0)(b)&&"percent"!==(c=b)&&"with ties"!==c&&"percent with ties"!==c)throw Error(`Invalid top modifiers: ${b}`);return e.create(a,b)}},36923:(a,b,c)=>{"use strict";c.d(b,{y:()=>f});var d=c(60353),e=c(81266);let f=(0,d.CN)({is:a=>"SchemableIdentifierNode"===a.kind,create:a=>(0,d.CN)({kind:"SchemableIdentifierNode",identifier:e.O.create(a)}),createWithSchema:(a,b)=>(0,d.CN)({kind:"SchemableIdentifierNode",schema:e.O.create(a),identifier:e.O.create(b)})})},37381:(a,b,c)=>{"use strict";c.d(b,{c:()=>d});class d{#w;#x;#aN;constructor(){this.#w=new Promise((a,b)=>{this.#aN=b,this.#x=a})}get promise(){return this.#w}resolve=a=>{this.#x&&this.#x(a)};reject=a=>{this.#aN&&this.#aN(a)}}},38729:(a,b,c)=>{"use strict";c.d(b,{Q:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"JSONReferenceNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"JSONReferenceNode",reference:a,traversal:b}),cloneWithTraversal:(a,b)=>(0,d.CN)({...a,traversal:b})})},39281:(a,b,c)=>{"use strict";c.d(b,{O:()=>K,A:()=>L});var d=c(90423),e=c(18804),f=c(19795),g=c(19151),h=c(31700),i=c(71644),j=c(2952),k=c(53284),l=c(94296),m=c(77688),n=c(40659),o=c(60353);let p=(0,o.CN)({is:a=>"UnaryOperationNode"===a.kind,create:(a,b)=>(0,o.CN)({kind:"UnaryOperationNode",operator:a,operand:b})});var q=c(82324),r=c(22795),s=c(61238),t=c(69079),u=c(44625),v=c(81266),w=c(80906);let x=(0,o.CN)({is:a=>"JSONPathLegNode"===a.kind,create:(a,b)=>(0,o.CN)({kind:"JSONPathLegNode",type:a,value:b})});var y=c(67183),z=c(38729),A=c(39450),B=c(90350);class C{#V;constructor(a){this.#V=a}at(a){return this.#aO("ArrayLocation",a)}key(a){return this.#aO("Member",a)}#aO(a,b){return new D(z.Q.is(this.#V)?z.Q.cloneWithTraversal(this.#V,y.c.is(this.#V.traversal)?y.c.cloneWithLeg(this.#V.traversal,x.create(a,b)):w.k.cloneWithValue(this.#V.traversal,B.q.createImmediate(b))):y.c.cloneWithLeg(this.#V,x.create(a,b)))}}class D extends C{#V;constructor(a){super(a),this.#V=a}get expressionType(){}as(a){return new E(this,a)}$castTo(){return new D(this.#V)}$notNull(){return new D(this.#V)}toOperationNode(){return this.#V}}class E{#aP;#aG;constructor(a,b){this.#aP=a,this.#aG=b}get expression(){return this.#aP}get alias(){return this.#aG}toOperationNode(){return u.N.create(this.#aP.toOperationNode(),(0,A.N)(this.#aG)?this.#aG.toOperationNode():v.O.create(this.#aG))}}var F=c(56112),G=c(55914);let H=(0,o.CN)({is:a=>"TupleNode"===a.kind,create:a=>(0,o.CN)({kind:"TupleNode",values:(0,o.CN)(a)})});var I=c(43926);let J=(0,o.CN)({is:a=>"CastNode"===a.kind,create:(a,b)=>(0,o.CN)({kind:"CastNode",expression:a,dataType:b})});function K(a=r.W){function b(a,b){return new m.Is(p.create(n.zX.create(a),(0,j.$O)(b)))}let c=Object.assign(function(a,b,c){return new m.Is((0,k.ds)(a,b,c))},{fn:void 0,eb:void 0,selectFrom:b=>(0,d.c)({queryId:(0,h.a)(),executor:a,queryNode:e.L.createFrom((0,f.JB)(b))}),case:a=>new s.OU({node:t.P.create((0,o.b0)(a)?void 0:(0,j.$O)(a))}),ref:(a,b)=>(0,o.b0)(b)?new m.Is((0,j.q5)(a)):new C((0,j.NF)(a,b)),jsonPath:()=>new C(y.c.create()),table:a=>new m.Is((0,f.M$)(a)),val:a=>new m.Is((0,q.$s)(a)),refTuple:(...a)=>new m.Is(H.create(a.map(j.$O))),tuple:(...a)=>new m.Is(H.create(a.map(q.$s))),lit:a=>new m.Is((0,q.dJ)(a)),unary:b,not:a=>b("not",a),exists:a=>b("exists",a),neg:a=>b("-",a),between:(a,b,c)=>new m.Is(F.l.create((0,j.$O)(a),n.zX.create("between"),G.s.create((0,q.$s)(b),(0,q.$s)(c)))),betweenSymmetric:(a,b,c)=>new m.Is(F.l.create((0,j.$O)(a),n.zX.create("between symmetric"),G.s.create((0,q.$s)(b),(0,q.$s)(c)))),and:a=>new m.Is((0,o.MH)(a)?(0,k.KN)(a,"and"):(0,k.Ve)(a,"and")),or:a=>new m.Is((0,o.MH)(a)?(0,k.KN)(a,"or"):(0,k.Ve)(a,"or")),parens(...a){let b=(0,k.GB)(a);return new m.Is(l.k.is(b)?b:l.k.create(b))},cast:(a,b)=>new m.Is(J.create((0,j.$O)(a),(0,I.Q)(b))),withSchema:b=>K(a.withPluginAtFront(new g.B(b)))});return c.fn=(0,i.t)(),c.eb=c,c}function L(a){return K()}},39450:(a,b,c)=>{"use strict";c.d(b,{N:()=>e});var d=c(60353);function e(a){return(0,d.Gv)(a)&&(0,d.Tn)(a.toOperationNode)}},40659:(a,b,c)=>{"use strict";c.d(b,{Xm:()=>h,we:()=>f,zX:()=>g});var d=c(60353);let e=["->","->>"],f=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from","+","-","*","/","%","^","&","|","#","<<",">>","&&","||",...e,"not","-","exists","not exists","between","between symmetric"],g=(0,d.CN)({is:a=>"OperatorNode"===a.kind,create:a=>(0,d.CN)({kind:"OperatorNode",operator:a})});function h(a){return(0,d.Kg)(a)&&e.includes(a)}},42437:(a,b,c)=>{"use strict";c.d(b,{V:()=>e});var d=c(60353);class e{nodeStack=[];#aQ=(0,d.CN)({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)});transformNode(a,b){if(!a)return a;this.nodeStack.push(a);let c=this.transformNodeImpl(a,b);return this.nodeStack.pop(),(0,d.CN)(c)}transformNodeImpl(a,b){return this.#aQ[a.kind](a,b)}transformNodeList(a,b){return a?(0,d.CN)(a.map(a=>this.transformNode(a,b))):a}transformSelectQuery(a,b){return{kind:"SelectQueryNode",from:this.transformNode(a.from,b),selections:this.transformNodeList(a.selections,b),distinctOn:this.transformNodeList(a.distinctOn,b),joins:this.transformNodeList(a.joins,b),groupBy:this.transformNode(a.groupBy,b),orderBy:this.transformNode(a.orderBy,b),where:this.transformNode(a.where,b),frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),limit:this.transformNode(a.limit,b),offset:this.transformNode(a.offset,b),with:this.transformNode(a.with,b),having:this.transformNode(a.having,b),explain:this.transformNode(a.explain,b),setOperations:this.transformNodeList(a.setOperations,b),fetch:this.transformNode(a.fetch,b),top:this.transformNode(a.top,b)}}transformSelection(a,b){return{kind:"SelectionNode",selection:this.transformNode(a.selection,b)}}transformColumn(a,b){return{kind:"ColumnNode",column:this.transformNode(a.column,b)}}transformAlias(a,b){return{kind:"AliasNode",node:this.transformNode(a.node,b),alias:this.transformNode(a.alias,b)}}transformTable(a,b){return{kind:"TableNode",table:this.transformNode(a.table,b)}}transformFrom(a,b){return{kind:"FromNode",froms:this.transformNodeList(a.froms,b)}}transformReference(a,b){return{kind:"ReferenceNode",column:this.transformNode(a.column,b),table:this.transformNode(a.table,b)}}transformAnd(a,b){return{kind:"AndNode",left:this.transformNode(a.left,b),right:this.transformNode(a.right,b)}}transformOr(a,b){return{kind:"OrNode",left:this.transformNode(a.left,b),right:this.transformNode(a.right,b)}}transformValueList(a,b){return{kind:"ValueListNode",values:this.transformNodeList(a.values,b)}}transformParens(a,b){return{kind:"ParensNode",node:this.transformNode(a.node,b)}}transformJoin(a,b){return{kind:"JoinNode",joinType:a.joinType,table:this.transformNode(a.table,b),on:this.transformNode(a.on,b)}}transformRaw(a,b){return{kind:"RawNode",sqlFragments:(0,d.CN)([...a.sqlFragments]),parameters:this.transformNodeList(a.parameters,b)}}transformWhere(a,b){return{kind:"WhereNode",where:this.transformNode(a.where,b)}}transformInsertQuery(a,b){return{kind:"InsertQueryNode",into:this.transformNode(a.into,b),columns:this.transformNodeList(a.columns,b),values:this.transformNode(a.values,b),returning:this.transformNode(a.returning,b),onConflict:this.transformNode(a.onConflict,b),onDuplicateKey:this.transformNode(a.onDuplicateKey,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),ignore:a.ignore,orAction:this.transformNode(a.orAction,b),replace:a.replace,explain:this.transformNode(a.explain,b),defaultValues:a.defaultValues,top:this.transformNode(a.top,b),output:this.transformNode(a.output,b)}}transformValues(a,b){return{kind:"ValuesNode",values:this.transformNodeList(a.values,b)}}transformDeleteQuery(a,b){return{kind:"DeleteQueryNode",from:this.transformNode(a.from,b),using:this.transformNode(a.using,b),joins:this.transformNodeList(a.joins,b),where:this.transformNode(a.where,b),returning:this.transformNode(a.returning,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),orderBy:this.transformNode(a.orderBy,b),limit:this.transformNode(a.limit,b),explain:this.transformNode(a.explain,b),top:this.transformNode(a.top,b),output:this.transformNode(a.output,b)}}transformReturning(a,b){return{kind:"ReturningNode",selections:this.transformNodeList(a.selections,b)}}transformCreateTable(a,b){return{kind:"CreateTableNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),constraints:this.transformNodeList(a.constraints,b),temporary:a.temporary,ifNotExists:a.ifNotExists,onCommit:a.onCommit,frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),selectQuery:this.transformNode(a.selectQuery,b)}}transformColumnDefinition(a,b){return{kind:"ColumnDefinitionNode",column:this.transformNode(a.column,b),dataType:this.transformNode(a.dataType,b),references:this.transformNode(a.references,b),primaryKey:a.primaryKey,autoIncrement:a.autoIncrement,unique:a.unique,notNull:a.notNull,unsigned:a.unsigned,defaultTo:this.transformNode(a.defaultTo,b),check:this.transformNode(a.check,b),generated:this.transformNode(a.generated,b),frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),nullsNotDistinct:a.nullsNotDistinct,identity:a.identity,ifNotExists:a.ifNotExists}}transformAddColumn(a,b){return{kind:"AddColumnNode",column:this.transformNode(a.column,b)}}transformDropTable(a,b){return{kind:"DropTableNode",table:this.transformNode(a.table,b),ifExists:a.ifExists,cascade:a.cascade}}transformOrderBy(a,b){return{kind:"OrderByNode",items:this.transformNodeList(a.items,b)}}transformOrderByItem(a,b){return{kind:"OrderByItemNode",orderBy:this.transformNode(a.orderBy,b),direction:this.transformNode(a.direction,b),collation:this.transformNode(a.collation,b),nulls:a.nulls}}transformGroupBy(a,b){return{kind:"GroupByNode",items:this.transformNodeList(a.items,b)}}transformGroupByItem(a,b){return{kind:"GroupByItemNode",groupBy:this.transformNode(a.groupBy,b)}}transformUpdateQuery(a,b){return{kind:"UpdateQueryNode",table:this.transformNode(a.table,b),from:this.transformNode(a.from,b),joins:this.transformNodeList(a.joins,b),where:this.transformNode(a.where,b),updates:this.transformNodeList(a.updates,b),returning:this.transformNode(a.returning,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),explain:this.transformNode(a.explain,b),limit:this.transformNode(a.limit,b),top:this.transformNode(a.top,b),output:this.transformNode(a.output,b),orderBy:this.transformNode(a.orderBy,b)}}transformColumnUpdate(a,b){return{kind:"ColumnUpdateNode",column:this.transformNode(a.column,b),value:this.transformNode(a.value,b)}}transformLimit(a,b){return{kind:"LimitNode",limit:this.transformNode(a.limit,b)}}transformOffset(a,b){return{kind:"OffsetNode",offset:this.transformNode(a.offset,b)}}transformOnConflict(a,b){return{kind:"OnConflictNode",columns:this.transformNodeList(a.columns,b),constraint:this.transformNode(a.constraint,b),indexExpression:this.transformNode(a.indexExpression,b),indexWhere:this.transformNode(a.indexWhere,b),updates:this.transformNodeList(a.updates,b),updateWhere:this.transformNode(a.updateWhere,b),doNothing:a.doNothing}}transformOnDuplicateKey(a,b){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(a.updates,b)}}transformCreateIndex(a,b){return{kind:"CreateIndexNode",name:this.transformNode(a.name,b),table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),unique:a.unique,using:this.transformNode(a.using,b),ifNotExists:a.ifNotExists,where:this.transformNode(a.where,b),nullsNotDistinct:a.nullsNotDistinct}}transformList(a,b){return{kind:"ListNode",items:this.transformNodeList(a.items,b)}}transformDropIndex(a,b){return{kind:"DropIndexNode",name:this.transformNode(a.name,b),table:this.transformNode(a.table,b),ifExists:a.ifExists,cascade:a.cascade}}transformPrimaryKeyConstraint(a,b){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(a.columns,b),name:this.transformNode(a.name,b),deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformUniqueConstraint(a,b){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(a.columns,b),name:this.transformNode(a.name,b),nullsNotDistinct:a.nullsNotDistinct,deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformForeignKeyConstraint(a,b){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(a.columns,b),references:this.transformNode(a.references,b),name:this.transformNode(a.name,b),onDelete:a.onDelete,onUpdate:a.onUpdate,deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformSetOperation(a,b){return{kind:"SetOperationNode",operator:a.operator,expression:this.transformNode(a.expression,b),all:a.all}}transformReferences(a,b){return{kind:"ReferencesNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),onDelete:a.onDelete,onUpdate:a.onUpdate}}transformCheckConstraint(a,b){return{kind:"CheckConstraintNode",expression:this.transformNode(a.expression,b),name:this.transformNode(a.name,b)}}transformWith(a,b){return{kind:"WithNode",expressions:this.transformNodeList(a.expressions,b),recursive:a.recursive}}transformCommonTableExpression(a,b){return{kind:"CommonTableExpressionNode",name:this.transformNode(a.name,b),materialized:a.materialized,expression:this.transformNode(a.expression,b)}}transformCommonTableExpressionName(a,b){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b)}}transformHaving(a,b){return{kind:"HavingNode",having:this.transformNode(a.having,b)}}transformCreateSchema(a,b){return{kind:"CreateSchemaNode",schema:this.transformNode(a.schema,b),ifNotExists:a.ifNotExists}}transformDropSchema(a,b){return{kind:"DropSchemaNode",schema:this.transformNode(a.schema,b),ifExists:a.ifExists,cascade:a.cascade}}transformAlterTable(a,b){return{kind:"AlterTableNode",table:this.transformNode(a.table,b),renameTo:this.transformNode(a.renameTo,b),setSchema:this.transformNode(a.setSchema,b),columnAlterations:this.transformNodeList(a.columnAlterations,b),addConstraint:this.transformNode(a.addConstraint,b),dropConstraint:this.transformNode(a.dropConstraint,b),renameConstraint:this.transformNode(a.renameConstraint,b),addIndex:this.transformNode(a.addIndex,b),dropIndex:this.transformNode(a.dropIndex,b)}}transformDropColumn(a,b){return{kind:"DropColumnNode",column:this.transformNode(a.column,b)}}transformRenameColumn(a,b){return{kind:"RenameColumnNode",column:this.transformNode(a.column,b),renameTo:this.transformNode(a.renameTo,b)}}transformAlterColumn(a,b){return{kind:"AlterColumnNode",column:this.transformNode(a.column,b),dataType:this.transformNode(a.dataType,b),dataTypeExpression:this.transformNode(a.dataTypeExpression,b),setDefault:this.transformNode(a.setDefault,b),dropDefault:a.dropDefault,setNotNull:a.setNotNull,dropNotNull:a.dropNotNull}}transformModifyColumn(a,b){return{kind:"ModifyColumnNode",column:this.transformNode(a.column,b)}}transformAddConstraint(a,b){return{kind:"AddConstraintNode",constraint:this.transformNode(a.constraint,b)}}transformDropConstraint(a,b){return{kind:"DropConstraintNode",constraintName:this.transformNode(a.constraintName,b),ifExists:a.ifExists,modifier:a.modifier}}transformRenameConstraint(a,b){return{kind:"RenameConstraintNode",oldName:this.transformNode(a.oldName,b),newName:this.transformNode(a.newName,b)}}transformCreateView(a,b){return{kind:"CreateViewNode",name:this.transformNode(a.name,b),temporary:a.temporary,orReplace:a.orReplace,ifNotExists:a.ifNotExists,materialized:a.materialized,columns:this.transformNodeList(a.columns,b),as:this.transformNode(a.as,b)}}transformRefreshMaterializedView(a,b){return{kind:"RefreshMaterializedViewNode",name:this.transformNode(a.name,b),concurrently:a.concurrently,withNoData:a.withNoData}}transformDropView(a,b){return{kind:"DropViewNode",name:this.transformNode(a.name,b),ifExists:a.ifExists,materialized:a.materialized,cascade:a.cascade}}transformGenerated(a,b){return{kind:"GeneratedNode",byDefault:a.byDefault,always:a.always,identity:a.identity,stored:a.stored,expression:this.transformNode(a.expression,b)}}transformDefaultValue(a,b){return{kind:"DefaultValueNode",defaultValue:this.transformNode(a.defaultValue,b)}}transformOn(a,b){return{kind:"OnNode",on:this.transformNode(a.on,b)}}transformSelectModifier(a,b){return{kind:"SelectModifierNode",modifier:a.modifier,rawModifier:this.transformNode(a.rawModifier,b),of:this.transformNodeList(a.of,b)}}transformCreateType(a,b){return{kind:"CreateTypeNode",name:this.transformNode(a.name,b),enum:this.transformNode(a.enum,b)}}transformDropType(a,b){return{kind:"DropTypeNode",name:this.transformNode(a.name,b),ifExists:a.ifExists}}transformExplain(a,b){return{kind:"ExplainNode",format:a.format,options:this.transformNode(a.options,b)}}transformSchemableIdentifier(a,b){return{kind:"SchemableIdentifierNode",schema:this.transformNode(a.schema,b),identifier:this.transformNode(a.identifier,b)}}transformAggregateFunction(a,b){return{kind:"AggregateFunctionNode",func:a.func,aggregated:this.transformNodeList(a.aggregated,b),distinct:a.distinct,orderBy:this.transformNode(a.orderBy,b),withinGroup:this.transformNode(a.withinGroup,b),filter:this.transformNode(a.filter,b),over:this.transformNode(a.over,b)}}transformOver(a,b){return{kind:"OverNode",orderBy:this.transformNode(a.orderBy,b),partitionBy:this.transformNode(a.partitionBy,b)}}transformPartitionBy(a,b){return{kind:"PartitionByNode",items:this.transformNodeList(a.items,b)}}transformPartitionByItem(a,b){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(a.partitionBy,b)}}transformBinaryOperation(a,b){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(a.leftOperand,b),operator:this.transformNode(a.operator,b),rightOperand:this.transformNode(a.rightOperand,b)}}transformUnaryOperation(a,b){return{kind:"UnaryOperationNode",operator:this.transformNode(a.operator,b),operand:this.transformNode(a.operand,b)}}transformUsing(a,b){return{kind:"UsingNode",tables:this.transformNodeList(a.tables,b)}}transformFunction(a,b){return{kind:"FunctionNode",func:a.func,arguments:this.transformNodeList(a.arguments,b)}}transformCase(a,b){return{kind:"CaseNode",value:this.transformNode(a.value,b),when:this.transformNodeList(a.when,b),else:this.transformNode(a.else,b),isStatement:a.isStatement}}transformWhen(a,b){return{kind:"WhenNode",condition:this.transformNode(a.condition,b),result:this.transformNode(a.result,b)}}transformJSONReference(a,b){return{kind:"JSONReferenceNode",reference:this.transformNode(a.reference,b),traversal:this.transformNode(a.traversal,b)}}transformJSONPath(a,b){return{kind:"JSONPathNode",inOperator:this.transformNode(a.inOperator,b),pathLegs:this.transformNodeList(a.pathLegs,b)}}transformJSONPathLeg(a,b){return{kind:"JSONPathLegNode",type:a.type,value:a.value}}transformJSONOperatorChain(a,b){return{kind:"JSONOperatorChainNode",operator:this.transformNode(a.operator,b),values:this.transformNodeList(a.values,b)}}transformTuple(a,b){return{kind:"TupleNode",values:this.transformNodeList(a.values,b)}}transformMergeQuery(a,b){return{kind:"MergeQueryNode",into:this.transformNode(a.into,b),using:this.transformNode(a.using,b),whens:this.transformNodeList(a.whens,b),with:this.transformNode(a.with,b),top:this.transformNode(a.top,b),endModifiers:this.transformNodeList(a.endModifiers,b),output:this.transformNode(a.output,b),returning:this.transformNode(a.returning,b)}}transformMatched(a,b){return{kind:"MatchedNode",not:a.not,bySource:a.bySource}}transformAddIndex(a,b){return{kind:"AddIndexNode",name:this.transformNode(a.name,b),columns:this.transformNodeList(a.columns,b),unique:a.unique,using:this.transformNode(a.using,b),ifNotExists:a.ifNotExists}}transformCast(a,b){return{kind:"CastNode",expression:this.transformNode(a.expression,b),dataType:this.transformNode(a.dataType,b)}}transformFetch(a,b){return{kind:"FetchNode",rowCount:this.transformNode(a.rowCount,b),modifier:a.modifier}}transformTop(a,b){return{kind:"TopNode",expression:a.expression,modifiers:a.modifiers}}transformOutput(a,b){return{kind:"OutputNode",selections:this.transformNodeList(a.selections,b)}}transformDataType(a,b){return a}transformSelectAll(a,b){return a}transformIdentifier(a,b){return a}transformValue(a,b){return a}transformPrimitiveValueList(a,b){return a}transformOperator(a,b){return a}transformDefaultInsertValue(a,b){return a}transformOrAction(a,b){return a}transformCollate(a,b){return a}}},43926:(a,b,c)=>{"use strict";c.d(b,{Q:()=>i});var d=c(60353);let e=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],f=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],g=(0,d.CN)({is:a=>"DataTypeNode"===a.kind,create:a=>(0,d.CN)({kind:"DataTypeNode",dataType:a})});var h=c(39450);function i(a){if((0,h.N)(a))return a.toOperationNode();if(e.includes(a)||f.some(b=>b.test(a)))return g.create(a);throw Error(`invalid column data type ${JSON.stringify(a)}`)}},44625:(a,b,c)=>{"use strict";c.d(b,{N:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"AliasNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"AliasNode",node:a,alias:b})})},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47467:(a,b,c)=>{"use strict";c.d(b,{o:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"InsertQueryNode"===a.kind,create:(a,b,c)=>(0,d.CN)({kind:"InsertQueryNode",into:a,...b&&{with:b},replace:c}),createWithoutInto:()=>(0,d.CN)({kind:"InsertQueryNode"}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},47777:(a,b,c)=>{"use strict";c.d(b,{O:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"OrderByNode"===a.kind,create:a=>(0,d.CN)({kind:"OrderByNode",items:(0,d.CN)([...a])}),cloneWithItems:(a,b)=>(0,d.CN)({...a,items:(0,d.CN)([...a.items,...b])})})},48137:(a,b,c)=>{"use strict";c.d(b,{G:()=>f});var d=c(37381),e=c(60353);async function f(a){let b=new d.c,c=new d.c;return a.provideConnection(async a=>(b.resolve(a),await c.promise)).catch(a=>b.reject(a)),(0,e.CN)({connection:await b.promise,release:c.resolve})}},49374:(a,b,c)=>{"use strict";c.d(b,{q:()=>f});var d=c(9005),e=c(60353);let f=(0,e.CN)({is:a=>"ReferenceNode"===a.kind,create:(a,b)=>(0,e.CN)({kind:"ReferenceNode",table:b,column:a}),createSelectAll:a=>(0,e.CN)({kind:"ReferenceNode",table:a,column:d.U.create()})})},51591:(a,b,c)=>{"use strict";c.d(b,{a:()=>h});var d=c(17793),e=c(53284),f=c(71088),g=c(19795);function h(a,b){var c,h,i,j,k,l,m,n;if(3===b.length){return c=a,h=b[0],i=b[1],j=b[2],d.b.createWithOn(c,(0,g.uJ)(h),(0,e.vC)(i,"=",j))}if(2===b.length){return k=a,l=b[0],(0,b[1])((0,f.GQ)(k,l)).toOperationNode()}if(1===b.length){return m=a,n=b[0],d.b.create(m,(0,g.uJ)(n))}throw Error("not implemented")}},53284:(a,b,c)=>{"use strict";c.d(b,{GB:()=>n,KN:()=>r,Ve:()=>q,ds:()=>o,vC:()=>p});var d=c(56112),e=c(60353),f=c(39450),g=c(40659),h=c(2952),i=c(82324),j=c(90350),k=c(55914),l=c(94296),m=c(28244);function n(a){if(3===a.length)return o(a[0],a[1],a[2]);if(1===a.length)return(0,i.$s)(a[0]);throw Error(`invalid arguments: ${JSON.stringify(a)}`)}function o(a,b,c){var e;return("is"===(e=b)||"is not"===e)&&s(c)?d.l.create((0,h.$O)(a),t(b),j.q.createImmediate(c)):d.l.create((0,h.$O)(a),t(b),(0,i.U2)(c))}function p(a,b,c){return d.l.create((0,h.$O)(a),t(b),(0,h.$O)(c))}function q(a,b){return r(Object.entries(a).filter(([,a])=>!(0,e.b0)(a)).map(([a,b])=>o(a,s(b)?"is":"=",b)),b)}function r(a,b,c=!0){let e="and"===b?k.s.create:m.K.create;if(0===a.length)return d.l.create(j.q.createImmediate(1),g.zX.create("="),j.q.createImmediate(+("and"===b)));let f=u(a[0]);for(let b=1;b<a.length;++b)f=e(f,u(a[b]));return a.length>1&&c?l.k.create(f):f}function s(a){return(0,e.kZ)(a)||(0,e.Lm)(a)}function t(a){if((0,e.Kg)(a)&&g.we.includes(a))return g.zX.create(a);if((0,f.N)(a))return a.toOperationNode();throw Error(`invalid operator ${JSON.stringify(a)}`)}function u(a){return(0,f.N)(a)?a.toOperationNode():a}},54315:(a,b,c)=>{"use strict";c.d(b,{h:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"PrimitiveValueListNode"===a.kind,create:a=>(0,d.CN)({kind:"PrimitiveValueListNode",values:(0,d.CN)([...a])})})},54744:(a,b,c)=>{"use strict";c.d(b,{o:()=>g});var d=c(60353),e=c(55914),f=c(28244);let g=(0,d.CN)({is:a=>"WhereNode"===a.kind,create:a=>(0,d.CN)({kind:"WhereNode",where:a}),cloneWithOperation:(a,b,c)=>(0,d.CN)({...a,where:"And"===b?e.s.create(a.where,c):f.K.create(a.where,c)})})},55914:(a,b,c)=>{"use strict";c.d(b,{s:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"AndNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"AndNode",left:a,right:b})})},56112:(a,b,c)=>{"use strict";c.d(b,{l:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"BinaryOperationNode"===a.kind,create:(a,b,c)=>(0,d.CN)({kind:"BinaryOperationNode",leftOperand:a,operator:b,rightOperand:c})})},57105:(a,b,c)=>{"use strict";c.d(b,{SS:()=>j,YK:()=>h,v0:()=>i});var d=c(70010),e=c(39450),f=c(39281),g=c(60353);function h(a){if((0,e.N)(a))return a.toOperationNode();if((0,g.Tn)(a))return a((0,f.A)()).toOperationNode();throw Error(`invalid expression: ${JSON.stringify(a)}`)}function i(a){if((0,e.N)(a))return a.toOperationNode();if((0,g.Tn)(a))return a((0,f.A)()).toOperationNode();throw Error(`invalid aliased expression: ${JSON.stringify(a)}`)}function j(a){return(0,d.B)(a)||(0,d.q)(a)||(0,g.Tn)(a)}},60353:(a,b,c)=>{"use strict";function d(a){return void 0===a||void 0===a}function e(a){return"string"==typeof a}function f(a){return"number"==typeof a}function g(a){return"boolean"==typeof a}function h(a){return null===a}function i(a){return a instanceof Date}function j(a){return"bigint"==typeof a}function k(a){return"undefined"!=typeof Buffer&&Buffer.isBuffer(a)}function l(a){return"function"==typeof a}function m(a){return"object"==typeof a&&null!==a}function n(a){return Object.freeze(a)}function o(a){return p(a)?a:[a]}function p(a){return Array.isArray(a)}function q(a){return a}c.d(b,{$P:()=>i,CN:()=>n,Et:()=>f,Gv:()=>m,Kg:()=>e,Lm:()=>g,MH:()=>p,Pe:()=>k,Tn:()=>l,_j:()=>o,b0:()=>d,kZ:()=>h,lQ:()=>q,sI:()=>j}),Object.prototype.toString},61238:(a,b,c)=>{"use strict";c.d(b,{OU:()=>j});var d=c(77688),e=c(60353),f=c(69079),g=c(33423),h=c(53284),i=c(82324);class j{#Y;constructor(a){this.#Y=(0,e.CN)(a)}when(...a){return new k({...this.#Y,node:f.P.cloneWithWhen(this.#Y.node,g.t.create((0,h.GB)(a)))})}}class k{#Y;constructor(a){this.#Y=(0,e.CN)(a)}then(a){return new l({...this.#Y,node:f.P.cloneWithThen(this.#Y.node,(0,i.qH)(a)?(0,i.dJ)(a):(0,i.$s)(a))})}}class l{#Y;constructor(a){this.#Y=(0,e.CN)(a)}when(...a){return new k({...this.#Y,node:f.P.cloneWithWhen(this.#Y.node,g.t.create((0,h.GB)(a)))})}else(a){return new m({...this.#Y,node:f.P.cloneWith(this.#Y.node,{else:(0,i.qH)(a)?(0,i.dJ)(a):(0,i.$s)(a)})})}end(){return new d.Is(f.P.cloneWith(this.#Y.node,{isStatement:!1}))}endCase(){return new d.Is(f.P.cloneWith(this.#Y.node,{isStatement:!0}))}}class m{#Y;constructor(a){this.#Y=(0,e.CN)(a)}end(){return new d.Is(f.P.cloneWith(this.#Y.node,{isStatement:!1}))}endCase(){return new d.Is(f.P.cloneWith(this.#Y.node,{isStatement:!0}))}}},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},65582:(a,b,c)=>{"use strict";c.d(b,{J:()=>n,G:()=>function a(b){return(0,d.Tn)(b)?a(b((0,l.A)())):(0,d.MH)(b)?b.map(a=>m(a)):[m(b)]}});var d=c(60353),e=c(49374),f=c(9005);let g=(0,d.CN)({is:a=>"SelectionNode"===a.kind,create:a=>(0,d.CN)({kind:"SelectionNode",selection:a}),createSelectAll:()=>(0,d.CN)({kind:"SelectionNode",selection:f.U.create()}),createSelectAllFromTable:a=>(0,d.CN)({kind:"SelectionNode",selection:e.q.createSelectAll(a)})});var h=c(2952),i=c(27646),j=c(57105),k=c(19795),l=c(39281);function m(a){return(0,d.Kg)(a)?g.create((0,h.DT)(a)):(0,i.C)(a)?g.create(a.toOperationNode()):g.create((0,j.v0)(a))}function n(a){return a?Array.isArray(a)?a.map(o):[o(a)]:[g.createSelectAll()]}function o(a){if((0,d.Kg)(a))return g.createSelectAllFromTable((0,k.M$)(a));throw Error(`invalid value selectAll expression: ${JSON.stringify(a)}`)}},65966:(a,b,c)=>{"use strict";c.d(b,{n:()=>an});var d=c(90423),e=c(65582),f=c(31009),g=c(54315),h=c(93159),i=c(60353),j=c(82324);let k=(0,i.CN)({is:a=>"ValuesNode"===a.kind,create:a=>(0,i.CN)({kind:"ValuesNode",values:(0,i.CN)(a)})});var l=c(57105);let m=(0,i.CN)({is:a=>"DefaultInsertValueNode"===a.kind,create:()=>(0,i.CN)({kind:"DefaultInsertValueNode"})});var n=c(39281);function o(a){let b=(0,i.Tn)(a)?a((0,n.A)()):a;var c=(0,i.MH)(b)?b:(0,i.CN)([b]);let d=function(a){let b=new Map;for(let c of a)for(let a of Object.keys(c))b.has(a)||void 0===c[a]||b.set(a,b.size);return b}(c);return[(0,i.CN)([...d.keys()].map(f.Z.create)),k.create(c.map(a=>(function(a,b){let c=Object.keys(a),d=Array.from({length:b.size}),e=!1,f=c.length;for(let g of c){let c=b.get(g);if((0,i.b0)(c)){f--;continue}let h=a[g];((0,i.b0)(h)||(0,l.SS)(h))&&(e=!0),d[c]=h}if(f<b.size||e){let a=m.create();return h.s.create(d.map(b=>(0,i.b0)(b)?a:(0,j.$s)(b)))}return g.h.create(d)})(a,d)))]}var p=c(47467),q=c(4315);let r=(0,i.CN)({is:a=>"ColumnUpdateNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"ColumnUpdateNode",column:a,value:b})});var s=c(2952);function t(a){return Object.entries((0,i.Tn)(a)?a((0,n.A)()):a).filter(([a,b])=>void 0!==b).map(([a,b])=>r.create(f.Z.create(a),(0,j.$s)(b)))}let u=(0,i.CN)({is:a=>"OnDuplicateKeyNode"===a.kind,create:a=>(0,i.CN)({kind:"OnDuplicateKeyNode",updates:a})});class v{insertId;numInsertedOrUpdatedRows;constructor(a,b){this.insertId=a,this.numInsertedOrUpdatedRows=b}}var w=c(10106),x=c(81266),y=c(54744);let z=(0,i.CN)({is:a=>"OnConflictNode"===a.kind,create:()=>(0,i.CN)({kind:"OnConflictNode"}),cloneWith:(a,b)=>(0,i.CN)({...a,...b}),cloneWithIndexWhere:(a,b)=>(0,i.CN)({...a,indexWhere:a.indexWhere?y.o.cloneWithOperation(a.indexWhere,"And",b):y.o.create(b)}),cloneWithIndexOrWhere:(a,b)=>(0,i.CN)({...a,indexWhere:a.indexWhere?y.o.cloneWithOperation(a.indexWhere,"Or",b):y.o.create(b)}),cloneWithUpdateWhere:(a,b)=>(0,i.CN)({...a,updateWhere:a.updateWhere?y.o.cloneWithOperation(a.updateWhere,"And",b):y.o.create(b)}),cloneWithUpdateOrWhere:(a,b)=>(0,i.CN)({...a,updateWhere:a.updateWhere?y.o.cloneWithOperation(a.updateWhere,"Or",b):y.o.create(b)}),cloneWithoutIndexWhere:a=>(0,i.CN)({...a,indexWhere:void 0}),cloneWithoutUpdateWhere:a=>(0,i.CN)({...a,updateWhere:void 0})});var A=c(53284);class B{#Y;constructor(a){this.#Y=(0,i.CN)(a)}column(a){let b=f.Z.create(a);return new B({...this.#Y,onConflictNode:z.cloneWith(this.#Y.onConflictNode,{columns:this.#Y.onConflictNode.columns?(0,i.CN)([...this.#Y.onConflictNode.columns,b]):(0,i.CN)([b])})})}columns(a){let b=a.map(f.Z.create);return new B({...this.#Y,onConflictNode:z.cloneWith(this.#Y.onConflictNode,{columns:this.#Y.onConflictNode.columns?(0,i.CN)([...this.#Y.onConflictNode.columns,...b]):(0,i.CN)(b)})})}constraint(a){return new B({...this.#Y,onConflictNode:z.cloneWith(this.#Y.onConflictNode,{constraint:x.O.create(a)})})}expression(a){return new B({...this.#Y,onConflictNode:z.cloneWith(this.#Y.onConflictNode,{indexExpression:a.toOperationNode()})})}where(...a){return new B({...this.#Y,onConflictNode:z.cloneWithIndexWhere(this.#Y.onConflictNode,(0,A.GB)(a))})}whereRef(a,b,c){return new B({...this.#Y,onConflictNode:z.cloneWithIndexWhere(this.#Y.onConflictNode,(0,A.vC)(a,b,c))})}clearWhere(){return new B({...this.#Y,onConflictNode:z.cloneWithoutIndexWhere(this.#Y.onConflictNode)})}doNothing(){return new C({...this.#Y,onConflictNode:z.cloneWith(this.#Y.onConflictNode,{doNothing:!0})})}doUpdateSet(a){return new D({...this.#Y,onConflictNode:z.cloneWith(this.#Y.onConflictNode,{updates:t(a)})})}$call(a){return a(this)}}class C{#Y;constructor(a){this.#Y=(0,i.CN)(a)}toOperationNode(){return this.#Y.onConflictNode}}class D{#Y;constructor(a){this.#Y=(0,i.CN)(a)}where(...a){return new D({...this.#Y,onConflictNode:z.cloneWithUpdateWhere(this.#Y.onConflictNode,(0,A.GB)(a))})}whereRef(a,b,c){return new D({...this.#Y,onConflictNode:z.cloneWithUpdateWhere(this.#Y.onConflictNode,(0,A.vC)(a,b,c))})}clearWhere(){return new D({...this.#Y,onConflictNode:z.cloneWithoutUpdateWhere(this.#Y.onConflictNode)})}$call(a){return a(this)}toOperationNode(){return this.#Y.onConflictNode}}var E=c(36903);let F=(0,i.CN)({is:a=>"OrActionNode"===a.kind,create:a=>(0,i.CN)({kind:"OrActionNode",action:a})});class G{#Y;constructor(a){this.#Y=(0,i.CN)(a)}values(a){let[b,c]=o(a);return new G({...this.#Y,queryNode:p.o.cloneWith(this.#Y.queryNode,{columns:b,values:c})})}columns(a){return new G({...this.#Y,queryNode:p.o.cloneWith(this.#Y.queryNode,{columns:(0,i.CN)(a.map(f.Z.create))})})}expression(a){return new G({...this.#Y,queryNode:p.o.cloneWith(this.#Y.queryNode,{values:(0,l.YK)(a)})})}defaultValues(){return new G({...this.#Y,queryNode:p.o.cloneWith(this.#Y.queryNode,{defaultValues:!0})})}modifyEnd(a){return new G({...this.#Y,queryNode:q.L.cloneWithEndModifier(this.#Y.queryNode,a.toOperationNode())})}ignore(){return new G({...this.#Y,queryNode:p.o.cloneWith(this.#Y.queryNode,{orAction:F.create("ignore")})})}orIgnore(){return new G({...this.#Y,queryNode:p.o.cloneWith(this.#Y.queryNode,{orAction:F.create("ignore")})})}orAbort(){return new G({...this.#Y,queryNode:p.o.cloneWith(this.#Y.queryNode,{orAction:F.create("abort")})})}orFail(){return new G({...this.#Y,queryNode:p.o.cloneWith(this.#Y.queryNode,{orAction:F.create("fail")})})}orReplace(){return new G({...this.#Y,queryNode:p.o.cloneWith(this.#Y.queryNode,{orAction:F.create("replace")})})}orRollback(){return new G({...this.#Y,queryNode:p.o.cloneWith(this.#Y.queryNode,{orAction:F.create("rollback")})})}top(a,b){return new G({...this.#Y,queryNode:q.L.cloneWithTop(this.#Y.queryNode,(0,E.f)(a,b))})}onConflict(a){return new G({...this.#Y,queryNode:p.o.cloneWith(this.#Y.queryNode,{onConflict:a(new B({onConflictNode:z.create()})).toOperationNode()})})}onDuplicateKeyUpdate(a){return new G({...this.#Y,queryNode:p.o.cloneWith(this.#Y.queryNode,{onDuplicateKey:u.create(t(a))})})}returning(a){return new G({...this.#Y,queryNode:q.L.cloneWithReturning(this.#Y.queryNode,(0,e.G)(a))})}returningAll(){return new G({...this.#Y,queryNode:q.L.cloneWithReturning(this.#Y.queryNode,(0,e.J)())})}output(a){return new G({...this.#Y,queryNode:q.L.cloneWithOutput(this.#Y.queryNode,(0,e.G)(a))})}outputAll(a){return new G({...this.#Y,queryNode:q.L.cloneWithOutput(this.#Y.queryNode,(0,e.J)(a))})}clearReturning(){return new G({...this.#Y,queryNode:q.L.cloneWithoutReturning(this.#Y.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new G({...this.#Y})}$castTo(){return new G(this.#Y)}$narrowType(){return new G(this.#Y)}$assertType(){return new G(this.#Y)}withPlugin(a){return new G({...this.#Y,executor:this.#Y.executor.withPlugin(a)})}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.queryNode,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){let a=this.compile(),b=await this.#Y.executor.executeQuery(a),{adapter:c}=this.#Y.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new v(b.insertId,b.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#Y.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new G({...this.#Y,queryNode:q.L.cloneWithExplain(this.#Y.queryNode,a,b)});return await c.execute()}}var H=c(51591),I=c(19795);class J{numDeletedRows;constructor(a){this.numDeletedRows=a}}var K=c(68228),L=c(70020),M=c(68019);class N{#Y;constructor(a){this.#Y=(0,i.CN)(a)}where(...a){return new N({...this.#Y,queryNode:q.L.cloneWithWhere(this.#Y.queryNode,(0,A.GB)(a))})}whereRef(a,b,c){return new N({...this.#Y,queryNode:q.L.cloneWithWhere(this.#Y.queryNode,(0,A.vC)(a,b,c))})}clearWhere(){return new N({...this.#Y,queryNode:q.L.cloneWithoutWhere(this.#Y.queryNode)})}top(a,b){return new N({...this.#Y,queryNode:q.L.cloneWithTop(this.#Y.queryNode,(0,E.f)(a,b))})}using(a){return new N({...this.#Y,queryNode:K.e.cloneWithUsing(this.#Y.queryNode,(0,I.JB)(a))})}innerJoin(...a){return this.#aR("InnerJoin",a)}leftJoin(...a){return this.#aR("LeftJoin",a)}rightJoin(...a){return this.#aR("RightJoin",a)}fullJoin(...a){return this.#aR("FullJoin",a)}#aR(a,b){return new N({...this.#Y,queryNode:q.L.cloneWithJoin(this.#Y.queryNode,(0,H.a)(a,b))})}returning(a){return new N({...this.#Y,queryNode:q.L.cloneWithReturning(this.#Y.queryNode,(0,e.G)(a))})}returningAll(a){return new N({...this.#Y,queryNode:q.L.cloneWithReturning(this.#Y.queryNode,(0,e.J)(a))})}output(a){return new N({...this.#Y,queryNode:q.L.cloneWithOutput(this.#Y.queryNode,(0,e.G)(a))})}outputAll(a){return new N({...this.#Y,queryNode:q.L.cloneWithOutput(this.#Y.queryNode,(0,e.J)(a))})}clearReturning(){return new N({...this.#Y,queryNode:q.L.cloneWithoutReturning(this.#Y.queryNode)})}clearLimit(){return new N({...this.#Y,queryNode:K.e.cloneWithoutLimit(this.#Y.queryNode)})}orderBy(...a){return new N({...this.#Y,queryNode:q.L.cloneWithOrderByItems(this.#Y.queryNode,(0,M.xk)(a))})}clearOrderBy(){return new N({...this.#Y,queryNode:q.L.cloneWithoutOrderBy(this.#Y.queryNode)})}limit(a){return new N({...this.#Y,queryNode:K.e.cloneWithLimit(this.#Y.queryNode,L.a.create((0,j.$s)(a)))})}modifyEnd(a){return new N({...this.#Y,queryNode:q.L.cloneWithEndModifier(this.#Y.queryNode,a.toOperationNode())})}$call(a){return a(this)}$if(a,b){return a?b(this):new N({...this.#Y})}$castTo(){return new N(this.#Y)}$narrowType(){return new N(this.#Y)}$assertType(){return new N(this.#Y)}withPlugin(a){return new N({...this.#Y,executor:this.#Y.executor.withPlugin(a)})}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.queryNode,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){let a=this.compile(),b=await this.#Y.executor.executeQuery(a),{adapter:c}=this.#Y.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new J(b.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#Y.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new N({...this.#Y,queryNode:q.L.cloneWithExplain(this.#Y.queryNode,a,b)});return await c.execute()}}var O=c(93087);class P{numUpdatedRows;numChangedRows;constructor(a,b){this.numUpdatedRows=a,this.numChangedRows=b}}class Q{#Y;constructor(a){this.#Y=(0,i.CN)(a)}where(...a){return new Q({...this.#Y,queryNode:q.L.cloneWithWhere(this.#Y.queryNode,(0,A.GB)(a))})}whereRef(a,b,c){return new Q({...this.#Y,queryNode:q.L.cloneWithWhere(this.#Y.queryNode,(0,A.vC)(a,b,c))})}clearWhere(){return new Q({...this.#Y,queryNode:q.L.cloneWithoutWhere(this.#Y.queryNode)})}top(a,b){return new Q({...this.#Y,queryNode:q.L.cloneWithTop(this.#Y.queryNode,(0,E.f)(a,b))})}from(a){return new Q({...this.#Y,queryNode:O.U.cloneWithFromItems(this.#Y.queryNode,(0,I.JB)(a))})}innerJoin(...a){return this.#aR("InnerJoin",a)}leftJoin(...a){return this.#aR("LeftJoin",a)}rightJoin(...a){return this.#aR("RightJoin",a)}fullJoin(...a){return this.#aR("FullJoin",a)}#aR(a,b){return new Q({...this.#Y,queryNode:q.L.cloneWithJoin(this.#Y.queryNode,(0,H.a)(a,b))})}orderBy(...a){return new Q({...this.#Y,queryNode:q.L.cloneWithOrderByItems(this.#Y.queryNode,(0,M.xk)(a))})}clearOrderBy(){return new Q({...this.#Y,queryNode:q.L.cloneWithoutOrderBy(this.#Y.queryNode)})}limit(a){return new Q({...this.#Y,queryNode:O.U.cloneWithLimit(this.#Y.queryNode,L.a.create((0,j.$s)(a)))})}set(...a){return new Q({...this.#Y,queryNode:O.U.cloneWithUpdates(this.#Y.queryNode,function(...a){return 2===a.length?[r.create((0,s.$O)(a[0]),(0,j.$s)(a[1]))]:t(a[0])}(...a))})}returning(a){return new Q({...this.#Y,queryNode:q.L.cloneWithReturning(this.#Y.queryNode,(0,e.G)(a))})}returningAll(a){return new Q({...this.#Y,queryNode:q.L.cloneWithReturning(this.#Y.queryNode,(0,e.J)(a))})}output(a){return new Q({...this.#Y,queryNode:q.L.cloneWithOutput(this.#Y.queryNode,(0,e.G)(a))})}outputAll(a){return new Q({...this.#Y,queryNode:q.L.cloneWithOutput(this.#Y.queryNode,(0,e.J)(a))})}modifyEnd(a){return new Q({...this.#Y,queryNode:q.L.cloneWithEndModifier(this.#Y.queryNode,a.toOperationNode())})}clearReturning(){return new Q({...this.#Y,queryNode:q.L.cloneWithoutReturning(this.#Y.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new Q({...this.#Y})}$castTo(){return new Q(this.#Y)}$narrowType(){return new Q(this.#Y)}$assertType(){return new Q(this.#Y)}withPlugin(a){return new Q({...this.#Y,executor:this.#Y.executor.withPlugin(a)})}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.queryNode,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){let a=this.compile(),b=await this.#Y.executor.executeQuery(a),{adapter:c}=this.#Y.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new P(b.numAffectedRows??BigInt(0),b.numChangedRows)]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#Y.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new Q({...this.#Y,queryNode:q.L.cloneWithExplain(this.#Y.queryNode,a,b)});return await c.execute()}}var R=c(18804),S=c(69385);let T=(0,i.CN)({is:a=>"CommonTableExpressionNameNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"CommonTableExpressionNameNode",table:S.H.create(a),columns:b?(0,i.CN)(b.map(f.Z.create)):void 0})});var U=c(71088);let V=(0,i.CN)({is:a=>"CommonTableExpressionNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"CommonTableExpressionNode",name:a,expression:b}),cloneWith:(a,b)=>(0,i.CN)({...a,...b})});class W{#Y;constructor(a){this.#Y=(0,i.CN)(a)}materialized(){return new W({...this.#Y,node:V.cloneWith(this.#Y.node,{materialized:!0})})}notMaterialized(){return new W({...this.#Y,node:V.cloneWith(this.#Y.node,{materialized:!1})})}toOperationNode(){return this.#Y.node}}function X(a,b){var c;let d=b((0,U.bl)()).toOperationNode();return(0,i.Tn)(a)?a((c=d,a=>new W({node:V.create(Y(a),c)}))).toOperationNode():V.create(Y(a),d)}function Y(a){if(!a.includes("("))return T.create(a);{let b=a.split(/[\(\)]/),c=b[0],d=b[1].split(",").map(a=>a.trim());return T.create(c,d)}}let Z=(0,i.CN)({is:a=>"WithNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"WithNode",expressions:(0,i.CN)([a]),...b}),cloneWithExpression:(a,b)=>(0,i.CN)({...a,expressions:(0,i.CN)([...a.expressions,b])})});var $=c(31700),_=c(19151),aa=c(24118);let ab=(0,i.CN)({is:a=>"MatchedNode"===a.kind,create:(a,b=!1)=>(0,i.CN)({kind:"MatchedNode",not:a,bySource:b})});var ac=c(39450),ad=c(31575),ae=c(33423);function af(a,b,c){return ae.t.create((0,A.KN)([ab.create(!a.isMatched,a.bySource),...b&&b.length>0?[3===b.length&&c?(0,A.vC)(b[0],b[1],b[2]):(0,A.GB)(b)]:[]],"and",!1))}function ag(a){return(0,i.Kg)(a)?ad.z.create([a],[]):(0,ac.N)(a)?a.toOperationNode():a}var ah=c(22795);class ai{numChangedRows;constructor(a){this.numChangedRows=a}}class aj{#Y;constructor(a){this.#Y=(0,i.CN)(a)}modifyEnd(a){return new aj({...this.#Y,queryNode:q.L.cloneWithEndModifier(this.#Y.queryNode,a.toOperationNode())})}top(a,b){return new aj({...this.#Y,queryNode:q.L.cloneWithTop(this.#Y.queryNode,(0,E.f)(a,b))})}using(...a){return new ak({...this.#Y,queryNode:aa.r.cloneWithUsing(this.#Y.queryNode,(0,H.a)("Using",a))})}returning(a){return new aj({...this.#Y,queryNode:q.L.cloneWithReturning(this.#Y.queryNode,(0,e.G)(a))})}returningAll(a){return new aj({...this.#Y,queryNode:q.L.cloneWithReturning(this.#Y.queryNode,(0,e.J)(a))})}output(a){return new aj({...this.#Y,queryNode:q.L.cloneWithOutput(this.#Y.queryNode,(0,e.G)(a))})}outputAll(a){return new aj({...this.#Y,queryNode:q.L.cloneWithOutput(this.#Y.queryNode,(0,e.J)(a))})}}class ak{#Y;constructor(a){this.#Y=(0,i.CN)(a)}modifyEnd(a){return new ak({...this.#Y,queryNode:q.L.cloneWithEndModifier(this.#Y.queryNode,a.toOperationNode())})}top(a,b){return new ak({...this.#Y,queryNode:q.L.cloneWithTop(this.#Y.queryNode,(0,E.f)(a,b))})}whenMatched(){return this.#aS([])}whenMatchedAnd(...a){return this.#aS(a)}whenMatchedAndRef(a,b,c){return this.#aS([a,b,c],!0)}#aS(a,b){return new al({...this.#Y,queryNode:aa.r.cloneWithWhen(this.#Y.queryNode,af({isMatched:!0},a,b))})}whenNotMatched(){return this.#aT([])}whenNotMatchedAnd(...a){return this.#aT(a)}whenNotMatchedAndRef(a,b,c){return this.#aT([a,b,c],!0)}whenNotMatchedBySource(){return this.#aT([],!1,!0)}whenNotMatchedBySourceAnd(...a){return this.#aT(a,!1,!0)}whenNotMatchedBySourceAndRef(a,b,c){return this.#aT([a,b,c],!0,!0)}returning(a){return new ak({...this.#Y,queryNode:q.L.cloneWithReturning(this.#Y.queryNode,(0,e.G)(a))})}returningAll(a){return new ak({...this.#Y,queryNode:q.L.cloneWithReturning(this.#Y.queryNode,(0,e.J)(a))})}output(a){return new ak({...this.#Y,queryNode:q.L.cloneWithOutput(this.#Y.queryNode,(0,e.G)(a))})}outputAll(a){return new ak({...this.#Y,queryNode:q.L.cloneWithOutput(this.#Y.queryNode,(0,e.J)(a))})}#aT(a,b=!1,c=!1){let d={...this.#Y,queryNode:aa.r.cloneWithWhen(this.#Y.queryNode,af({isMatched:!1,bySource:c},a,b))};return new(c?al:am)(d)}$call(a){return a(this)}$if(a,b){return a?b(this):new ak({...this.#Y})}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.queryNode,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){let a=this.compile(),b=await this.#Y.executor.executeQuery(a),{adapter:c}=this.#Y.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new ai(b.numAffectedRows)]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}}class al{#Y;constructor(a){this.#Y=(0,i.CN)(a)}thenDelete(){return new ak({...this.#Y,queryNode:aa.r.cloneWithThen(this.#Y.queryNode,ag("delete"))})}thenDoNothing(){return new ak({...this.#Y,queryNode:aa.r.cloneWithThen(this.#Y.queryNode,ag("do nothing"))})}thenUpdate(a){return new ak({...this.#Y,queryNode:aa.r.cloneWithThen(this.#Y.queryNode,ag(a(new Q({queryId:this.#Y.queryId,executor:ah.W,queryNode:O.U.createWithoutTable()}))))})}thenUpdateSet(...a){return this.thenUpdate(b=>b.set(...a))}}class am{#Y;constructor(a){this.#Y=(0,i.CN)(a)}thenDoNothing(){return new ak({...this.#Y,queryNode:aa.r.cloneWithThen(this.#Y.queryNode,ag("do nothing"))})}thenInsertValues(a){let[b,c]=o(a);return new ak({...this.#Y,queryNode:aa.r.cloneWithThen(this.#Y.queryNode,ag(p.o.cloneWith(p.o.createWithoutInto(),{columns:b,values:c})))})}}class an{#Y;constructor(a){this.#Y=(0,i.CN)(a)}selectFrom(a){return(0,d.c)({queryId:(0,$.a)(),executor:this.#Y.executor,queryNode:R.L.createFrom((0,I.JB)(a),this.#Y.withNode)})}selectNoFrom(a){return(0,d.c)({queryId:(0,$.a)(),executor:this.#Y.executor,queryNode:R.L.cloneWithSelections(R.L.create(this.#Y.withNode),(0,e.G)(a))})}insertInto(a){return new G({queryId:(0,$.a)(),executor:this.#Y.executor,queryNode:p.o.create((0,I.M$)(a),this.#Y.withNode)})}replaceInto(a){return new G({queryId:(0,$.a)(),executor:this.#Y.executor,queryNode:p.o.create((0,I.M$)(a),this.#Y.withNode,!0)})}deleteFrom(a){return new N({queryId:(0,$.a)(),executor:this.#Y.executor,queryNode:K.e.create((0,I.JB)(a),this.#Y.withNode)})}updateTable(a){return new Q({queryId:(0,$.a)(),executor:this.#Y.executor,queryNode:O.U.create((0,I.JB)(a),this.#Y.withNode)})}mergeInto(a){return new aj({queryId:(0,$.a)(),executor:this.#Y.executor,queryNode:aa.r.create((0,I.Xm)(a),this.#Y.withNode)})}with(a,b){let c=X(a,b);return new an({...this.#Y,withNode:this.#Y.withNode?Z.cloneWithExpression(this.#Y.withNode,c):Z.create(c)})}withRecursive(a,b){let c=X(a,b);return new an({...this.#Y,withNode:this.#Y.withNode?Z.cloneWithExpression(this.#Y.withNode,c):Z.create(c,{recursive:!0})})}withPlugin(a){return new an({...this.#Y,executor:this.#Y.executor.withPlugin(a)})}withoutPlugins(){return new an({...this.#Y,executor:this.#Y.executor.withoutPlugins()})}withSchema(a){return new an({...this.#Y,executor:this.#Y.executor.withPluginAtFront(new _.B(a))})}}},67183:(a,b,c)=>{"use strict";c.d(b,{c:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"JSONPathNode"===a.kind,create:a=>(0,d.CN)({kind:"JSONPathNode",inOperator:a,pathLegs:(0,d.CN)([])}),cloneWithLeg:(a,b)=>(0,d.CN)({...a,pathLegs:(0,d.CN)([...a.pathLegs,b])})})},68019:(a,b,c)=>{"use strict";c.d(b,{bE:()=>o,xk:()=>p});var d=c(27646),e=c(70010),f=c(60353);let g=(0,f.CN)({is:a=>"OrderByItemNode"===a.kind,create:(a,b)=>(0,f.CN)({kind:"OrderByItemNode",orderBy:a,direction:b}),cloneWith:(a,b)=>(0,f.CN)({...a,...b})});var h=c(31575),i=c(81266);let j={create:a=>(0,f.CN)({kind:"CollateNode",collation:i.O.create(a)})};class k{#Y;constructor(a){this.#Y=(0,f.CN)(a)}desc(){return new k({node:g.cloneWith(this.#Y.node,{direction:h.z.createWithSql("desc")})})}asc(){return new k({node:g.cloneWith(this.#Y.node,{direction:h.z.createWithSql("asc")})})}nullsLast(){return new k({node:g.cloneWith(this.#Y.node,{nulls:"last"})})}nullsFirst(){return new k({node:g.cloneWith(this.#Y.node,{nulls:"first"})})}collate(a){return new k({node:g.cloneWith(this.#Y.node,{collation:j.create(a)})})}toOperationNode(){return this.#Y.node}}var l=c(80234),m=c(57105),n=c(2952);function o(a){return"asc"===a||"desc"===a}function p(a){if(2===a.length)return[q(a[0],a[1])];if(1===a.length){let[b]=a;return Array.isArray(b)?((0,l.u)("orderBy(array) is deprecated, use multiple orderBy calls instead."),b.map(a=>q(a))):[q(b)]}throw Error(`Invalid number of arguments at order by! expected 1-2, received ${a.length}`)}function q(a,b){let c=function(a){if((0,m.SS)(a))return(0,m.YK)(a);if((0,d.C)(a))return a.toOperationNode();let[b,c]=a.split(" ");return c?((0,l.u)("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),r((0,n.q5)(b),c)):(0,n.q5)(a)}(a);if(g.is(c)){if(b)throw Error("Cannot specify direction twice!");return c}return r(c,b)}function r(a,b){if("string"==typeof b){if(!o(b))throw Error(`Invalid order by direction: ${b}`);return g.create(a,h.z.createWithSql(b))}if((0,e.B)(b))return(0,l.u)("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),g.create(a,b.toOperationNode());let c=g.create(a);return b?b(new k({node:c})).toOperationNode():c}},68228:(a,b,c)=>{"use strict";c.d(b,{e:()=>h});var d=c(60353),e=c(75227);let f=(0,d.CN)({is:a=>"UsingNode"===a.kind,create:a=>(0,d.CN)({kind:"UsingNode",tables:(0,d.CN)(a)}),cloneWithTables:(a,b)=>(0,d.CN)({...a,tables:(0,d.CN)([...a.tables,...b])})});var g=c(4315);let h=(0,d.CN)({is:a=>"DeleteQueryNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"DeleteQueryNode",from:e.N.create(a),...b&&{with:b}}),cloneWithOrderByItems:(a,b)=>g.L.cloneWithOrderByItems(a,b),cloneWithoutOrderBy:a=>g.L.cloneWithoutOrderBy(a),cloneWithLimit:(a,b)=>(0,d.CN)({...a,limit:b}),cloneWithoutLimit:a=>(0,d.CN)({...a,limit:void 0}),cloneWithUsing:(a,b)=>(0,d.CN)({...a,using:void 0!==a.using?f.cloneWithTables(a.using,b):f.create(b)})})},68558:(a,b,c)=>{"use strict";c.d(b,{n:()=>p});var d=c(93092),e=c(47467),f=c(60353);class g{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#aU=(0,f.CN)({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),RenameConstraintNode:this.visitRenameConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),RefreshMaterializedViewNode:this.visitRefreshMaterializedView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this),OrActionNode:this.visitOrAction.bind(this),CollateNode:this.visitCollate.bind(this)});visitNode=a=>{this.nodeStack.push(a),this.#aU[a.kind](a),this.nodeStack.pop()}}var h=c(40659),i=c(94296),j=c(4315),k=c(88487),l=c(90409),m=c(24118),n=c(80234);let o=/'/g;class p extends g{#aV="";#aW=[];get numParameters(){return this.#aW.length}compileQuery(a,b){return this.#aV="",this.#aW=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(a),(0,f.CN)({query:a,queryId:b,sql:this.getSql(),parameters:[...this.#aW]})}getSql(){return this.#aV}visitSelectQuery(a){let b=void 0!==this.parentNode&&!i.k.is(this.parentNode)&&!e.o.is(this.parentNode)&&!d.B.is(this.parentNode)&&!k.Y.is(this.parentNode)&&!l.i.is(this.parentNode);void 0===this.parentNode&&a.explain&&(this.visitNode(a.explain),this.append(" ")),b&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("select"),a.distinctOn&&(this.append(" "),this.compileDistinctOn(a.distinctOn)),a.frontModifiers?.length&&(this.append(" "),this.compileList(a.frontModifiers," ")),a.top&&(this.append(" "),this.visitNode(a.top)),a.selections&&(this.append(" "),this.compileList(a.selections)),a.from&&(this.append(" "),this.visitNode(a.from)),a.joins&&(this.append(" "),this.compileList(a.joins," ")),a.where&&(this.append(" "),this.visitNode(a.where)),a.groupBy&&(this.append(" "),this.visitNode(a.groupBy)),a.having&&(this.append(" "),this.visitNode(a.having)),a.setOperations&&(this.append(" "),this.compileList(a.setOperations," ")),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.offset&&(this.append(" "),this.visitNode(a.offset)),a.fetch&&(this.append(" "),this.visitNode(a.fetch)),a.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...a.endModifiers])," ")),b&&this.append(")")}visitFrom(a){this.append("from "),this.compileList(a.froms)}visitSelection(a){this.visitNode(a.selection)}visitColumn(a){this.visitNode(a.column)}compileDistinctOn(a){this.append("distinct on ("),this.compileList(a),this.append(")")}compileList(a,b=", "){let c=a.length-1;for(let d=0;d<=c;d++)this.visitNode(a[d]),d<c&&this.append(b)}visitWhere(a){this.append("where "),this.visitNode(a.where)}visitHaving(a){this.append("having "),this.visitNode(a.having)}visitInsertQuery(a){let b=this.nodeStack.find(j.L.is),c=b!==a;!c&&a.explain&&(this.visitNode(a.explain),this.append(" ")),c&&!m.r.is(b)&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append(a.replace?"replace":"insert"),a.ignore&&((0,n.u)("`InsertQueryNode.ignore` is deprecated. Use `InsertQueryNode.orAction` instead."),this.append(" ignore")),a.orAction&&(this.append(" "),this.visitNode(a.orAction)),a.top&&(this.append(" "),this.visitNode(a.top)),a.into&&(this.append(" into "),this.visitNode(a.into)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.output&&(this.append(" "),this.visitNode(a.output)),a.values&&(this.append(" "),this.visitNode(a.values)),a.defaultValues&&(this.append(" "),this.append("default values")),a.onConflict&&(this.append(" "),this.visitNode(a.onConflict)),a.onDuplicateKey&&(this.append(" "),this.visitNode(a.onDuplicateKey)),a.returning&&(this.append(" "),this.visitNode(a.returning)),c&&!m.r.is(b)&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitValues(a){this.append("values "),this.compileList(a.values)}visitDeleteQuery(a){let b=this.nodeStack.find(j.L.is)!==a;!b&&a.explain&&(this.visitNode(a.explain),this.append(" ")),b&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("delete "),a.top&&(this.visitNode(a.top),this.append(" ")),this.visitNode(a.from),a.output&&(this.append(" "),this.visitNode(a.output)),a.using&&(this.append(" "),this.visitNode(a.using)),a.joins&&(this.append(" "),this.compileList(a.joins," ")),a.where&&(this.append(" "),this.visitNode(a.where)),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.returning&&(this.append(" "),this.visitNode(a.returning)),b&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitReturning(a){this.append("returning "),this.compileList(a.selections)}visitAlias(a){this.visitNode(a.node),this.append(" as "),this.visitNode(a.alias)}visitReference(a){a.table&&(this.visitNode(a.table),this.append(".")),this.visitNode(a.column)}visitSelectAll(a){this.append("*")}visitIdentifier(a){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(a),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(a){if(!(0,f.Kg)(a.name))throw Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(a.name))}visitAnd(a){this.visitNode(a.left),this.append(" and "),this.visitNode(a.right)}visitOr(a){this.visitNode(a.left),this.append(" or "),this.visitNode(a.right)}visitValue(a){a.immediate?this.appendImmediateValue(a.value):this.appendValue(a.value)}visitValueList(a){this.append("("),this.compileList(a.values),this.append(")")}visitTuple(a){this.append("("),this.compileList(a.values),this.append(")")}visitPrimitiveValueList(a){this.append("(");let{values:b}=a;for(let a=0;a<b.length;++a)this.appendValue(b[a]),a!==b.length-1&&this.append(", ");this.append(")")}visitParens(a){this.append("("),this.visitNode(a.node),this.append(")")}visitJoin(a){this.append(s[a.joinType]),this.append(" "),this.visitNode(a.table),a.on&&(this.append(" "),this.visitNode(a.on))}visitOn(a){this.append("on "),this.visitNode(a.on)}visitRaw(a){let{sqlFragments:b,parameters:c}=a;for(let a=0;a<b.length;++a)this.append(b[a]),c.length>a&&this.visitNode(c[a])}visitOperator(a){this.append(a.operator)}visitTable(a){this.visitNode(a.table)}visitSchemableIdentifier(a){a.schema&&(this.visitNode(a.schema),this.append(".")),this.visitNode(a.identifier)}visitCreateTable(a){this.append("create "),a.frontModifiers&&a.frontModifiers.length>0&&(this.compileList(a.frontModifiers," "),this.append(" ")),a.temporary&&this.append("temporary "),this.append("table "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.table),a.selectQuery?(this.append(" as "),this.visitNode(a.selectQuery)):(this.append(" ("),this.compileList([...a.columns,...a.constraints??[]]),this.append(")"),a.onCommit&&(this.append(" on commit "),this.append(a.onCommit)),a.endModifiers&&a.endModifiers.length>0&&(this.append(" "),this.compileList(a.endModifiers," ")))}visitColumnDefinition(a){a.ifNotExists&&this.append("if not exists "),this.visitNode(a.column),this.append(" "),this.visitNode(a.dataType),a.unsigned&&this.append(" unsigned"),a.frontModifiers&&a.frontModifiers.length>0&&(this.append(" "),this.compileList(a.frontModifiers," ")),a.generated&&(this.append(" "),this.visitNode(a.generated)),a.identity&&this.append(" identity"),a.defaultTo&&(this.append(" "),this.visitNode(a.defaultTo)),a.notNull&&this.append(" not null"),a.unique&&this.append(" unique"),a.nullsNotDistinct&&this.append(" nulls not distinct"),a.primaryKey&&this.append(" primary key"),a.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),a.references&&(this.append(" "),this.visitNode(a.references)),a.check&&(this.append(" "),this.visitNode(a.check)),a.endModifiers&&a.endModifiers.length>0&&(this.append(" "),this.compileList(a.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(a){this.append("references "),this.visitNode(a.table),this.append(" ("),this.compileList(a.columns),this.append(")"),a.onDelete&&(this.append(" on delete "),this.append(a.onDelete)),a.onUpdate&&(this.append(" on update "),this.append(a.onUpdate))}visitDropTable(a){this.append("drop table "),a.ifExists&&this.append("if exists "),this.visitNode(a.table),a.cascade&&this.append(" cascade")}visitDataType(a){this.append(a.dataType)}visitOrderBy(a){this.append("order by "),this.compileList(a.items)}visitOrderByItem(a){this.visitNode(a.orderBy),a.collation&&(this.append(" "),this.visitNode(a.collation)),a.direction&&(this.append(" "),this.visitNode(a.direction)),a.nulls&&(this.append(" nulls "),this.append(a.nulls))}visitGroupBy(a){this.append("group by "),this.compileList(a.items)}visitGroupByItem(a){this.visitNode(a.groupBy)}visitUpdateQuery(a){let b=this.nodeStack.find(j.L.is),c=b!==a;if(!c&&a.explain&&(this.visitNode(a.explain),this.append(" ")),c&&!m.r.is(b)&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("update "),a.top&&(this.visitNode(a.top),this.append(" ")),a.table&&(this.visitNode(a.table),this.append(" ")),this.append("set "),a.updates&&this.compileList(a.updates),a.output&&(this.append(" "),this.visitNode(a.output)),a.from&&(this.append(" "),this.visitNode(a.from)),a.joins){if(!a.from)throw Error("Joins in an update query are only supported as a part of a PostgreSQL 'update set from join' query. If you want to create a MySQL 'update join set' query, see https://kysely.dev/docs/examples/update/my-sql-joins");this.append(" "),this.compileList(a.joins," ")}a.where&&(this.append(" "),this.visitNode(a.where)),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.returning&&(this.append(" "),this.visitNode(a.returning)),c&&!m.r.is(b)&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitColumnUpdate(a){this.visitNode(a.column),this.append(" = "),this.visitNode(a.value)}visitLimit(a){this.append("limit "),this.visitNode(a.limit)}visitOffset(a){this.append("offset "),this.visitNode(a.offset)}visitOnConflict(a){this.append("on conflict"),a.columns?(this.append(" ("),this.compileList(a.columns),this.append(")")):a.constraint?(this.append(" on constraint "),this.visitNode(a.constraint)):a.indexExpression&&(this.append(" ("),this.visitNode(a.indexExpression),this.append(")")),a.indexWhere&&(this.append(" "),this.visitNode(a.indexWhere)),!0===a.doNothing?this.append(" do nothing"):a.updates&&(this.append(" do update set "),this.compileList(a.updates),a.updateWhere&&(this.append(" "),this.visitNode(a.updateWhere)))}visitOnDuplicateKey(a){this.append("on duplicate key update "),this.compileList(a.updates)}visitCreateIndex(a){this.append("create "),a.unique&&this.append("unique "),this.append("index "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),a.table&&(this.append(" on "),this.visitNode(a.table)),a.using&&(this.append(" using "),this.visitNode(a.using)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.nullsNotDistinct&&this.append(" nulls not distinct"),a.where&&(this.append(" "),this.visitNode(a.where))}visitDropIndex(a){this.append("drop index "),a.ifExists&&this.append("if exists "),this.visitNode(a.name),a.table&&(this.append(" on "),this.visitNode(a.table)),a.cascade&&this.append(" cascade")}visitCreateSchema(a){this.append("create schema "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.schema)}visitDropSchema(a){this.append("drop schema "),a.ifExists&&this.append("if exists "),this.visitNode(a.schema),a.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("primary key ("),this.compileList(a.columns),this.append(")"),this.buildDeferrable(a)}buildDeferrable(a){void 0!==a.deferrable&&(a.deferrable?this.append(" deferrable"):this.append(" not deferrable")),void 0!==a.initiallyDeferred&&(a.initiallyDeferred?this.append(" initially deferred"):this.append(" initially immediate"))}visitUniqueConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("unique"),a.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(a.columns),this.append(")"),this.buildDeferrable(a)}visitCheckConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("check ("),this.visitNode(a.expression),this.append(")")}visitForeignKeyConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("foreign key ("),this.compileList(a.columns),this.append(") "),this.visitNode(a.references),a.onDelete&&(this.append(" on delete "),this.append(a.onDelete)),a.onUpdate&&(this.append(" on update "),this.append(a.onUpdate)),this.buildDeferrable(a)}visitList(a){this.compileList(a.items)}visitWith(a){this.append("with "),a.recursive&&this.append("recursive "),this.compileList(a.expressions)}visitCommonTableExpression(a){this.visitNode(a.name),this.append(" as "),(0,f.Lm)(a.materialized)&&(a.materialized||this.append("not "),this.append("materialized ")),this.visitNode(a.expression)}visitCommonTableExpressionName(a){this.visitNode(a.table),a.columns&&(this.append("("),this.compileList(a.columns),this.append(")"))}visitAlterTable(a){this.append("alter table "),this.visitNode(a.table),this.append(" "),a.renameTo&&(this.append("rename to "),this.visitNode(a.renameTo)),a.setSchema&&(this.append("set schema "),this.visitNode(a.setSchema)),a.addConstraint&&this.visitNode(a.addConstraint),a.dropConstraint&&this.visitNode(a.dropConstraint),a.renameConstraint&&this.visitNode(a.renameConstraint),a.columnAlterations&&this.compileColumnAlterations(a.columnAlterations),a.addIndex&&this.visitNode(a.addIndex),a.dropIndex&&this.visitNode(a.dropIndex)}visitAddColumn(a){this.append("add column "),this.visitNode(a.column)}visitRenameColumn(a){this.append("rename column "),this.visitNode(a.column),this.append(" to "),this.visitNode(a.renameTo)}visitDropColumn(a){this.append("drop column "),this.visitNode(a.column)}visitAlterColumn(a){this.append("alter column "),this.visitNode(a.column),this.append(" "),a.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(a.dataType),a.dataTypeExpression&&(this.append("using "),this.visitNode(a.dataTypeExpression))),a.setDefault&&(this.append("set default "),this.visitNode(a.setDefault)),a.dropDefault&&this.append("drop default"),a.setNotNull&&this.append("set not null"),a.dropNotNull&&this.append("drop not null")}visitModifyColumn(a){this.append("modify column "),this.visitNode(a.column)}visitAddConstraint(a){this.append("add "),this.visitNode(a.constraint)}visitDropConstraint(a){this.append("drop constraint "),a.ifExists&&this.append("if exists "),this.visitNode(a.constraintName),"cascade"===a.modifier?this.append(" cascade"):"restrict"===a.modifier&&this.append(" restrict")}visitRenameConstraint(a){this.append("rename constraint "),this.visitNode(a.oldName),this.append(" to "),this.visitNode(a.newName)}visitSetOperation(a){this.append(a.operator),this.append(" "),a.all&&this.append("all "),this.visitNode(a.expression)}visitCreateView(a){this.append("create "),a.orReplace&&this.append("or replace "),a.materialized&&this.append("materialized "),a.temporary&&this.append("temporary "),this.append("view "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),this.append(" "),a.columns&&(this.append("("),this.compileList(a.columns),this.append(") ")),a.as&&(this.append("as "),this.visitNode(a.as))}visitRefreshMaterializedView(a){this.append("refresh materialized view "),a.concurrently&&this.append("concurrently "),this.visitNode(a.name),a.withNoData?this.append(" with no data"):this.append(" with data")}visitDropView(a){this.append("drop "),a.materialized&&this.append("materialized "),this.append("view "),a.ifExists&&this.append("if exists "),this.visitNode(a.name),a.cascade&&this.append(" cascade")}visitGenerated(a){this.append("generated "),a.always&&this.append("always "),a.byDefault&&this.append("by default "),this.append("as "),a.identity&&this.append("identity"),a.expression&&(this.append("("),this.visitNode(a.expression),this.append(")")),a.stored&&this.append(" stored")}visitDefaultValue(a){this.append("default "),this.visitNode(a.defaultValue)}visitSelectModifier(a){a.rawModifier?this.visitNode(a.rawModifier):this.append(q[a.modifier]),a.of&&(this.append(" of "),this.compileList(a.of,", "))}visitCreateType(a){this.append("create type "),this.visitNode(a.name),a.enum&&(this.append(" as enum "),this.visitNode(a.enum))}visitDropType(a){this.append("drop type "),a.ifExists&&this.append("if exists "),this.visitNode(a.name)}visitExplain(a){this.append("explain"),(a.options||a.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),a.options&&(this.visitNode(a.options),a.format&&this.append(this.getExplainOptionsDelimiter())),a.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(a.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(a){this.append("default")}visitAggregateFunction(a){this.append(a.func),this.append("("),a.distinct&&this.append("distinct "),this.compileList(a.aggregated),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),this.append(")"),a.withinGroup&&(this.append(" within group ("),this.visitNode(a.withinGroup),this.append(")")),a.filter&&(this.append(" filter("),this.visitNode(a.filter),this.append(")")),a.over&&(this.append(" "),this.visitNode(a.over))}visitOver(a){this.append("over("),a.partitionBy&&(this.visitNode(a.partitionBy),a.orderBy&&this.append(" ")),a.orderBy&&this.visitNode(a.orderBy),this.append(")")}visitPartitionBy(a){this.append("partition by "),this.compileList(a.items)}visitPartitionByItem(a){this.visitNode(a.partitionBy)}visitBinaryOperation(a){this.visitNode(a.leftOperand),this.append(" "),this.visitNode(a.operator),this.append(" "),this.visitNode(a.rightOperand)}visitUnaryOperation(a){this.visitNode(a.operator),this.isMinusOperator(a.operator)||this.append(" "),this.visitNode(a.operand)}isMinusOperator(a){return h.zX.is(a)&&"-"===a.operator}visitUsing(a){this.append("using "),this.compileList(a.tables)}visitFunction(a){this.append(a.func),this.append("("),this.compileList(a.arguments),this.append(")")}visitCase(a){this.append("case"),a.value&&(this.append(" "),this.visitNode(a.value)),a.when&&(this.append(" "),this.compileList(a.when," ")),a.else&&(this.append(" else "),this.visitNode(a.else)),this.append(" end"),a.isStatement&&this.append(" case")}visitWhen(a){this.append("when "),this.visitNode(a.condition),a.result&&(this.append(" then "),this.visitNode(a.result))}visitJSONReference(a){this.visitNode(a.reference),this.visitNode(a.traversal)}visitJSONPath(a){for(let b of(a.inOperator&&this.visitNode(a.inOperator),this.append("'$"),a.pathLegs))this.visitNode(b);this.append("'")}visitJSONPathLeg(a){let b="ArrayLocation"===a.type;this.append(b?"[":"."),this.append(String(a.value)),b&&this.append("]")}visitJSONOperatorChain(a){for(let b=0,c=a.values.length;b<c;b++)b===c-1?this.visitNode(a.operator):this.append("->"),this.visitNode(a.values[b])}visitMergeQuery(a){a.with&&(this.visitNode(a.with),this.append(" ")),this.append("merge "),a.top&&(this.visitNode(a.top),this.append(" ")),this.append("into "),this.visitNode(a.into),a.using&&(this.append(" "),this.visitNode(a.using)),a.whens&&(this.append(" "),this.compileList(a.whens," ")),a.returning&&(this.append(" "),this.visitNode(a.returning)),a.output&&(this.append(" "),this.visitNode(a.output)),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitMatched(a){a.not&&this.append("not "),this.append("matched"),a.bySource&&this.append(" by source")}visitAddIndex(a){this.append("add "),a.unique&&this.append("unique "),this.append("index "),this.visitNode(a.name),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.using&&(this.append(" using "),this.visitNode(a.using))}visitCast(a){this.append("cast("),this.visitNode(a.expression),this.append(" as "),this.visitNode(a.dataType),this.append(")")}visitFetch(a){this.append("fetch next "),this.visitNode(a.rowCount),this.append(` rows ${a.modifier}`)}visitOutput(a){this.append("output "),this.compileList(a.selections)}visitTop(a){this.append(`top(${a.expression})`),a.modifiers&&this.append(` ${a.modifiers}`)}visitOrAction(a){this.append(a.action)}visitCollate(a){this.append("collate "),this.visitNode(a.collation)}append(a){this.#aV+=a}appendValue(a){this.addParameter(a),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(a){let b=this.getLeftIdentifierWrapper(),c=this.getRightIdentifierWrapper(),d="";for(let e of a)d+=e,e===b?d+=b:e===c&&(d+=c);return d}sanitizeStringLiteral(a){return a.replace(o,"''")}addParameter(a){this.#aW.push(a)}appendImmediateValue(a){if((0,f.Kg)(a))this.appendStringLiteral(a);else if((0,f.Et)(a)||(0,f.Lm)(a)||(0,f.sI)(a))this.append(a.toString());else if((0,f.kZ)(a))this.append("null");else if((0,f.$P)(a))this.appendImmediateValue(a.toISOString());else throw Error(`invalid immediate value ${a}`)}appendStringLiteral(a){this.append("'"),this.append(this.sanitizeStringLiteral(a)),this.append("'")}sortSelectModifiers(a){return a.sort((a,b)=>a.modifier&&b.modifier?r[a.modifier]-r[b.modifier]:1),(0,f.CN)(a)}compileColumnAlterations(a){this.compileList(a)}announcesNewColumnDataType(){return!0}}let q=(0,f.CN)({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),r=(0,f.CN)({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),s=(0,f.CN)({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",CrossJoin:"cross join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",LateralCrossJoin:"cross join lateral",OuterApply:"outer apply",CrossApply:"cross apply",Using:"using"})},69079:(a,b,c)=>{"use strict";c.d(b,{P:()=>f});var d=c(60353),e=c(33423);let f=(0,d.CN)({is:a=>"CaseNode"===a.kind,create:a=>(0,d.CN)({kind:"CaseNode",value:a}),cloneWithWhen:(a,b)=>(0,d.CN)({...a,when:(0,d.CN)(a.when?[...a.when,b]:[b])}),cloneWithThen:(a,b)=>(0,d.CN)({...a,when:a.when?(0,d.CN)([...a.when.slice(0,-1),e.t.cloneWithResult(a.when[a.when.length-1],b)]):void 0}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},69385:(a,b,c)=>{"use strict";c.d(b,{H:()=>f});var d=c(60353),e=c(36923);let f=(0,d.CN)({is:a=>"TableNode"===a.kind,create:a=>(0,d.CN)({kind:"TableNode",table:e.y.create(a)}),createWithSchema:(a,b)=>(0,d.CN)({kind:"TableNode",table:e.y.createWithSchema(a,b)})})},70010:(a,b,c)=>{"use strict";c.d(b,{B:()=>f,q:()=>g});var d=c(39450),e=c(60353);function f(a){return(0,e.Gv)(a)&&"expressionType"in a&&(0,d.N)(a)}function g(a){return(0,e.Gv)(a)&&"expression"in a&&(0,e.Kg)(a.alias)&&(0,d.N)(a)}},70020:(a,b,c)=>{"use strict";c.d(b,{a:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"LimitNode"===a.kind,create:a=>(0,d.CN)({kind:"LimitNode",limit:a})})},71088:(a,b,c)=>{"use strict";c.d(b,{GQ:()=>u,EQ:()=>v,bl:()=>t});var d=c(17793),e=c(60353),f=c(47777);let g=(0,e.CN)({is:a=>"PartitionByNode"===a.kind,create:a=>(0,e.CN)({kind:"PartitionByNode",items:(0,e.CN)(a)}),cloneWithItems:(a,b)=>(0,e.CN)({...a,items:(0,e.CN)([...a.items,...b])})}),h=(0,e.CN)({is:a=>"OverNode"===a.kind,create:()=>(0,e.CN)({kind:"OverNode"}),cloneWithOrderByItems:(a,b)=>(0,e.CN)({...a,orderBy:a.orderBy?f.O.cloneWithItems(a.orderBy,b):f.O.create(b)}),cloneWithPartitionByItems:(a,b)=>(0,e.CN)({...a,partitionBy:a.partitionBy?g.cloneWithItems(a.partitionBy,b):g.create(b)})});var i=c(31575),j=c(53284);class k{#Y;constructor(a){this.#Y=(0,e.CN)(a)}on(...a){return new k({...this.#Y,joinNode:d.b.cloneWithOn(this.#Y.joinNode,(0,j.GB)(a))})}onRef(a,b,c){return new k({...this.#Y,joinNode:d.b.cloneWithOn(this.#Y.joinNode,(0,j.vC)(a,b,c))})}onTrue(){return new k({...this.#Y,joinNode:d.b.cloneWithOn(this.#Y.joinNode,i.z.createWithSql("true"))})}$call(a){return a(this)}toOperationNode(){return this.#Y.joinNode}}var l=c(4315),m=c(68019);let n=(0,e.CN)({is:a=>"PartitionByItemNode"===a.kind,create:a=>(0,e.CN)({kind:"PartitionByItemNode",partitionBy:a})});var o=c(2952);class p{#Y;constructor(a){this.#Y=(0,e.CN)(a)}orderBy(...a){return new p({overNode:h.cloneWithOrderByItems(this.#Y.overNode,(0,m.xk)(a))})}clearOrderBy(){return new p({overNode:l.L.cloneWithoutOrderBy(this.#Y.overNode)})}partitionBy(a){return new p({overNode:h.cloneWithPartitionByItems(this.#Y.overNode,(0,o.kU)(a).map(n.create))})}$call(a){return a(this)}toOperationNode(){return this.#Y.overNode}}var q=c(65966),r=c(22795),s=c(19795);function t(){return new q.n({executor:r.W})}function u(a,b){return new k({joinNode:d.b.create(a,(0,s.uJ)(b))})}function v(){return new p({overNode:h.create()})}},71644:(a,b,c)=>{"use strict";c.d(b,{t:()=>u});var d=c(77688),e=c(60353),f=c(54744),g=c(47777);let h=(0,e.CN)({is:a=>"AggregateFunctionNode"===a.kind,create:(a,b=[])=>(0,e.CN)({kind:"AggregateFunctionNode",func:a,aggregated:b}),cloneWithDistinct:a=>(0,e.CN)({...a,distinct:!0}),cloneWithOrderBy(a,b,c=!1){let d=c?"withinGroup":"orderBy";return(0,e.CN)({...a,[d]:a[d]?g.O.cloneWithItems(a[d],b):g.O.create(b)})},cloneWithFilter:(a,b)=>(0,e.CN)({...a,filter:a.filter?f.o.cloneWithOperation(a.filter,"And",b):f.o.create(b)}),cloneWithOrFilter:(a,b)=>(0,e.CN)({...a,filter:a.filter?f.o.cloneWithOperation(a.filter,"Or",b):f.o.create(b)}),cloneWithOver:(a,b)=>(0,e.CN)({...a,over:b})}),i=(0,e.CN)({is:a=>"FunctionNode"===a.kind,create:(a,b)=>(0,e.CN)({kind:"FunctionNode",func:a,arguments:b})});var j=c(2952),k=c(65582),l=c(44625),m=c(81266),n=c(71088),o=c(53284),p=c(68019),q=c(4315);class r{#Y;constructor(a){this.#Y=(0,e.CN)(a)}get expressionType(){}as(a){return new s(this,a)}distinct(){return new r({...this.#Y,aggregateFunctionNode:h.cloneWithDistinct(this.#Y.aggregateFunctionNode)})}orderBy(...a){return new r({...this.#Y,aggregateFunctionNode:q.L.cloneWithOrderByItems(this.#Y.aggregateFunctionNode,(0,p.xk)(a))})}clearOrderBy(){return new r({...this.#Y,aggregateFunctionNode:q.L.cloneWithoutOrderBy(this.#Y.aggregateFunctionNode)})}withinGroupOrderBy(...a){return new r({...this.#Y,aggregateFunctionNode:h.cloneWithOrderBy(this.#Y.aggregateFunctionNode,(0,p.xk)(a),!0)})}filterWhere(...a){return new r({...this.#Y,aggregateFunctionNode:h.cloneWithFilter(this.#Y.aggregateFunctionNode,(0,o.GB)(a))})}filterWhereRef(a,b,c){return new r({...this.#Y,aggregateFunctionNode:h.cloneWithFilter(this.#Y.aggregateFunctionNode,(0,o.vC)(a,b,c))})}over(a){let b=(0,n.EQ)();return new r({...this.#Y,aggregateFunctionNode:h.cloneWithOver(this.#Y.aggregateFunctionNode,(a?a(b):b).toOperationNode())})}$call(a){return a(this)}$castTo(){return new r(this.#Y)}$notNull(){return new r(this.#Y)}toOperationNode(){return this.#Y.aggregateFunctionNode}}class s{#aX;#aG;constructor(a,b){this.#aX=a,this.#aG=b}get expression(){return this.#aX}get alias(){return this.#aG}toOperationNode(){return l.N.create(this.#aX.toOperationNode(),m.O.create(this.#aG))}}var t=c(19795);function u(){let a=(a,b)=>new d.Is(i.create(a,(0,j.kU)(b??[]))),b=(a,b)=>new r({aggregateFunctionNode:h.create(a,b?(0,j.kU)(b):void 0)});return Object.assign(a,{agg:b,avg:a=>b("avg",[a]),coalesce:(...b)=>a("coalesce",b),count:a=>b("count",[a]),countAll:a=>new r({aggregateFunctionNode:h.create("count",(0,k.J)(a))}),max:a=>b("max",[a]),min:a=>b("min",[a]),sum:a=>b("sum",[a]),any:b=>a("any",[b]),jsonAgg:a=>new r({aggregateFunctionNode:h.create("json_agg",[(0,e.Kg)(a)?(0,t.M$)(a):a.toOperationNode()])}),toJson:a=>new d.Is(i.create("to_json",[(0,e.Kg)(a)?(0,t.M$)(a):a.toOperationNode()]))})}},75227:(a,b,c)=>{"use strict";c.d(b,{N:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"FromNode"===a.kind,create:a=>(0,d.CN)({kind:"FromNode",froms:(0,d.CN)(a)}),cloneWithFroms:(a,b)=>(0,d.CN)({...a,froms:(0,d.CN)([...a.froms,...b])})})},77688:(a,b,c)=>{"use strict";c.d(b,{Is:()=>k});var d=c(44625),e=c(55914),f=c(81266),g=c(39450),h=c(28244),i=c(94296),j=c(53284);class k{#V;constructor(a){this.#V=a}get expressionType(){}as(a){return new l(this,a)}or(...a){return new m(h.K.create(this.#V,(0,j.GB)(a)))}and(...a){return new n(e.s.create(this.#V,(0,j.GB)(a)))}$castTo(){return new k(this.#V)}$notNull(){return new k(this.#V)}toOperationNode(){return this.#V}}class l{#aY;#aG;constructor(a,b){this.#aY=a,this.#aG=b}get expression(){return this.#aY}get alias(){return this.#aG}toOperationNode(){return d.N.create(this.#aY.toOperationNode(),(0,g.N)(this.#aG)?this.#aG.toOperationNode():f.O.create(this.#aG))}}class m{#V;constructor(a){this.#V=a}get expressionType(){}as(a){return new l(this,a)}or(...a){return new m(h.K.create(this.#V,(0,j.GB)(a)))}$castTo(){return new m(this.#V)}toOperationNode(){return i.k.create(this.#V)}}class n{#V;constructor(a){this.#V=a}get expressionType(){}as(a){return new l(this,a)}and(...a){return new n(e.s.create(this.#V,(0,j.GB)(a)))}$castTo(){return new n(this.#V)}toOperationNode(){return i.k.create(this.#V)}}},78329:(a,b,c)=>{"use strict";c.d(b,{kQ:()=>e,sy:()=>f});var d=c(60353);let e="kysely_migration",f="kysely_migration_lock";(0,d.CN)({__noMigrations__:!0})},78335:()=>{},80234:(a,b,c)=>{"use strict";c.d(b,{u:()=>e});let d=new Set;function e(a){d.has(a)||(d.add(a),console.log(a))}},80906:(a,b,c)=>{"use strict";c.d(b,{k:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"JSONOperatorChainNode"===a.kind,create:a=>(0,d.CN)({kind:"JSONOperatorChainNode",operator:a,values:(0,d.CN)([])}),cloneWithValue:(a,b)=>(0,d.CN)({...a,values:(0,d.CN)([...a.values,b])})})},81266:(a,b,c)=>{"use strict";c.d(b,{O:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"IdentifierNode"===a.kind,create:a=>(0,d.CN)({kind:"IdentifierNode",name:a})})},82324:(a,b,c)=>{"use strict";c.d(b,{$s:()=>j,U2:()=>i,dJ:()=>l,qH:()=>k});var d=c(54315),e=c(93159),f=c(90350),g=c(60353),h=c(57105);function i(a){var b;return(0,g.MH)(a)?(b=a).some(h.SS)?e.s.create(b.map(a=>j(a))):d.h.create(b):j(a)}function j(a){return(0,h.SS)(a)?(0,h.YK)(a):f.q.create(a)}function k(a){return(0,g.Et)(a)||(0,g.Lm)(a)||(0,g.kZ)(a)}function l(a){if(!k(a))throw Error(`unsafe immediate value ${JSON.stringify(a)}`);return f.q.createImmediate(a)}},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},88487:(a,b,c)=>{"use strict";c.d(b,{Y:()=>f});var d=c(60353),e=c(36923);let f=(0,d.CN)({is:a=>"CreateViewNode"===a.kind,create:a=>(0,d.CN)({kind:"CreateViewNode",name:e.y.create(a)}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},90350:(a,b,c)=>{"use strict";c.d(b,{q:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"ValueNode"===a.kind,create:a=>(0,d.CN)({kind:"ValueNode",value:a}),createImmediate:a=>(0,d.CN)({kind:"ValueNode",value:a,immediate:!0})})},90409:(a,b,c)=>{"use strict";c.d(b,{i:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"SetOperationNode"===a.kind,create:(a,b,c)=>(0,d.CN)({kind:"SetOperationNode",operator:a,expression:b,all:c})})},90423:(a,b,c)=>{"use strict";c.d(b,{c:()=>D});var d=c(44625),e=c(60353);let f=(0,e.CN)({is:a=>"SelectModifierNode"===a.kind,create:(a,b)=>(0,e.CN)({kind:"SelectModifierNode",modifier:a,of:b}),createWithExpression:a=>(0,e.CN)({kind:"SelectModifierNode",rawModifier:a})});var g=c(51591),h=c(19795),i=c(65582),j=c(2952),k=c(18804),l=c(4315),m=c(68019),n=c(70020);let o=(0,e.CN)({is:a=>"OffsetNode"===a.kind,create:a=>(0,e.CN)({kind:"OffsetNode",offset:a})}),p=(0,e.CN)({is:a=>"GroupByItemNode"===a.kind,create:a=>(0,e.CN)({kind:"GroupByItemNode",groupBy:a})});var q=c(39281),r=c(10106),s=c(81266),t=c(90409),u=c(57105);function v(a,b,c){return(0,e.Tn)(b)&&(b=b((0,q.O)())),(0,e.MH)(b)||(b=[b]),b.map(b=>t.i.create(a,(0,u.YK)(b),c))}var w=c(53284),x=c(77688),y=c(82324),z=c(90350);let A={create:(a,b)=>({kind:"FetchNode",rowCount:z.q.create(a),modifier:b})};var B=c(36903);class C{#Y;constructor(a){this.#Y=(0,e.CN)(a)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...a){return new C({...this.#Y,queryNode:l.L.cloneWithWhere(this.#Y.queryNode,(0,w.GB)(a))})}whereRef(a,b,c){return new C({...this.#Y,queryNode:l.L.cloneWithWhere(this.#Y.queryNode,(0,w.vC)(a,b,c))})}having(...a){return new C({...this.#Y,queryNode:k.L.cloneWithHaving(this.#Y.queryNode,(0,w.GB)(a))})}havingRef(a,b,c){return new C({...this.#Y,queryNode:k.L.cloneWithHaving(this.#Y.queryNode,(0,w.vC)(a,b,c))})}select(a){return new C({...this.#Y,queryNode:k.L.cloneWithSelections(this.#Y.queryNode,(0,i.G)(a))})}distinctOn(a){return new C({...this.#Y,queryNode:k.L.cloneWithDistinctOn(this.#Y.queryNode,(0,j.kU)(a))})}modifyFront(a){return new C({...this.#Y,queryNode:k.L.cloneWithFrontModifier(this.#Y.queryNode,f.createWithExpression(a.toOperationNode()))})}modifyEnd(a){return new C({...this.#Y,queryNode:l.L.cloneWithEndModifier(this.#Y.queryNode,f.createWithExpression(a.toOperationNode()))})}distinct(){return new C({...this.#Y,queryNode:k.L.cloneWithFrontModifier(this.#Y.queryNode,f.create("Distinct"))})}forUpdate(a){return new C({...this.#Y,queryNode:l.L.cloneWithEndModifier(this.#Y.queryNode,f.create("ForUpdate",a?(0,e._j)(a).map(h.M$):void 0))})}forShare(a){return new C({...this.#Y,queryNode:l.L.cloneWithEndModifier(this.#Y.queryNode,f.create("ForShare",a?(0,e._j)(a).map(h.M$):void 0))})}forKeyShare(a){return new C({...this.#Y,queryNode:l.L.cloneWithEndModifier(this.#Y.queryNode,f.create("ForKeyShare",a?(0,e._j)(a).map(h.M$):void 0))})}forNoKeyUpdate(a){return new C({...this.#Y,queryNode:l.L.cloneWithEndModifier(this.#Y.queryNode,f.create("ForNoKeyUpdate",a?(0,e._j)(a).map(h.M$):void 0))})}skipLocked(){return new C({...this.#Y,queryNode:l.L.cloneWithEndModifier(this.#Y.queryNode,f.create("SkipLocked"))})}noWait(){return new C({...this.#Y,queryNode:l.L.cloneWithEndModifier(this.#Y.queryNode,f.create("NoWait"))})}selectAll(a){return new C({...this.#Y,queryNode:k.L.cloneWithSelections(this.#Y.queryNode,(0,i.J)(a))})}innerJoin(...a){return this.#aR("InnerJoin",a)}leftJoin(...a){return this.#aR("LeftJoin",a)}rightJoin(...a){return this.#aR("RightJoin",a)}fullJoin(...a){return this.#aR("FullJoin",a)}crossJoin(...a){return this.#aR("CrossJoin",a)}innerJoinLateral(...a){return this.#aR("LateralInnerJoin",a)}leftJoinLateral(...a){return this.#aR("LateralLeftJoin",a)}crossJoinLateral(...a){return this.#aR("LateralCrossJoin",a)}crossApply(...a){return this.#aR("CrossApply",a)}outerApply(...a){return this.#aR("OuterApply",a)}#aR(a,b){return new C({...this.#Y,queryNode:l.L.cloneWithJoin(this.#Y.queryNode,(0,g.a)(a,b))})}orderBy(...a){return new C({...this.#Y,queryNode:l.L.cloneWithOrderByItems(this.#Y.queryNode,(0,m.xk)(a))})}groupBy(a){var b;return new C({...this.#Y,queryNode:k.L.cloneWithGroupByItems(this.#Y.queryNode,(b=a,b=(0,e.Tn)(b)?b((0,q.A)()):b,(0,j.kU)(b).map(p.create)))})}limit(a){return new C({...this.#Y,queryNode:k.L.cloneWithLimit(this.#Y.queryNode,n.a.create((0,y.$s)(a)))})}offset(a){return new C({...this.#Y,queryNode:k.L.cloneWithOffset(this.#Y.queryNode,o.create((0,y.$s)(a)))})}fetch(a,b="only"){return new C({...this.#Y,queryNode:k.L.cloneWithFetch(this.#Y.queryNode,function(a,b){var c;if(!(0,e.Et)(a)&&!(0,e.sI)(a))throw Error(`Invalid fetch row count: ${a}`);if("only"!==(c=b)&&"with ties"!==c)throw Error(`Invalid fetch modifier: ${b}`);return A.create(a,b)}(a,b))})}top(a,b){return new C({...this.#Y,queryNode:l.L.cloneWithTop(this.#Y.queryNode,(0,B.f)(a,b))})}union(a){return new C({...this.#Y,queryNode:k.L.cloneWithSetOperations(this.#Y.queryNode,v("union",a,!1))})}unionAll(a){return new C({...this.#Y,queryNode:k.L.cloneWithSetOperations(this.#Y.queryNode,v("union",a,!0))})}intersect(a){return new C({...this.#Y,queryNode:k.L.cloneWithSetOperations(this.#Y.queryNode,v("intersect",a,!1))})}intersectAll(a){return new C({...this.#Y,queryNode:k.L.cloneWithSetOperations(this.#Y.queryNode,v("intersect",a,!0))})}except(a){return new C({...this.#Y,queryNode:k.L.cloneWithSetOperations(this.#Y.queryNode,v("except",a,!1))})}exceptAll(a){return new C({...this.#Y,queryNode:k.L.cloneWithSetOperations(this.#Y.queryNode,v("except",a,!0))})}as(a){return new E(this,a)}clearSelect(){return new C({...this.#Y,queryNode:k.L.cloneWithoutSelections(this.#Y.queryNode)})}clearWhere(){return new C({...this.#Y,queryNode:l.L.cloneWithoutWhere(this.#Y.queryNode)})}clearLimit(){return new C({...this.#Y,queryNode:k.L.cloneWithoutLimit(this.#Y.queryNode)})}clearOffset(){return new C({...this.#Y,queryNode:k.L.cloneWithoutOffset(this.#Y.queryNode)})}clearOrderBy(){return new C({...this.#Y,queryNode:l.L.cloneWithoutOrderBy(this.#Y.queryNode)})}clearGroupBy(){return new C({...this.#Y,queryNode:k.L.cloneWithoutGroupBy(this.#Y.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new C({...this.#Y})}$castTo(){return new C(this.#Y)}$narrowType(){return new C(this.#Y)}$assertType(){return new C(this.#Y)}$asTuple(){return new x.Is(this.toOperationNode())}$asScalar(){return new x.Is(this.toOperationNode())}withPlugin(a){return new C({...this.#Y,executor:this.#Y.executor.withPlugin(a)})}toOperationNode(){return this.#Y.executor.transformQuery(this.#Y.queryNode,this.#Y.queryId)}compile(){return this.#Y.executor.compileQuery(this.toOperationNode(),this.#Y.queryId)}async execute(){let a=this.compile();return(await this.#Y.executor.executeQuery(a)).rows}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=r.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,r.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#Y.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new C({...this.#Y,queryNode:l.L.cloneWithExplain(this.#Y.queryNode,a,b)});return await c.execute()}}function D(a){return new C(a)}class E{#aZ;#aG;constructor(a,b){this.#aZ=a,this.#aG=b}get expression(){return this.#aZ}get alias(){return this.#aG}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return d.N.create(this.#aZ.toOperationNode(),s.O.create(this.#aG))}}},93087:(a,b,c)=>{"use strict";c.d(b,{U:()=>g});var d=c(60353),e=c(75227),f=c(97831);let g=(0,d.CN)({is:a=>"UpdateQueryNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"UpdateQueryNode",table:1===a.length?a[0]:f.v.create(a),...b&&{with:b}}),createWithoutTable:()=>(0,d.CN)({kind:"UpdateQueryNode"}),cloneWithFromItems:(a,b)=>(0,d.CN)({...a,from:a.from?e.N.cloneWithFroms(a.from,b):e.N.create(b)}),cloneWithUpdates:(a,b)=>(0,d.CN)({...a,updates:a.updates?(0,d.CN)([...a.updates,...b]):b}),cloneWithLimit:(a,b)=>(0,d.CN)({...a,limit:b})})},93092:(a,b,c)=>{"use strict";c.d(b,{B:()=>f,o:()=>e});var d=c(60353);let e=["preserve rows","delete rows","drop"],f=(0,d.CN)({is:a=>"CreateTableNode"===a.kind,create:a=>(0,d.CN)({kind:"CreateTableNode",table:a,columns:(0,d.CN)([])}),cloneWithColumn:(a,b)=>(0,d.CN)({...a,columns:(0,d.CN)([...a.columns,b])}),cloneWithConstraint:(a,b)=>(0,d.CN)({...a,constraints:a.constraints?(0,d.CN)([...a.constraints,b]):(0,d.CN)([b])}),cloneWithFrontModifier:(a,b)=>(0,d.CN)({...a,frontModifiers:a.frontModifiers?(0,d.CN)([...a.frontModifiers,b]):(0,d.CN)([b])}),cloneWithEndModifier:(a,b)=>(0,d.CN)({...a,endModifiers:a.endModifiers?(0,d.CN)([...a.endModifiers,b]):(0,d.CN)([b])}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},93159:(a,b,c)=>{"use strict";c.d(b,{s:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"ValueListNode"===a.kind,create:a=>(0,d.CN)({kind:"ValueListNode",values:(0,d.CN)(a)})})},94296:(a,b,c)=>{"use strict";c.d(b,{k:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"ParensNode"===a.kind,create:a=>(0,d.CN)({kind:"ParensNode",node:a})})},95736:(a,b,c)=>{"use strict";a.exports=c(44870)},96487:()=>{},96931:(a,b,c)=>{"use strict";c.d(b,{D:()=>e});let d=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function e(a){let b="";for(let c=0;c<a;++c)b+=d[~~(Math.random()*d.length)];return b}},97831:(a,b,c)=>{"use strict";c.d(b,{v:()=>e});var d=c(60353);let e=(0,d.CN)({is:a=>"ListNode"===a.kind,create:a=>(0,d.CN)({kind:"ListNode",items:(0,d.CN)(a)})})}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[5873],()=>b(b.s=10670));module.exports=c})();