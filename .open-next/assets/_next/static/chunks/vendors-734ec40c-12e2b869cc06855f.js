"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9168],{15187:(e,t,n)=>{n.d(t,{NJ:()=>ex});var o=n(70284),i=n(64876),r=n(72253),s=r.z.object({error:r.z.object({message:r.z.string(),type:r.z.string().nullish(),param:r.z.any().nullish(),code:r.z.union([r.z.string(),r.z.number()]).nullish()})}),a=(0,o.sl)({errorSchema:s,errorToMessage:e=>e.error.message});function l({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function u(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var d=r.z.object({logitBias:r.z.record(r.z.coerce.number(),r.z.number()).optional(),logprobs:r.z.union([r.z.boolean(),r.z.number()]).optional(),parallelToolCalls:r.z.boolean().optional(),user:r.z.string().optional(),reasoningEffort:r.z.enum(["minimal","low","medium","high"]).optional(),maxCompletionTokens:r.z.number().optional(),store:r.z.boolean().optional(),metadata:r.z.record(r.z.string().max(64),r.z.string().max(512)).optional(),prediction:r.z.record(r.z.string(),r.z.any()).optional(),structuredOutputs:r.z.boolean().optional(),serviceTier:r.z.enum(["auto","flex","priority"]).optional(),strictJsonSchema:r.z.boolean().optional(),textVerbosity:r.z.enum(["low","medium","high"]).optional(),promptCacheKey:r.z.string().optional(),safetyIdentifier:r.z.string().optional()}),p=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:s,frequencyPenalty:a,presencePenalty:l,stopSequences:u,responseFormat:p,seed:c,tools:m,toolChoice:g,providerOptions:f}){var z,_,b,v,w,k,x,I,j;let C=[],T=null!=(z=await (0,o.xI)({provider:"openai",providerOptions:f,schema:d}))?z:{},q=null==(_=T.structuredOutputs)||_;null!=s&&C.push({type:"unsupported-setting",setting:"topK"}),(null==p?void 0:p.type)!=="json"||null==p.schema||q||C.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let{messages:E,warnings:S}=function({prompt:e,systemMessageMode:t="system"}){let n=[],r=[];for(let{role:s,content:a}of e)switch(s){case"system":switch(t){case"system":n.push({role:"system",content:a});break;case"developer":n.push({role:"developer",content:a});break;case"remove":r.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${t}`)}break;case"user":if(1===a.length&&"text"===a[0].type){n.push({role:"user",content:a[0].text});break}n.push({role:"user",content:a.map((e,t)=>{var n,r,s;switch(e.type){case"text":return{type:"text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){let t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"image_url",image_url:{url:e.data instanceof URL?e.data.toString():`data:${t};base64,${(0,o.ej)(e.data)}`,detail:null==(r=null==(n=e.providerOptions)?void 0:n.openai)?void 0:r.imageDetail}}}if(e.mediaType.startsWith("audio/")){if(e.data instanceof URL)throw new i.b8({functionality:"audio file parts with URLs"});switch(e.mediaType){case"audio/wav":return{type:"input_audio",input_audio:{data:(0,o.ej)(e.data),format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:(0,o.ej)(e.data),format:"mp3"}};default:throw new i.b8({functionality:`audio content parts with media type ${e.mediaType}`})}}if("application/pdf"===e.mediaType){if(e.data instanceof URL)throw new i.b8({functionality:"PDF file parts with URLs"});return{type:"file",file:"string"==typeof e.data&&e.data.startsWith("file-")?{file_id:e.data}:{filename:null!=(s=e.filename)?s:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${(0,o.ej)(e.data)}`}}}else throw new i.b8({functionality:`file part media type ${e.mediaType}`})}})});break;case"assistant":{let e="",t=[];for(let n of a)switch(n.type){case"text":e+=n.text;break;case"tool-call":t.push({id:n.toolCallId,type:"function",function:{name:n.toolName,arguments:JSON.stringify(n.input)}})}n.push({role:"assistant",content:e,tool_calls:t.length>0?t:void 0});break}case"tool":for(let e of a){let t,o=e.output;switch(o.type){case"text":case"error-text":t=o.value;break;case"content":case"json":case"error-json":t=JSON.stringify(o.value)}n.push({role:"tool",tool_call_id:e.toolCallId,content:t})}break;default:throw Error(`Unsupported role: ${s}`)}return{messages:n,warnings:r}}({prompt:e,systemMessageMode:h(w=this.modelId)?null!=(x=null==(k=y[w])?void 0:k.systemMessageMode)?x:"developer":"system"});C.push(...S);let M=null!=(b=T.strictJsonSchema)&&b,$={model:this.modelId,logit_bias:T.logitBias,logprobs:!0===T.logprobs||"number"==typeof T.logprobs||void 0,top_logprobs:"number"==typeof T.logprobs?T.logprobs:"boolean"==typeof T.logprobs&&T.logprobs?0:void 0,user:T.user,parallel_tool_calls:T.parallelToolCalls,max_tokens:t,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:l,response_format:(null==p?void 0:p.type)==="json"?q&&null!=p.schema?{type:"json_schema",json_schema:{schema:p.schema,strict:M,name:null!=(v=p.name)?v:"response",description:p.description}}:{type:"json_object"}:void 0,stop:u,seed:c,verbosity:T.textVerbosity,max_completion_tokens:T.maxCompletionTokens,store:T.store,metadata:T.metadata,prediction:T.prediction,reasoning_effort:T.reasoningEffort,service_tier:T.serviceTier,prompt_cache_key:T.promptCacheKey,safety_identifier:T.safetyIdentifier,messages:E};h(this.modelId)?(null!=$.temperature&&($.temperature=void 0,C.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=$.top_p&&($.top_p=void 0,C.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),null!=$.frequency_penalty&&($.frequency_penalty=void 0,C.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),null!=$.presence_penalty&&($.presence_penalty=void 0,C.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),null!=$.logit_bias&&($.logit_bias=void 0,C.push({type:"other",message:"logitBias is not supported for reasoning models"})),null!=$.logprobs&&($.logprobs=void 0,C.push({type:"other",message:"logprobs is not supported for reasoning models"})),null!=$.top_logprobs&&($.top_logprobs=void 0,C.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),null!=$.max_tokens&&(null==$.max_completion_tokens&&($.max_completion_tokens=$.max_tokens),$.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&null!=$.temperature&&($.temperature=void 0,C.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),"flex"!==T.serviceTier||(I=this.modelId).startsWith("o3")||I.startsWith("o4-mini")||I.startsWith("gpt-5")&&!I.startsWith("gpt-5-chat")||(C.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),$.service_tier=void 0),"priority"!==T.serviceTier||(j=this.modelId).startsWith("gpt-4")||j.startsWith("gpt-5-mini")||j.startsWith("gpt-5")&&!j.startsWith("gpt-5-nano")&&!j.startsWith("gpt-5-chat")||j.startsWith("o3")||j.startsWith("o4-mini")||(C.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),$.service_tier=void 0);let{tools:N,toolChoice:R,toolWarnings:A}=function({tools:e,toolChoice:t,structuredOutputs:n,strictJsonSchema:o}){e=(null==e?void 0:e.length)?e:void 0;let r=[];if(null==e)return{tools:void 0,toolChoice:void 0,toolWarnings:r};let s=[];for(let t of e)"function"===t.type?s.push({type:"function",function:{name:t.name,description:t.description,parameters:t.inputSchema,strict:n?o:void 0}}):r.push({type:"unsupported-tool",tool:t});if(null==t)return{tools:s,toolChoice:void 0,toolWarnings:r};let a=t.type;switch(a){case"auto":case"none":case"required":return{tools:s,toolChoice:a,toolWarnings:r};case"tool":return{tools:s,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:r};default:throw new i.b8({functionality:`tool choice type: ${a}`})}}({tools:m,toolChoice:g,structuredOutputs:q,strictJsonSchema:M});return{args:{...$,tools:N,tool_choice:R},warnings:[...C,...A]}}async doGenerate(e){var t,n,i,r,s,d,p,c,g,h,y,f,z,_;let{args:b,warnings:v}=await this.getArgs(e),{responseHeaders:w,value:k,rawValue:x}=await (0,o.GU)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,o.m2)(this.config.headers(),e.headers),body:b,failedResponseHandler:a,successfulResponseHandler:(0,o.cV)(m),abortSignal:e.abortSignal,fetch:this.config.fetch}),I=k.choices[0],j=[],C=I.message.content;for(let e of(null!=C&&C.length>0&&j.push({type:"text",text:C}),null!=(t=I.message.tool_calls)?t:[]))j.push({type:"tool-call",toolCallId:null!=(n=e.id)?n:(0,o.$C)(),toolName:e.function.name,input:e.function.arguments});for(let e of null!=(i=I.message.annotations)?i:[])j.push({type:"source",sourceType:"url",id:(0,o.$C)(),url:e.url,title:e.title});let T=null==(r=k.usage)?void 0:r.completion_tokens_details,q=null==(s=k.usage)?void 0:s.prompt_tokens_details,E={openai:{}};return(null==T?void 0:T.accepted_prediction_tokens)!=null&&(E.openai.acceptedPredictionTokens=null==T?void 0:T.accepted_prediction_tokens),(null==T?void 0:T.rejected_prediction_tokens)!=null&&(E.openai.rejectedPredictionTokens=null==T?void 0:T.rejected_prediction_tokens),(null==(d=I.logprobs)?void 0:d.content)!=null&&(E.openai.logprobs=I.logprobs.content),{content:j,finishReason:u(I.finish_reason),usage:{inputTokens:null!=(c=null==(p=k.usage)?void 0:p.prompt_tokens)?c:void 0,outputTokens:null!=(h=null==(g=k.usage)?void 0:g.completion_tokens)?h:void 0,totalTokens:null!=(f=null==(y=k.usage)?void 0:y.total_tokens)?f:void 0,reasoningTokens:null!=(z=null==T?void 0:T.reasoning_tokens)?z:void 0,cachedInputTokens:null!=(_=null==q?void 0:q.cached_tokens)?_:void 0},request:{body:b},response:{...l(k),headers:w,body:x},warnings:v,providerMetadata:E}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:s,value:d}=await (0,o.GU)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,o.m2)(this.config.headers(),e.headers),body:r,failedResponseHandler:a,successfulResponseHandler:(0,o.Ds)(g),abortSignal:e.abortSignal,fetch:this.config.fetch}),p=[],c="unknown",m={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},h=!0,y=!1,f={openai:{}};return{stream:d.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:n})},transform(t,n){var r,s,a,d,g,z,_,b,v,w,k,x,I,j,C,T,q,E,S,M,$,N,R,A;if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success){c="error",n.enqueue({type:"error",error:t.error});return}let P=t.value;if("error"in P){c="error",n.enqueue({type:"error",error:P.error});return}h&&(h=!1,n.enqueue({type:"response-metadata",...l(P)})),null!=P.usage&&(m.inputTokens=null!=(r=P.usage.prompt_tokens)?r:void 0,m.outputTokens=null!=(s=P.usage.completion_tokens)?s:void 0,m.totalTokens=null!=(a=P.usage.total_tokens)?a:void 0,m.reasoningTokens=null!=(g=null==(d=P.usage.completion_tokens_details)?void 0:d.reasoning_tokens)?g:void 0,m.cachedInputTokens=null!=(_=null==(z=P.usage.prompt_tokens_details)?void 0:z.cached_tokens)?_:void 0,(null==(b=P.usage.completion_tokens_details)?void 0:b.accepted_prediction_tokens)!=null&&(f.openai.acceptedPredictionTokens=null==(v=P.usage.completion_tokens_details)?void 0:v.accepted_prediction_tokens),(null==(w=P.usage.completion_tokens_details)?void 0:w.rejected_prediction_tokens)!=null&&(f.openai.rejectedPredictionTokens=null==(k=P.usage.completion_tokens_details)?void 0:k.rejected_prediction_tokens));let U=P.choices[0];if((null==U?void 0:U.finish_reason)!=null&&(c=u(U.finish_reason)),(null==(x=null==U?void 0:U.logprobs)?void 0:x.content)!=null&&(f.openai.logprobs=U.logprobs.content),(null==U?void 0:U.delta)==null)return;let V=U.delta;if(null!=V.content&&(y||(n.enqueue({type:"text-start",id:"0"}),y=!0),n.enqueue({type:"text-delta",id:"0",delta:V.content})),null!=V.tool_calls)for(let e of V.tool_calls){let t=e.index;if(null==p[t]){if("function"!==e.type)throw new i.xn({data:e,message:"Expected 'function' type."});if(null==e.id)throw new i.xn({data:e,message:"Expected 'id' to be a string."});if((null==(I=e.function)?void 0:I.name)==null)throw new i.xn({data:e,message:"Expected 'function.name' to be a string."});n.enqueue({type:"tool-input-start",id:e.id,toolName:e.function.name}),p[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(j=e.function.arguments)?j:""},hasFinished:!1};let r=p[t];(null==(C=r.function)?void 0:C.name)!=null&&(null==(T=r.function)?void 0:T.arguments)!=null&&(r.function.arguments.length>0&&n.enqueue({type:"tool-input-delta",id:r.id,delta:r.function.arguments}),(0,o.v0)(r.function.arguments)&&(n.enqueue({type:"tool-input-end",id:r.id}),n.enqueue({type:"tool-call",toolCallId:null!=(q=r.id)?q:(0,o.$C)(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0));continue}let r=p[t];!r.hasFinished&&((null==(E=e.function)?void 0:E.arguments)!=null&&(r.function.arguments+=null!=(M=null==(S=e.function)?void 0:S.arguments)?M:""),n.enqueue({type:"tool-input-delta",id:r.id,delta:null!=($=e.function.arguments)?$:""}),(null==(N=r.function)?void 0:N.name)!=null&&(null==(R=r.function)?void 0:R.arguments)!=null&&(0,o.v0)(r.function.arguments)&&(n.enqueue({type:"tool-input-end",id:r.id}),n.enqueue({type:"tool-call",toolCallId:null!=(A=r.id)?A:(0,o.$C)(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0))}if(null!=V.annotations)for(let e of V.annotations)n.enqueue({type:"source",sourceType:"url",id:(0,o.$C)(),url:e.url,title:e.title})},flush(e){y&&e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:c,usage:m,...null!=f?{providerMetadata:f}:{}})}})),request:{body:r},response:{headers:s}}}},c=r.z.object({prompt_tokens:r.z.number().nullish(),completion_tokens:r.z.number().nullish(),total_tokens:r.z.number().nullish(),prompt_tokens_details:r.z.object({cached_tokens:r.z.number().nullish()}).nullish(),completion_tokens_details:r.z.object({reasoning_tokens:r.z.number().nullish(),accepted_prediction_tokens:r.z.number().nullish(),rejected_prediction_tokens:r.z.number().nullish()}).nullish()}).nullish(),m=r.z.object({id:r.z.string().nullish(),created:r.z.number().nullish(),model:r.z.string().nullish(),choices:r.z.array(r.z.object({message:r.z.object({role:r.z.literal("assistant").nullish(),content:r.z.string().nullish(),tool_calls:r.z.array(r.z.object({id:r.z.string().nullish(),type:r.z.literal("function"),function:r.z.object({name:r.z.string(),arguments:r.z.string()})})).nullish(),annotations:r.z.array(r.z.object({type:r.z.literal("url_citation"),start_index:r.z.number(),end_index:r.z.number(),url:r.z.string(),title:r.z.string()})).nullish()}),index:r.z.number(),logprobs:r.z.object({content:r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number(),top_logprobs:r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number()}))})).nullish()}).nullish(),finish_reason:r.z.string().nullish()})),usage:c}),g=r.z.union([r.z.object({id:r.z.string().nullish(),created:r.z.number().nullish(),model:r.z.string().nullish(),choices:r.z.array(r.z.object({delta:r.z.object({role:r.z.enum(["assistant"]).nullish(),content:r.z.string().nullish(),tool_calls:r.z.array(r.z.object({index:r.z.number(),id:r.z.string().nullish(),type:r.z.literal("function").nullish(),function:r.z.object({name:r.z.string().nullish(),arguments:r.z.string().nullish()})})).nullish(),annotations:r.z.array(r.z.object({type:r.z.literal("url_citation"),start_index:r.z.number(),end_index:r.z.number(),url:r.z.string(),title:r.z.string()})).nullish()}).nullish(),logprobs:r.z.object({content:r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number(),top_logprobs:r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number()}))})).nullish()}).nullish(),finish_reason:r.z.string().nullish(),index:r.z.number()})),usage:c}),s]);function h(e){return(e.startsWith("o")||e.startsWith("gpt-5"))&&!e.startsWith("gpt-5-chat")}var y={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function f({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function z(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var _=r.z.object({echo:r.z.boolean().optional(),logitBias:r.z.record(r.z.string(),r.z.number()).optional(),suffix:r.z.string().optional(),user:r.z.string().optional(),logprobs:r.z.union([r.z.boolean(),r.z.number()]).optional()}),b=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={},this.modelId=e,this.config=t}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:s,frequencyPenalty:a,presencePenalty:l,stopSequences:u,responseFormat:d,tools:p,toolChoice:c,seed:m,providerOptions:g}){let h=[],y={...await (0,o.xI)({provider:"openai",providerOptions:g,schema:_}),...await (0,o.xI)({provider:this.providerOptionsName,providerOptions:g,schema:_})};null!=s&&h.push({type:"unsupported-setting",setting:"topK"}),(null==p?void 0:p.length)&&h.push({type:"unsupported-setting",setting:"tools"}),null!=c&&h.push({type:"unsupported-setting",setting:"toolChoice"}),null!=d&&"text"!==d.type&&h.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:f,stopSequences:z}=function({prompt:e,user:t="user",assistant:n="assistant"}){let o="";for(let{role:r,content:s}of("system"===e[0].role&&(o+=`${e[0].content}

`,e=e.slice(1)),e))switch(r){case"system":throw new i.M3({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let e=s.map(e=>{if("text"===e.type)return e.text}).filter(Boolean).join("");o+=`${t}:
${e}

`;break}case"assistant":{let e=s.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new i.b8({functionality:"tool-call messages"})}}).join("");o+=`${n}:
${e}

`;break}case"tool":throw new i.b8({functionality:"tool messages"});default:throw Error(`Unsupported role: ${r}`)}return{prompt:o+=`${n}:
`,stopSequences:[`
${t}:`]}}({prompt:e}),b=[...null!=z?z:[],...null!=u?u:[]];return{args:{model:this.modelId,echo:y.echo,logit_bias:y.logitBias,logprobs:(null==y?void 0:y.logprobs)===!0?0:(null==y?void 0:y.logprobs)===!1||null==y?void 0:y.logprobs,suffix:y.suffix,user:y.user,max_tokens:t,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:l,seed:m,prompt:f,stop:b.length>0?b:void 0},warnings:h}}async doGenerate(e){var t,n,i;let{args:r,warnings:s}=await this.getArgs(e),{responseHeaders:l,value:u,rawValue:d}=await (0,o.GU)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,o.m2)(this.config.headers(),e.headers),body:r,failedResponseHandler:a,successfulResponseHandler:(0,o.cV)(w),abortSignal:e.abortSignal,fetch:this.config.fetch}),p=u.choices[0],c={openai:{}};return null!=p.logprobs&&(c.openai.logprobs=p.logprobs),{content:[{type:"text",text:p.text}],usage:{inputTokens:null==(t=u.usage)?void 0:t.prompt_tokens,outputTokens:null==(n=u.usage)?void 0:n.completion_tokens,totalTokens:null==(i=u.usage)?void 0:i.total_tokens},finishReason:z(p.finish_reason),request:{body:r},response:{...f(u),headers:l,body:d},providerMetadata:c,warnings:s}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),i={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:r,value:s}=await (0,o.GU)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,o.m2)(this.config.headers(),e.headers),body:i,failedResponseHandler:a,successfulResponseHandler:(0,o.Ds)(k),abortSignal:e.abortSignal,fetch:this.config.fetch}),l="unknown",u={openai:{}},d={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},p=!0;return{stream:s.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success){l="error",n.enqueue({type:"error",error:t.error});return}let o=t.value;if("error"in o){l="error",n.enqueue({type:"error",error:o.error});return}p&&(p=!1,n.enqueue({type:"response-metadata",...f(o)}),n.enqueue({type:"text-start",id:"0"})),null!=o.usage&&(d.inputTokens=o.usage.prompt_tokens,d.outputTokens=o.usage.completion_tokens,d.totalTokens=o.usage.total_tokens);let i=o.choices[0];(null==i?void 0:i.finish_reason)!=null&&(l=z(i.finish_reason)),(null==i?void 0:i.logprobs)!=null&&(u.openai.logprobs=i.logprobs),(null==i?void 0:i.text)!=null&&i.text.length>0&&n.enqueue({type:"text-delta",id:"0",delta:i.text})},flush(e){p||e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:l,providerMetadata:u,usage:d})}})),request:{body:i},response:{headers:r}}}},v=r.z.object({prompt_tokens:r.z.number(),completion_tokens:r.z.number(),total_tokens:r.z.number()}),w=r.z.object({id:r.z.string().nullish(),created:r.z.number().nullish(),model:r.z.string().nullish(),choices:r.z.array(r.z.object({text:r.z.string(),finish_reason:r.z.string(),logprobs:r.z.object({tokens:r.z.array(r.z.string()),token_logprobs:r.z.array(r.z.number()),top_logprobs:r.z.array(r.z.record(r.z.string(),r.z.number())).nullish()}).nullish()})),usage:v.nullish()}),k=r.z.union([r.z.object({id:r.z.string().nullish(),created:r.z.number().nullish(),model:r.z.string().nullish(),choices:r.z.array(r.z.object({text:r.z.string(),finish_reason:r.z.string().nullish(),index:r.z.number(),logprobs:r.z.object({tokens:r.z.array(r.z.string()),token_logprobs:r.z.array(r.z.number()),top_logprobs:r.z.array(r.z.record(r.z.string(),r.z.number())).nullish()}).nullish()})),usage:v.nullish()}),s]),x=r.z.object({dimensions:r.z.number().optional(),user:r.z.string().optional()}),I=class{constructor(e,t){this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){var s;if(e.length>this.maxEmbeddingsPerCall)throw new i.Ch({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let l=null!=(s=await (0,o.xI)({provider:"openai",providerOptions:r,schema:x}))?s:{},{responseHeaders:u,value:d,rawValue:p}=await (0,o.GU)({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:(0,o.m2)(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:l.dimensions,user:l.user},failedResponseHandler:a,successfulResponseHandler:(0,o.cV)(j),abortSignal:n,fetch:this.config.fetch});return{embeddings:d.data.map(e=>e.embedding),usage:d.usage?{tokens:d.usage.prompt_tokens}:void 0,response:{headers:u,body:p}}}},j=r.z.object({data:r.z.array(r.z.object({embedding:r.z.array(r.z.number())})),usage:r.z.object({prompt_tokens:r.z.number()}).nullish()}),C={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},T=new Set(["gpt-image-1"]),q=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get maxImagesPerCall(){var e;return null!=(e=C[this.modelId])?e:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:i,seed:r,providerOptions:s,headers:l,abortSignal:u}){var d,p,c,m;let g=[];null!=i&&g.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=r&&g.push({type:"unsupported-setting",setting:"seed"});let h=null!=(c=null==(p=null==(d=this.config._internal)?void 0:d.currentDate)?void 0:p.call(d))?c:new Date,{value:y,responseHeaders:f}=await (0,o.GU)({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:(0,o.m2)(this.config.headers(),l),body:{model:this.modelId,prompt:e,n:t,size:n,...null!=(m=s.openai)?m:{},...!T.has(this.modelId)?{response_format:"b64_json"}:{}},failedResponseHandler:a,successfulResponseHandler:(0,o.cV)(E),abortSignal:u,fetch:this.config.fetch});return{images:y.data.map(e=>e.b64_json),warnings:g,response:{timestamp:h,modelId:this.modelId,headers:f},providerMetadata:{openai:{images:y.data.map(e=>e.revised_prompt?{revisedPrompt:e.revised_prompt}:null)}}}}},E=r.z.object({data:r.z.array(r.z.object({b64_json:r.z.string(),revised_prompt:r.z.string().optional()}))}),S=r.z.object({code:r.z.string().nullish(),containerId:r.z.string()}),M=r.z.object({outputs:r.z.array(r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("logs"),logs:r.z.string()}),r.z.object({type:r.z.literal("image"),url:r.z.string()})])).nullish()}),$=r.z.object({container:r.z.union([r.z.string(),r.z.object({fileIds:r.z.array(r.z.string()).optional()})]).optional()}),N=(0,o.J2)({id:"openai.code_interpreter",name:"code_interpreter",inputSchema:S,outputSchema:M}),R=r.z.object({key:r.z.string(),type:r.z.enum(["eq","ne","gt","gte","lt","lte"]),value:r.z.union([r.z.string(),r.z.number(),r.z.boolean()])}),A=r.z.object({type:r.z.enum(["and","or"]),filters:r.z.array(r.z.union([R,r.z.lazy(()=>A)]))}),P=r.z.object({vectorStoreIds:r.z.array(r.z.string()),maxNumResults:r.z.number().optional(),ranking:r.z.object({ranker:r.z.string().optional(),scoreThreshold:r.z.number().optional()}).optional(),filters:r.z.union([R,A]).optional()}),U=r.z.object({queries:r.z.array(r.z.string()),results:r.z.array(r.z.object({attributes:r.z.record(r.z.string(),r.z.unknown()),fileId:r.z.string(),filename:r.z.string(),score:r.z.number(),text:r.z.string()})).nullable()}),V=(0,o.J2)({id:"openai.file_search",name:"file_search",inputSchema:r.z.object({}),outputSchema:U}),O=r.z.object({background:r.z.enum(["auto","opaque","transparent"]).optional(),inputFidelity:r.z.enum(["low","high"]).optional(),inputImageMask:r.z.object({fileId:r.z.string().optional(),imageUrl:r.z.string().optional()}).optional(),model:r.z.string().optional(),moderation:r.z.enum(["auto"]).optional(),outputCompression:r.z.number().int().min(0).max(100).optional(),outputFormat:r.z.enum(["png","jpeg","webp"]).optional(),quality:r.z.enum(["auto","low","medium","high"]).optional(),size:r.z.enum(["1024x1024","1024x1536","1536x1024","auto"]).optional()}).strict(),W=r.z.object({result:r.z.string()}),G=(0,o.J2)({id:"openai.image_generation",name:"image_generation",inputSchema:r.z.object({}),outputSchema:W}),H=r.z.object({filters:r.z.object({allowedDomains:r.z.array(r.z.string()).optional()}).optional(),searchContextSize:r.z.enum(["low","medium","high"]).optional(),userLocation:r.z.object({type:r.z.literal("approximate"),country:r.z.string().optional(),city:r.z.string().optional(),region:r.z.string().optional(),timezone:r.z.string().optional()}).optional()}),D=(0,o.hL)({id:"openai.web_search",name:"web_search",inputSchema:r.z.object({action:r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("search"),query:r.z.string().nullish()}),r.z.object({type:r.z.literal("open_page"),url:r.z.string()}),r.z.object({type:r.z.literal("find"),url:r.z.string(),pattern:r.z.string()})]).nullish()})}),L=r.z.object({searchContextSize:r.z.enum(["low","medium","high"]).optional(),userLocation:r.z.object({type:r.z.literal("approximate"),country:r.z.string().optional(),city:r.z.string().optional(),region:r.z.string().optional(),timezone:r.z.string().optional()}).optional()}),J={codeInterpreter:(e={})=>N(e),fileSearch:V,imageGeneration:(e={})=>G(e),webSearchPreview:(0,o.hL)({id:"openai.web_search_preview",name:"web_search_preview",inputSchema:r.z.object({action:r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("search"),query:r.z.string().nullish()}),r.z.object({type:r.z.literal("open_page"),url:r.z.string()}),r.z.object({type:r.z.literal("find"),url:r.z.string(),pattern:r.z.string()})]).nullish()})}),webSearch:(e={})=>D(e)};function K(e,t){return!!t&&t.some(t=>e.startsWith(t))}async function F({prompt:e,systemMessageMode:t,fileIdPrefixes:n,store:r}){var s,a,l,u,d,p;let c=[],m=[];for(let{role:g,content:h}of e)switch(g){case"system":switch(t){case"system":c.push({role:"system",content:h});break;case"developer":c.push({role:"developer",content:h});break;case"remove":m.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${t}`)}break;case"user":c.push({role:"user",content:h.map((e,t)=>{var r,s,a;switch(e.type){case"text":return{type:"input_text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){let t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"input_image",...e.data instanceof URL?{image_url:e.data.toString()}:"string"==typeof e.data&&K(e.data,n)?{file_id:e.data}:{image_url:`data:${t};base64,${(0,o.ej)(e.data)}`},detail:null==(s=null==(r=e.providerOptions)?void 0:r.openai)?void 0:s.imageDetail}}if("application/pdf"===e.mediaType){if(e.data instanceof URL)return{type:"input_file",file_url:e.data.toString()};return{type:"input_file",..."string"==typeof e.data&&K(e.data,n)?{file_id:e.data}:{filename:null!=(a=e.filename)?a:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${(0,o.ej)(e.data)}`}}}throw new i.b8({functionality:`file part media type ${e.mediaType}`})}})});break;case"assistant":{let e={},t={};for(let n of h)switch(n.type){case"text":c.push({role:"assistant",content:[{type:"output_text",text:n.text}],id:null!=(l=null==(a=null==(s=n.providerOptions)?void 0:s.openai)?void 0:a.itemId)?l:void 0});break;case"tool-call":if(t[n.toolCallId]=n,n.providerExecuted)break;c.push({type:"function_call",call_id:n.toolCallId,name:n.toolName,arguments:JSON.stringify(n.input),id:null!=(p=null==(d=null==(u=n.providerOptions)?void 0:u.openai)?void 0:d.itemId)?p:void 0});break;case"tool-result":r?c.push({type:"item_reference",id:n.toolCallId}):m.push({type:"other",message:`Results for OpenAI tool ${n.toolName} are not sent to the API when store is false`});break;case"reasoning":{let t=await (0,o.xI)({provider:"openai",providerOptions:n.providerOptions,schema:B}),i=null==t?void 0:t.itemId;if(null!=i){let o=e[i],r=[];n.text.length>0?r.push({type:"summary_text",text:n.text}):void 0!==o&&m.push({type:"other",message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(n)}.`}),void 0===o?(e[i]={type:"reasoning",id:i,encrypted_content:null==t?void 0:t.reasoningEncryptedContent,summary:r},c.push(e[i])):o.summary.push(...r)}else m.push({type:"other",message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(n)}.`})}}break}case"tool":for(let e of h){let t,n=e.output;switch(n.type){case"text":case"error-text":t=n.value;break;case"content":case"json":case"error-json":t=JSON.stringify(n.value)}c.push({type:"function_call_output",call_id:e.toolCallId,output:t})}break;default:throw Error(`Unsupported role: ${g}`)}return{input:c,warnings:m}}var B=r.z.object({itemId:r.z.string().nullish(),reasoningEncryptedContent:r.z.string().nullish()});function Y({finishReason:e,hasFunctionCall:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}var Z=r.z.object({type:r.z.literal("web_search_call"),id:r.z.string(),status:r.z.string(),action:r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("search"),query:r.z.string().nullish()}),r.z.object({type:r.z.literal("open_page"),url:r.z.string()}),r.z.object({type:r.z.literal("find"),url:r.z.string(),pattern:r.z.string()})]).nullish()}),Q=r.z.object({type:r.z.literal("file_search_call"),id:r.z.string(),queries:r.z.array(r.z.string()),results:r.z.array(r.z.object({attributes:r.z.record(r.z.string(),r.z.unknown()),file_id:r.z.string(),filename:r.z.string(),score:r.z.number(),text:r.z.string()})).nullish()}),X=r.z.object({type:r.z.literal("code_interpreter_call"),id:r.z.string(),code:r.z.string().nullable(),container_id:r.z.string(),outputs:r.z.array(r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("logs"),logs:r.z.string()}),r.z.object({type:r.z.literal("image"),url:r.z.string()})])).nullable()}),ee=r.z.object({type:r.z.literal("image_generation_call"),id:r.z.string(),result:r.z.string()}),et=r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number(),top_logprobs:r.z.array(r.z.object({token:r.z.string(),logprob:r.z.number()}))})),en=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({maxOutputTokens:e,temperature:t,stopSequences:n,topP:r,topK:s,presencePenalty:a,frequencyPenalty:l,seed:u,prompt:d,providerOptions:p,tools:c,toolChoice:m,responseFormat:g}){var h,y,f,z;let _=[],b=function(e){let t={requiredAutoTruncation:!1,systemMessageMode:"system",supportsFlexProcessing:e.startsWith("o3")||e.startsWith("o4-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-chat"),supportsPriorityProcessing:e.startsWith("gpt-4")||e.startsWith("gpt-5-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-nano")&&!e.startsWith("gpt-5-chat")||e.startsWith("o3")||e.startsWith("o4-mini")};return e.startsWith("gpt-5-chat")?{...t,isReasoningModel:!1}:e.startsWith("o")||e.startsWith("gpt-5")||e.startsWith("codex-")||e.startsWith("computer-use")?e.startsWith("o1-mini")||e.startsWith("o1-preview")?{...t,isReasoningModel:!0,systemMessageMode:"remove"}:{...t,isReasoningModel:!0,systemMessageMode:"developer"}:{...t,isReasoningModel:!1}}(this.modelId);null!=s&&_.push({type:"unsupported-setting",setting:"topK"}),null!=u&&_.push({type:"unsupported-setting",setting:"seed"}),null!=a&&_.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=l&&_.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=n&&_.push({type:"unsupported-setting",setting:"stopSequences"});let v=await (0,o.xI)({provider:"openai",providerOptions:p,schema:ef}),{input:w,warnings:k}=await F({prompt:d,systemMessageMode:b.systemMessageMode,fileIdPrefixes:this.config.fileIdPrefixes,store:null==(h=null==v?void 0:v.store)||h});_.push(...k);let x=null!=(y=null==v?void 0:v.strictJsonSchema)&&y,I=null==v?void 0:v.include;function j(e){I=null!=I?[...I,e]:[e]}let C="number"==typeof(null==v?void 0:v.logprobs)?null==v?void 0:v.logprobs:(null==v?void 0:v.logprobs)===!0?20:void 0;C&&j("message.output_text.logprobs");let T=null==(f=null==c?void 0:c.find(e=>"provider-defined"===e.type&&("openai.web_search"===e.id||"openai.web_search_preview"===e.id)))?void 0:f.name;T&&j("web_search_call.action.sources"),(null==c?void 0:c.find(e=>"provider-defined"===e.type&&"openai.code_interpreter"===e.id))!=null&&j("code_interpreter_call.outputs");let q={model:this.modelId,input:w,temperature:t,top_p:r,max_output_tokens:e,...((null==g?void 0:g.type)==="json"||(null==v?void 0:v.textVerbosity))&&{text:{...(null==g?void 0:g.type)==="json"&&{format:null!=g.schema?{type:"json_schema",strict:x,name:null!=(z=g.name)?z:"response",description:g.description,schema:g.schema}:{type:"json_object"}},...(null==v?void 0:v.textVerbosity)&&{verbosity:v.textVerbosity}}},max_tool_calls:null==v?void 0:v.maxToolCalls,metadata:null==v?void 0:v.metadata,parallel_tool_calls:null==v?void 0:v.parallelToolCalls,previous_response_id:null==v?void 0:v.previousResponseId,store:null==v?void 0:v.store,user:null==v?void 0:v.user,instructions:null==v?void 0:v.instructions,service_tier:null==v?void 0:v.serviceTier,include:I,prompt_cache_key:null==v?void 0:v.promptCacheKey,safety_identifier:null==v?void 0:v.safetyIdentifier,top_logprobs:C,...b.isReasoningModel&&((null==v?void 0:v.reasoningEffort)!=null||(null==v?void 0:v.reasoningSummary)!=null)&&{reasoning:{...(null==v?void 0:v.reasoningEffort)!=null&&{effort:v.reasoningEffort},...(null==v?void 0:v.reasoningSummary)!=null&&{summary:v.reasoningSummary}}},...b.requiredAutoTruncation&&{truncation:"auto"}};b.isReasoningModel?(null!=q.temperature&&(q.temperature=void 0,_.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=q.top_p&&(q.top_p=void 0,_.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))):((null==v?void 0:v.reasoningEffort)!=null&&_.push({type:"unsupported-setting",setting:"reasoningEffort",details:"reasoningEffort is not supported for non-reasoning models"}),(null==v?void 0:v.reasoningSummary)!=null&&_.push({type:"unsupported-setting",setting:"reasoningSummary",details:"reasoningSummary is not supported for non-reasoning models"})),(null==v?void 0:v.serviceTier)!=="flex"||b.supportsFlexProcessing||(_.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),delete q.service_tier),(null==v?void 0:v.serviceTier)!=="priority"||b.supportsPriorityProcessing||(_.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),delete q.service_tier);let{tools:E,toolChoice:S,toolWarnings:M}=function({tools:e,toolChoice:t,strictJsonSchema:n}){e=(null==e?void 0:e.length)?e:void 0;let o=[];if(null==e)return{tools:void 0,toolChoice:void 0,toolWarnings:o};let r=[];for(let t of e)switch(t.type){case"function":r.push({type:"function",name:t.name,description:t.description,parameters:t.inputSchema,strict:n});break;case"provider-defined":switch(t.id){case"openai.file_search":{let e=P.parse(t.args);r.push({type:"file_search",vector_store_ids:e.vectorStoreIds,max_num_results:e.maxNumResults,ranking_options:e.ranking?{ranker:e.ranking.ranker,score_threshold:e.ranking.scoreThreshold}:void 0,filters:e.filters});break}case"openai.web_search_preview":{let e=L.parse(t.args);r.push({type:"web_search_preview",search_context_size:e.searchContextSize,user_location:e.userLocation});break}case"openai.web_search":{let e=H.parse(t.args);r.push({type:"web_search",filters:null!=e.filters?{allowed_domains:e.filters.allowedDomains}:void 0,search_context_size:e.searchContextSize,user_location:e.userLocation});break}case"openai.code_interpreter":{let e=$.parse(t.args);r.push({type:"code_interpreter",container:null==e.container?{type:"auto",file_ids:void 0}:"string"==typeof e.container?e.container:{type:"auto",file_ids:e.container.fileIds}});break}case"openai.image_generation":{let e=O.parse(t.args);r.push({type:"image_generation",background:e.background,input_fidelity:e.inputFidelity,input_image_mask:e.inputImageMask?{file_id:e.inputImageMask.fileId,image_url:e.inputImageMask.imageUrl}:void 0,model:e.model,size:e.size,quality:e.quality,moderation:e.moderation,output_format:e.outputFormat,output_compression:e.outputCompression})}}break;default:o.push({type:"unsupported-tool",tool:t})}if(null==t)return{tools:r,toolChoice:void 0,toolWarnings:o};let s=t.type;switch(s){case"auto":case"none":case"required":return{tools:r,toolChoice:s,toolWarnings:o};case"tool":return{tools:r,toolChoice:"code_interpreter"===t.toolName||"file_search"===t.toolName||"image_generation"===t.toolName||"web_search_preview"===t.toolName||"web_search"===t.toolName?{type:t.toolName}:{type:"function",name:t.toolName},toolWarnings:o};default:throw new i.b8({functionality:`tool choice type: ${s}`})}}({tools:c,toolChoice:m,strictJsonSchema:x});return{webSearchToolName:T,args:{...q,tools:E,tool_choice:S},warnings:[..._,...M]}}async doGenerate(e){var t,n,s,l,u,d,p,c,m,g,h,y,f,z,_,b,v,w,k;let{args:x,warnings:I,webSearchToolName:j}=await this.getArgs(e),C=this.config.url({path:"/responses",modelId:this.modelId}),{responseHeaders:T,value:q,rawValue:E}=await (0,o.GU)({url:C,headers:(0,o.m2)(this.config.headers(),e.headers),body:x,failedResponseHandler:a,successfulResponseHandler:(0,o.cV)(r.z.object({id:r.z.string(),created_at:r.z.number(),error:r.z.object({code:r.z.string(),message:r.z.string()}).nullish(),model:r.z.string(),output:r.z.array(r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("message"),role:r.z.literal("assistant"),id:r.z.string(),content:r.z.array(r.z.object({type:r.z.literal("output_text"),text:r.z.string(),logprobs:et.nullish(),annotations:r.z.array(r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("url_citation"),start_index:r.z.number(),end_index:r.z.number(),url:r.z.string(),title:r.z.string()}),r.z.object({type:r.z.literal("file_citation"),file_id:r.z.string(),filename:r.z.string().nullish(),index:r.z.number().nullish(),start_index:r.z.number().nullish(),end_index:r.z.number().nullish(),quote:r.z.string().nullish()}),r.z.object({type:r.z.literal("container_file_citation")})]))}))}),Z,Q,X,ee,r.z.object({type:r.z.literal("function_call"),call_id:r.z.string(),name:r.z.string(),arguments:r.z.string(),id:r.z.string()}),r.z.object({type:r.z.literal("computer_call"),id:r.z.string(),status:r.z.string().optional()}),r.z.object({type:r.z.literal("reasoning"),id:r.z.string(),encrypted_content:r.z.string().nullish(),summary:r.z.array(r.z.object({type:r.z.literal("summary_text"),text:r.z.string()}))})])),service_tier:r.z.string().nullish(),incomplete_details:r.z.object({reason:r.z.string()}).nullish(),usage:eo})),abortSignal:e.abortSignal,fetch:this.config.fetch});if(q.error)throw new i.hL({message:q.error.message,url:C,requestBodyValues:x,statusCode:400,responseHeaders:T,responseBody:E,isRetryable:!1});let S=[],M=[],$=!1;for(let i of q.output)switch(i.type){case"reasoning":for(let e of(0===i.summary.length&&i.summary.push({type:"summary_text",text:""}),i.summary))S.push({type:"reasoning",text:e.text,providerMetadata:{openai:{itemId:i.id,reasoningEncryptedContent:null!=(t=i.encrypted_content)?t:null}}});break;case"image_generation_call":S.push({type:"tool-call",toolCallId:i.id,toolName:"image_generation",input:"{}",providerExecuted:!0}),S.push({type:"tool-result",toolCallId:i.id,toolName:"image_generation",result:{result:i.result},providerExecuted:!0});break;case"message":for(let t of i.content)for(let r of((null==(s=null==(n=e.providerOptions)?void 0:n.openai)?void 0:s.logprobs)&&t.logprobs&&M.push(t.logprobs),S.push({type:"text",text:t.text,providerMetadata:{openai:{itemId:i.id}}}),t.annotations))"url_citation"===r.type?S.push({type:"source",sourceType:"url",id:null!=(d=null==(u=(l=this.config).generateId)?void 0:u.call(l))?d:(0,o.$C)(),url:r.url,title:r.title}):"file_citation"===r.type&&S.push({type:"source",sourceType:"document",id:null!=(m=null==(c=(p=this.config).generateId)?void 0:c.call(p))?m:(0,o.$C)(),mediaType:"text/plain",title:null!=(h=null!=(g=r.quote)?g:r.filename)?h:"Document",filename:null!=(y=r.filename)?y:r.file_id});break;case"function_call":$=!0,S.push({type:"tool-call",toolCallId:i.call_id,toolName:i.name,input:i.arguments,providerMetadata:{openai:{itemId:i.id}}});break;case"web_search_call":S.push({type:"tool-call",toolCallId:i.id,toolName:null!=j?j:"web_search",input:JSON.stringify({action:i.action}),providerExecuted:!0}),S.push({type:"tool-result",toolCallId:i.id,toolName:null!=j?j:"web_search",result:{status:i.status},providerExecuted:!0});break;case"computer_call":S.push({type:"tool-call",toolCallId:i.id,toolName:"computer_use",input:"",providerExecuted:!0}),S.push({type:"tool-result",toolCallId:i.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:i.status||"completed"},providerExecuted:!0});break;case"file_search_call":S.push({type:"tool-call",toolCallId:i.id,toolName:"file_search",input:"{}",providerExecuted:!0}),S.push({type:"tool-result",toolCallId:i.id,toolName:"file_search",result:{queries:i.queries,results:null!=(z=null==(f=i.results)?void 0:f.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text})))?z:null},providerExecuted:!0});break;case"code_interpreter_call":S.push({type:"tool-call",toolCallId:i.id,toolName:"code_interpreter",input:JSON.stringify({code:i.code,containerId:i.container_id}),providerExecuted:!0}),S.push({type:"tool-result",toolCallId:i.id,toolName:"code_interpreter",result:{outputs:i.outputs},providerExecuted:!0})}let N={openai:{responseId:q.id}};return M.length>0&&(N.openai.logprobs=M),"string"==typeof q.service_tier&&(N.openai.serviceTier=q.service_tier),{content:S,finishReason:Y({finishReason:null==(_=q.incomplete_details)?void 0:_.reason,hasFunctionCall:$}),usage:{inputTokens:q.usage.input_tokens,outputTokens:q.usage.output_tokens,totalTokens:q.usage.input_tokens+q.usage.output_tokens,reasoningTokens:null!=(v=null==(b=q.usage.output_tokens_details)?void 0:b.reasoning_tokens)?v:void 0,cachedInputTokens:null!=(k=null==(w=q.usage.input_tokens_details)?void 0:w.cached_tokens)?k:void 0},request:{body:x},response:{id:q.id,timestamp:new Date(1e3*q.created_at),modelId:q.model,headers:T,body:E},providerMetadata:N,warnings:I}}async doStream(e){let t,{args:n,warnings:i,webSearchToolName:r}=await this.getArgs(e),{responseHeaders:s,value:l}=await (0,o.GU)({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:(0,o.m2)(this.config.headers(),e.headers),body:{...n,stream:!0},failedResponseHandler:a,successfulResponseHandler:(0,o.Ds)(eg),abortSignal:e.abortSignal,fetch:this.config.fetch}),u=this,d="unknown",p={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},c=[],m=null,g={},h=!1,y={};return{stream:l.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:i})},transform(n,i){var s,a,l,f,z,_,b,v,w,k,x,I,j,C,T,q,E,S,M,$,N,R,A,P,U,V;if(e.includeRawChunks&&i.enqueue({type:"raw",rawValue:n.rawValue}),!n.success){d="error",i.enqueue({type:"error",error:n.error});return}let O=n.value;if(ey(O)){"function_call"===O.item.type?(g[O.output_index]={toolName:O.item.name,toolCallId:O.item.call_id},i.enqueue({type:"tool-input-start",id:O.item.call_id,toolName:O.item.name})):"web_search_call"===O.item.type?(g[O.output_index]={toolName:null!=r?r:"web_search",toolCallId:O.item.id},i.enqueue({type:"tool-input-start",id:O.item.id,toolName:null!=r?r:"web_search"})):"computer_call"===O.item.type?(g[O.output_index]={toolName:"computer_use",toolCallId:O.item.id},i.enqueue({type:"tool-input-start",id:O.item.id,toolName:"computer_use"})):"file_search_call"===O.item.type?i.enqueue({type:"tool-call",toolCallId:O.item.id,toolName:"file_search",input:"{}",providerExecuted:!0}):"image_generation_call"===O.item.type?i.enqueue({type:"tool-call",toolCallId:O.item.id,toolName:"image_generation",input:"{}",providerExecuted:!0}):"message"===O.item.type?i.enqueue({type:"text-start",id:O.item.id,providerMetadata:{openai:{itemId:O.item.id}}}):ey(P=O)&&"reasoning"===P.item.type&&(y[O.item.id]={encryptedContent:O.item.encrypted_content,summaryParts:[0]},i.enqueue({type:"reasoning-start",id:`${O.item.id}:0`,providerMetadata:{openai:{itemId:O.item.id,reasoningEncryptedContent:null!=(s=O.item.encrypted_content)?s:null}}}))}else if(eh(O))if("function_call"===O.item.type)g[O.output_index]=void 0,h=!0,i.enqueue({type:"tool-input-end",id:O.item.call_id}),i.enqueue({type:"tool-call",toolCallId:O.item.call_id,toolName:O.item.name,input:O.item.arguments,providerMetadata:{openai:{itemId:O.item.id}}});else if("web_search_call"===O.item.type)g[O.output_index]=void 0,i.enqueue({type:"tool-input-end",id:O.item.id}),i.enqueue({type:"tool-call",toolCallId:O.item.id,toolName:"web_search",input:JSON.stringify({action:O.item.action}),providerExecuted:!0}),i.enqueue({type:"tool-result",toolCallId:O.item.id,toolName:"web_search",result:{status:O.item.status},providerExecuted:!0});else if("computer_call"===O.item.type)g[O.output_index]=void 0,i.enqueue({type:"tool-input-end",id:O.item.id}),i.enqueue({type:"tool-call",toolCallId:O.item.id,toolName:"computer_use",input:"",providerExecuted:!0}),i.enqueue({type:"tool-result",toolCallId:O.item.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:O.item.status||"completed"},providerExecuted:!0});else if("file_search_call"===O.item.type)g[O.output_index]=void 0,i.enqueue({type:"tool-result",toolCallId:O.item.id,toolName:"file_search",result:{queries:O.item.queries,results:null!=(l=null==(a=O.item.results)?void 0:a.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text})))?l:null},providerExecuted:!0});else if("code_interpreter_call"===O.item.type)i.enqueue({type:"tool-call",toolCallId:O.item.id,toolName:"code_interpreter",input:JSON.stringify({code:O.item.code,containerId:O.item.container_id}),providerExecuted:!0}),i.enqueue({type:"tool-result",toolCallId:O.item.id,toolName:"code_interpreter",result:{outputs:O.item.outputs},providerExecuted:!0});else if("image_generation_call"===O.item.type)i.enqueue({type:"tool-result",toolCallId:O.item.id,toolName:"image_generation",result:{result:O.item.result},providerExecuted:!0});else if("message"===O.item.type)i.enqueue({type:"text-end",id:O.item.id});else{if(eh(U=O)&&"reasoning"===U.item.type){for(let e of y[O.item.id].summaryParts)i.enqueue({type:"reasoning-end",id:`${O.item.id}:${e}`,providerMetadata:{openai:{itemId:O.item.id,reasoningEncryptedContent:null!=(f=O.item.encrypted_content)?f:null}}});delete y[O.item.id]}}else if("response.function_call_arguments.delta"===O.type){let e=g[O.output_index];null!=e&&i.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:O.delta})}else{"response.created"===O.type?(m=O.response.id,i.enqueue({type:"response-metadata",id:O.response.id,timestamp:new Date(1e3*O.response.created_at),modelId:O.response.model})):"response.output_text.delta"===O.type?(i.enqueue({type:"text-delta",id:O.item_id,delta:O.delta}),(null==(_=null==(z=e.providerOptions)?void 0:z.openai)?void 0:_.logprobs)&&O.logprobs&&c.push(O.logprobs)):"response.reasoning_summary_part.added"===O.type?O.summary_index>0&&(null==(b=y[O.item_id])||b.summaryParts.push(O.summary_index),i.enqueue({type:"reasoning-start",id:`${O.item_id}:${O.summary_index}`,providerMetadata:{openai:{itemId:O.item_id,reasoningEncryptedContent:null!=(w=null==(v=y[O.item_id])?void 0:v.encryptedContent)?w:null}}})):"response.reasoning_summary_text.delta"===O.type?i.enqueue({type:"reasoning-delta",id:`${O.item_id}:${O.summary_index}`,delta:O.delta,providerMetadata:{openai:{itemId:O.item_id}}}):"response.completed"===(V=O).type||"response.incomplete"===V.type?(d=Y({finishReason:null==(k=O.response.incomplete_details)?void 0:k.reason,hasFunctionCall:h}),p.inputTokens=O.response.usage.input_tokens,p.outputTokens=O.response.usage.output_tokens,p.totalTokens=O.response.usage.input_tokens+O.response.usage.output_tokens,p.reasoningTokens=null!=(I=null==(x=O.response.usage.output_tokens_details)?void 0:x.reasoning_tokens)?I:void 0,p.cachedInputTokens=null!=(C=null==(j=O.response.usage.input_tokens_details)?void 0:j.cached_tokens)?C:void 0,"string"==typeof O.response.service_tier&&(t=O.response.service_tier)):"response.output_text.annotation.added"===O.type?"url_citation"===O.annotation.type?i.enqueue({type:"source",sourceType:"url",id:null!=(E=null==(q=(T=u.config).generateId)?void 0:q.call(T))?E:(0,o.$C)(),url:O.annotation.url,title:O.annotation.title}):"file_citation"===O.annotation.type&&i.enqueue({type:"source",sourceType:"document",id:null!=($=null==(M=(S=u.config).generateId)?void 0:M.call(S))?$:(0,o.$C)(),mediaType:"text/plain",title:null!=(R=null!=(N=O.annotation.quote)?N:O.annotation.filename)?R:"Document",filename:null!=(A=O.annotation.filename)?A:O.annotation.file_id}):"error"===O.type&&i.enqueue({type:"error",error:O})}},flush(e){let n={openai:{responseId:m}};c.length>0&&(n.openai.logprobs=c),void 0!==t&&(n.openai.serviceTier=t),e.enqueue({type:"finish",finishReason:d,usage:p,providerMetadata:n})}})),request:{body:n},response:{headers:s}}}},eo=r.z.object({input_tokens:r.z.number(),input_tokens_details:r.z.object({cached_tokens:r.z.number().nullish()}).nullish(),output_tokens:r.z.number(),output_tokens_details:r.z.object({reasoning_tokens:r.z.number().nullish()}).nullish()}),ei=r.z.object({type:r.z.literal("response.output_text.delta"),item_id:r.z.string(),delta:r.z.string(),logprobs:et.nullish()}),er=r.z.object({type:r.z.literal("error"),code:r.z.string(),message:r.z.string(),param:r.z.string().nullish(),sequence_number:r.z.number()}),es=r.z.object({type:r.z.enum(["response.completed","response.incomplete"]),response:r.z.object({incomplete_details:r.z.object({reason:r.z.string()}).nullish(),usage:eo,service_tier:r.z.string().nullish()})}),ea=r.z.object({type:r.z.literal("response.created"),response:r.z.object({id:r.z.string(),created_at:r.z.number(),model:r.z.string(),service_tier:r.z.string().nullish()})}),el=r.z.object({type:r.z.literal("response.output_item.added"),output_index:r.z.number(),item:r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("message"),id:r.z.string()}),r.z.object({type:r.z.literal("reasoning"),id:r.z.string(),encrypted_content:r.z.string().nullish()}),r.z.object({type:r.z.literal("function_call"),id:r.z.string(),call_id:r.z.string(),name:r.z.string(),arguments:r.z.string()}),r.z.object({type:r.z.literal("web_search_call"),id:r.z.string(),status:r.z.string(),action:r.z.object({type:r.z.literal("search"),query:r.z.string().optional()}).nullish()}),r.z.object({type:r.z.literal("computer_call"),id:r.z.string(),status:r.z.string()}),r.z.object({type:r.z.literal("file_search_call"),id:r.z.string()}),r.z.object({type:r.z.literal("image_generation_call"),id:r.z.string()})])}),eu=r.z.object({type:r.z.literal("response.output_item.done"),output_index:r.z.number(),item:r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("message"),id:r.z.string()}),r.z.object({type:r.z.literal("reasoning"),id:r.z.string(),encrypted_content:r.z.string().nullish()}),r.z.object({type:r.z.literal("function_call"),id:r.z.string(),call_id:r.z.string(),name:r.z.string(),arguments:r.z.string(),status:r.z.literal("completed")}),X,ee,Z,Q,r.z.object({type:r.z.literal("computer_call"),id:r.z.string(),status:r.z.literal("completed")})])}),ed=r.z.object({type:r.z.literal("response.function_call_arguments.delta"),item_id:r.z.string(),output_index:r.z.number(),delta:r.z.string()}),ep=r.z.object({type:r.z.literal("response.output_text.annotation.added"),annotation:r.z.discriminatedUnion("type",[r.z.object({type:r.z.literal("url_citation"),url:r.z.string(),title:r.z.string()}),r.z.object({type:r.z.literal("file_citation"),file_id:r.z.string(),filename:r.z.string().nullish(),index:r.z.number().nullish(),start_index:r.z.number().nullish(),end_index:r.z.number().nullish(),quote:r.z.string().nullish()})])}),ec=r.z.object({type:r.z.literal("response.reasoning_summary_part.added"),item_id:r.z.string(),summary_index:r.z.number()}),em=r.z.object({type:r.z.literal("response.reasoning_summary_text.delta"),item_id:r.z.string(),summary_index:r.z.number(),delta:r.z.string()}),eg=r.z.union([ei,es,ea,el,eu,ed,ep,ec,em,er,r.z.object({type:r.z.string()}).loose()]);function eh(e){return"response.output_item.done"===e.type}function ey(e){return"response.output_item.added"===e.type}var ef=r.z.object({include:r.z.array(r.z.enum(["reasoning.encrypted_content","file_search_call.results","message.output_text.logprobs"])).nullish(),instructions:r.z.string().nullish(),logprobs:r.z.union([r.z.boolean(),r.z.number().min(1).max(20)]).optional(),maxToolCalls:r.z.number().nullish(),metadata:r.z.any().nullish(),parallelToolCalls:r.z.boolean().nullish(),previousResponseId:r.z.string().nullish(),promptCacheKey:r.z.string().nullish(),reasoningEffort:r.z.string().nullish(),reasoningSummary:r.z.string().nullish(),safetyIdentifier:r.z.string().nullish(),serviceTier:r.z.enum(["auto","flex","priority"]).nullish(),store:r.z.boolean().nullish(),strictJsonSchema:r.z.boolean().nullish(),textVerbosity:r.z.enum(["low","medium","high"]).nullish(),user:r.z.string().nullish()}),ez=r.z.object({instructions:r.z.string().nullish(),speed:r.z.number().min(.25).max(4).default(1).nullish()}),e_=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({text:e,voice:t="alloy",outputFormat:n="mp3",speed:i,instructions:r,language:s,providerOptions:a}){let l=[],u=await (0,o.xI)({provider:"openai",providerOptions:a,schema:ez}),d={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:i,instructions:r};if(n&&(["mp3","opus","aac","flac","wav","pcm"].includes(n)?d.response_format=n:l.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${n}. Using mp3 instead.`})),u){let e={};for(let t in e){let n=e[t];void 0!==n&&(d[t]=n)}}return s&&l.push({type:"unsupported-setting",setting:"language",details:`OpenAI speech models do not support language selection. Language parameter "${s}" was ignored.`}),{requestBody:d,warnings:l}}async doGenerate(e){var t,n,i;let r=null!=(i=null==(n=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:n.call(t))?i:new Date,{requestBody:s,warnings:l}=await this.getArgs(e),{value:u,responseHeaders:d,rawValue:p}=await (0,o.GU)({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:(0,o.m2)(this.config.headers(),e.headers),body:s,failedResponseHandler:a,successfulResponseHandler:(0,o.HD)(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:u,warnings:l,request:{body:JSON.stringify(s)},response:{timestamp:r,modelId:this.modelId,headers:d,body:p}}}},eb=r.z.object({include:r.z.array(r.z.string()).optional(),language:r.z.string().optional(),prompt:r.z.string().optional(),temperature:r.z.number().min(0).max(1).default(0).optional(),timestampGranularities:r.z.array(r.z.enum(["word","segment"])).default(["segment"]).optional()}),ev={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},ew=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({audio:e,mediaType:t,providerOptions:n}){let i=await (0,o.xI)({provider:"openai",providerOptions:n,schema:eb}),r=new FormData,s=e instanceof Uint8Array?new Blob([e]):new Blob([(0,o.Z9)(e)]);r.append("model",this.modelId);let a=(0,o.HQ)(t);if(r.append("file",new File([s],"audio",{type:t}),`audio.${a}`),i){for(let[e,t]of Object.entries({include:i.include,language:i.language,prompt:i.prompt,response_format:["gpt-4o-transcribe","gpt-4o-mini-transcribe"].includes(this.modelId)?"json":"verbose_json",temperature:i.temperature,timestamp_granularities:i.timestampGranularities}))if(null!=t)if(Array.isArray(t))for(let n of t)r.append(`${e}[]`,String(n));else r.append(e,String(t))}return{formData:r,warnings:[]}}async doGenerate(e){var t,n,i,r,s,l,u,d;let p=null!=(i=null==(n=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:n.call(t))?i:new Date,{formData:c,warnings:m}=await this.getArgs(e),{value:g,responseHeaders:h,rawValue:y}=await (0,o.S)({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:(0,o.m2)(this.config.headers(),e.headers),formData:c,failedResponseHandler:a,successfulResponseHandler:(0,o.cV)(ek),abortSignal:e.abortSignal,fetch:this.config.fetch}),f=null!=g.language&&g.language in ev?ev[g.language]:void 0;return{text:g.text,segments:null!=(u=null!=(l=null==(r=g.segments)?void 0:r.map(e=>({text:e.text,startSecond:e.start,endSecond:e.end})))?l:null==(s=g.words)?void 0:s.map(e=>({text:e.word,startSecond:e.start,endSecond:e.end})))?u:[],language:f,durationInSeconds:null!=(d=g.duration)?d:void 0,warnings:m,response:{timestamp:p,modelId:this.modelId,headers:h,body:y}}}},ek=r.z.object({text:r.z.string(),language:r.z.string().nullish(),duration:r.z.number().nullish(),words:r.z.array(r.z.object({word:r.z.string(),start:r.z.number(),end:r.z.number()})).nullish(),segments:r.z.array(r.z.object({id:r.z.number(),seek:r.z.number(),start:r.z.number(),end:r.z.number(),text:r.z.string(),tokens:r.z.array(r.z.number()),temperature:r.z.number(),avg_logprob:r.z.number(),compression_ratio:r.z.number(),no_speech_prob:r.z.number()})).nullish()}),ex=function(e={}){var t,n;let i=null!=(t=(0,o.ae)(e.baseURL))?t:"https://api.openai.com/v1",r=null!=(n=e.name)?n:"openai",s=()=>(0,o.WZ)({Authorization:`Bearer ${(0,o.WL)({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers},"ai-sdk/openai/2.0.36"),a=t=>new I(t,{provider:`${r}.embedding`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch}),l=t=>new q(t,{provider:`${r}.image`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch}),u=t=>new ew(t,{provider:`${r}.transcription`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch}),d=t=>new e_(t,{provider:`${r}.speech`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch}),c=e=>{if(new.target)throw Error("The OpenAI model function cannot be called with the new keyword.");return m(e)},m=t=>new en(t,{provider:`${r}.responses`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch,fileIdPrefixes:["file-"]}),g=function(e){return c(e)};return g.languageModel=c,g.chat=t=>new p(t,{provider:`${r}.chat`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch}),g.completion=t=>new b(t,{provider:`${r}.completion`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch}),g.responses=m,g.embedding=a,g.textEmbedding=a,g.textEmbeddingModel=a,g.image=l,g.imageModel=l,g.transcription=u,g.transcriptionModel=u,g.speech=d,g.speechModel=d,g.tools=J,g}()},92395:(e,t,n)=>{n.d(t,{JS:()=>el,jN:()=>j,vj:()=>A});var o,i,r,s,a,l,u,d,p,c,m,g,h,y,f=n(64876),z=n(70284),_=n(72253),b=n(81029).hp,v=n(95704),w=Symbol.for("vercel.ai.gateway.error"),k=class e extends(i=Error,o=w,i){constructor({message:e,statusCode:t=500,cause:n}){super(e),this[o]=!0,this.statusCode=t,this.cause=n}static isInstance(t){return e.hasMarker(t)}static hasMarker(e){return"object"==typeof e&&null!==e&&w in e&&!0===e[w]}},x="GatewayAuthenticationError",I=Symbol.for(`vercel.ai.gateway.error.${x}`),j=class e extends(s=k,r=I,s){constructor({message:e="Authentication failed",statusCode:t=401,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[r]=!0,this.name=x,this.type="authentication_error"}static isInstance(e){return k.hasMarker(e)&&I in e}static createContextualError({apiKeyProvided:t,oidcTokenProvided:n,message:o="Authentication failed",statusCode:i=401,cause:r}){return new e({message:t?`AI Gateway authentication failed: Invalid API key provided.

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:n?`AI Gateway authentication failed: Invalid OIDC token provided.

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed

Alternative: Provide an API key via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:`AI Gateway authentication failed: No authentication provided.

Provide either an API key or OIDC token.

API key instructions:

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

OIDC token instructions:

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed`,statusCode:i,cause:r})}},C="GatewayInvalidRequestError",T=Symbol.for(`vercel.ai.gateway.error.${C}`),q=class extends(l=k,a=T,l){constructor({message:e="Invalid request",statusCode:t=400,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[a]=!0,this.name=C,this.type="invalid_request_error"}static isInstance(e){return k.hasMarker(e)&&T in e}},E="GatewayRateLimitError",S=Symbol.for(`vercel.ai.gateway.error.${E}`),M=class extends(d=k,u=S,d){constructor({message:e="Rate limit exceeded",statusCode:t=429,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[u]=!0,this.name=E,this.type="rate_limit_exceeded"}static isInstance(e){return k.hasMarker(e)&&S in e}},$="GatewayModelNotFoundError",N=Symbol.for(`vercel.ai.gateway.error.${$}`),R=_.z.object({modelId:_.z.string()}),A=class extends(c=k,p=N,c){constructor({message:e="Model not found",statusCode:t=404,modelId:n,cause:o}={}){super({message:e,statusCode:t,cause:o}),this[p]=!0,this.name=$,this.type="model_not_found",this.modelId=n}static isInstance(e){return k.hasMarker(e)&&N in e}},P="GatewayInternalServerError",U=Symbol.for(`vercel.ai.gateway.error.${P}`),V=class extends(g=k,m=U,g){constructor({message:e="Internal server error",statusCode:t=500,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[m]=!0,this.name=P,this.type="internal_server_error"}static isInstance(e){return k.hasMarker(e)&&U in e}},O="GatewayResponseError",W=Symbol.for(`vercel.ai.gateway.error.${O}`),G=class extends(y=k,h=W,y){constructor({message:e="Invalid response from Gateway",statusCode:t=502,response:n,validationError:o,cause:i}={}){super({message:e,statusCode:t,cause:i}),this[h]=!0,this.name=O,this.type="response_error",this.response=n,this.validationError=o}static isInstance(e){return k.hasMarker(e)&&W in e}};function H({response:e,statusCode:t,defaultMessage:n="Gateway request failed",cause:o,authMethod:i}){let r=D.safeParse(e);if(!r.success)return new G({message:`Invalid error response format: ${n}`,statusCode:t,response:e,validationError:r.error,cause:o});let s=r.data,a=s.error.type,l=s.error.message;switch(a){case"authentication_error":return j.createContextualError({apiKeyProvided:"api-key"===i,oidcTokenProvided:"oidc"===i,statusCode:t,cause:o});case"invalid_request_error":return new q({message:l,statusCode:t,cause:o});case"rate_limit_exceeded":return new M({message:l,statusCode:t,cause:o});case"model_not_found":{let e=R.safeParse(s.error.param);return new A({message:l,statusCode:t,modelId:e.success?e.data.modelId:void 0,cause:o})}default:return new V({message:l,statusCode:t,cause:o})}}var D=_.z.object({error:_.z.object({message:_.z.string(),type:_.z.string().nullish(),param:_.z.unknown().nullish(),code:_.z.union([_.z.string(),_.z.number()]).nullish()})});function L(e,t){var n;return k.isInstance(e)?e:f.hL.isInstance(e)?H({response:function(e){if(void 0!==e.data)return e.data;if(null!=e.responseBody)try{return JSON.parse(e.responseBody)}catch(t){return e.responseBody}return{}}(e),statusCode:null!=(n=e.statusCode)?n:500,defaultMessage:"Gateway request failed",cause:e,authMethod:t}):H({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:"Unknown Gateway error",cause:e,authMethod:t})}var J="ai-gateway-auth-method";function K(e){let t=F.safeParse(e[J]);return t.success?t.data:void 0}var F=_.z.union([_.z.literal("api-key"),_.z.literal("oidc")]),B=class{constructor(e){this.config=e}async getAvailableModels(){try{let{value:e}=await (0,z.$b)({url:`${this.config.baseURL}/config`,headers:await (0,z.hd)(this.config.headers()),successfulResponseHandler:(0,z.cV)(X),failedResponseHandler:(0,z.sl)({errorSchema:_.z.any(),errorToMessage:e=>e}),fetch:this.config.fetch});return e}catch(e){throw L(e)}}async getCredits(){try{let e=new URL(this.config.baseURL),{value:t}=await (0,z.$b)({url:`${e.origin}/v1/credits`,headers:await (0,z.hd)(this.config.headers()),successfulResponseHandler:(0,z.cV)(ee),failedResponseHandler:(0,z.sl)({errorSchema:_.z.any(),errorToMessage:e=>e}),fetch:this.config.fetch});return t}catch(e){throw L(e)}}},Y=_.z.object({specificationVersion:_.z.literal("v2"),provider:_.z.string(),modelId:_.z.string()}),Z=_.z.object({input:_.z.string(),output:_.z.string(),input_cache_read:_.z.string().nullish(),input_cache_write:_.z.string().nullish()}).transform(({input:e,output:t,input_cache_read:n,input_cache_write:o})=>({input:e,output:t,...n?{cachedInputTokens:n}:{},...o?{cacheCreationInputTokens:o}:{}})),Q=_.z.object({id:_.z.string(),name:_.z.string(),description:_.z.string().nullish(),pricing:Z.nullish(),specification:Y,modelType:_.z.enum(["language","embedding","image"]).nullish()}),X=_.z.object({models:_.z.array(Q)}),ee=_.z.object({balance:_.z.string(),total_used:_.z.string()}).transform(({balance:e,total_used:t})=>({balance:e,totalUsed:t})),et=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){let{abortSignal:t,...n}=e;return{args:this.maybeEncodeFileParts(n),warnings:[]}}async doGenerate(e){let{args:t,warnings:n}=await this.getArgs(e),{abortSignal:o}=e,i=await (0,z.hd)(this.config.headers());try{let{responseHeaders:r,value:s,rawValue:a}=await (0,z.GU)({url:this.getUrl(),headers:(0,z.m2)(i,e.headers,this.getModelConfigHeaders(this.modelId,!1),await (0,z.hd)(this.config.o11yHeaders)),body:t,successfulResponseHandler:(0,z.cV)(_.z.any()),failedResponseHandler:(0,z.sl)({errorSchema:_.z.any(),errorToMessage:e=>e}),...o&&{abortSignal:o},fetch:this.config.fetch});return{...s,request:{body:t},response:{headers:r,body:a},warnings:n}}catch(e){throw L(e,K(i))}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),{abortSignal:o}=e,i=await (0,z.hd)(this.config.headers());try{let{value:r,responseHeaders:s}=await (0,z.GU)({url:this.getUrl(),headers:(0,z.m2)(i,e.headers,this.getModelConfigHeaders(this.modelId,!0),await (0,z.hd)(this.config.o11yHeaders)),body:t,successfulResponseHandler:(0,z.Ds)(_.z.any()),failedResponseHandler:(0,z.sl)({errorSchema:_.z.any(),errorToMessage:e=>e}),...o&&{abortSignal:o},fetch:this.config.fetch});return{stream:r.pipeThrough(new TransformStream({start(e){n.length>0&&e.enqueue({type:"stream-start",warnings:n})},transform(t,n){if(t.success){let o=t.value;("raw"!==o.type||e.includeRawChunks)&&("response-metadata"===o.type&&o.timestamp&&"string"==typeof o.timestamp&&(o.timestamp=new Date(o.timestamp)),n.enqueue(o))}else n.error(t.error)}})),request:{body:t},response:{headers:s}}}catch(e){throw L(e,K(i))}}isFilePart(e){return e&&"object"==typeof e&&"type"in e&&"file"===e.type}maybeEncodeFileParts(e){for(let t of e.prompt)for(let e of t.content)if(this.isFilePart(e)&&e.data instanceof Uint8Array){let t=Uint8Array.from(e.data),n=b.from(t).toString("base64");e.data=new URL(`data:${e.mediaType||"application/octet-stream"};base64,${n}`)}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":"2","ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},en=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:o}){var i;let r=await (0,z.hd)(this.config.headers());try{let{responseHeaders:s,value:a,rawValue:l}=await (0,z.GU)({url:this.getUrl(),headers:(0,z.m2)(r,null!=t?t:{},this.getModelConfigHeaders(),await (0,z.hd)(this.config.o11yHeaders)),body:{input:1===e.length?e[0]:e,...o?{providerOptions:o}:{}},successfulResponseHandler:(0,z.cV)(eo),failedResponseHandler:(0,z.sl)({errorSchema:_.z.any(),errorToMessage:e=>e}),...n&&{abortSignal:n},fetch:this.config.fetch});return{embeddings:a.embeddings,usage:null!=(i=a.usage)?i:void 0,providerMetadata:a.providerMetadata,response:{headers:s,body:l}}}catch(e){throw L(e,K(r))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"2","ai-model-id":this.modelId}}},eo=_.z.object({embeddings:_.z.array(_.z.array(_.z.number())),usage:_.z.object({tokens:_.z.number()}).nullish(),providerMetadata:_.z.record(_.z.string(),_.z.record(_.z.string(),_.z.unknown())).optional()});async function ei(){var e,t;let n=null!=(t=null==(e=ea().headers)?void 0:e["x-vercel-oidc-token"])?t:v.env.VERCEL_OIDC_TOKEN;if(!n)throw new j({message:"OIDC token not available",statusCode:401});return n}async function er(){var e;return null==(e=ea().headers)?void 0:e["x-vercel-id"]}var es=Symbol.for("@vercel/request-context");function ea(){var e,t,n;return null!=(n=null==(t=null==(e=globalThis[es])?void 0:e.get)?void 0:t.call(e))?n:{}}var el=function(e={}){var t,n;let o=null,i=null,r=null!=(t=e.metadataCacheRefreshMillis)?t:3e5,s=0,a=null!=(n=(0,z.ae)(e.baseURL))?n:"https://ai-gateway.vercel.sh/v1/ai",l=async()=>{let t=await eu(e);if(t)return(0,z.WZ)({Authorization:`Bearer ${t.token}`,"ai-gateway-protocol-version":"0.0.1",[J]:t.authMethod,...e.headers},"ai-sdk/gateway/1.0.30");throw j.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},u=()=>{let e=(0,z.x3)({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),t=(0,z.x3)({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),n=(0,z.x3)({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{let o=await er();return{...e&&{"ai-o11y-deployment-id":e},...t&&{"ai-o11y-environment":t},...n&&{"ai-o11y-region":n},...o&&{"ai-o11y-request-id":o}}}},d=t=>new et(t,{provider:"gateway",baseURL:a,headers:l,fetch:e.fetch,o11yHeaders:u()}),p=async()=>new B({baseURL:a,headers:l,fetch:e.fetch}).getCredits().catch(async e=>{throw L(e,K(await l()))}),c=function(e){if(new.target)throw Error("The Gateway Provider model function cannot be called with the new keyword.");return d(e)};return c.getAvailableModels=async()=>{var t,n,u;let d=null!=(u=null==(n=null==(t=e._internal)?void 0:t.currentDate)?void 0:n.call(t).getTime())?u:Date.now();return(!o||d-s>r)&&(s=d,o=new B({baseURL:a,headers:l,fetch:e.fetch}).getAvailableModels().then(e=>(i=e,e)).catch(async e=>{throw L(e,K(await l()))})),i?Promise.resolve(i):o},c.getCredits=p,c.imageModel=e=>{throw new f.eM({modelId:e,modelType:"imageModel"})},c.languageModel=d,c.textEmbeddingModel=t=>new en(t,{provider:"gateway",baseURL:a,headers:l,fetch:e.fetch,o11yHeaders:u()}),c}();async function eu(e){let t=(0,z.x3)({settingValue:e.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(t)return{token:t,authMethod:"api-key"};try{return{token:await ei(),authMethod:"oidc"}}catch(e){return null}}}}]);