(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3698],{25782:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>l});var a=t(95155),i=t(12115),n=t(4192),r=t(31322);function l(){let e,{user:s,loading:t}=(0,n.A)(),[l,o]=(0,i.useState)(null),[m,x]=(0,i.useState)(null),[p,h]=(0,i.useState)(!0),[g,u]=(0,i.useState)(null);if((0,i.useEffect)(()=>{if(t)return;if(!s){u("Unauthorized"),h(!1);return}let e=async()=>{try{let e=await fetch("/api/admin/status",{cache:"no-store"});if(!e.ok)throw Error("Failed to fetch admin status");let s=await e.json();o(s);let t=await fetch("/api/admin/flags",{cache:"no-store"});t.ok&&x(await t.json())}catch(e){u(e instanceof Error?e.message:"An error occurred")}finally{h(!1)}};e();let a=setInterval(e,15e3);return()=>clearInterval(a)},[t,s]),t||p)return(0,a.jsx)("div",{className:"min-h-[60vh] flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-purple-500"})});if(!s)return window.location.href="/signin",null;if(g||!l)return(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"p-4 rounded-xl bg-red-50 border border-red-200 text-red-800",children:g||"Failed to load admin data"})});let f=e=>new Intl.NumberFormat().format(e);return(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)(r.PY1.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"rounded-2xl p-6 border glass",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Feature Flags & Budget"})}),m&&(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"rounded-lg p-4 bg-white/60 border space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:m.enableNotifications,onChange:async e=>{x({...m,enableNotifications:e.target.checked}),await fetch("/api/admin/flags",{method:"POST",body:JSON.stringify({enableNotifications:e.target.checked})})}}),"Enable Notifications"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:m.enableScraping,onChange:async e=>{x({...m,enableScraping:e.target.checked}),await fetch("/api/admin/flags",{method:"POST",body:JSON.stringify({enableScraping:e.target.checked})})}}),"Enable Scraping"]})]}),(0,a.jsxs)("div",{className:"rounded-lg p-4 bg-white/60 border space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:["Daily Notif Cap",(0,a.jsx)("input",{type:"number",className:"border rounded px-2 py-1 w-24",value:m.notifDailyCap,onChange:async e=>{let s=parseInt(e.target.value||"0",10);x({...m,notifDailyCap:s}),await fetch("/api/admin/flags",{method:"POST",body:JSON.stringify({notifDailyCap:s})})}})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:["Scrape/User Hourly Cap",(0,a.jsx)("input",{type:"number",className:"border rounded px-2 py-1 w-24",value:m.scrapingUserHourlyCap,onChange:async e=>{let s=parseInt(e.target.value||"0",10);x({...m,scrapingUserHourlyCap:s}),await fetch("/api/admin/flags",{method:"POST",body:JSON.stringify({scrapingUserHourlyCap:s})})}})]})]})]})]}),(0,a.jsx)(r.PY1.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"relative overflow-hidden rounded-2xl p-6 gradient-empowerment holo-overlay text-white",children:(0,a.jsxs)("div",{className:"relative z-10",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),(0,a.jsx)("p",{className:"opacity-90",children:"Health, queues, and controls"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)(r.PY1.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"rounded-xl p-4 glass border",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Uptime"}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[f(l.uptimeSeconds),"s"]})]}),(0,a.jsxs)(r.PY1.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"rounded-xl p-4 glass border",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Server Time"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:new Date(l.serverTime).toLocaleString()})]}),(0,a.jsxs)(r.PY1.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"rounded-xl p-4 glass border",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Admin"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:"You"})]})]}),(0,a.jsxs)(r.PY1.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"rounded-2xl p-6 border glass-shine",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Notifications"}),(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold ".concat(l.notifications.status.running?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:l.notifications.status.running?"Running":"Stopped"})]}),(0,a.jsx)("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-6 gap-3",children:["pending","processing","completed","failed","cancelled","total"].map(e=>(0,a.jsxs)("div",{className:"rounded-lg p-3 bg-white/60 border",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e}),(0,a.jsx)("div",{className:"text-xl font-semibold",children:f(l.notifications.stats[e])})]},e))}),(0,a.jsxs)("div",{className:"mt-3 text-sm text-gray-600",children:["Last processed: ",l.notifications.status.lastProcessedAt?new Date(l.notifications.status.lastProcessedAt).toLocaleString():"—"]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(c,{})}),(0,a.jsxs)("div",{className:"mt-4 flex gap-3",children:[(0,a.jsx)("button",{onClick:async()=>{confirm("Are you sure you want to START the notification processor?")&&await fetch("/api/notifications/processor",{method:"POST",body:JSON.stringify({action:"start"})})},className:"bold-btn",children:"Start"}),(0,a.jsx)("button",{onClick:async()=>{confirm("Are you sure you want to STOP the notification processor?")&&await fetch("/api/notifications/processor",{method:"POST",body:JSON.stringify({action:"stop"})})},className:"bold-btn",children:"Stop"}),(0,a.jsx)("button",{onClick:async()=>{confirm("Cleanup old jobs (>30 days)?")&&await fetch("/api/notifications/jobs/cleanup",{method:"POST",body:JSON.stringify({days:30})})},className:"bold-btn",children:"Cleanup"})]})]}),(0,a.jsxs)(r.PY1.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"rounded-2xl p-6 border glass-shine",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Scraping"}),(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold ".concat(l.scraping.running?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:l.scraping.running?"Running":"Stopped"})]}),(0,a.jsx)("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-6 gap-3",children:[["Pending",l.scraping.metrics.pendingJobs],["Running",l.scraping.metrics.runningJobs],["Completed",l.scraping.metrics.completedJobs],["Failed",l.scraping.metrics.failedJobs],["Success",(e=l.scraping.metrics.successRate,"".concat(Math.round(100*e),"%"))],["Avg ms",f(l.scraping.metrics.averageExecutionTime)]].map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"rounded-lg p-3 bg-white/60 border",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:s}),(0,a.jsx)("div",{className:"text-xl font-semibold",children:t})]},s)})}),(0,a.jsxs)("div",{className:"mt-3 text-sm text-gray-600",children:["Last loop: ",l.scraping.lastLoopAt?new Date(l.scraping.lastLoopAt).toLocaleString():"—"]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(d,{})}),(0,a.jsxs)("div",{className:"mt-4 flex gap-3",children:[(0,a.jsx)("button",{onClick:async()=>{confirm("Start scraping scheduler?")&&await fetch("/api/scraping/metrics",{method:"POST",body:JSON.stringify({action:"start"})})},className:"bold-btn",children:"Start"}),(0,a.jsx)("button",{onClick:async()=>{confirm("Stop scraping scheduler?")&&await fetch("/api/scraping/metrics",{method:"POST",body:JSON.stringify({action:"stop"})})},className:"bold-btn",children:"Stop"})]})]})]})}function c(){let[e,s]=(0,i.useState)([]);return((0,i.useEffect)(()=>{(async()=>{let e=await fetch("/api/notifications/jobs?status=failed&limit=10&offset=0",{cache:"no-store"});e.ok&&s((await e.json()).jobs||[])})()},[]),e.length)?(0,a.jsx)("div",{className:"overflow-x-auto rounded-lg border bg-white/60",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50",children:[(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Job"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Error"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Processed"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"px-3 py-2",children:e.id}),(0,a.jsx)("td",{className:"px-3 py-2 text-red-700",children:e.error||"—"}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.processedAt?new Date(e.processedAt).toLocaleString():"—"})]},e.id))})]})}):(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"No recent failures"})}function d(){let[e,s]=(0,i.useState)([]);return((0,i.useEffect)(()=>{(async()=>{let e=await fetch("/api/scraping/failures?limit=10",{cache:"no-store"});e.ok&&s((await e.json()).items||[])})()},[]),e.length)?(0,a.jsx)("div",{className:"overflow-x-auto rounded-lg border bg-white/60",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-50",children:[(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Job"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Error"}),(0,a.jsx)("th",{className:"px-3 py-2 text-left",children:"Completed"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{className:"px-3 py-2",children:e.jobId}),(0,a.jsx)("td",{className:"px-3 py-2 text-red-700",children:e.error||"—"}),(0,a.jsx)("td",{className:"px-3 py-2",children:e.completedAt?new Date(e.completedAt).toLocaleString():"—"})]},e.jobId))})]})}):(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"No recent failures"})}},74292:(e,s,t)=>{Promise.resolve().then(t.bind(t,25782))}},e=>{e.O(0,[2136,7908,8030,2583,9168,4774,27,6308,563,4696,9173,9219,4409,3376,9765,7650,8920,871,6680,6975,4228,3848,9809,8061,2807,1198,1159,5159,23,6529,5593,4180,3976,186,8790,7358],()=>e(e.s=74292)),_N_E=e.O()}]);