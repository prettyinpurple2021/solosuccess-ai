(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4631],{9208:(e,t,i)=>{Promise.resolve().then(i.bind(i,99430))},99430:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Z});var a=i(95155),s=i(12115),r=i(4192),n=i(29081),o=i(97003),l=i(83209),c=i(33789),d=i(90235),u=i(20120),h=i(28171),m=i(52056),p=i(68854),f=i(83457),x=i(99708),g=i(84926),v=i(23664),j=i(46046),y=i(95740),N=i(71360),b=i(20508),w=i(31322),k=i(66893),S=i(2479),A=i(7235),E=i(67812),T=i(87060),C=i(83550),P=i(32559),D=i(85998),F=i(94266),q=i(26983),R=i(23327),O=i(15870),J=i(17910),U=i(30814),_=i(56154);class I{static getInstance(){return I.instance||(I.instance=new I),I.instance}isSupported(){return"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window}async getPermissionState(){if(!this.isSupported())return{supported:!1,permission:"denied",subscription:null};let e=await this.getServiceWorkerRegistration(),t=e?await e.pushManager.getSubscription():null;return{supported:!0,permission:Notification.permission,subscription:t}}async requestPermission(){if(!this.isSupported())throw Error("Web Push notifications are not supported");let e=await Notification.requestPermission();try{(await fetch("/api/preferences",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"notificationPermission",value:e})})).ok||(0,S.JE)("Failed to save notification permission to database")}catch(e){(0,S.JE)("Failed to save notification permission:",e)}return e}async subscribe(){if("granted"!==await this.requestPermission())throw Error("Notification permission not granted");let e=await this.getServiceWorkerRegistration();if(!e)throw Error("Service worker not registered");let t=await e.pushManager.getSubscription();return t||(t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlB64ToUint8Array(this.VAPID_PUBLIC_KEY)})),await this.sendSubscriptionToServer(t),t}async unsubscribe(){let e=await this.getServiceWorkerRegistration();if(!e)return!1;let t=await e.pushManager.getSubscription();if(!t)return!1;let i=await t.unsubscribe();return i&&await this.removeSubscriptionFromServer(t),i}async showNotification(e){if(!this.isSupported()||"granted"!==Notification.permission)return void(0,S.JE)("Cannot show notification: permission not granted");let t=await this.getServiceWorkerRegistration();t?await t.showNotification(e.title,{body:e.body,icon:e.icon||"/images/logo.png",badge:e.badge||"/images/logo.png",data:e.data,actions:e.actions||[],tag:e.tag,requireInteraction:e.requireInteraction,silent:e.silent}):new Notification(e.title,{body:e.body,icon:e.icon||"/images/logo.png",badge:e.badge||"/images/logo.png",data:e.data,tag:e.tag,requireInteraction:e.requireInteraction,silent:e.silent})}async scheduleNotification(e){let t=e.scheduledTime.getTime()-Date.now();if(t<=0)return void this.showNotification(e.payload);this.cancelScheduledNotification(e.id);let i=setTimeout(()=>{this.showNotification(e.payload),this.scheduledNotifications.delete(e.id)},t);this.scheduledNotifications.set(e.id,i);try{let t=await this.getScheduledNotifications();t.push(e),(await fetch("/api/preferences",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"scheduledNotifications",value:t})})).ok||(0,S.JE)("Failed to save scheduled notifications to database")}catch(e){(0,S.JE)("Failed to save scheduled notifications:",e)}}async cancelScheduledNotification(e){let t=this.scheduledNotifications.get(e);t&&(clearTimeout(t),this.scheduledNotifications.delete(e));try{let t=(await this.getScheduledNotifications()).filter(t=>t.id!==e);(await fetch("/api/preferences",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"scheduledNotifications",value:t})})).ok||(0,S.JE)("Failed to update scheduled notifications in database")}catch(e){(0,S.JE)("Failed to update scheduled notifications:",e)}}async getScheduledNotifications(){try{let t=await fetch("/api/preferences");if(t.ok){var e;let i=null==(e=(await t.json()).preferences)?void 0:e.scheduledNotifications;if(i&&Array.isArray(i))return i.map(e=>({...e,scheduledTime:new Date(e.scheduledTime)}))}}catch(e){(0,S.vV)("Error fetching scheduled notifications from database:",e)}return[]}async restoreScheduledNotifications(){let e=await this.getScheduledNotifications(),t=new Date;e.forEach(e=>{e.scheduledTime>t&&this.scheduleNotification(e)})}scheduleTaskReminder(e,t,i,a){let s=new Date(i.getTime()-36e5);s<=new Date||this.scheduleNotification({id:"task_reminder_".concat(e),type:"task_reminder",taskId:e,scheduledTime:s,payload:{title:"".concat("urgent"===a?"\uD83D\uDEA8":"high"===a?"⚡":"\uD83D\uDCCB"," Task Due Soon"),body:'"'.concat(t,'" is due in 1 hour'),icon:"/images/logo.png",badge:"/images/logo.png",tag:"task_".concat(e),requireInteraction:"urgent"===a,vibrate:"urgent"===a?[300,100,300,100,300]:[200,100,200],actions:[{action:"complete_task",title:"Mark Complete",icon:"/images/logo.png"},{action:"view_task",title:"View Task",icon:"/images/logo.png"}],data:{type:"task_reminder",taskId:e,url:"/dashboard/slaylist?task=".concat(e)}}})}scheduleWorkloadAlert(e,t){if(e<80)return;let i=new Date(Date.now()+18e5);this.scheduleNotification({id:"workload_alert_".concat(Date.now()),type:"workload_alert",scheduledTime:i,payload:{title:"\uD83D\uDEA8 High Workload Detected",body:"Your workload score is ".concat(e,"/100. ").concat(t[0]||"Consider taking a break."),icon:"/images/logo.png",badge:"/images/logo.png",tag:"workload_alert",requireInteraction:!0,vibrate:[300,100,300],actions:[{action:"view_dashboard",title:"View Dashboard",icon:"/images/logo.png"},{action:"dismiss",title:"Dismiss",icon:"/images/logo.png"}],data:{type:"workload_alert",url:"/dashboard",workloadScore:e,recommendations:t}}})}async getServiceWorkerRegistration(){if(!("serviceWorker"in navigator))return null;try{return await navigator.serviceWorker.getRegistration()||null}catch(e){return(0,S.vV)("Error getting service worker registration:",e),null}}async sendSubscriptionToServer(e){try{let t={userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language};if(!(await fetch("/api/notifications/push-subscriptions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscription:e.toJSON(),deviceInfo:t})})).ok)throw Error("Failed to send subscription to server")}catch(e){(0,S.vV)("Error sending subscription to server:",e)}}async removeSubscriptionFromServer(e){try{let t=e.toJSON();if(!t.endpoint)return void(0,S.JE)("No endpoint found in subscription data");await fetch("/api/notifications/push-subscriptions?endpoint=".concat(encodeURIComponent(t.endpoint)),{method:"DELETE"})}catch(e){(0,S.vV)("Error removing subscription from server:",e)}}urlB64ToUint8Array(e){let t="=".repeat((4-e.length%4)%4),i=(e+t).replace(/-/g,"+").replace(/_/g,"/"),a=window.atob(i),s=new Uint8Array(a.length);for(let e=0;e<a.length;++e)s[e]=a.charCodeAt(e);return s}constructor(){this.scheduledNotifications=new Map,this.VAPID_PUBLIC_KEY="BEl62iUYgUivxIkv69yViEuiBIa40HvcCXvbdliMKvaV4MV8A3wfUFHVN1oNPROl56W4gNqVIwOqhH7nJ1EIIvg"}}let V=I.getInstance();var z=i(33292);function B(e){let{className:t=""}=e,[i,r]=(0,s.useState)({supported:!1,permission:"default",subscription:null}),[n,c]=(0,s.useState)(!1),{toast:u}=(0,h.dj)(),{preferences:p,loading:f,setPreference:x,setPreferences:g}=(0,z.H)({defaultValues:{notifications:{enabled:!1,taskReminders:!0,goalDeadlines:!0,workloadAlerts:!0,productivityTips:!1,reminderOffset:60,quietHours:{enabled:!1,start:"22:00",end:"08:00"},frequency:"normal"}},fallbackToLocalStorage:!0}),v=p.notifications||{enabled:!1,taskReminders:!0,goalDeadlines:!0,workloadAlerts:!0,productivityTips:!1,reminderOffset:60,quietHours:{enabled:!1,start:"22:00",end:"08:00"},frequency:"normal"};(0,s.useEffect)(()=>{j()},[]);let j=async()=>{try{let e=await V.getPermissionState();r(e)}catch(e){(0,S.vV)("Error loading notification settings:",e)}},y=async e=>{try{await x("notifications",e)}catch(e){(0,S.vV)("Failed to save notification preferences:",e),u({title:"Failed to Save Settings",description:"Your notification preferences could not be saved.",variant:"destructive"})}},N=async()=>{if("granted"!==i.permission)try{c(!0);let e=await V.subscribe();r(t=>({...t,permission:"granted",subscription:e}));let t={...v,enabled:!0};y(t),u({title:"Notifications Enabled",description:"You'll now receive smart reminders and alerts."}),V.showNotification({title:"\uD83C\uDF89 Notifications Enabled!",body:"You'll now receive smart reminders to help you stay productive.",icon:"/images/logo.png",vibrate:[200,100,200]})}catch(e){(0,S.vV)("Error enabling notifications:",e),u({title:"Failed to Enable Notifications",description:e instanceof Error?e.message:"Please check your browser settings.",variant:"destructive"})}finally{c(!1)}else y({...v,enabled:!v.enabled})},b=async()=>{try{i.subscription&&(await V.unsubscribe(),r(e=>({...e,subscription:null})));let e={...v,enabled:!1};y(e),u({title:"Notifications Disabled",description:"You won't receive any more notifications."})}catch(e){(0,S.vV)("Error disabling notifications:",e),u({title:"Error",description:"Failed to disable notifications completely.",variant:"destructive"})}};return f?(0,a.jsx)(l.Zp,{className:t,children:(0,a.jsx)(l.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-4"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})})}):(0,a.jsxs)(l.Zp,{className:t,children:[(0,a.jsx)(l.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(D.A,{className:"w-5 h-5 text-purple-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(l.ZB,{children:"Notification Settings"}),(0,a.jsx)(l.BT,{children:"Manage your push notifications and reminders"})]})]}),(()=>{switch(i.permission){case"granted":return(0,a.jsx)(E.E,{className:"bg-green-100 text-green-800",children:"Enabled"});case"denied":return(0,a.jsx)(E.E,{className:"bg-red-100 text-red-800",children:"Blocked"});default:return(0,a.jsx)(E.E,{className:"bg-gray-100 text-gray-800",children:"Not Requested"})}})()]})}),(0,a.jsxs)(l.Wu,{className:"space-y-6",children:[!i.supported&&(0,a.jsxs)(P.Fc,{variant:"destructive",children:[(0,a.jsx)(m.A,{className:"h-4 w-4"}),(0,a.jsx)(P.XL,{children:"Notifications Not Supported"}),(0,a.jsx)(P.TN,{children:"Your browser doesn't support push notifications. Please use a modern browser like Chrome, Firefox, or Safari."})]}),i.supported&&"denied"===i.permission&&(0,a.jsxs)(P.Fc,{variant:"destructive",children:[(0,a.jsx)(F.A,{className:"h-4 w-4"}),(0,a.jsx)(P.XL,{children:"Notifications Blocked"}),(0,a.jsx)(P.TN,{children:"Notifications are blocked in your browser. Please click the lock icon in your address bar and allow notifications, then refresh this page."})]}),i.supported&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)(d.J,{htmlFor:"notifications-enabled",className:"text-base font-medium",children:"Enable Notifications"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Receive smart reminders and productivity alerts"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["granted"===i.permission&&(0,a.jsx)(o.$,{onClick:()=>{V.showNotification({title:"\uD83E\uDDEA Test Notification",body:"This is how your notifications will look!",icon:"/images/logo.png",vibrate:[200,100,200],actions:[{action:"view",title:"View Dashboard"}]})},variant:"outline",size:"sm",disabled:!v.enabled,children:"Test"}),(0,a.jsx)(A.d,{id:"notifications-enabled",checked:v.enabled&&"granted"===i.permission,onCheckedChange:v.enabled?b:N,disabled:n||"denied"===i.permission})]})]}),v.enabled&&"granted"===i.permission&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"font-medium flex items-center gap-2",children:[(0,a.jsx)(O.A,{className:"w-4 h-4"}),"Notification Types"]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(q.A,{className:"w-4 h-4 text-blue-600"}),(0,a.jsx)(d.J,{children:"Task Reminders"})]}),(0,a.jsx)(A.d,{checked:v.taskReminders,onCheckedChange:e=>y({...v,taskReminders:e})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(U.A,{className:"w-4 h-4 text-green-600"}),(0,a.jsx)(d.J,{children:"Goal Deadlines"})]}),(0,a.jsx)(A.d,{checked:v.goalDeadlines,onCheckedChange:e=>y({...v,goalDeadlines:e})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(_.A,{className:"w-4 h-4 text-orange-600"}),(0,a.jsx)(d.J,{children:"Workload Alerts"})]}),(0,a.jsx)(A.d,{checked:v.workloadAlerts,onCheckedChange:e=>y({...v,workloadAlerts:e})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(R.A,{className:"w-4 h-4 text-purple-600"}),(0,a.jsx)(d.J,{children:"Productivity Tips"})]}),(0,a.jsx)(A.d,{checked:v.productivityTips,onCheckedChange:e=>y({...v,productivityTips:e})})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"font-medium",children:"Reminder Timing"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d.J,{children:["Remind me ",v.reminderOffset," minutes before tasks are due"]}),(0,a.jsx)(T.A,{value:[v.reminderOffset],onValueChange:e=>{let[t]=e;return y({...v,reminderOffset:t})},max:1440,min:5,step:5,className:"w-full"}),(0,a.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,a.jsx)("span",{children:"5 min"}),(0,a.jsx)("span",{children:"24 hours"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{children:"Notification Frequency"}),(0,a.jsxs)(C.l6,{value:v.frequency,onValueChange:e=>y({...v,frequency:e}),children:[(0,a.jsx)(C.bq,{children:(0,a.jsx)(C.yv,{})}),(0,a.jsxs)(C.gC,{children:[(0,a.jsx)(C.eb,{value:"minimal",children:"Minimal"}),(0,a.jsx)(C.eb,{value:"normal",children:"Normal"}),(0,a.jsx)(C.eb,{value:"frequent",children:"Frequent"})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:(e=>{switch(e){case"minimal":return"Only urgent reminders and critical alerts";case"normal":return"Task reminders, deadlines, and workload alerts";case"frequent":return"All notifications including productivity tips";default:return""}})(v.frequency)})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-medium",children:"Quiet Hours"}),(0,a.jsx)(A.d,{checked:v.quietHours.enabled,onCheckedChange:e=>y({...v,quietHours:{...v.quietHours,enabled:e}})})]}),v.quietHours.enabled&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{children:"Start Time"}),(0,a.jsx)("input",{type:"time",value:v.quietHours.start,onChange:e=>y({...v,quietHours:{...v.quietHours,start:e.target.value}}),className:"w-full p-2 border border-gray-300 rounded-md text-sm","aria-label":"Quiet hours start time"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.J,{children:"End Time"}),(0,a.jsx)("input",{type:"time",value:v.quietHours.end,onChange:e=>y({...v,quietHours:{...v.quietHours,end:e.target.value}}),className:"w-full p-2 border border-gray-300 rounded-md text-sm","aria-label":"Quiet hours end time"})]})]})]}),(0,a.jsxs)(P.Fc,{children:[(0,a.jsx)(J.A,{className:"h-4 w-4"}),(0,a.jsx)(P.XL,{children:"Privacy & Security"}),(0,a.jsx)(P.TN,{children:"Notifications are processed locally and only sent when needed. Your notification preferences are stored on your device."})]})]})]})]})}var W=i(95664),L=i(21786),H=i(65229),M=i(15239);let Y=e=>{let{currentAvatar:t,onAvatarChange:i,className:r=""}=e,[n,o]=(0,s.useState)(!1),[l,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),h=(0,s.useRef)(null),m=async e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(!a)return;if(u(null),!a.type.startsWith("image/"))return void u("Please select an image file");if(a.size>5242880)return void u("File size must be under 5MB");let s=URL.createObjectURL(a);c(s);try{o(!0);let e=new FormData;e.append("avatar",a);let t=await fetch("/api/avatar/upload",{method:"POST",headers:{...localStorage.getItem("authToken")?{Authorization:"Bearer ".concat(localStorage.getItem("authToken"))}:{}},body:e}),r=await t.json();if(!t.ok)throw Error(r.error||"Upload failed");null==i||i(r.avatar),URL.revokeObjectURL(s),c(null)}catch(e){(0,S.vV)("Avatar upload error:",e),u(e instanceof Error?e.message:"Upload failed"),URL.revokeObjectURL(s),c(null)}finally{o(!1),h.current&&(h.current.value="")}},x=async()=>{if(t)try{if(o(!0),!(await fetch("/api/unified-briefcase?id=".concat(t.id),{method:"DELETE"})).ok)throw Error("Failed to remove avatar");null==i||i(null)}catch(e){(0,S.vV)("Avatar removal error:",e),u(e instanceof Error?e.message:"Failed to remove avatar")}finally{o(!1)}},g=l||(null==t?void 0:t.url),v=!g&&!n;return(0,a.jsxs)("div",{className:"relative ".concat(r),children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-purple-200 via-pink-200 to-teal-200 border-4 border-white shadow-lg shadow-purple-200/50 overflow-hidden group cursor-pointer hover:shadow-xl hover:shadow-pink-300/60 transition-all duration-300 hover:scale-105",children:v?(0,a.jsxs)("div",{className:"w-full h-full flex items-center justify-center text-purple-400 group-hover:text-pink-500 transition-colors relative",onClick:()=>{var e;return null==(e=h.current)?void 0:e.click()},children:[(0,a.jsx)(p.A,{size:28,className:"relative z-10"}),(0,a.jsx)(y.A,{size:16,className:"absolute top-2 right-2 text-teal-400 animate-pulse"}),(0,a.jsx)(f.A,{size:12,className:"absolute bottom-2 left-2 text-pink-400 animate-bounce"})]}):g?(0,a.jsxs)("div",{className:"relative w-full h-full",children:[(0,a.jsx)(M.default,{src:g,alt:"Profile avatar",fill:!0,className:"object-cover",sizes:"96px"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-500/0 via-pink-500/0 to-teal-500/0 group-hover:from-purple-500/30 group-hover:via-pink-500/30 group-hover:to-teal-500/30 transition-all duration-300 flex items-center justify-center cursor-pointer",onClick:()=>{var e;return null==(e=h.current)?void 0:e.click()},children:(0,a.jsxs)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center gap-1",children:[(0,a.jsx)(W.A,{size:18,className:"text-white drop-shadow-lg"}),(0,a.jsx)(y.A,{size:14,className:"text-white animate-pulse"})]})})]}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-transparent bg-gradient-to-r from-purple-500 to-pink-500 rounded-full"})})}),t&&!n&&(0,a.jsx)("button",{onClick:x,className:"absolute -top-2 -right-2 w-7 h-7 bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white rounded-full flex items-center justify-center transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-110",title:"Remove avatar",children:(0,a.jsx)(H.A,{size:14})})]}),(0,a.jsxs)("div",{className:"mt-4 flex flex-col items-center",children:[(0,a.jsxs)("button",{onClick:()=>{var e;return null==(e=h.current)?void 0:e.click()},disabled:n,className:"flex items-center gap-2 px-6 py-2.5 bg-gradient-to-r from-purple-500 via-pink-500 to-teal-500 hover:from-purple-600 hover:via-pink-600 hover:to-teal-600 disabled:from-gray-300 disabled:via-gray-300 disabled:to-gray-300 text-white rounded-full transition-all duration-300 text-sm font-medium shadow-lg hover:shadow-xl hover:scale-105 group",children:[(0,a.jsx)(L.A,{size:16,className:"group-hover:animate-bounce"}),t?"Change Avatar":"Upload Avatar",(0,a.jsx)(p.A,{size:14,className:"opacity-70"})]}),(0,a.jsx)("p",{className:"text-xs text-purple-600/70 mt-2 text-center font-medium",children:"✨ JPG, PNG or WebP • Max 5MB ✨"})]}),d&&(0,a.jsx)("div",{className:"mt-3 p-3 bg-gradient-to-r from-pink-50 to-purple-50 border border-pink-200 rounded-lg shadow-sm",children:(0,a.jsxs)("p",{className:"text-sm text-pink-600 font-medium flex items-center gap-2",children:[(0,a.jsx)(f.A,{size:14,className:"text-pink-500"}),d]})}),(0,a.jsx)("input",{ref:h,type:"file",accept:"image/*",onChange:m,"aria-label":"Upload avatar image",title:"Upload avatar image",className:"hidden",disabled:n})]})};function Z(){let{user:e,signOut:t,loading:i}=(0,r.A)(),{toast:A}=(0,h.dj)(),{avatar:E,updateAvatar:T}=(()=>{let[e,t]=(0,s.useState)(null),[i,a]=(0,s.useState)(!0),[r,n]=(0,s.useState)(null),o=async()=>{try{a(!0),n(null);let e=await fetch("/api/avatar/upload"),i=await e.json();if(!e.ok){if(401===e.status)return void t(null);throw Error(i.error||"Failed to fetch avatar")}t(i.avatar)}catch(e){(0,S.vV)("Fetch avatar error:",e),n(e instanceof Error?e.message:"Failed to fetch avatar")}finally{a(!1)}};return(0,s.useEffect)(()=>{o()},[]),{avatar:e,loading:i,error:r,refetch:o,updateAvatar:e=>{t(e)}}})(),[C,P]=(0,s.useState)(!1),[D,F]=(0,s.useState)(!1),[q,R]=(0,s.useState)({displayName:(null==e?void 0:e.name)||"",email:(null==e?void 0:e.email)||""}),O=async()=>{if(e){P(!0);try{if(q.displayName!==e.name&&!(await fetch("/api/auth/update-profile",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken"))},body:JSON.stringify({name:q.displayName})})).ok)throw Error("Failed to update profile");A({title:"Profile Updated",description:"Your profile has been successfully updated."})}catch(e){A({title:"Error",description:"Failed to update profile. Please try again.",variant:"destructive"})}finally{P(!1)}}},J=async()=>{try{await t(),A({title:"Signed Out",description:"You have been successfully signed out."})}catch(e){A({title:"Error",description:"Failed to sign out. Please try again.",variant:"destructive"})}},U=async()=>{if(e){F(!0);try{if(!(await fetch("/api/auth/delete-account",{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("authToken"))}})).ok)throw Error("Failed to delete account");A({title:"Account Deleted",description:"Your account has been permanently deleted."}),window.location.href="/"}catch(e){A({title:"Error",description:"Failed to delete account. Please contact support.",variant:"destructive"})}finally{F(!1)}}};return i?(0,a.jsx)("div",{className:"min-h-screen gradient-background p-6 flex items-center justify-center",children:(0,a.jsx)(n.Rh,{variant:"boss",size:"lg",text:"Checking your access..."})}):e?(0,a.jsx)("div",{className:"container mx-auto p-6 max-w-4xl",children:(0,a.jsxs)(w.PY1.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,a.jsxs)("div",{className:"mb-8 text-center",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-4",children:[(0,a.jsx)(p.A,{className:"text-purple-600",size:32}),(0,a.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-purple-600 via-pink-600 to-teal-600 bg-clip-text text-transparent",children:"Account Settings"}),(0,a.jsx)(y.A,{className:"text-teal-600 animate-pulse",size:32})]}),(0,a.jsxs)("p",{className:"text-purple-700/80 font-medium flex items-center justify-center gap-2",children:[(0,a.jsx)(f.A,{size:16,className:"text-pink-500"}),"Manage your account information and preferences, queen!",(0,a.jsx)(f.A,{size:16,className:"text-pink-500"})]})]}),(0,a.jsxs)("div",{className:"grid gap-6",children:[(0,a.jsxs)(l.Zp,{className:"bg-white/90 backdrop-blur-sm border-purple-200 shadow-lg shadow-purple-100/50",children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"flex items-center gap-2 text-purple-900",children:[(0,a.jsx)(p.A,{className:"h-6 w-6 text-purple-600"}),"Your Avatar",(0,a.jsx)(y.A,{className:"h-4 w-4 text-teal-500"})]}),(0,a.jsx)(l.BT,{className:"text-purple-700/80 font-medium",children:"Upload your profile picture to personalize your account"})]}),(0,a.jsx)(l.Wu,{className:"flex justify-center",children:(0,a.jsx)(Y,{currentAvatar:E,onAvatarChange:e=>{T(e),e&&A({title:"Avatar Updated! \uD83D\uDC51",description:"Your profile picture has been updated successfully."})}})})]}),(0,a.jsx)(k.SubscriptionManager,{}),(0,a.jsx)(B,{}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(b.A,{className:"h-5 w-5"}),"Profile Information"]}),(0,a.jsx)(l.BT,{children:"Update your personal information and display name"})]}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"displayName",children:"Display Name"}),(0,a.jsx)(c.p,{id:"displayName",value:q.displayName,onChange:e=>R(t=>({...t,displayName:e.target.value})),placeholder:"Enter your display name"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(d.J,{htmlFor:"email",children:"Email Address"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(v.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)(c.p,{id:"email",value:q.email,disabled:!0,className:"bg-muted"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Email address cannot be changed. Contact support if you need to update it."})]})]}),(0,a.jsxs)(o.$,{onClick:O,disabled:C,className:"w-full sm:w-auto",children:[(0,a.jsx)(j.A,{className:"h-4 w-4 mr-2"}),C?"Saving...":"Save Changes"]})]})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(x.A,{className:"h-5 w-5"}),"Account Actions"]}),(0,a.jsx)(l.BT,{children:"Manage your account security and access"})]}),(0,a.jsx)(l.Wu,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,a.jsxs)(o.$,{variant:"outline",onClick:J,className:"flex items-center gap-2",children:[(0,a.jsx)(g.A,{className:"h-4 w-4"}),"Sign Out"]}),(0,a.jsxs)(u.Lt,{children:[(0,a.jsx)(u.tv,{asChild:!0,children:(0,a.jsxs)(o.$,{variant:"destructive",className:"flex items-center gap-2",children:[(0,a.jsx)(N.A,{className:"h-4 w-4"}),"Delete Account"]})}),(0,a.jsxs)(u.EO,{children:[(0,a.jsxs)(u.wd,{children:[(0,a.jsxs)(u.r7,{className:"flex items-center gap-2",children:[(0,a.jsx)(m.A,{className:"h-5 w-5 text-destructive"}),"Delete Account"]}),(0,a.jsx)(u.$v,{children:"This action cannot be undone. This will permanently delete your account and remove all your data from our servers. All your projects, templates, and settings will be lost forever."})]}),(0,a.jsxs)(u.ck,{children:[(0,a.jsx)(u.Zr,{children:"Cancel"}),(0,a.jsx)(u.Rx,{onClick:U,disabled:D,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:D?"Deleting...":"Delete Account"})]})]})]})]})})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(x.A,{className:"h-5 w-5"}),"Security Information"]}),(0,a.jsx)(l.BT,{children:"Your account security details"})]}),(0,a.jsx)(l.Wu,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:"Account Created"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.created_at?new Date(e.created_at).toLocaleDateString():"Unknown"})]})}),(0,a.jsx)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:"Last Updated"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.updated_at?new Date(e.updated_at).toLocaleDateString():"Unknown"})]})}),(0,a.jsx)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium",children:"User ID"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground font-mono",children:e.id})]})})]})})]})]})]})}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Please sign in to access settings"}),(0,a.jsx)(o.$,{asChild:!0,children:(0,a.jsx)("a",{href:"/signin",children:"Sign In"})})]})})}}},e=>{e.O(0,[6975,4228,3848,9809,8061,2807,1198,1159,5159,23,6529,5593,4180,3976,186,8790,5848,8861,9701,5147,4961,2136,7908,8030,2583,9168,4774,27,6308,563,4696,9173,9219,4409,3376,9765,7650,8920,871,6680,7358],()=>e(e.s=9208)),_N_E=e.O()}]);